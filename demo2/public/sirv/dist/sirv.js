if (!window.Sirv) {
  (function () {
    var _this5 = this;

    window.Sirv = {}; // sirvRequire === require

    var sirvRequirejs = function (window) {
      /** vim: et:ts=4:sw=4:sts=4
      * @license RequireJS 2.3.6 Copyright jQuery Foundation and other contributors.
      * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
      */
      //Not using strict: uneven strict support in browsers, #392, and causes
      //problems with requirejs.exec()/transpiler plugins that may not be strict.

      /*jslint regexp: true, nomen: true, sloppy: true */

      /*global window, navigator, document, importScripts, setTimeout, opera */
      var requirejs, require, define;

      (function (global, setTimeout) {
        var req,
            s,
            head,
            baseElement,
            dataMain,
            src,
            interactiveScript,
            currentlyAddingScript,
            mainScript,
            subPath,
            version = '2.3.6',
            commentRegExp = /\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/mg,
            cjsRequireRegExp = /[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,
            jsSuffixRegExp = /\.js$/,
            currDirRegExp = /^\.\//,
            op = Object.prototype,
            ostring = op.toString,
            hasOwn = op.hasOwnProperty,
            isBrowser = !!(typeof window !== 'undefined' && typeof navigator !== 'undefined' && window.document),
            isWebWorker = !isBrowser && typeof importScripts !== 'undefined',
            //PS3 indicates loaded and complete, but need to wait for complete
        //specifically. Sequence is 'loading', 'loaded', execution,
        // then 'complete'. The UA check is unfortunate, but not sure how
        //to feature test w/o causing perf issues.
        readyRegExp = isBrowser && navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/,
            defContextName = '_',
            //Oh the tragedy, detecting opera. See the usage of isOpera for reason.
        isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]',
            contexts = {},
            cfg = {},
            globalDefQueue = [],
            useInteractive = false; //Could match something like ')//comment', do not lose the prefix to comment.

        function commentReplace(match, singlePrefix) {
          return singlePrefix || '';
        }

        function isFunction(it) {
          return ostring.call(it) === '[object Function]';
        }

        function isArray(it) {
          return ostring.call(it) === '[object Array]';
        }
        /**
         * Helper function for iterating over an array. If the func returns
         * a true value, it will break out of the loop.
         */


        function each(ary, func) {
          if (ary) {
            var i;

            for (i = 0; i < ary.length; i += 1) {
              if (ary[i] && func(ary[i], i, ary)) {
                break;
              }
            }
          }
        }
        /**
         * Helper function for iterating over an array backwards. If the func
         * returns a true value, it will break out of the loop.
         */


        function eachReverse(ary, func) {
          if (ary) {
            var i;

            for (i = ary.length - 1; i > -1; i -= 1) {
              if (ary[i] && func(ary[i], i, ary)) {
                break;
              }
            }
          }
        }

        function hasProp(obj, prop) {
          return hasOwn.call(obj, prop);
        }

        function getOwn(obj, prop) {
          return hasProp(obj, prop) && obj[prop];
        }
        /**
         * Cycles over properties in an object and calls a function for each
         * property value. If the function returns a truthy value, then the
         * iteration is stopped.
         */


        function eachProp(obj, func) {
          var prop;

          for (prop in obj) {
            if (hasProp(obj, prop)) {
              if (func(obj[prop], prop)) {
                break;
              }
            }
          }
        }
        /**
         * Simple function to mix in properties from source into target,
         * but only if target does not already have a property of the same name.
         */


        function mixin(target, source, force, deepStringMixin) {
          if (source) {
            eachProp(source, function (value, prop) {
              if (force || !hasProp(target, prop)) {
                if (deepStringMixin && typeof value === 'object' && value && !isArray(value) && !isFunction(value) && !(value instanceof RegExp)) {
                  if (!target[prop]) {
                    target[prop] = {};
                  }

                  mixin(target[prop], value, force, deepStringMixin);
                } else {
                  target[prop] = value;
                }
              }
            });
          }

          return target;
        } //Similar to Function.prototype.bind, but the 'this' object is specified
        //first, since it is easier to read/figure out what 'this' will be.


        function bind(obj, fn) {
          return function () {
            return fn.apply(obj, arguments);
          };
        }

        function scripts() {
          return document.getElementsByTagName('script');
        }

        function defaultOnError(err) {
          throw err;
        } //Allow getting a global that is expressed in
        //dot notation, like 'a.b.c'.


        function getGlobal(value) {
          if (!value) {
            return value;
          }

          var g = global;
          each(value.split('.'), function (part) {
            g = g[part];
          });
          return g;
        }
        /**
         * Constructs an error with a pointer to an URL with more information.
         * @param {String} id the error ID that maps to an ID on a web page.
         * @param {String} message human readable error.
         * @param {Error} [err] the original error, if there is one.
         *
         * @returns {Error}
         */


        function makeError(id, msg, err, requireModules) {
          var e = new Error(msg + '\nhttps://requirejs.org/docs/errors.html#' + id);
          e.requireType = id;
          e.requireModules = requireModules;

          if (err) {
            e.originalError = err;
          }

          return e;
        }

        if (typeof define !== 'undefined') {
          //If a define is already in play via another AMD loader,
          //do not overwrite.
          return;
        }

        if (typeof requirejs !== 'undefined') {
          if (isFunction(requirejs)) {
            //Do not overwrite an existing requirejs instance.
            return;
          }

          cfg = requirejs;
          requirejs = undefined;
        } //Allow for a require config object


        if (typeof require !== 'undefined' && !isFunction(require)) {
          //assume it is a config object.
          cfg = require;
          require = undefined;
        }

        function newContext(contextName) {
          var inCheckLoaded,
              Module,
              context,
              handlers,
              checkLoadedTimeoutId,
              config = {
            //Defaults. Do not set a default for map
            //config to speed up normalize(), which
            //will run faster if there is no default.
            waitSeconds: 7,
            baseUrl: './',
            paths: {},
            bundles: {},
            pkgs: {},
            shim: {},
            config: {}
          },
              registry = {},
              //registry of just enabled modules, to speed
          //cycle breaking code when lots of modules
          //are registered, but not activated.
          enabledRegistry = {},
              undefEvents = {},
              defQueue = [],
              defined = {},
              urlFetched = {},
              bundlesMap = {},
              requireCounter = 1,
              unnormalizedCounter = 1;
          /**
           * Trims the . and .. from an array of path segments.
           * It will keep a leading path segment if a .. will become
           * the first path segment, to help with module name lookups,
           * which act like paths, but can be remapped. But the end result,
           * all paths that use this function should look normalized.
           * NOTE: this method MODIFIES the input array.
           * @param {Array} ary the array of path segments.
           */

          function trimDots(ary) {
            var i, part;

            for (i = 0; i < ary.length; i++) {
              part = ary[i];

              if (part === '.') {
                ary.splice(i, 1);
                i -= 1;
              } else if (part === '..') {
                // If at the start, or previous value is still ..,
                // keep them so that when converted to a path it may
                // still work when converted to a path, even though
                // as an ID it is less than ideal. In larger point
                // releases, may be better to just kick out an error.
                if (i === 0 || i === 1 && ary[2] === '..' || ary[i - 1] === '..') {
                  continue;
                } else if (i > 0) {
                  ary.splice(i - 1, 2);
                  i -= 2;
                }
              }
            }
          }
          /**
           * Given a relative module name, like ./something, normalize it to
           * a real name that can be mapped to a path.
           * @param {String} name the relative name
           * @param {String} baseName a real name that the name arg is relative
           * to.
           * @param {Boolean} applyMap apply the map config to the value. Should
           * only be done if this normalization is for a dependency ID.
           * @returns {String} normalized name
           */


          function normalize(name, baseName, applyMap) {
            var pkgMain,
                mapValue,
                nameParts,
                i,
                j,
                nameSegment,
                lastIndex,
                foundMap,
                foundI,
                foundStarMap,
                starI,
                normalizedBaseParts,
                baseParts = baseName && baseName.split('/'),
                map = config.map,
                starMap = map && map['*']; //Adjust any relative paths.

            if (name) {
              name = name.split('/');
              lastIndex = name.length - 1; // If wanting node ID compatibility, strip .js from end
              // of IDs. Have to do this here, and not in nameToUrl
              // because node allows either .js or non .js to map
              // to same file.

              if (config.nodeIdCompat && jsSuffixRegExp.test(name[lastIndex])) {
                name[lastIndex] = name[lastIndex].replace(jsSuffixRegExp, '');
              } // Starts with a '.' so need the baseName


              if (name[0].charAt(0) === '.' && baseParts) {
                //Convert baseName to array, and lop off the last part,
                //so that . matches that 'directory' and not name of the baseName's
                //module. For instance, baseName of 'one/two/three', maps to
                //'one/two/three.js', but we want the directory, 'one/two' for
                //this normalization.
                normalizedBaseParts = baseParts.slice(0, baseParts.length - 1);
                name = normalizedBaseParts.concat(name);
              }

              trimDots(name);
              name = name.join('/');
            } //Apply map config if available.


            if (applyMap && map && (baseParts || starMap)) {
              nameParts = name.split('/');

              outerLoop: for (i = nameParts.length; i > 0; i -= 1) {
                nameSegment = nameParts.slice(0, i).join('/');

                if (baseParts) {
                  //Find the longest baseName segment match in the config.
                  //So, do joins on the biggest to smallest lengths of baseParts.
                  for (j = baseParts.length; j > 0; j -= 1) {
                    mapValue = getOwn(map, baseParts.slice(0, j).join('/')); //baseName segment has config, find if it has one for
                    //this name.

                    if (mapValue) {
                      mapValue = getOwn(mapValue, nameSegment);

                      if (mapValue) {
                        //Match, update name to the new value.
                        foundMap = mapValue;
                        foundI = i;
                        break outerLoop;
                      }
                    }
                  }
                } //Check for a star map match, but just hold on to it,
                //if there is a shorter segment match later in a matching
                //config, then favor over this star map.


                if (!foundStarMap && starMap && getOwn(starMap, nameSegment)) {
                  foundStarMap = getOwn(starMap, nameSegment);
                  starI = i;
                }
              }

              if (!foundMap && foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
              }

              if (foundMap) {
                nameParts.splice(0, foundI, foundMap);
                name = nameParts.join('/');
              }
            } // If the name points to a package's name, use
            // the package main instead.


            pkgMain = getOwn(config.pkgs, name);
            return pkgMain ? pkgMain : name;
          }

          function removeScript(name) {
            if (isBrowser) {
              each(scripts(), function (scriptNode) {
                if (scriptNode.getAttribute('data-requiremodule') === name && scriptNode.getAttribute('data-requirecontext') === context.contextName) {
                  scriptNode.parentNode.removeChild(scriptNode);
                  return true;
                }
              });
            }
          }

          function hasPathFallback(id) {
            var pathConfig = getOwn(config.paths, id);

            if (pathConfig && isArray(pathConfig) && pathConfig.length > 1) {
              //Pop off the first array value, since it failed, and
              //retry
              pathConfig.shift();

              context.require.undef(id); //Custom require that does not do map translation, since
              //ID is "absolute", already mapped/resolved.


              context.makeRequire(null, {
                skipMap: true
              })([id]);
              return true;
            }
          } //Turns a plugin!resource to [plugin, resource]
          //with the plugin being undefined if the name
          //did not have a plugin prefix.


          function splitPrefix(name) {
            var prefix,
                index = name ? name.indexOf('!') : -1;

            if (index > -1) {
              prefix = name.substring(0, index);
              name = name.substring(index + 1, name.length);
            }

            return [prefix, name];
          }
          /**
           * Creates a module mapping that includes plugin prefix, module
           * name, and path. If parentModuleMap is provided it will
           * also normalize the name via require.normalize()
           *
           * @param {String} name the module name
           * @param {String} [parentModuleMap] parent module map
           * for the module name, used to resolve relative names.
           * @param {Boolean} isNormalized: is the ID already normalized.
           * This is true if this call is done for a define() module ID.
           * @param {Boolean} applyMap: apply the map config to the ID.
           * Should only be true if this map is for a dependency.
           *
           * @returns {Object}
           */


          function makeModuleMap(name, parentModuleMap, isNormalized, applyMap) {
            var url,
                pluginModule,
                suffix,
                nameParts,
                prefix = null,
                parentName = parentModuleMap ? parentModuleMap.name : null,
                originalName = name,
                isDefine = true,
                normalizedName = ''; //If no name, then it means it is a require call, generate an
            //internal name.

            if (!name) {
              isDefine = false;
              name = '_@r' + (requireCounter += 1);
            }

            nameParts = splitPrefix(name);
            prefix = nameParts[0];
            name = nameParts[1];

            if (prefix) {
              prefix = normalize(prefix, parentName, applyMap);
              pluginModule = getOwn(defined, prefix);
            } //Account for relative paths if there is a base name.


            if (name) {
              if (prefix) {
                if (isNormalized) {
                  normalizedName = name;
                } else if (pluginModule && pluginModule.normalize) {
                  //Plugin is loaded, use its normalize method.
                  normalizedName = pluginModule.normalize(name, function (name) {
                    return normalize(name, parentName, applyMap);
                  });
                } else {
                  // If nested plugin references, then do not try to
                  // normalize, as it will not normalize correctly. This
                  // places a restriction on resourceIds, and the longer
                  // term solution is not to normalize until plugins are
                  // loaded and all normalizations to allow for async
                  // loading of a loader plugin. But for now, fixes the
                  // common uses. Details in #1131
                  normalizedName = name.indexOf('!') === -1 ? normalize(name, parentName, applyMap) : name;
                }
              } else {
                //A regular module.
                normalizedName = normalize(name, parentName, applyMap); //Normalized name may be a plugin ID due to map config
                //application in normalize. The map config values must
                //already be normalized, so do not need to redo that part.

                nameParts = splitPrefix(normalizedName);
                prefix = nameParts[0];
                normalizedName = nameParts[1];
                isNormalized = true;
                url = context.nameToUrl(normalizedName);
              }
            } //If the id is a plugin id that cannot be determined if it needs
            //normalization, stamp it with a unique ID so two matching relative
            //ids that may conflict can be separate.


            suffix = prefix && !pluginModule && !isNormalized ? '_unnormalized' + (unnormalizedCounter += 1) : '';
            return {
              prefix: prefix,
              name: normalizedName,
              parentMap: parentModuleMap,
              unnormalized: !!suffix,
              url: url,
              originalName: originalName,
              isDefine: isDefine,
              id: (prefix ? prefix + '!' + normalizedName : normalizedName) + suffix
            };
          }

          function getModule(depMap) {
            var id = depMap.id,
                mod = getOwn(registry, id);

            if (!mod) {
              mod = registry[id] = new context.Module(depMap);
            }

            return mod;
          }

          function on(depMap, name, fn) {
            var id = depMap.id,
                mod = getOwn(registry, id);

            if (hasProp(defined, id) && (!mod || mod.defineEmitComplete)) {
              if (name === 'defined') {
                fn(defined[id]);
              }
            } else {
              mod = getModule(depMap);

              if (mod.error && name === 'error') {
                fn(mod.error);
              } else {
                mod.on(name, fn);
              }
            }
          }

          function onError(err, errback) {
            var ids = err.requireModules,
                notified = false;

            if (errback) {
              errback(err);
            } else {
              each(ids, function (id) {
                var mod = getOwn(registry, id);

                if (mod) {
                  //Set error on module, so it skips timeout checks.
                  mod.error = err;

                  if (mod.events.error) {
                    notified = true;
                    mod.emit('error', err);
                  }
                }
              });

              if (!notified) {
                req.onError(err);
              }
            }
          }
          /**
           * Internal method to transfer globalQueue items to this context's
           * defQueue.
           */


          function takeGlobalQueue() {
            //Push all the globalDefQueue items into the context's defQueue
            if (globalDefQueue.length) {
              each(globalDefQueue, function (queueItem) {
                var id = queueItem[0];

                if (typeof id === 'string') {
                  context.defQueueMap[id] = true;
                }

                defQueue.push(queueItem);
              });
              globalDefQueue = [];
            }
          }

          handlers = {
            'require': function (mod) {
              if (mod.require) {
                return mod.require;
              } else {
                return mod.require = context.makeRequire(mod.map);
              }
            },
            'exports': function (mod) {
              mod.usingExports = true;

              if (mod.map.isDefine) {
                if (mod.exports) {
                  return defined[mod.map.id] = mod.exports;
                } else {
                  return mod.exports = defined[mod.map.id] = {};
                }
              }
            },
            'module': function (mod) {
              if (mod.module) {
                return mod.module;
              } else {
                return mod.module = {
                  id: mod.map.id,
                  uri: mod.map.url,
                  config: function () {
                    return getOwn(config.config, mod.map.id) || {};
                  },
                  exports: mod.exports || (mod.exports = {})
                };
              }
            }
          };

          function cleanRegistry(id) {
            //Clean up machinery used for waiting modules.
            delete registry[id];
            delete enabledRegistry[id];
          }

          function breakCycle(mod, traced, processed) {
            var id = mod.map.id;

            if (mod.error) {
              mod.emit('error', mod.error);
            } else {
              traced[id] = true;
              each(mod.depMaps, function (depMap, i) {
                var depId = depMap.id,
                    dep = getOwn(registry, depId); //Only force things that have not completed
                //being defined, so still in the registry,
                //and only if it has not been matched up
                //in the module already.

                if (dep && !mod.depMatched[i] && !processed[depId]) {
                  if (getOwn(traced, depId)) {
                    mod.defineDep(i, defined[depId]);
                    mod.check(); //pass false?
                  } else {
                    breakCycle(dep, traced, processed);
                  }
                }
              });
              processed[id] = true;
            }
          }

          function checkLoaded() {
            var err,
                usingPathFallback,
                waitInterval = config.waitSeconds * 1000,
                //It is possible to disable the wait interval by using waitSeconds of 0.
            expired = waitInterval && context.startTime + waitInterval < new Date().getTime(),
                noLoads = [],
                reqCalls = [],
                stillLoading = false,
                needCycleCheck = true; //Do not bother if this call was a result of a cycle break.

            if (inCheckLoaded) {
              return;
            }

            inCheckLoaded = true; //Figure out the state of all the modules.

            eachProp(enabledRegistry, function (mod) {
              var map = mod.map,
                  modId = map.id; //Skip things that are not enabled or in error state.

              if (!mod.enabled) {
                return;
              }

              if (!map.isDefine) {
                reqCalls.push(mod);
              }

              if (!mod.error) {
                //If the module should be executed, and it has not
                //been inited and time is up, remember it.
                if (!mod.inited && expired) {
                  if (hasPathFallback(modId)) {
                    usingPathFallback = true;
                    stillLoading = true;
                  } else {
                    noLoads.push(modId);
                    removeScript(modId);
                  }
                } else if (!mod.inited && mod.fetched && map.isDefine) {
                  stillLoading = true;

                  if (!map.prefix) {
                    //No reason to keep looking for unfinished
                    //loading. If the only stillLoading is a
                    //plugin resource though, keep going,
                    //because it may be that a plugin resource
                    //is waiting on a non-plugin cycle.
                    return needCycleCheck = false;
                  }
                }
              }
            });

            if (expired && noLoads.length) {
              //If wait time expired, throw error of unloaded modules.
              err = makeError('timeout', 'Load timeout for modules: ' + noLoads, null, noLoads);
              err.contextName = context.contextName;
              return onError(err);
            } //Not expired, check for a cycle.


            if (needCycleCheck) {
              each(reqCalls, function (mod) {
                breakCycle(mod, {}, {});
              });
            } //If still waiting on loads, and the waiting load is something
            //other than a plugin resource, or there are still outstanding
            //scripts, then just try back later.


            if ((!expired || usingPathFallback) && stillLoading) {
              //Something is still waiting to load. Wait for it, but only
              //if a timeout is not already in effect.
              if ((isBrowser || isWebWorker) && !checkLoadedTimeoutId) {
                checkLoadedTimeoutId = setTimeout(function () {
                  checkLoadedTimeoutId = 0;
                  checkLoaded();
                }, 50);
              }
            }

            inCheckLoaded = false;
          }

          Module = function (map) {
            this.events = getOwn(undefEvents, map.id) || {};
            this.map = map;
            this.shim = getOwn(config.shim, map.id);
            this.depExports = [];
            this.depMaps = [];
            this.depMatched = [];
            this.pluginMaps = {};
            this.depCount = 0;
            /* this.exports this.factory
               this.depMaps = [],
               this.enabled, this.fetched
            */
          };

          Module.prototype = {
            init: function (depMaps, factory, errback, options) {
              options = options || {}; //Do not do more inits if already done. Can happen if there
              //are multiple define calls for the same module. That is not
              //a normal, common case, but it is also not unexpected.

              if (this.inited) {
                return;
              }

              this.factory = factory;

              if (errback) {
                //Register for errors on this module.
                this.on('error', errback);
              } else if (this.events.error) {
                //If no errback already, but there are error listeners
                //on this module, set up an errback to pass to the deps.
                errback = bind(this, function (err) {
                  this.emit('error', err);
                });
              } //Do a copy of the dependency array, so that
              //source inputs are not modified. For example
              //"shim" deps are passed in here directly, and
              //doing a direct modification of the depMaps array
              //would affect that config.


              this.depMaps = depMaps && depMaps.slice(0);
              this.errback = errback; //Indicate this module has be initialized

              this.inited = true;
              this.ignore = options.ignore; //Could have option to init this module in enabled mode,
              //or could have been previously marked as enabled. However,
              //the dependencies are not known until init is called. So
              //if enabled previously, now trigger dependencies as enabled.

              if (options.enabled || this.enabled) {
                //Enable this module and dependencies.
                //Will call this.check()
                this.enable();
              } else {
                this.check();
              }
            },
            defineDep: function (i, depExports) {
              //Because of cycles, defined callback for a given
              //export can be called more than once.
              if (!this.depMatched[i]) {
                this.depMatched[i] = true;
                this.depCount -= 1;
                this.depExports[i] = depExports;
              }
            },
            fetch: function () {
              if (this.fetched) {
                return;
              }

              this.fetched = true;
              context.startTime = new Date().getTime();
              var map = this.map; //If the manager is for a plugin managed resource,
              //ask the plugin to load it now.

              if (this.shim) {
                context.makeRequire(this.map, {
                  enableBuildCallback: true
                })(this.shim.deps || [], bind(this, function () {
                  return map.prefix ? this.callPlugin() : this.load();
                }));
              } else {
                //Regular dependency.
                return map.prefix ? this.callPlugin() : this.load();
              }
            },
            load: function () {
              var url = this.map.url; //Regular dependency.

              if (!urlFetched[url]) {
                urlFetched[url] = true;
                context.load(this.map.id, url);
              }
            },

            /**
             * Checks if the module is ready to define itself, and if so,
             * define it.
             */
            check: function () {
              if (!this.enabled || this.enabling) {
                return;
              }

              var err,
                  cjsModule,
                  id = this.map.id,
                  depExports = this.depExports,
                  exports = this.exports,
                  factory = this.factory;

              if (!this.inited) {
                // Only fetch if not already in the defQueue.
                if (!hasProp(context.defQueueMap, id)) {
                  this.fetch();
                }
              } else if (this.error) {
                this.emit('error', this.error);
              } else if (!this.defining) {
                //The factory could trigger another require call
                //that would result in checking this module to
                //define itself again. If already in the process
                //of doing that, skip this work.
                this.defining = true;

                if (this.depCount < 1 && !this.defined) {
                  if (isFunction(factory)) {
                    //If there is an error listener, favor passing
                    //to that instead of throwing an error. However,
                    //only do it for define()'d  modules. require
                    //errbacks should not be called for failures in
                    //their callbacks (#699). However if a global
                    //onError is set, use that.
                    if (this.events.error && this.map.isDefine || req.onError !== defaultOnError) {
                      try {
                        exports = context.execCb(id, factory, depExports, exports);
                      } catch (e) {
                        err = e;
                      }
                    } else {
                      exports = context.execCb(id, factory, depExports, exports);
                    } // Favor return value over exports. If node/cjs in play,
                    // then will not have a return value anyway. Favor
                    // module.exports assignment over exports object.


                    if (this.map.isDefine && exports === undefined) {
                      cjsModule = this.module;

                      if (cjsModule) {
                        exports = cjsModule.exports;
                      } else if (this.usingExports) {
                        //exports already set the defined value.
                        exports = this.exports;
                      }
                    }

                    if (err) {
                      err.requireMap = this.map;
                      err.requireModules = this.map.isDefine ? [this.map.id] : null;
                      err.requireType = this.map.isDefine ? 'define' : 'require';
                      return onError(this.error = err);
                    }
                  } else {
                    //Just a literal value
                    exports = factory;
                  }

                  this.exports = exports;

                  if (this.map.isDefine && !this.ignore) {
                    defined[id] = exports;

                    if (req.onResourceLoad) {
                      var resLoadMaps = [];
                      each(this.depMaps, function (depMap) {
                        resLoadMaps.push(depMap.normalizedMap || depMap);
                      });
                      req.onResourceLoad(context, this.map, resLoadMaps);
                    }
                  } //Clean up


                  cleanRegistry(id);
                  this.defined = true;
                } //Finished the define stage. Allow calling check again
                //to allow define notifications below in the case of a
                //cycle.


                this.defining = false;

                if (this.defined && !this.defineEmitted) {
                  this.defineEmitted = true;
                  this.emit('defined', this.exports);
                  this.defineEmitComplete = true;
                }
              }
            },
            callPlugin: function () {
              var map = this.map,
                  id = map.id,
                  //Map already normalized the prefix.
              pluginMap = makeModuleMap(map.prefix); //Mark this as a dependency for this plugin, so it
              //can be traced for cycles.

              this.depMaps.push(pluginMap);
              on(pluginMap, 'defined', bind(this, function (plugin) {
                var load,
                    normalizedMap,
                    normalizedMod,
                    bundleId = getOwn(bundlesMap, this.map.id),
                    name = this.map.name,
                    parentName = this.map.parentMap ? this.map.parentMap.name : null,
                    localRequire = context.makeRequire(map.parentMap, {
                  enableBuildCallback: true
                }); //If current map is not normalized, wait for that
                //normalized name to load instead of continuing.

                if (this.map.unnormalized) {
                  //Normalize the ID if the plugin allows it.
                  if (plugin.normalize) {
                    name = plugin.normalize(name, function (name) {
                      return normalize(name, parentName, true);
                    }) || '';
                  } //prefix and name should already be normalized, no need
                  //for applying map config again either.


                  normalizedMap = makeModuleMap(map.prefix + '!' + name, this.map.parentMap, true);
                  on(normalizedMap, 'defined', bind(this, function (value) {
                    this.map.normalizedMap = normalizedMap;
                    this.init([], function () {
                      return value;
                    }, null, {
                      enabled: true,
                      ignore: true
                    });
                  }));
                  normalizedMod = getOwn(registry, normalizedMap.id);

                  if (normalizedMod) {
                    //Mark this as a dependency for this plugin, so it
                    //can be traced for cycles.
                    this.depMaps.push(normalizedMap);

                    if (this.events.error) {
                      normalizedMod.on('error', bind(this, function (err) {
                        this.emit('error', err);
                      }));
                    }

                    normalizedMod.enable();
                  }

                  return;
                } //If a paths config, then just load that file instead to
                //resolve the plugin, as it is built into that paths layer.


                if (bundleId) {
                  this.map.url = context.nameToUrl(bundleId);
                  this.load();
                  return;
                }

                load = bind(this, function (value) {
                  this.init([], function () {
                    return value;
                  }, null, {
                    enabled: true
                  });
                });
                load.error = bind(this, function (err) {
                  this.inited = true;
                  this.error = err;
                  err.requireModules = [id]; //Remove temp unnormalized modules for this module,
                  //since they will never be resolved otherwise now.

                  eachProp(registry, function (mod) {
                    if (mod.map.id.indexOf(id + '_unnormalized') === 0) {
                      cleanRegistry(mod.map.id);
                    }
                  });
                  onError(err);
                }); //Allow plugins to load other code without having to know the
                //context or how to 'complete' the load.

                load.fromText = bind(this, function (text, textAlt) {
                  /*jslint evil: true */
                  var moduleName = map.name,
                      moduleMap = makeModuleMap(moduleName),
                      hasInteractive = useInteractive; //As of 2.1.0, support just passing the text, to reinforce
                  //fromText only being called once per resource. Still
                  //support old style of passing moduleName but discard
                  //that moduleName in favor of the internal ref.

                  if (textAlt) {
                    text = textAlt;
                  } //Turn off interactive script matching for IE for any define
                  //calls in the text, then turn it back on at the end.


                  if (hasInteractive) {
                    useInteractive = false;
                  } //Prime the system by creating a module instance for
                  //it.


                  getModule(moduleMap); //Transfer any config to this other module.

                  if (hasProp(config.config, id)) {
                    config.config[moduleName] = config.config[id];
                  }

                  try {
                    req.exec(text);
                  } catch (e) {
                    return onError(makeError('fromtexteval', 'fromText eval for ' + id + ' failed: ' + e, e, [id]));
                  }

                  if (hasInteractive) {
                    useInteractive = true;
                  } //Mark this as a dependency for the plugin
                  //resource


                  this.depMaps.push(moduleMap); //Support anonymous modules.

                  context.completeLoad(moduleName); //Bind the value of that module to the value for this
                  //resource ID.

                  localRequire([moduleName], load);
                }); //Use parentName here since the plugin's name is not reliable,
                //could be some weird string with no path that actually wants to
                //reference the parentName's path.

                plugin.load(map.name, localRequire, load, config);
              }));
              context.enable(pluginMap, this);
              this.pluginMaps[pluginMap.id] = pluginMap;
            },
            enable: function () {
              enabledRegistry[this.map.id] = this;
              this.enabled = true; //Set flag mentioning that the module is enabling,
              //so that immediate calls to the defined callbacks
              //for dependencies do not trigger inadvertent load
              //with the depCount still being zero.

              this.enabling = true; //Enable each dependency

              each(this.depMaps, bind(this, function (depMap, i) {
                var id, mod, handler;

                if (typeof depMap === 'string') {
                  //Dependency needs to be converted to a depMap
                  //and wired up to this module.
                  depMap = makeModuleMap(depMap, this.map.isDefine ? this.map : this.map.parentMap, false, !this.skipMap);
                  this.depMaps[i] = depMap;
                  handler = getOwn(handlers, depMap.id);

                  if (handler) {
                    this.depExports[i] = handler(this);
                    return;
                  }

                  this.depCount += 1;
                  on(depMap, 'defined', bind(this, function (depExports) {
                    if (this.undefed) {
                      return;
                    }

                    this.defineDep(i, depExports);
                    this.check();
                  }));

                  if (this.errback) {
                    on(depMap, 'error', bind(this, this.errback));
                  } else if (this.events.error) {
                    // No direct errback on this module, but something
                    // else is listening for errors, so be sure to
                    // propagate the error correctly.
                    on(depMap, 'error', bind(this, function (err) {
                      this.emit('error', err);
                    }));
                  }
                }

                id = depMap.id;
                mod = registry[id]; //Skip special modules like 'require', 'exports', 'module'
                //Also, don't call enable if it is already enabled,
                //important in circular dependency cases.

                if (!hasProp(handlers, id) && mod && !mod.enabled) {
                  context.enable(depMap, this);
                }
              })); //Enable each plugin that is used in
              //a dependency

              eachProp(this.pluginMaps, bind(this, function (pluginMap) {
                var mod = getOwn(registry, pluginMap.id);

                if (mod && !mod.enabled) {
                  context.enable(pluginMap, this);
                }
              }));
              this.enabling = false;
              this.check();
            },
            on: function (name, cb) {
              var cbs = this.events[name];

              if (!cbs) {
                cbs = this.events[name] = [];
              }

              cbs.push(cb);
            },
            emit: function (name, evt) {
              each(this.events[name], function (cb) {
                cb(evt);
              });

              if (name === 'error') {
                //Now that the error handler was triggered, remove
                //the listeners, since this broken Module instance
                //can stay around for a while in the registry.
                delete this.events[name];
              }
            }
          };

          function callGetModule(args) {
            //Skip modules already defined.
            if (!hasProp(defined, args[0])) {
              getModule(makeModuleMap(args[0], null, true)).init(args[1], args[2]);
            }
          }

          function removeListener(node, func, name, ieName) {
            //Favor detachEvent because of IE9
            //issue, see attachEvent/addEventListener comment elsewhere
            //in this file.
            if (node.detachEvent && !isOpera) {
              //Probably IE. If not it will throw an error, which will be
              //useful to know.
              if (ieName) {
                node.detachEvent(ieName, func);
              }
            } else {
              node.removeEventListener(name, func, false);
            }
          }
          /**
           * Given an event from a script node, get the requirejs info from it,
           * and then removes the event listeners on the node.
           * @param {Event} evt
           * @returns {Object}
           */


          function getScriptData(evt) {
            //Using currentTarget instead of target for Firefox 2.0's sake. Not
            //all old browsers will be supported, but this one was easy enough
            //to support and still makes sense.
            var node = evt.currentTarget || evt.srcElement; //Remove the listeners once here.

            removeListener(node, context.onScriptLoad, 'load', 'onreadystatechange');
            removeListener(node, context.onScriptError, 'error');
            return {
              node: node,
              id: node && node.getAttribute('data-requiremodule')
            };
          }

          function intakeDefines() {
            var args; //Any defined modules in the global queue, intake them now.

            takeGlobalQueue(); //Make sure any remaining defQueue items get properly processed.

            while (defQueue.length) {
              args = defQueue.shift();

              if (args[0] === null) {
                return onError(makeError('mismatch', 'Mismatched anonymous define() module: ' + args[args.length - 1]));
              } else {
                //args are id, deps, factory. Should be normalized by the
                //define() function.
                callGetModule(args);
              }
            }

            context.defQueueMap = {};
          }

          context = {
            config: config,
            contextName: contextName,
            registry: registry,
            defined: defined,
            urlFetched: urlFetched,
            defQueue: defQueue,
            defQueueMap: {},
            Module: Module,
            makeModuleMap: makeModuleMap,
            nextTick: req.nextTick,
            onError: onError,

            /**
             * Set a configuration for the context.
             * @param {Object} cfg config object to integrate.
             */
            configure: function (cfg) {
              //Make sure the baseUrl ends in a slash.
              if (cfg.baseUrl) {
                if (cfg.baseUrl.charAt(cfg.baseUrl.length - 1) !== '/') {
                  cfg.baseUrl += '/';
                }
              } // Convert old style urlArgs string to a function.


              if (typeof cfg.urlArgs === 'string') {
                var urlArgs = cfg.urlArgs;

                cfg.urlArgs = function (id, url) {
                  return (url.indexOf('?') === -1 ? '?' : '&') + urlArgs;
                };
              } //Save off the paths since they require special processing,
              //they are additive.


              var shim = config.shim,
                  objs = {
                paths: true,
                bundles: true,
                config: true,
                map: true
              };
              eachProp(cfg, function (value, prop) {
                if (objs[prop]) {
                  if (!config[prop]) {
                    config[prop] = {};
                  }

                  mixin(config[prop], value, true, true);
                } else {
                  config[prop] = value;
                }
              }); //Reverse map the bundles

              if (cfg.bundles) {
                eachProp(cfg.bundles, function (value, prop) {
                  each(value, function (v) {
                    if (v !== prop) {
                      bundlesMap[v] = prop;
                    }
                  });
                });
              } //Merge shim


              if (cfg.shim) {
                eachProp(cfg.shim, function (value, id) {
                  //Normalize the structure
                  if (isArray(value)) {
                    value = {
                      deps: value
                    };
                  }

                  if ((value.exports || value.init) && !value.exportsFn) {
                    value.exportsFn = context.makeShimExports(value);
                  }

                  shim[id] = value;
                });
                config.shim = shim;
              } //Adjust packages if necessary.


              if (cfg.packages) {
                each(cfg.packages, function (pkgObj) {
                  var location, name;
                  pkgObj = typeof pkgObj === 'string' ? {
                    name: pkgObj
                  } : pkgObj;
                  name = pkgObj.name;
                  location = pkgObj.location;

                  if (location) {
                    config.paths[name] = pkgObj.location;
                  } //Save pointer to main module ID for pkg name.
                  //Remove leading dot in main, so main paths are normalized,
                  //and remove any trailing .js, since different package
                  //envs have different conventions: some use a module name,
                  //some use a file name.


                  config.pkgs[name] = pkgObj.name + '/' + (pkgObj.main || 'main').replace(currDirRegExp, '').replace(jsSuffixRegExp, '');
                });
              } //If there are any "waiting to execute" modules in the registry,
              //update the maps for them, since their info, like URLs to load,
              //may have changed.


              eachProp(registry, function (mod, id) {
                //If module already has init called, since it is too
                //late to modify them, and ignore unnormalized ones
                //since they are transient.
                if (!mod.inited && !mod.map.unnormalized) {
                  mod.map = makeModuleMap(id, null, true);
                }
              }); //If a deps array or a config callback is specified, then call
              //require with those args. This is useful when require is defined as a
              //config object before require.js is loaded.

              if (cfg.deps || cfg.callback) {
                context.require(cfg.deps || [], cfg.callback);
              }
            },
            makeShimExports: function (value) {
              function fn() {
                var ret;

                if (value.init) {
                  ret = value.init.apply(global, arguments);
                }

                return ret || value.exports && getGlobal(value.exports);
              }

              return fn;
            },
            makeRequire: function (relMap, options) {
              options = options || {};

              function localRequire(deps, callback, errback) {
                var id, map, requireMod;

                if (options.enableBuildCallback && callback && isFunction(callback)) {
                  callback.__requireJsBuild = true;
                }

                if (typeof deps === 'string') {
                  if (isFunction(callback)) {
                    //Invalid call
                    return onError(makeError('requireargs', 'Invalid require call'), errback);
                  } //If require|exports|module are requested, get the
                  //value for them from the special handlers. Caveat:
                  //this only works while module is being defined.


                  if (relMap && hasProp(handlers, deps)) {
                    return handlers[deps](registry[relMap.id]);
                  } //Synchronous access to one module. If require.get is
                  //available (as in the Node adapter), prefer that.


                  if (req.get) {
                    return req.get(context, deps, relMap, localRequire);
                  } //Normalize module name, if it contains . or ..


                  map = makeModuleMap(deps, relMap, false, true);
                  id = map.id;

                  if (!hasProp(defined, id)) {
                    return onError(makeError('notloaded', 'Module name "' + id + '" has not been loaded yet for context: ' + contextName + (relMap ? '' : '. Use require([])')));
                  }

                  return defined[id];
                } //Grab defines waiting in the global queue.


                intakeDefines(); //Mark all the dependencies as needing to be loaded.

                context.nextTick(function () {
                  //Some defines could have been added since the
                  //require call, collect them.
                  intakeDefines();
                  requireMod = getModule(makeModuleMap(null, relMap)); //Store if map config should be applied to this require
                  //call for dependencies.

                  requireMod.skipMap = options.skipMap;
                  requireMod.init(deps, callback, errback, {
                    enabled: true
                  });
                  checkLoaded();
                });
                return localRequire;
              }

              mixin(localRequire, {
                isBrowser: isBrowser,

                /**
                 * Converts a module name + .extension into an URL path.
                 * *Requires* the use of a module name. It does not support using
                 * plain URLs like nameToUrl.
                 */
                toUrl: function (moduleNamePlusExt) {
                  var ext,
                      index = moduleNamePlusExt.lastIndexOf('.'),
                      segment = moduleNamePlusExt.split('/')[0],
                      isRelative = segment === '.' || segment === '..'; //Have a file extension alias, and it is not the
                  //dots from a relative path.

                  if (index !== -1 && (!isRelative || index > 1)) {
                    ext = moduleNamePlusExt.substring(index, moduleNamePlusExt.length);
                    moduleNamePlusExt = moduleNamePlusExt.substring(0, index);
                  }

                  return context.nameToUrl(normalize(moduleNamePlusExt, relMap && relMap.id, true), ext, true);
                },
                defined: function (id) {
                  return hasProp(defined, makeModuleMap(id, relMap, false, true).id);
                },
                specified: function (id) {
                  id = makeModuleMap(id, relMap, false, true).id;
                  return hasProp(defined, id) || hasProp(registry, id);
                }
              }); //Only allow undef on top level require calls

              if (!relMap) {
                localRequire.undef = function (id) {
                  //Bind any waiting define() calls to this context,
                  //fix for #408
                  takeGlobalQueue();
                  var map = makeModuleMap(id, relMap, true),
                      mod = getOwn(registry, id);
                  mod.undefed = true;
                  removeScript(id);
                  delete defined[id];
                  delete urlFetched[map.url];
                  delete undefEvents[id]; //Clean queued defines too. Go backwards
                  //in array so that the splices do not
                  //mess up the iteration.

                  eachReverse(defQueue, function (args, i) {
                    if (args[0] === id) {
                      defQueue.splice(i, 1);
                    }
                  });
                  delete context.defQueueMap[id];

                  if (mod) {
                    //Hold on to listeners in case the
                    //module will be attempted to be reloaded
                    //using a different config.
                    if (mod.events.defined) {
                      undefEvents[id] = mod.events;
                    }

                    cleanRegistry(id);
                  }
                };
              }

              return localRequire;
            },

            /**
             * Called to enable a module if it is still in the registry
             * awaiting enablement. A second arg, parent, the parent module,
             * is passed in for context, when this method is overridden by
             * the optimizer. Not shown here to keep code compact.
             */
            enable: function (depMap) {
              var mod = getOwn(registry, depMap.id);

              if (mod) {
                getModule(depMap).enable();
              }
            },

            /**
             * Internal method used by environment adapters to complete a load event.
             * A load event could be a script load or just a load pass from a synchronous
             * load call.
             * @param {String} moduleName the name of the module to potentially complete.
             */
            completeLoad: function (moduleName) {
              var found,
                  args,
                  mod,
                  shim = getOwn(config.shim, moduleName) || {},
                  shExports = shim.exports;
              takeGlobalQueue();

              while (defQueue.length) {
                args = defQueue.shift();

                if (args[0] === null) {
                  args[0] = moduleName; //If already found an anonymous module and bound it
                  //to this name, then this is some other anon module
                  //waiting for its completeLoad to fire.

                  if (found) {
                    break;
                  }

                  found = true;
                } else if (args[0] === moduleName) {
                  //Found matching define call for this script!
                  found = true;
                }

                callGetModule(args);
              }

              context.defQueueMap = {}; //Do this after the cycle of callGetModule in case the result
              //of those calls/init calls changes the registry.

              mod = getOwn(registry, moduleName);

              if (!found && !hasProp(defined, moduleName) && mod && !mod.inited) {
                if (config.enforceDefine && (!shExports || !getGlobal(shExports))) {
                  if (hasPathFallback(moduleName)) {
                    return;
                  } else {
                    return onError(makeError('nodefine', 'No define call for ' + moduleName, null, [moduleName]));
                  }
                } else {
                  //A script that does not call define(), so just simulate
                  //the call for it.
                  callGetModule([moduleName, shim.deps || [], shim.exportsFn]);
                }
              }

              checkLoaded();
            },

            /**
             * Converts a module name to a file path. Supports cases where
             * moduleName may actually be just an URL.
             * Note that it **does not** call normalize on the moduleName,
             * it is assumed to have already been normalized. This is an
             * internal API, not a public one. Use toUrl for the public API.
             */
            nameToUrl: function (moduleName, ext, skipExt) {
              var paths,
                  syms,
                  i,
                  parentModule,
                  url,
                  parentPath,
                  bundleId,
                  pkgMain = getOwn(config.pkgs, moduleName);

              if (pkgMain) {
                moduleName = pkgMain;
              }

              bundleId = getOwn(bundlesMap, moduleName);

              if (bundleId) {
                return context.nameToUrl(bundleId, ext, skipExt);
              } //If a colon is in the URL, it indicates a protocol is used and it is just
              //an URL to a file, or if it starts with a slash, contains a query arg (i.e. ?)
              //or ends with .js, then assume the user meant to use an url and not a module id.
              //The slash is important for protocol-less URLs as well as full paths.


              if (req.jsExtRegExp.test(moduleName)) {
                //Just a plain path, not module name lookup, so just return it.
                //Add extension if it is included. This is a bit wonky, only non-.js things pass
                //an extension, this method probably needs to be reworked.
                url = moduleName + (ext || '');
              } else {
                //A module that needs to be converted to a path.
                paths = config.paths;
                syms = moduleName.split('/'); //For each module name segment, see if there is a path
                //registered for it. Start with most specific name
                //and work up from it.

                for (i = syms.length; i > 0; i -= 1) {
                  parentModule = syms.slice(0, i).join('/');
                  parentPath = getOwn(paths, parentModule);

                  if (parentPath) {
                    //If an array, it means there are a few choices,
                    //Choose the one that is desired
                    if (isArray(parentPath)) {
                      parentPath = parentPath[0];
                    }

                    syms.splice(0, i, parentPath);
                    break;
                  }
                } //Join the path parts together, then figure out if baseUrl is needed.


                url = syms.join('/');
                url += ext || (/^data\:|^blob\:|\?/.test(url) || skipExt ? '' : '.js');
                url = (url.charAt(0) === '/' || url.match(/^[\w\+\.\-]+:/) ? '' : config.baseUrl) + url;
              }

              return config.urlArgs && !/^blob\:/.test(url) ? url + config.urlArgs(moduleName, url) : url;
            },
            //Delegates to req.load. Broken out as a separate function to
            //allow overriding in the optimizer.
            load: function (id, url) {
              req.load(context, id, url);
            },

            /**
             * Executes a module callback function. Broken out as a separate function
             * solely to allow the build system to sequence the files in the built
             * layer in the right sequence.
             *
             * @private
             */
            execCb: function (name, callback, args, exports) {
              return callback.apply(exports, args);
            },

            /**
             * callback for script loads, used to check status of loading.
             *
             * @param {Event} evt the event from the browser for the script
             * that was loaded.
             */
            onScriptLoad: function (evt) {
              //Using currentTarget instead of target for Firefox 2.0's sake. Not
              //all old browsers will be supported, but this one was easy enough
              //to support and still makes sense.
              if (evt.type === 'load' || readyRegExp.test((evt.currentTarget || evt.srcElement).readyState)) {
                //Reset interactive script so a script node is not held onto for
                //to long.
                interactiveScript = null; //Pull out the name of the module and the context.

                var data = getScriptData(evt);
                context.completeLoad(data.id);
              }
            },

            /**
             * Callback for script errors.
             */
            onScriptError: function (evt) {
              var data = getScriptData(evt);

              if (!hasPathFallback(data.id)) {
                var parents = [];
                eachProp(registry, function (value, key) {
                  if (key.indexOf('_@r') !== 0) {
                    each(value.depMaps, function (depMap) {
                      if (depMap.id === data.id) {
                        parents.push(key);
                        return true;
                      }
                    });
                  }
                });
                return onError(makeError('scripterror', 'Script error for "' + data.id + (parents.length ? '", needed by: ' + parents.join(', ') : '"'), evt, [data.id]));
              }
            }
          };
          context.require = context.makeRequire();
          return context;
        }
        /**
         * Main entry point.
         *
         * If the only argument to require is a string, then the module that
         * is represented by that string is fetched for the appropriate context.
         *
         * If the first argument is an array, then it will be treated as an array
         * of dependency string names to fetch. An optional function callback can
         * be specified to execute when all of those dependencies are available.
         *
         * Make a local req variable to help Caja compliance (it assumes things
         * on a require that are not standardized), and to give a short
         * name for minification/local scope use.
         */


        req = requirejs = function (deps, callback, errback, optional) {
          //Find the right context, use default
          var context,
              config,
              contextName = defContextName; // Determine if have config object in the call.

          if (!isArray(deps) && typeof deps !== 'string') {
            // deps is a config object
            config = deps;

            if (isArray(callback)) {
              // Adjust args if there are dependencies
              deps = callback;
              callback = errback;
              errback = optional;
            } else {
              deps = [];
            }
          }

          if (config && config.context) {
            contextName = config.context;
          }

          context = getOwn(contexts, contextName);

          if (!context) {
            context = contexts[contextName] = req.s.newContext(contextName);
          }

          if (config) {
            context.configure(config);
          }

          return context.require(deps, callback, errback);
        };
        /**
         * Support require.config() to make it easier to cooperate with other
         * AMD loaders on globally agreed names.
         */


        req.config = function (config) {
          return req(config);
        };
        /**
         * Execute something after the current tick
         * of the event loop. Override for other envs
         * that have a better solution than setTimeout.
         * @param  {Function} fn function to execute later.
         */


        req.nextTick = typeof setTimeout !== 'undefined' ? function (fn) {
          setTimeout(fn, 4);
        } : function (fn) {
          fn();
        };
        /**
         * Export require as a global, but only if it does not already exist.
         */

        if (!require) {
          require = req;
        }

        req.version = version; //Used to filter out dependencies that are already paths.

        req.jsExtRegExp = /^\/|:|\?|\.js$/;
        req.isBrowser = isBrowser;
        s = req.s = {
          contexts: contexts,
          newContext: newContext
        }; //Create default context.

        req({}); //Exports some context-sensitive methods on global require.

        each(['toUrl', 'undef', 'defined', 'specified'], function (prop) {
          //Reference from contexts instead of early binding to default context,
          //so that during builds, the latest instance of the default context
          //with its config gets used.
          req[prop] = function () {
            var ctx = contexts[defContextName];
            return ctx.require[prop].apply(ctx, arguments);
          };
        });

        if (isBrowser) {
          head = s.head = document.getElementsByTagName('head')[0]; //If BASE tag is in play, using appendChild is a problem for IE6.
          //When that browser dies, this can be removed. Details in this jQuery bug:
          //http://dev.jquery.com/ticket/2709

          baseElement = document.getElementsByTagName('base')[0];

          if (baseElement) {
            head = s.head = baseElement.parentNode;
          }
        }
        /**
         * Any errors that require explicitly generates will be passed to this
         * function. Intercept/override it if you want custom error handling.
         * @param {Error} err the error object.
         */


        req.onError = defaultOnError;
        /**
         * Creates the node for the load command. Only used in browser envs.
         */

        req.createNode = function (config, moduleName, url) {
          var node = config.xhtml ? document.createElementNS('http://www.w3.org/1999/xhtml', 'html:script') : document.createElement('script');
          node.type = config.scriptType || 'text/javascript';
          node.charset = 'utf-8';
          node.async = true;
          return node;
        };
        /**
         * Does the request to load a module for the browser case.
         * Make this a separate function to allow other environments
         * to override it.
         *
         * @param {Object} context the require context to find state.
         * @param {String} moduleName the name of the module.
         * @param {Object} url the URL to the module.
         */


        req.load = function (context, moduleName, url) {
          var config = context && context.config || {},
              node;

          if (isBrowser) {
            //In the browser so use a script tag
            node = req.createNode(config, moduleName, url);
            node.setAttribute('data-requirecontext', context.contextName);
            node.setAttribute('data-requiremodule', moduleName); //Set up load listener. Test attachEvent first because IE9 has
            //a subtle issue in its addEventListener and script onload firings
            //that do not match the behavior of all other browsers with
            //addEventListener support, which fire the onload event for a
            //script right after the script execution. See:
            //https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution
            //UNFORTUNATELY Opera implements attachEvent but does not follow the script
            //script execution mode.

            if (node.attachEvent && //Check if node.attachEvent is artificially added by custom script or
            //natively supported by browser
            //read https://github.com/requirejs/requirejs/issues/187
            //if we can NOT find [native code] then it must NOT natively supported.
            //in IE8, node.attachEvent does not have toString()
            //Note the test for "[native code" with no closing brace, see:
            //https://github.com/requirejs/requirejs/issues/273
            !(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) && !isOpera) {
              //Probably IE. IE (at least 6-8) do not fire
              //script onload right after executing the script, so
              //we cannot tie the anonymous define call to a name.
              //However, IE reports the script as being in 'interactive'
              //readyState at the time of the define call.
              useInteractive = true;
              node.attachEvent('onreadystatechange', context.onScriptLoad); //It would be great to add an error handler here to catch
              //404s in IE9+. However, onreadystatechange will fire before
              //the error handler, so that does not help. If addEventListener
              //is used, then IE will fire error before load, but we cannot
              //use that pathway given the connect.microsoft.com issue
              //mentioned above about not doing the 'script execute,
              //then fire the script load event listener before execute
              //next script' that other browsers do.
              //Best hope: IE10 fixes the issues,
              //and then destroys all installs of IE 6-9.
              //node.attachEvent('onerror', context.onScriptError);
            } else {
              node.addEventListener('load', context.onScriptLoad, false);
              node.addEventListener('error', context.onScriptError, false);
            }

            node.src = url; //Calling onNodeCreated after all properties on the node have been
            //set, but before it is placed in the DOM.

            if (config.onNodeCreated) {
              config.onNodeCreated(node, config, moduleName, url);
            } //For some cache cases in IE 6-8, the script executes before the end
            //of the appendChild execution, so to tie an anonymous define
            //call to the module name (which is stored on the node), hold on
            //to a reference to this node, but clear after the DOM insertion.


            currentlyAddingScript = node;

            if (baseElement) {
              head.insertBefore(node, baseElement);
            } else {
              head.appendChild(node);
            }

            currentlyAddingScript = null;
            return node;
          } else if (isWebWorker) {
            try {
              //In a web worker, use importScripts. This is not a very
              //efficient use of importScripts, importScripts will block until
              //its script is downloaded and evaluated. However, if web workers
              //are in play, the expectation is that a build has been done so
              //that only one script needs to be loaded anyway. This may need
              //to be reevaluated if other use cases become common.
              // Post a task to the event loop to work around a bug in WebKit
              // where the worker gets garbage-collected after calling
              // importScripts(): https://webkit.org/b/153317
              setTimeout(function () {}, 0);
              importScripts(url); //Account for anonymous modules

              context.completeLoad(moduleName);
            } catch (e) {
              context.onError(makeError('importscripts', 'importScripts failed for ' + moduleName + ' at ' + url, e, [moduleName]));
            }
          }
        };

        function getInteractiveScript() {
          if (interactiveScript && interactiveScript.readyState === 'interactive') {
            return interactiveScript;
          }

          eachReverse(scripts(), function (script) {
            if (script.readyState === 'interactive') {
              return interactiveScript = script;
            }
          });
          return interactiveScript;
        } //Look for a data-main script attribute, which could also adjust the baseUrl.


        if (isBrowser && !cfg.skipDataMain) {
          //Figure out baseUrl. Get it from the script tag with require.js in it.
          eachReverse(scripts(), function (script) {
            //Set the 'head' where we can append children by
            //using the script's parent.
            if (!head) {
              head = script.parentNode;
            } //Look for a data-main attribute to set main script for the page
            //to load. If it is there, the path to data main becomes the
            //baseUrl, if it is not already set.


            dataMain = script.getAttribute('data-main');

            if (dataMain) {
              //Preserve dataMain in case it is a path (i.e. contains '?')
              mainScript = dataMain; //Set final baseUrl if there is not already an explicit one,
              //but only do so if the data-main value is not a loader plugin
              //module ID.

              if (!cfg.baseUrl && mainScript.indexOf('!') === -1) {
                //Pull off the directory of data-main for use as the
                //baseUrl.
                src = mainScript.split('/');
                mainScript = src.pop();
                subPath = src.length ? src.join('/') + '/' : './';
                cfg.baseUrl = subPath;
              } //Strip off any trailing .js since mainScript is now
              //like a module name.


              mainScript = mainScript.replace(jsSuffixRegExp, ''); //If mainScript is still a path, fall back to dataMain

              if (req.jsExtRegExp.test(mainScript)) {
                mainScript = dataMain;
              } //Put the data-main script in the files to load.


              cfg.deps = cfg.deps ? cfg.deps.concat(mainScript) : [mainScript];
              return true;
            }
          });
        }
        /**
         * The function that handles definitions of modules. Differs from
         * require() in that a string for the module should be the first argument,
         * and the function to execute after dependencies are loaded should
         * return a value to define the module corresponding to the first argument's
         * name.
         */


        define = function (name, deps, callback) {
          var node, context; //Allow for anonymous modules

          if (typeof name !== 'string') {
            //Adjust args appropriately
            callback = deps;
            deps = name;
            name = null;
          } //This module may not have dependencies


          if (!isArray(deps)) {
            callback = deps;
            deps = null;
          } //If no name, and callback is a function, then figure out if it a
          //CommonJS thing with dependencies.


          if (!deps && isFunction(callback)) {
            deps = []; //Remove comments from the callback string,
            //look for require calls, and pull them into the dependencies,
            //but only if there are function args.

            if (callback.length) {
              callback.toString().replace(commentRegExp, commentReplace).replace(cjsRequireRegExp, function (match, dep) {
                deps.push(dep);
              }); //May be a CommonJS thing even without require calls, but still
              //could use exports, and module. Avoid doing exports and module
              //work though if it just needs require.
              //REQUIRES the function to expect the CommonJS variables in the
              //order listed below.

              deps = (callback.length === 1 ? ['require'] : ['require', 'exports', 'module']).concat(deps);
            }
          } //If in IE 6-8 and hit an anonymous define() call, do the interactive
          //work.


          if (useInteractive) {
            node = currentlyAddingScript || getInteractiveScript();

            if (node) {
              if (!name) {
                name = node.getAttribute('data-requiremodule');
              }

              context = contexts[node.getAttribute('data-requirecontext')];
            }
          } //Always save off evaluating the def call until the script onload handler.
          //This allows multiple modules to be in a file without prematurely
          //tracing dependencies, and allows for anonymous module support,
          //where the module name is not known until the script onload event
          //occurs. If no context, use the global queue, and get it processed
          //in the onscript load callback.


          if (context) {
            context.defQueue.push([name, deps, callback]);
            context.defQueueMap[name] = true;
          } else {
            globalDefQueue.push([name, deps, callback]);
          }
        };

        define.amd = {
          jQuery: true
        };
        /**
         * Executes the text. Normally just uses eval, but can be modified
         * to use a better, environment-specific call. Only used for transpiling
         * loader plugins, not for plain JS modules.
         * @param {String} text the text to execute/evaluate.
         */

        req.exec = function (text) {
          /*jslint evil: true */
          return eval(text);
        }; //Set up with config info.


        req(cfg);
      })(_this5, typeof setTimeout === 'undefined' ? undefined : setTimeout);

      return {
        requirejs: requirejs,
        require: require,
        define: define
      };
    }({
      document: true
    });

    Sirv.define = sirvRequirejs.define;
    /* eslint-env es6 */

    /* global sirvRequirejs */

    /* eslint-disable no-lonely-if */

    /* eslint-disable quote-props */

    /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "sirvRequire|isLazyImage|SIRV_BASE_URL|SIRV_HTTP_PROTOCOL" }] */

    /*
        WE DON'T HAVE 'magicjs' MODULE AT THIS STAGE!
    */

    var sirvRequire = null;
    var isLazyImage = false;
    var SIRV_ASSETS_URL = '';
    var SIRV_BASE_URL = '';
    var SIRV_HTTP_PROTOCOL = 'https:'; // base modules

    var sirvDeps = ['bHelpers', // all modules
    'magicJS', // all modules
    'globalVariables', // all modules
    'globalFunctions', // all modules
    'EventEmitter', // most modules
    'helper', // most modules
    'EventManager', // start module
    'Loader', // RoundLoader
    'RoundLoader', // ComponentLoader, ProgressLoader, Zoom
    'ComponentLoader', // slider
    'ResponsiveImage', // BaseImage, Spin, Zoom
    'ViewerImage', // Slider
    'defaultsVideoOptions', // Slider, Video
    'ContextMenu', // Slider
    'Slider', // start module
    'SliderBuilder', // slider bilder module
    'BaseInstance', 'Instance', 'HotspotInstance', 'Hotspot', 'Hotspots', 'SpinHotspots', 'getDPPX'];

    (function () {
      var customDependencies = null;
      var scripts = document.getElementsByTagName('script');

      var fltuc = function (str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      };

      var getLowerString = function (string) {
        return string.toLowerCase();
      };

      var getAbsoluteURL = function () {
        var a;
        return function (url) {
          if (!a) a = document.createElement('a');
          a.setAttribute('href', url);
          return ('!!' + a.href).replace('!!', '');
        };
      }();

      var spinModule = null;
      var zoomModule = null;
      var videoModule = null;
      var descriptionModule = null;
      var productDetailModule = null;
      var socialButtonsModule = null;
      var remoteDeps = {
        // Hint: [
        //     'bHelpers',
        //     'magicJS',
        //     'globalVariables',
        //     'globalFunctions',
        //     'helper'
        // ],
        // 'ImageZoom': [
        //     'bHelpers',
        //     'magicjs',
        //     'globalVariables',
        //     'globalFunctions',
        //     'helper',
        //     'EventEmitter'
        // ],
        // 'ProgressLoader': [
        //     'bHelpers',
        //     'magicJS',
        //     'globalVariables',
        //     'globalFunctions',
        //     'helper',
        //     'RoundLoader'
        // ],
        // 'Componentzoomapi': [
        //     'bHelpers',
        //     'magicJS',
        //     'Componentapi'
        // ],
        // 'Componentzoominstance': [
        //     'bHelpers',
        //     'magicJS',
        //     'Componentinstance'
        // ],
        'Spin': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'globalVariables', // it is in base deps
        'globalFunctions', // it is in base deps
        'helper', // it is in base deps
        'EventEmitter', // it is in base deps
        'ResponsiveImage', // it is in base deps
        'HotspotInstance', 'Zoominstance', 'Hint', // 'ImageZoom',
        'ProgressLoader'],
        'Zoom': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'globalVariables', // it is in base deps
        'globalFunctions', // it is in base deps
        'helper', // it is in base deps
        'EventEmitter', // it is in base deps
        'ResponsiveImage', // it is in base deps
        'RoundLoader', // it is in base deps
        'HotspotInstance', 'Zoominstance', 'Hint' // 'ImageZoom'
        ],
        'Video': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'globalVariables', // it is in base deps
        'globalFunctions', // it is in base deps
        'helper', // it is in base deps
        'EventEmitter', // it is in base deps
        'defaultsVideoOptions', // it is in base deps
        'Instance' // it is in base deps
        ],
        'LazyImage': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'globalVariables', // it is in base deps
        'globalFunctions', // it is in base deps
        'helper', // it is in base deps
        'EventEmitter', // it is in base deps
        'ResponsiveImage', // it is in base deps
        'BaseInstance', // it is in base deps
        'getDPPX' // it is in base deps
        ],
        'Description': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'EventEmitter', // it is in base deps
        'helper' // it is in base deps
        ],
        'ProductDetail': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'helper', // it is in base deps
        'Description'],
        'SocialButtons': ['bHelpers', // it is in base deps
        'magicJS', // it is in base deps
        'EventEmitter', // it is in base deps
        'helper' // it is in base deps
        ]
      };
      var aliases = {
        Spin: 'Spin',
        Zoom: 'Zoom',
        Video: 'Video',
        Image: 'LazyImage',
        Description: 'Description',
        Productdetail: 'ProductDetail',
        Socialbuttons: 'SocialButtons'
      };
      var BASE_MODULES = ['Image', 'Spin', 'Video', 'Zoom'];

      for (var i = 0, l = scripts.length; i < l; i++) {
        var src = scripts[i].getAttribute('src') || '';
        var isTestJs = scripts[i].getAttribute('data-sirvjs-test') !== null;

        if (isTestJs) {
          SIRV_ASSETS_URL = getAbsoluteURL(src).replace(/([^#?]+)\/.*$/, '$1/');
        } else {
          if (/sirv\.(com|localhost(:\d+)?)\/(([^#?]+)\/)?sirv\.js([?#].*)?$/i.test(src) || /sirv\.(com|localhost(:\d+)?)\/(([^#?]+)\/)?sirv\.full\.js([?#].*)?$/i.test(src)) {
            SIRV_BASE_URL = getAbsoluteURL(src).replace(/(^https?:\/\/[^/]*).*/, '$1/');
            SIRV_ASSETS_URL = getAbsoluteURL(src).replace(/([^#?]+)\/.*$/, '$1/');

            if (/sirv\.localhost(:\d+)?\/(([^#?]+)\/)?sirv\.js([?#].*)?$/i.test(src) || /sirv\.localhost(:\d+)?\/(([^#?]+)\/)?sirv\.full\.js([?#].*)?$/i.test(src)) {
              // dev env on localhost
              SIRV_HTTP_PROTOCOL = 'http:';
            }
          }
        }

        var dComponents = scripts[i].getAttribute('data-components');

        if (dComponents) {
          dComponents = dComponents.trim();
          dComponents = dComponents.replace(/\s+/g, ' ');
        }

        if (!customDependencies && dComponents && dComponents !== '') {
          customDependencies = dComponents.split(/,/.test(dComponents) ? ',' : ' ');
          break;
        }
      }

      if (!customDependencies && window.SirvComponents) {
        try {
          customDependencies = JSON.parse(JSON.stringify(window.SirvComponents));
        } catch (e) {// empty
        }
      }

      if (!customDependencies) {
        customDependencies = BASE_MODULES;
      }
      /* start-full-content-block */


      customDependencies = (customDependencies || []).concat(BASE_MODULES);
      /* end-full-content-block */

      customDependencies.forEach(function (rawDep) {
        var value = rawDep.trim();

        if (value !== '') {
          value = getLowerString(value);
          value = fltuc(value);

          if (aliases[value]) {
            remoteDeps[aliases[value]].forEach(function (dep) {
              if (sirvDeps.indexOf(dep) === -1) {
                sirvDeps.push(dep);
              }
            });

            if (sirvDeps.indexOf(aliases[value]) === -1) {
              sirvDeps.push(aliases[value]);
            }

            if (value === 'Image') {
              isLazyImage = true;
            } else {
              switch (value) {
                case 'Spin':
                  spinModule = aliases[value];
                  break;

                case 'Zoom':
                  zoomModule = aliases[value];
                  break;

                case 'Video':
                  videoModule = aliases[value];
                  break;

                case 'Description':
                  descriptionModule = aliases[value];
                  break;

                case 'Productdetail':
                  productDetailModule = aliases[value];
                  break;

                case 'Socialbuttons':
                  socialButtonsModule = aliases[value];
                  break;

                default: // no default

              }
            }
          }
        }
      });
      sirvRequire = sirvRequirejs.require.config({
        waitSeconds: 0,
        baseUrl: SIRV_ASSETS_URL,
        deps: sirvDeps,
        paths: {
          polyfill: 'components/polyfill',
          EventEmitter: 'components/emitter',
          bHelpers: 'components/bHelpers',
          magicJS: 'components/magicjs',
          BaseInstance: 'components/baseinstance',
          Instance: 'components/instance',
          HotspotInstance: 'components/hotspotinstance',
          Zoominstance: 'components/zoominstance',
          globalVariables: 'components/globalVariables',
          globalFunctions: 'components/globalFunctions',
          helper: 'components/helper-module',
          EventManager: 'components/eventmanager',
          ContextMenu: 'components/contextmenu',
          Hint: 'components/hint',
          ResponsiveImage: 'components/imageclass',
          Loader: 'components/loader',
          RoundLoader: 'components/roundloader',
          ComponentLoader: 'components/componentloader',
          ProgressLoader: 'components/progressloader',
          LazyImage: 'components/lazyimage',
          ViewerImage: 'components/image',
          Spin: 'components/spin',
          defaultsVideoOptions: 'components/defaultsVideoOptions',
          Description: 'components/description',
          ProductDetail: 'components/productDetail',
          SocialButtons: 'components/socialButtons',
          SliderBuilder: 'components/sliderBuilder',
          VideoLib: 'vjs/sirv.videojs',
          Video: 'components/video',
          Zoom: 'components/zoom',
          Slider: 'components/slider',
          Hotspot: 'components/hotspot',
          Hotspots: 'components/hotspots',
          SpinHotspots: 'components/spinHotspots',
          Vimeo: 'components/vimeo',
          ImageZoom: 'components/imagezoom',
          qualitySelector: 'vjs/qualityselector',
          getDPPX: 'components/getdppx'
        },
        urlArgs: 'v=develop-1646752161768',
        config: {
          'Slider': {
            spin: spinModule,
            zoom: zoomModule,
            video: videoModule,
            description: descriptionModule,
            productDetail: productDetailModule,
            socialButtons: socialButtonsModule
          },
          'Video': {
            libcss: SIRV_ASSETS_URL + 'vjs/sirv.videojs.css',
            libjs: 'VideoLib',
            qualitySelectorcss: SIRV_ASSETS_URL + 'vjs/qualityselector.css',
            qualitySelectorjs: 'qualitySelector'
          }
        }
      });
    })();
    /* global Sirv */


    Sirv.define('Promise', {
      // eslint-disable-next-line
      load: function (name, req, onload, config) {
        if (window.Promise) {
          onload(window.Promise);
        } else {
          req(['polyfill'], function (value) {
            onload(value.Promise);
          });
        }
      }
    });
    Sirv.define('bHelpers', function () {
      var moduleName = 'bHelpers';
      var bHelpers = {};

      function _inheritsLoose(subClass, superClass) {
        subClass.prototype = Object.create(superClass.prototype);
        subClass.prototype.constructor = subClass;
        subClass.__proto__ = superClass;
      }

      bHelpers.inheritsLoose = _inheritsLoose;

      function _assertThisInitialized(self) {
        if (self === void 0) {
          throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        }

        return self;
      }

      bHelpers.assertThisInitialized = _assertThisInitialized;

      function _readOnlyError(name) {
        throw new Error("\"" + name + "\" is read-only");
      }

      bHelpers.readOnlyError = _readOnlyError;

      function _classPrivateFieldGet(receiver, privateMap) {
        var descriptor = privateMap.get(receiver);

        if (!descriptor) {
          throw new TypeError("attempted to get private field on non-instance");
        }

        if (descriptor.get) {
          return descriptor.get.call(receiver);
        }

        return descriptor.value;
      }

      bHelpers.classPrivateFieldGet = _classPrivateFieldGet;

      function _classPrivateFieldSet(receiver, privateMap, value) {
        var descriptor = privateMap.get(receiver);

        if (!descriptor) {
          throw new TypeError("attempted to set private field on non-instance");
        }

        if (descriptor.set) {
          descriptor.set.call(receiver, value);
        } else {
          if (!descriptor.writable) {
            throw new TypeError("attempted to set read only private field");
          }

          descriptor.value = value;
        }

        return value;
      }

      bHelpers.classPrivateFieldSet = _classPrivateFieldSet;
      bHelpers;
      return bHelpers;
    });
    Sirv.define('magicJS', ['bHelpers'], function (bHelpers) {
      var moduleName = 'magicJS';
      /**
      * @version ${MagicJS_version}
      * @package MagicJS
      * @access public
      *
      * @copyright   ${build_year} MagicToolbox.com, To use this code on your own site, visit http://www.magictoolbox.com
      * @license     http://www.magictoolbox.com/license/
      * @author      MagicToolbox.com <support@magictoolbox.com>
      *
      */
      // var magicJS;
      // var $J;
      // magicJS = $J = (function() {
      //     var WIN = window;
      //     var UND = WIN.undefined;
      //     var DOC = document;

      var magicJS;
      var $J;

      magicJS = $J = function () {
        var WIN = window;
        var UND = WIN.undefined;
        var DOC = document;
        /* eslint-env es6 */

        /* global UND, WIN, DOC, Doc */

        /* eslint-disable no-use-before-define */

        /* eslint no-return-assign: "error" */

        /* eslint no-extra-boolean-cast: "off" */

        /* eslint no-continue: "off" */

        /* eslint no-restricted-syntax: ["error", "WithStatement", "BinaryExpression[operator='in']"] */

        /* eslint-disable dot-notation */

        /* eslint-disable eqeqeq */

        var STORAGE = new WeakMap();
        /*
         * Script: base.js
         * Contains core methods.
         */

        /**
         * Contains core methods.
         * @class
         * @static
         */

        var magicJS =
        /** @lends magicJS# */
        {
          /**
           * Start UUID for objects
           */
          UUID: 0,

          /**
           * Storage for object properties
           */
          storage: {},

          /**
           * Assign unique id for an object
           */
          $uuid: function (o) {
            return o.$J_UUID || (o.$J_UUID = ++$J.UUID);
          },

          /**
           * Retreive storage of an object by uuid
           */
          getStorage: function (uuid) {
            return $J.storage[uuid] || ($J.storage[uuid] = {});
          },

          /**
           * Empty function that returns false
           */
          $false: function () {
            return false;
          },

          /**
           * Empty function that returns true
           */
          $true: function () {
            return true;
          },

          /**
           * Id of the magicJS <style></style>
           */
          stylesId: 'mjs-' + Math.floor(Math.random() * new Date().getTime()),

          /**
           * Check if the object defined
           *
           * @param {Object}   object to check
           *
           * @returns {bool}  - true or false
           */
          defined: function (o) {
            return o != UND;
          },

          /**
           * Check if the object defined and return itself of default value
           *
           * @param {Object}   object to check
           * @param {Mixed}    default value
           *
           * @returns {Mixed} - Returns object if it is defined, otherwise default value
           */
          // ifndef: (o, defaultValue) => {
          //     return (o !== UND) ? o : defaultValue;
          // },
          // exists: (o) => {
          //     return !!(o);
          // },

          /**
           * Checks for element within array
           *
           * @param   {Array} source      Source
           * @param   {Mixed} needle      Element that is checked
           * @param   {Integer} [from=0]      The start index to search
           *
           * @returns {Boolean}   true if element found, otherwise false
           */
          contains: function (source, needle, from) {
            return source.indexOf(needle, from) !== -1;
          },

          /**
           * Get type of the object
           *
           * @param {Object}  object to check
           *
           * @returns {String}    - object type
           */
          typeOf: function (o) {
            if (!$J.defined(o)) {
              return false;
            }

            if (o.$J_TYPE) {
              return o.$J_TYPE;
            }

            if (!!o.nodeType) {
              if (o.nodeType === 1) {
                return 'element';
              }

              if (o.nodeType === 3) {
                return 'textnode';
              }
            }

            if (o === WIN) {
              return 'window';
            }

            if (o === DOC) {
              return 'document';
            } // if ((o instanceof WIN.Object || o instanceof WIN.Function) && o.constructor === $J.Class) {
            //     return 'class';
            // }


            if (o instanceof WIN.Array) {
              return 'array';
            }

            if (o instanceof WIN.Function) {
              return 'function';
            }

            if (o instanceof WIN.String) {
              return 'string';
            }

            if ($J.browser.trident) {
              if ($J.defined(o.cancelBubble)) {
                return 'event';
              }
            } else {
              //if ( o instanceof WIN.Event || o === WIN.event || o.constructor == WIN.MouseEvent ) { return 'event'; }
              // eslint-disable-next-line
              if (o === WIN.event || o.constructor == WIN.Event || o.constructor == WIN.MouseEvent || o.constructor == WIN.UIEvent || o.constructor == WIN.KeyboardEvent || o.constructor == WIN.KeyEvent) {
                return 'event';
              }
            }

            if (o instanceof WIN.Date) {
              return 'date';
            }

            if (o instanceof WIN.RegExp) {
              return 'regexp';
            }

            if (o.length && o.item) {
              return 'collection';
            }

            if (o.length && o.callee) {
              return 'arguments';
            }

            return typeof o;
          },

          /**
           * Extend objects
           *
           * @param {mixed}   objects to extend
           * @param {Hash}    properties
           *
           * @returns first extended object
           * @type   {Object}
           */
          extend: function (o, p) {
            if (!(o instanceof WIN.Array)) {
              o = [o];
            }

            if (!p) {
              return o[0];
            }

            for (var i = 0, l = o.length; i < l; i++) {
              if (!$J.defined(o)) {
                continue;
              } // for ( const k in (p || {}) ) {


              for (var k in p) {
                if (!Object.prototype.hasOwnProperty.call(p, k)) {
                  continue;
                }

                try {
                  o[i][k] = p[k];
                } catch (x) {// empty
                }
              }
            }

            return o[0];
          },

          /**
           * Extend an objects' prototype
           *
           * @param {mixed} object to extend
           * @param {Hash}  properties
           *
           * @returns first extended object
           * @type   {Object}
           */
          implement: function (o, p) {
            if (!(o instanceof WIN.Array)) {
              o = [o];
            }

            for (var i = 0, l = o.length; i < l; i++) {
              if (!$J.defined(o[i])) {
                continue;
              }

              if (!o[i].prototype) {
                continue;
              }

              for (var k in p || {}) {
                if (!o[i].prototype[k]) {
                  o[i].prototype[k] = p[k];
                }
              }
            }

            return o[0];
          },

          /**
           * Extend a native Javascript object (e.g. Array)
           *
           * @param {Object}   object to extend
           * @param {Hash}     properties
           */
          nativize: function (o, p) {
            if (!$J.defined(o)) {
              return o;
            }

            for (var k in p || {}) {
              if (!o[k]) {
                o[k] = p[k];
              }
            }

            return o;
          },

          /**
           * Run first succeeded functions
           *
           * @param {Function}     function to be executed
           *
           * @returns {Mixed}     - result of function call or null
           */
          $try: function () {
            for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
              args[_key3] = arguments[_key3];
            }

            for (var i = 0, l = args.length; i < l; i++) {
              try {
                return args[i]();
              } catch (e) {// empty
              }
            }

            return null;
          },

          /**
           * Convert iterable object to an array
           *
           * @param {Mixed}    iterable object
           *
           * @returns {Array} - result array
           */
          $A: function (o) {
            if (!$J.defined(o)) {
              return $J.$([]);
            }

            if (o.toArray) {
              return $J.$(o.toArray());
            }

            if (o.item) {
              var l = o.length || 0;
              var a = new Array(l);

              while (l--) {
                a[l] = o[l];
              }

              return $J.$(a);
            }

            return $J.$(Array.prototype.slice.call(o));
          },

          /**
           * Get current time in milliseconds
           *
           * @returns {Number}    - number of milliseconds since 1 January 1970 00:00:00
           */
          now: function () {
            return new Date().getTime();
          },
          detach: function (o) {
            var r;

            switch ($J.typeOf(o)) {
              case 'object':
                r = {};

                for (var p in o) {
                  if (Object.prototype.hasOwnProperty.call(o, p)) {
                    r[p] = $J.detach(o[p]);
                  }
                }

                break;

              case 'array':
                r = [];

                for (var i = 0, l = o.length; i < l; i++) {
                  r[i] = $J.detach(o[i]);
                }

                break;

              default:
                return o;
            }

            return $J.$(r);
          },
          $: function (o) {
            var result = o;

            switch ($J.typeOf(o)) {
              case 'string':
                {
                  var el = DOC.getElementById(o);

                  if ($J.defined(el)) {
                    result = $J.$(el);
                  } else {
                    result = null;
                  }

                  break;
                }

              case 'window':
              case 'document':
                if (STORAGE.has(o)) {
                  result = STORAGE.get(o);
                } else {
                  result = new Doc(o);
                }

                break;

              case 'element':
                if (STORAGE.has(o)) {
                  result = STORAGE.get(o);
                } else {
                  result = new Element(o);
                }

                break;

              case 'event':
                result = new $J.Events.MagicEvent(o);
                break;
              // no default
            }

            return result;
          },

          /**
           * Creates new dom element
           *
           * @param   {String}
           *
           * @returns
           */
          $new: function (tag, props, css) {
            return $J.$(DOC.createElement(tag)).setProps(props || {}).setCss(css || {});
          },

          /**
           * Adds new CSS style definition to the document
           *
           * @param {String} selector CSS selector
           * @param {String|Object} css CSS rules
           * @param {String} [id] Identifier of the style sheet. Optional.
           * @param {dom object} [root] Context of searching element by id
           *
           * @return {Number} position of the added CSS within the style sheet
           */
          addCSS: function (selector, css, id, root) {
            var style;
            var sheet;
            var idx = -1;
            var rules = [];
            var rootNode = DOC.head || DOC.body;

            if (root) {
              rootNode = $(root).node || root;
            }

            if (!id) {
              id = $J.stylesId;
            }

            style = $(rootNode.querySelector('#' + id));

            if (!style) {
              style = $J.$new('style', {
                id: id,
                type: 'text/css'
              });
              rootNode.insertBefore(style.node, rootNode.firstChild);
            } // sheet = style.sheet;


            sheet = style.node.sheet;

            if (!sheet) {
              // sheet = style.styleSheet;
              sheet = style.node.styleSheet;
            }

            if ($J.typeOf(css) !== 'string') {
              for (var p in css) {
                if (Object.prototype.hasOwnProperty.call(css, p)) {
                  rules.push(p + ':' + css[p]);
                }
              }

              css = rules.join(';');
            }

            if (sheet.insertRule) {
              idx = sheet.insertRule(selector + ' {' + css + '}', sheet.cssRules.length);
            } else {
              idx = sheet.addRule(selector, css);
            }

            return idx;
          },

          /**
           * Remove CSS rule by index from a particular stylesheet
           *
           * @param {String} id Identifier of the style sheet
           * @param {Number} index Position of the CSS to be removed within the style sheet
           */
          removeCSS: function (id, index) {
            var style = $J.$(id);

            if ($J.typeOf(style) !== 'element') {
              return;
            }

            var sheet = style.sheet || style.styleSheet;

            if (sheet.deleteRule) {
              sheet.deleteRule(index);
            } else if (sheet.removeRule) {
              sheet.removeRule(index);
            }
          },

          /**
           * Create UUID
           * @return {String}
           */
          generateUUID: function () {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
              var r = Math.random() * 16 | 0;
              var v = c === 'x' ? r : r & 0x3 | 0x8;
              return v.toString(16);
            }).toUpperCase();
          },

          /**
           * Retrieve absolute URL of a given link
           * @param {String} url link
           * @return {String}
           */
          getAbsoluteURL: function () {
            var a;
            return function (url) {
              if (!a) a = DOC.createElement('a');
              a.setAttribute('href', url);
              return ('!!' + a.href).replace('!!', '');
            };
          }(),

          /**
           * String hash function similar to java.lang.String.hashCode().
           *
           * @param {String} s A string.
           * @return {Number} Hash value for {@code s}, between 0 (inclusive) and 2^32
           *  (exclusive). The empty string returns 0.
           */
          getHashCode: function (s) {
            var r = 0;
            var l = s.length;

            for (var i = 0; i < l; ++i) {
              r = 31 * r + s.charCodeAt(i);
              r %= 0x100000000;
            }

            return r;
          },

          /**
           * Return camel-case string
           *
           * @param {String}
           *
           * @returns {String}    - string in camel-case
           */
          camelize: function (str) {
            return str.replace(/-\D/g, function (m) {
              return m.charAt(1).toUpperCase();
            });
          },

          /**
           * Return hyphenated string
           *
           * @param {String}
           *
           * @returns {String} - hyphenated string
           */
          dashize: function (str) {
            return str.replace(/[A-Z]/g, function (m) {
              return '-' + m.charAt(0).toLowerCase();
            });
          },

          /**
           * Check if string contains substring
           *
           * @param {string}      - source
           * @param {string}      - needle to find
           * @param {string}      - Optional. Separator
           *
           * @returns {bool}      - True if the needle found, False otherwise
           */
          stringHas: function (source, str, sep) {
            sep = sep || '';
            return (sep + source + sep).indexOf(sep + str + sep) > -1;
          }
        };
        var $J = magicJS;
        var $j = magicJS.$; //eslint-disable-line no-unused-vars

        var $ = $J.$;
        /* eslint-env es6 */

        /* global $J, WIN, DOC, UND, DocumentTouch */

        /* eslint-disable dot-notation */

        /* eslint new-parens: "off" */

        /* eslint no-extra-boolean-cast: "off" */

        /* eslint no-unused-vars: ["error", { "args": "none" }] */

        /**
          *     Browser engines
          *         Gecko:
          *             1.81 - Firefox 2
          *             1.90 - Firefox 3
          *             1.91 - Firefox 3.5
          *             1.92 - Firefox 3.6
          *             2.0  - Firefox 4.0
          *             5    - Firefox 5.0
          *             ...
          *             25    - Firefox 25
          *
          *         Presto:
          *             2.0 - Opera 9
          *             2.1 - Opera 9.5
          *             2.1 - Opera 9.6
          *             2.2 - Opera 10.00-10.10
          *             2.5 - Opera 10.50
          *             2.6 - Opera 10.6
          *             2.7 - Opera 11
          *
          *         Trident:
          *             7 - IE 11
          *             6 - IE 10
          *             5 - IE 9
          *             4 - IE 8
          *             3 - IE 7
          *             2 - IE 6
          */
        // Normalized event names

        var EVENTS_MAP = {}; // Shortcut for userAgent

        var _UA = navigator.userAgent.toLowerCase();

        var _engine = _UA.match(/(webkit|gecko|trident|presto)\/(\d+\.?\d*)/i);

        var _version = _UA.match(/(edge|opr)\/(\d+\.?\d*)/i) || _UA.match(/(crios|chrome|safari|firefox|opera|opr)\/(\d+\.?\d*)/i);

        var _safariVer = _UA.match(/version\/(\d+\.?\d*)/i); // Shortcut for document style property for further references


        var docStyles = DOC.documentElement.style;

        var isSupported = function (p) {
          var pp = p.charAt(0).toUpperCase() + p.slice(1);
          return p in docStyles || 'Webkit' + pp in docStyles || 'Moz' + pp in docStyles || 'ms' + pp in docStyles || 'O' + pp in docStyles;
        };
        /** @lends browser# */

        /**
            * @constructs
            * @class Contains information about the client browser
        */


        $J.browser = {
          /**
          * Browser supported features
          */
          features: {
            xpath: !!DOC.evaluate,
            air: !!WIN.runtime,
            query: !!DOC.querySelector,
            fullScreen: !!(DOC.fullscreenEnabled || DOC.msFullscreenEnabled || DOC.exitFullscreen || DOC.cancelFullScreen || DOC.webkitexitFullscreen || DOC.webkitCancelFullScreen || DOC.mozCancelFullScreen || DOC.oCancelFullScreen || DOC.msCancelFullScreen),
            xhr2: !!WIN.ProgressEvent && !!WIN.FormData && WIN.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest(),
            transition: isSupported('transition'),
            transform: isSupported('transform'),
            perspective: isSupported('perspective'),
            animation: isSupported('animation'),
            requestAnimationFrame: false,
            multibackground: false,
            cssFilters: false,
            canvas: false,
            svg: function () {
              return DOC.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1');
            }()
          },

          /**
           * Touch screen support
           */
          touchScreen: function () {
            return 'ontouchstart' in WIN || WIN.DocumentTouch && DOC instanceof DocumentTouch || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
          }(),

          /**
           * Mobile device?
           */
          mobile: !!_UA.match(/(android|bb\d+|meego).+|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/),

          /**
           * Browser engine
           */
          engine: function () {
            var result = 'unknown';

            if (_engine && _engine[1]) {
              result = _engine[1].toLowerCase();
            } else if (WIN.opera) {
              result = 'presto';
            } else if (!!WIN.ActiveXObject) {
              result = 'trident';
            } else if (DOC.getBoxObjectFor !== UND || WIN.mozInnerScreenY !== null) {
              result = 'gecko';
            } else if (WIN.WebKitPoint !== null || !navigator.taintEnabled) {
              result = 'webkit';
            }

            return result;
          }(),

          /**
           * Browser engine version
           */
          version: _engine && _engine[2] ? parseFloat(_engine[2]) : 0,

          /**
           * Browser name & version
           */
          uaName: _version && _version[1] ? _version[1].toLowerCase() : '',
          uaVersion: _version && _version[2] ? parseFloat(_version[2]) : 0,
          // prefix for css properties like -webkit-box-shadow
          cssPrefix: '',
          // prefix for style properties like element.style.WebkitBoxShadow
          cssDomPrefix: '',
          // DOM prefix
          domPrefix: '',

          /**
           * IE document mode
           */
          ieMode: 0,

          /**
           * Platform
           *
           * mac      - Mac OS
           * win      - Windows
           * linux    - Linux
           * ios      - Apple iPod/iPhone/iPad
           *
           */
          platform: function () {
            var result;

            if (_UA.match(/ip(?:ad|od|hone)/)) {
              result = 'ios';
            } else {
              result = _UA.match(/(?:webos|android)/);

              if (!result) {
                result = navigator.platform.match(/mac|win|linux/i);

                if (!result) {
                  result = ['other'];
                }
              }

              result = result[0].toLowerCase();
            }

            return result;
          }(),

          /**
           * Browser box model
           *
           * Basically used to determine how IE renders in quirks mode
           */
          backCompat: DOC.compatMode && DOC.compatMode.toLowerCase() === 'backcompat',

          /**
           * Width of the browser's scrollbars
           */
          scrollbarsWidth: 0,

          /**
           * Reference to the real document element
           *
           * Used to correct work with page dimension
           */
          getDoc: function () {
            return DOC.compatMode && DOC.compatMode.toLowerCase() === 'backcompat' ? DOC.body : DOC.documentElement;
          },

          /**
           * Reference to the requestAnimationFrame method (if any)
           */
          requestAnimationFrame: WIN.requestAnimationFrame || WIN.mozRequestAnimationFrame || WIN.webkitRequestAnimationFrame || WIN.oRequestAnimationFrame || WIN.msRequestAnimationFrame || UND,

          /**
           * Reference to the cancelAnimationFrame method (if any)
           */
          cancelAnimationFrame: WIN.cancelAnimationFrame || WIN.mozCancelAnimationFrame || WIN.mozCancelAnimationFrame || WIN.oCancelAnimationFrame || WIN.msCancelAnimationFrame || WIN.webkitCancelRequestAnimationFrame || UND,

          /**
           * Indicates that DOM content is ready for manipulation
           *
           * @see domready
           */
          ready: false,

          /**
           * Fires when DOM content is ready for manipulation
           *
           * @see domready
           */
          onready: function () {
            if ($J.browser.ready) {
              return;
            }

            var node;
            var style;
            $J.browser.ready = true;

            try {
              // Calculate width of browser's scrollbars
              var tmp = $J.$new('div').setCss({
                width: 100,
                height: 100,
                overflow: 'scroll',
                position: 'absolute',
                top: -9999
              }).appendTo(DOC.body);
              $J.browser.scrollbarsWidth = tmp.offsetWidth - tmp.clientWidth;
              tmp.remove();
            } catch (ex) {// empty
            }

            try {
              // Test multiple background support
              node = $J.$new('div');
              style = node.style;
              style.cssText = 'background:url(https://),url(https://),red url(https://)';
              $J.browser.features.multibackground = /(url\s*\(.*?){3}/.test(style.background);
              style = null;
              node = null;
            } catch (ex) {// empty
            }

            if (!$J.browser.cssTransformProp) {
              $J.browser.cssTransformProp = $J.dashize($J.normalizeCSS('transform'));
            }

            try {
              // Test CSS filters support
              node = $J.$new('div');
              node.style.cssText = $J.dashize($J.normalizeCSS('filter')) + ':blur(2px);';
              $J.browser.features.cssFilters = !!node.style.length && (!$J.browser.ieMode || $J.browser.ieMode > 9);
              node = null;
            } catch (ex) {// empty
            }

            if (!$J.browser.features.cssFilters) {
              $J.$(DOC.documentElement).addClass('no-cssfilters-magic');
            }

            try {
              // Test Canvas support
              $J.browser.features.canvas = function () {
                var tmp = $J.$new('canvas');
                return !!(tmp.getContext && tmp.getContext('2d'));
              }();
            } catch (ex) {// empty
            }

            if (WIN.TransitionEvent === UND && WIN.WebKitTransitionEvent !== UND) {
              EVENTS_MAP['transitionend'] = 'webkitTransitionEnd';
            }

            $J.$(DOC).callEvent('domready');
          }
        };

        (function () {
          var i;
          var magicClasses = []; // Extra CSS classes applied to <html> (e.g. lt-ie9-magic, mobile-magic)

          switch ($J.browser.engine) {
            case 'trident':
              if (!$J.browser.version) {
                $J.browser.version = !!WIN.XMLHttpRequest ? 3 : 2;
              }

              break;

            case 'gecko':
              $J.browser.version = _version && _version[2] ? parseFloat(_version[2]) : 0;
              break;
            // no default
          }

          $J.browser[$J.browser.engine] = true;

          if (_version && _version[1] === 'crios') {
            $J.browser.uaName = 'chrome';
          }

          if (!!WIN.chrome) {
            $J.browser.chrome = true;
          }

          if (_version && _version[1] === 'opr') {
            $J.browser.uaName = 'opera';
            $J.browser.opera = true;
          }

          if ($J.browser.uaName === 'safari' && _safariVer && _safariVer[1]) {
            $J.browser.uaVersion = parseFloat(_safariVer[1]);
          }

          if ($J.browser.platform === 'android' && $J.browser.webkit && _safariVer && _safariVer[1]) {
            $J.browser.androidBrowser = true;
          } // browser prefixes


          var prefixes = {
            gecko: ['-moz-', 'Moz', 'moz'],
            webkit: ['-webkit-', 'Webkit', 'webkit'],
            trident: ['-ms-', 'ms', 'ms'],
            presto: ['-o-', 'O', 'o']
          }[$J.browser.engine] || ['', '', ''];
          $J.browser.cssPrefix = prefixes[0];
          $J.browser.cssDomPrefix = prefixes[1];
          $J.browser.domPrefix = prefixes[2];

          $J.browser.ieMode = function () {
            var result;

            if (!$J.browser.trident) {
              result = UND;
            } else if (DOC.documentMode) {
              result = DOC.documentMode;
            } else if ($J.browser.backCompat) {
              result = 5;
            } else {
              var v = 0;

              switch ($J.browser.version) {
                case 2:
                  v = 6;
                  break;

                case 3:
                  v = 7;
                  break;
                // no default
              }

              result = v;
            }

            return result;
          }(); // Mobile Safari engine in the “request desktop site” mode on iOS/iPadOS.
          // Since iPadOS 13, Safari's “request desktop site” setting is turned on by default for all websites


          if (!$J.browser.mobile && $J.browser.platform === 'mac' && $J.browser.touchScreen) {
            $J.browser.mobile = true;
            $J.browser.platform = 'ios';
          }

          magicClasses.push($J.browser.platform + '-magic');

          if ($J.browser.mobile) {
            magicClasses.push('mobile-magic');
          }

          if ($J.browser.androidBrowser) {
            magicClasses.push('android-browser-magic');
          }

          if ($J.browser.ieMode) {
            // Add CSS class of the IE version to <html> for possible tricks
            $J.browser.uaName = 'ie';
            $J.browser.uaVersion = $J.browser.ieMode;
            magicClasses.push('ie' + $J.browser.ieMode + '-magic');

            for (i = 11; i > $J.browser.ieMode; i--) {
              magicClasses.push('lt-ie' + i + '-magic');
            }
          }

          if ($J.browser.webkit && $J.browser.version < 536) {
            // Disable fullscreen in old Safari
            $J.browser.features.fullScreen = false;
          }

          if ($J.browser.requestAnimationFrame) {
            // Enable native requestAnimationFrame if it works (issue in Safari 6.1.x)
            $J.browser.requestAnimationFrame.call(WIN, function () {
              $J.browser.features.requestAnimationFrame = true;
            });
          }

          if ($J.browser.features.svg) {
            magicClasses.push('svg-magic');
          } else {
            magicClasses.push('no-svg-magic');
          }

          var exClasses = (DOC.documentElement.className || '').match(/\S+/g) || [];
          DOC.documentElement.className = $J.$(exClasses).concat(magicClasses).join(' ');

          try {
            DOC.documentElement.setAttribute('data-magic-ua', $J.browser.uaName);
            DOC.documentElement.setAttribute('data-magic-ua-ver', $J.browser.uaVersion);
            DOC.documentElement.setAttribute('data-magic-engine', $J.browser.engine);
            DOC.documentElement.setAttribute('data-magic-engine-ver', $J.browser.version); // DOC.documentElement.setAttribute('data-magic-features', magicClasses.join(' '));
          } catch (ex) {// empty
          }

          if ($J.browser.ieMode && $J.browser.ieMode < 9) {
            // Workaround for IE<9 to support <figure> & <figcaption> elements
            DOC.createElement('figure');
            DOC.createElement('figcaption');
          } // Map pointer events for IE 10.


          if (!WIN.navigator.pointerEnabled) {
            ['Down', 'Up', 'Move', 'Over', 'Out'].forEach(function (type) {
              // EVENTS_MAP['pointer' + type.toLowerCase()] = WIN.navigator.msPointerEnabled ? 'MSPointer' + type : -1;
              var evt = 'pointer' + type.toLowerCase();

              if ($J.browser.uaName === 'edge') {
                EVENTS_MAP[evt] = evt;
              } else if (WIN.navigator.msPointerEnabled) {
                EVENTS_MAP[evt] = 'MSPointer' + type;
              } else {
                EVENTS_MAP[evt] = -1;
              }
            });
          }
        })();

        (function () {
          var getCancel = function () {
            var result = DOC.exitFullscreen || DOC.cancelFullScreen || document[$J.browser.domPrefix + 'ExitFullscreen'] || document[$J.browser.domPrefix + 'CancelFullScreen'];

            if (!result) {
              result = function () {};
            }

            return result;
          };

          var getChangeEventName = function () {
            var result;

            if (DOC.msExitFullscreen) {
              result = 'MSFullscreenChange';
            } else {
              if (DOC.exitFullscreen) {
                result = '';
              } else {
                result = $J.browser.domPrefix;
              }

              result += 'fullscreenchange';
            }

            return result;
          };

          var getErrorEventName = function () {
            var result;

            if (DOC.msExitFullscreen) {
              result = 'MSFullscreenError';
            } else {
              if (DOC.exitFullscreen) {
                result = '';
              } else {
                result = $J.browser.domPrefix;
              }

              result += 'fullscreenerror';
            }

            return result;
          };

          var callRequestFullscreen = function (el) {
            var f = el.requestFullscreen || el[$J.browser.domPrefix + 'RequestFullscreen'] || el[$J.browser.domPrefix + 'RequestFullScreen'];

            if (!f) {
              f = function () {};
            }

            f.call(el);
          };

          var fullScreen = {
            capable: $J.browser.features.fullScreen,
            enabled: function () {
              return !!(DOC.fullscreenElement || DOC[$J.browser.domPrefix + 'FullscreenElement'] || DOC.fullScreen || DOC.webkitIsFullScreen || DOC[$J.browser.domPrefix + 'FullScreen']);
            },
            request: function (el, opts) {
              if (!opts) {
                opts = {};
              }

              if (fullScreen.capable && !opts.windowFullscreen) {
                fullScreen.onchange = function (e) {
                  // onfullscreenchange event
                  if (fullScreen.enabled()) {
                    // we entered full-screen mode
                    if (opts.onEnter) {
                      opts.onEnter();
                    }
                  } else {
                    // left fullscreen mode
                    $J.$(DOC).removeEvent(fullScreen.changeEventName, fullScreen.onchange);

                    if (opts.onExit) {
                      opts.onExit();
                    }
                  }
                };

                $J.$(DOC).addEvent(fullScreen.changeEventName, fullScreen.onchange);

                fullScreen.onerror = function (e) {
                  // onfullscreenchange event
                  if (opts.fallback) {
                    opts.fallback();
                  }

                  $J.$(DOC).removeEvent(fullScreen.errorEventName, fullScreen.onerror);
                }; // if native fullscreen failed, enter pseudo mode


                $J.$(DOC).addEvent(fullScreen.errorEventName, fullScreen.onerror);
                callRequestFullscreen($(el).node);
              } else if (opts.fallback) {
                opts.fallback();
              }
            },
            cancel: getCancel(),
            changeEventName: getChangeEventName(),
            errorEventName: getErrorEventName(),
            prefix: $J.browser.domPrefix,
            activeElement: null
          };
          $J.browser.fullScreen = fullScreen;
        })();
        /* eslint-env es6 */

        /* global WIN, DOC, UND, docStyles, STORAGE, EVENTS_MAP */

        /* eslint-disable quote-props */

        /* eslint no-restricted-syntax: ["error", "WithStatement"] */

        /* eslint-disable camelcase */
        // Not whitespace regexp
        // const r_nwp = /\S+/g;


        var r_cssToNum = /^(border(Top|Bottom|Left|Right)Width)|((padding|margin)(Top|Bottom|Left|Right))$/; // normalize CSS names

        var cssMap = {
          'float': typeof docStyles.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat'
        }; // Unitless CSS properties (w/o 'px')

        var nopxCSS = {
          'fontWeight': true,
          'lineHeight': true,
          'opacity': true,
          'zIndex': true,
          'zoom': true
        };
        var getCssValue;

        if (WIN.getComputedStyle) {
          getCssValue = function (e, name) {
            var css = WIN.getComputedStyle(e, null);
            return css ? css.getPropertyValue(name) || css[name] : null;
          };
        } else {
          getCssValue = function (e, name) {
            var css = e.currentStyle;
            var v = null;
            v = css ? css[name] : null;

            if (v === null && e.style && e.style[name]) {
              v = e.style[name];
            }

            return v;
          };
        } // Returns normalize CSS name (probably with a vendor prefix)


        var normalizeCSS = function (name) {
          var pName; // Webkit reports the existence of the filter property, but it can be used only with -webkit- prefix.

          var standard = $J.browser.webkit && name === 'filter' ? false : name in docStyles; // if ( !(name in docStyles) ) {

          if (!standard) {
            pName = $J.browser.cssDomPrefix + name.charAt(0).toUpperCase() + name.slice(1);

            if (pName in docStyles) {
              return pName;
            }
          }

          return name;
        };

        $J.normalizeCSS = normalizeCSS;

        var Base = /*#__PURE__*/function () {
          "use strict";

          function Base(node) {
            this.node = node;
            this.$J_UUID = ++$J.UUID;
            this.$J_TYPE = null;

            this.$J_EXT = function () {};

            STORAGE.set(this.node, this);
          }
          /**
           * Retreive object's property from the global storage
           *
           * @param  {string}    - property name
           * @param  {mixed}     - default value
           *
           * @returns {mixed}     - property value
           */


          var _proto5 = Base.prototype;

          _proto5.fetch = function fetch(prop, def) {
            var s = $J.getStorage(this.$J_UUID);
            var p = s[prop];
            var result = null;

            if (def !== UND && p === UND) {
              s[prop] = def;
              p = s[prop];
            }

            if ($J.defined(p)) {
              result = p;
            }

            return result;
          }
          /**
           * Store object's property in the global storage
           *
           * @param  {string}    - property name
           * @param  {mixed}     - value
           *
           * @returns {element}   - HTML element
           */
          ;

          _proto5.store = function store(prop, val) {
            var s = $J.getStorage(this.$J_UUID);
            s[prop] = val;
            return this;
          }
          /**
           * Delete object's property from the global storage
           *
           * @param  {string}    - property name
           *
           * @returns {element}   - HTML element
           */
          ;

          _proto5.del = function del(prop) {
            var s = $J.getStorage(this.$J_UUID);
            delete s[prop];
            return this;
          }
          /**
           * Add event listener
           *
           * @param  type  {Mixed}     event type
           * @param  fn  {Function}    listener
           * @param  [priority=10] {Integer} order in which the listener will be called
           */
          ;

          _proto5.addEvent = function addEvent(type, fn, priority, options) {
            var _this6 = this;

            var handlers; // let _self;

            var _type;

            if ($J.typeOf(type) === 'string') {
              _type = type.split(' ');

              if (_type.length > 1) {
                type = _type;
              }
            }

            if ($J.typeOf(type) === 'array') {
              type.forEach(function (__type) {
                // this.addEvent.call(this, __type, fn, priority, options);
                _this6.addEvent(__type, fn, priority, options);
              });
              return this;
            } // Normalize event name


            type = EVENTS_MAP[type] || type;

            if (!type || !fn || $J.typeOf(type) !== 'string' || $J.typeOf(fn) !== 'function') {
              return this;
            }

            if (type === 'domready' && $J.browser.ready) {
              // fn.call(this);
              fn();
              return this;
            }

            priority = parseInt(priority || 50, 10);

            if (!fn.$J_EUID) {
              fn.$J_EUID = Math.floor(Math.random() * $J.now());
            } // const events = $J.Doc.fetch.call(this, '_EVENTS_', {});


            var events = this.fetch('_EVENTS_', {});
            handlers = events[type];

            if (!handlers) {
              // Initialize event handlers queue
              handlers = [];
              events[type] = handlers; // _self = this;

              if ($J.Events.handlers[type]) {
                $J.Events.handlers[type].add.call(this, options); // $J.Events.handlers[type].add(this, options);
              } else {
                // handlers['handle'] = function (e) {
                handlers['handle'] = function (e) {
                  e = $J.extend(e || WIN.e, {
                    $J_TYPE: 'event'
                  }); // $J.Doc.callEvent.call(_self, type, $J.$(e));

                  _this6.callEvent(type, $J.$(e));
                };

                this.node[$J._event_add_]($J._event_prefix_ + type, handlers['handle'], false);
              }
            }

            var fnObj = {
              type: type,
              fn: fn,
              priority: priority,
              euid: fn.$J_EUID
            };
            handlers.push(fnObj);
            handlers.sort(function (a, b) {
              return a.priority - b.priority;
            });
            return this;
          } // removeEvent(type/*, fn */) {
          ;

          _proto5.removeEvent = function removeEvent() {
            var _this7 = this;

            // const events = $J.Doc.fetch.call(this, '_EVENTS_', {});
            var events = this.fetch('_EVENTS_', {});
            var fnObj;
            var k;

            var _type; // let del;


            var type = arguments.length <= 0 ? undefined : arguments[0]; // const fn = arguments.length > 1 ? arguments[1] : -100;

            var fn = arguments.length > 1 ? arguments.length <= 1 ? undefined : arguments[1] : -100;

            if ($J.typeOf(type) === 'string') {
              _type = type.split(' ');

              if (_type.length > 1) {
                type = _type;
              }
            }

            if ($J.typeOf(type) === 'array') {
              // $J.$(type).each(this.removeEvent.bindAsEvent(this, fn));
              type.forEach(function (__type) {
                _this7.removeEvent(__type, fn);
              });
              return this;
            } // Normalize event name


            type = EVENTS_MAP[type] || type;

            if (!type || $J.typeOf(type) !== 'string' || !events || !events[type]) {
              return this;
            }

            var handlers = events[type] || [];

            for (k = 0; k < handlers.length; k++) {
              fnObj = handlers[k];

              if (fn === -100 || !!fn && fn.$J_EUID === fnObj.euid) {
                // del = handlers.splice(k--, 1);
                handlers.splice(k--, 1);
              }
            }

            if (handlers.length === 0) {
              if ($J.Events.handlers[type]) {
                $J.Events.handlers[type].remove.call(this);
              } else {
                this.node[$J._event_del_]($J._event_prefix_ + type, handlers['handle'], false);
              }

              delete events[type];
            }

            return this;
          };

          _proto5.callEvent = function callEvent(type, e) {
            var events = this.fetch('_EVENTS_', {});
            var k; // Normalize event name

            type = EVENTS_MAP[type] || type;

            if (!type || $J.typeOf(type) !== 'string' || !events || !events[type]) {// return this;
            } else {
              try {
                if (!e || !e.type) {
                  e = $J.extend(e || {}, {
                    type: type
                  });
                }
              } catch (ev) {// empty
              }

              if (e.timeStamp === UND) {
                e.timeStamp = $J.now();
              }

              var handlers = events[type] || [];

              for (k = 0; k < handlers.length && !(e.isQueueStopped && e.isQueueStopped()); k++) {
                handlers[k].fn.call(this, e);
              }
            }
          };

          _proto5.raiseEvent = function raiseEvent(type, name) {
            var _native = type !== 'domready';

            var o = this;
            var e; // Normalize event name

            type = EVENTS_MAP[type] || type;

            if (!_native) {
              this.callEvent(type);
              return this;
            }

            if (o === DOC && DOC.createEvent && !o.dispatchEvent) {
              o = DOC.documentElement;
            }

            if (DOC.createEvent) {
              e = DOC.createEvent(type);
              e.initEvent(name, true, true);
            } else {
              e = DOC.createEventObject();
              e.eventType = type;
            }

            if (DOC.createEvent) {
              o.dispatchEvent(e);
            } else {
              o.fireEvent('on' + name, e);
            }

            return e;
          };

          _proto5.clearEvents = function clearEvents() {
            // const events = $J.Doc.fetch.call(this, '_EVENTS_');
            var events = this.fetch('_EVENTS_');

            if (!events) {
              return this;
            }

            for (var _type in events) {
              if (Object.prototype.hasOwnProperty.call(events, _type)) {
                // $J.Doc.removeEvent.call(this, _type);
                this.removeEvent(_type);
              }
            } // $J.Doc.del.call(this, '_EVENTS_');


            this.del('_EVENTS_');
            return this;
          };

          return Base;
        }();

        var Element = /*#__PURE__*/function (_Base) {
          "use strict";

          bHelpers.inheritsLoose(Element, _Base);

          function Element(node) {
            var _this8;

            _this8 = _Base.call(this, node) || this;
            _this8.$J_TYPE = 'magicjs-element';
            return _this8;
          } // Full screen


          var _proto6 = Element.prototype;

          _proto6.requestFullScreen = function requestFullScreen() {
            if ($J.browser.fullScreen.capable && !DOC.requestFullScreen) {
              $J.browser.fullScreen.request(this.node);
            } else {
              this.node.requestFullScreen(this.node);
            }
          }
          /**
           * Adds class(es) to element
           *
           * @param {String}   val   One or more space-separated classes to be added
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.addClass = function addClass(val) {
            var _this9 = this;

            val = val ? val.split(' ') : [''];
            val.forEach(function (v) {
              v = v.trim();

              if (v) {
                _this9.node.classList.add(v);
              }
            });
            return this;
          }
          /**
           * Removes class(es) from element.
           *
           * @param {String}  [val] One or more space-separated classes to be removed. If omitted, remove all classes.
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.removeClass = function removeClass(val) {
            this.node.classList.remove(val);
            return this;
          }
          /**
           * Toogles a class on element
           *
           * @param {String}   val  A class name to be toggled
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.toggleClass = function toggleClass(val) {
            this.node.classList.toggle(val);
            return this;
          }
          /**
           * Retrieves element's css style
           *
           * @param {String}   property CSS property to retrieve
           *
           * @returns {Mixed}     Value of CSS property
           */
          ;

          _proto6.getCss = function getCss(p) {
            var cssName = $J.camelize(p);
            var v = null;

            if (!cssMap[cssName]) {
              cssMap[cssName] = normalizeCSS(cssName);
            }

            p = cssMap[cssName]; // p = cssMap[cssName] || (cssMap[cssName] = normalizeCSS(cssName));

            v = getCssValue(this.node, p);

            if (v === 'auto') {
              v = null;
            }

            if (v !== null) {
              if (p === 'opacity') return $J.defined(v) ? parseFloat(v) : 1.0;

              if (r_cssToNum.test(p)) {
                v = parseInt(v, 10) ? v : '0px';
              }
            }

            return v;
          }
          /**
           * Applies a single CSS style to element
           *
           * @param {String}      key        CSS property name
           * @param {Mixed}      value    Value to be set up
           *
           * @returns {Element}   Reference to the element itself
           */
          ;

          _proto6.setCssProp = function setCssProp(k, v) {
            var cssName = $J.camelize(k);

            try {
              if (!cssMap[cssName]) {
                cssMap[cssName] = normalizeCSS(cssName);
              }

              k = cssMap[cssName]; // k = cssMap[cssName] || (cssMap[cssName] = normalizeCSS(cssName));

              this.node.style[k] = v + ($J.typeOf(v) === 'number' && !nopxCSS[cssName] ? 'px' : '');
            } catch (e) {// empty
            }

            return this;
          }
          /**
           * Applies css styles to element
           *
           * @param {Hash}    styles  Set of the CSS styles to apply
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.setCss = function setCss(styles) {
            for (var s in styles) {
              if (Object.prototype.hasOwnProperty.call(styles, s)) {
                this.setCssProp(s, styles[s]);
              }
            }

            return this;
          }
          /**
           * Retrieves set of element's css style
           *
           * @param {String[]}   styles   CSS styles to retrieve
           *
           * @returns {Hash}      Set of CSS styles
           */
          ;

          _proto6.getStyles = function getStyles() {
            var _this10 = this;

            var r = {};

            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
              args[_key4] = arguments[_key4];
            }

            args.forEach(function (k) {
              r[k] = _this10.getCss(k);
            });
            return r;
          }
          /**
           * Applies properties to element
           *
           * @param {Hash}    properties  Set of properties to apply
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.setProps = function setProps(props) {
            for (var p in props) {
              if (p === 'class') {
                this.addClass('' + props[p]);
              } else {
                this.node.setAttribute(p, '' + props[p]);
              }
            }

            return this;
          };

          _proto6.getTransitionDuration = function getTransitionDuration() {
            var duration = 0;
            var delay = 0;
            duration = this.getCss('transition-duration');
            delay = this.getCss('transition-delay');

            if (duration.indexOf('ms') > -1) {
              duration = parseFloat(duration);
            } else if (duration.indexOf('s') > -1) {
              duration = parseFloat(duration) * 1000;
            }

            if (delay.indexOf('ms') > -1) {
              delay = parseFloat(delay);
            } else if (delay.indexOf('s') > -1) {
              delay = parseFloat(delay) * 1000;
            }

            return duration + delay;
          }
          /**
           * Gets size of element
           *
           * @returns {Hash} Size of the element  {width: x, height: x}
           */
          ;

          _proto6.getSize = function getSize() {
            return {
              'width': this.node.offsetWidth,
              'height': this.node.offsetHeight
            };
          }
          /**
           * Gets inner size of element
           *
           * @param  [withPadding=false] {Boolean} include padding in returning size
           *
           * @returns {Hash} Size of the element  {width: x, height: x}
           */
          ;

          _proto6.getInnerSize = function getInnerSize(withPadding) {
            var size = this.getSize();
            size.width -= parseFloat(this.getCss('border-left-width') || 0) + parseFloat(this.getCss('border-right-width') || 0);
            size.height -= parseFloat(this.getCss('border-top-width') || 0) + parseFloat(this.getCss('border-bottom-width') || 0);

            if (!withPadding) {
              size.width -= parseFloat(this.getCss('padding-left') || 0) + parseFloat(this.getCss('padding-right') || 0);
              size.height -= parseFloat(this.getCss('padding-top') || 0) + parseFloat(this.getCss('padding-bottom') || 0);
            }

            return size;
          }
          /**
           * Gets scroll offsets
           *
           * @returns {Hash} Number of pixels that element has been scrolled upward and to the left
           */
          ;

          _proto6.getScroll = function getScroll() {
            return {
              'top': this.node.scrollTop,
              'left': this.node.scrollLeft
            };
          }
          /**
           * Gets scroll offsets from the window top left corner
           *
           * @returns {Hash}
           */
          ;

          _proto6.getFullScroll = function getFullScroll() {
            var el = this.node;
            var p = {
              'top': 0,
              'left': 0
            };

            do {
              p.left += el.scrollLeft || 0;
              p.top += el.scrollTop || 0;
              el = el.parentNode;
            } while (el);

            return p;
          }
          /**
           * Gets absolue position of element
           *
           * @returns {Hash} Coordinates of element's top left corner
           */
          ;

          _proto6.getPosition = function getPosition() {
            var el = this.node;
            var l = 0;
            var t = 0;

            if ($J.defined(DOC.documentElement.getBoundingClientRect)) {
              var b = this.node.getBoundingClientRect();
              var docScroll = $J.$(DOC).getScroll();
              var doc = $J.browser.getDoc();
              return {
                'top': b.top + docScroll.y - doc.clientTop,
                'left': b.left + docScroll.x - doc.clientLeft
              };
            }

            do {
              l += el.offsetLeft || 0;
              t += el.offsetTop || 0;
              el = el.offsetParent;
            } while (el && !/^(?:body|html)$/i.test(el.tagName));

            return {
              'top': t,
              'left': l
            };
          }
          /**
           * Gets element's absolute coordinates on a page
           *
           * @returns {Hash}  top/left/bottom/right coordinates
           */
          ;

          _proto6.getRect = function getRect() {
            var p = this.getPosition();
            var s = this.getSize();
            return {
              'top': p.top,
              'bottom': p.top + s.height,
              'left': p.left,
              'right': p.left + s.width
            };
          }
          /**
           * Sets element content
           *
           * @param {String} content New content
           *
           * @returns {Element}   Reference to the element itself
           */
          ;

          _proto6.changeContent = function changeContent(c) {
            try {
              this.node.innerHTML = c;
            } catch (e) {
              this.node.innerText = c;
            }

            return this;
          }
          /**
           * Removes element from the DOM tree
           *
           * @returns {Element} Reference to the removed element
           */
          ;

          _proto6.remove = function remove() {
            var result = this;

            if (this.node.parentNode) {
              result = $J.$(this.node.parentNode.removeChild(this.node));
            } // TODO remove from storage


            return result;
          }
          /**
           * Kills element by removes it DOM tree and clear all events.
           * All child elements will be killed too.
           *
           * @returns Null
           */
          ;

          _proto6.kill = function kill() {
            $J.$A(this.node.childNodes).forEach(function (o) {
              if (o.nodeType === 3 || o.nodeType === 8) {
                return;
              }

              $J.$(o).kill();
            });
            this.remove();
            this.clearEvents();

            if (this.$J_UUID) {
              $J.storage[this.$J_UUID] = null;
              delete $J.storage[this.$J_UUID];
            }

            return null;
          }
          /**
           * Appends child element
           *
           * @param  {Element}   element  Element to append
           * @param  {String}    [position='bottom']  Where to append: top/bottom.
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.append = function append(o, p) {
            if (p === void 0) {
              p = 'bottom';
            }

            var f = this.node.firstChild;
            o = $J.$(o);

            if (p === 'top' && f) {
              this.node.insertBefore(o.node, f);
            } else {
              this.node.appendChild(o.node || o);
            }

            return this;
          }
          /**
           * Appends element to parent
           *
           * @param  {Element}   parent   Parent element
           * @param  {String}    [position='bottom']  Where to append: top/bottom.
           *
           * @returns {Element}    Reference to the element itself
           */
          ;

          _proto6.appendTo = function appendTo(o, p) {
            // return $J.$(o).append(this, p);
            $J.$(o).append(this, p);
            return this;
          };

          _proto6.getTagName = function getTagName() {
            return this.node.tagName.toLowerCase();
          };

          _proto6.attr = function attr(attrName, attrValue) {
            var result = this;

            if ($J.defined(attrValue)) {
              this.node.setAttribute(attrName, attrValue);
            } else {
              result = this.node.getAttribute(attrName);

              if (!result || $J.typeOf(result) !== 'string' || result.trim() === '') {
                result = null;
              }
            }

            return result;
          };

          _proto6.removeAttr = function removeAttr(attrName) {
            this.node.removeAttribute(attrName);
            return this;
          }
          /**
           * Checks if the specified class applied to the element
           * @param  {String}  cName Class to check
           * @return {Boolean}
           */
          ;

          _proto6.hasClass = function hasClass(cName) {
            // Use `classList` if browser supports it.
            if (this.node.classList) {
              return this.node.classList.contains(cName);
            }

            var className = this.node.className;

            if (this.node.className instanceof SVGAnimatedString) {
              className = this.node.className.baseVal;
            }

            return !$J.stringHas(cName || '', ' ') && $J.stringHas(className || '', ' ');
          };

          _proto6.hasAttribute = function hasAttribute(attrName) {
            return this.node.hasAttribute(attrName);
          };

          return Element;
        }(Base);
        /* eslint-disable class-methods-use-this */


        var Doc = /*#__PURE__*/function (_Base2) {
          "use strict";

          bHelpers.inheritsLoose(Doc, _Base2);

          function Doc(node) {
            var _this11;

            _this11 = _Base2.call(this, node) || this;
            var type = 'magicjs-document';

            if (node === WIN) {
              type = 'magicjs-window';
            }

            _this11.$J_TYPE = type;
            return _this11;
          }
          /**
           * Gets size of browser window
           */


          var _proto7 = Doc.prototype;

          _proto7.getSize = function getSize() {
            if ($J.browser.touchScreen || $J.browser.presto925 || $J.browser.webkit419) {
              return {
                'width': WIN.innerWidth,
                'height': WIN.innerHeight
              };
            }

            return {
              'width': $J.browser.getDoc().clientWidth,
              'height': $J.browser.getDoc().clientHeight
            };
          }
          /**
           * Gets window scroll offsets
           */
          ;

          _proto7.getScroll = function getScroll() {
            return {
              'x': WIN.pageXOffset || $J.browser.getDoc().scrollLeft,
              'y': WIN.pageYOffset || $J.browser.getDoc().scrollTop
            };
          }
          /**
           * Get full page size including scroll
           */
          ;

          _proto7.getFullSize = function getFullSize() {
            var s = this.getSize();
            return {
              'width': Math.max($J.browser.getDoc().scrollWidth, s.width),
              'height': Math.max($J.browser.getDoc().scrollHeight, s.height)
            };
          };

          return Doc;
        }(Base);
        /* eslint-env es6 */

        /* global magicJS, $J */

        /* global WIN, DOC, UND */

        /* global EVENTS_MAP */

        /* eslint-disable dot-notation */

        /* eslint-disable no-unused-vars */

        /* eslint no-restricted-syntax: ["error", "WithStatement", "BinaryExpression[operator='in']"] */

        /* eslint no-unused-vars: ["error", { "args": "none" }] */


        $J.Events = {};
        /**
         * Contains Event methods, custom Events and Element methods to dealing with events.
         * @class Contains Event methods, custom Events and Element methods to dealing with events.
         */

        var MagicEvent = /*#__PURE__*/function () {
          "use strict";

          function MagicEvent(originEvent) {
            this.oe = originEvent;
            this.$J_TYPE = 'event';
            this.isQueueStopped = $J.$false;
            this.type = this.oe.type;
            this.timeStamp = this.oe.timeStamp;
            this.propertyName = this.oe.propertyName;
            this.pointerType = this.oe.pointerType;
          }

          var _proto8 = MagicEvent.prototype;

          _proto8.getOriginEvent = function getOriginEvent() {
            return this.oe;
          }
          /**
           * Stop event propagation and default actions.
           * @return {Event}
           */
          ;

          _proto8.stop = function stop() {
            return this.stopDistribution().stopDefaults();
          }
          /**
           * Stop event propagation.
           * @return {Event}
           */
          ;

          _proto8.stopDistribution = function stopDistribution() {
            if (this.oe.stopPropagation) {
              // if (this.oe.cancelable) {
              this.oe.stopPropagation(); // }
            } else {
              this.oe.cancelBubble = true;
            }

            return this;
          }
          /**
           * Stop default action.
           * @return {Event}
           */
          ;

          _proto8.stopDefaults = function stopDefaults() {
            if (this.oe.preventDefault) {
              this.oe.preventDefault();
            } else {
              this.oe.returnValue = false;
            }

            return this;
          }
          /**
           * Prevent other listeners to handle the event.
           * @return {Event}
           */
          ;

          _proto8.stopQueue = function stopQueue() {
            this.isQueueStopped = $J.$true;
            return this;
          }
          /**
           * Return mouse/pointer coordinates relative to the viewport.
           * @return {Object}
           */
          ;

          _proto8.getClientXY = function getClientXY() {
            var src;
            var result = {
              x: 0,
              y: 0
            };

            if (/touch/i.test(this.type)) {
              src = this.oe.changedTouches[0];
            } else {
              src = this.oe;
            }

            if ($J.defined(src)) {
              result = {
                x: src.clientX,
                y: src.clientY
              };
            }

            return result;
          }
          /**
           * Return mouse/pointer coordinates relative to the viewport, including scroll offset.
           * @return {Object}
           */
          ;

          _proto8.getPageXY = function getPageXY() {
            var src;
            var result = {
              x: 0,
              y: 0
            };

            if (/touch/i.test(this.type)) {
              src = this.oe.changedTouches[0];
            } else {
              src = this.oe;
            }

            if ($J.defined(src)) {
              result = {
                x: src.pageX || src.clientX + $J.browser.getDoc().scrollLeft,
                y: src.pageY || src.clientY + $J.browser.getDoc().scrollTop
              };
            }

            return result;
          }
          /**
           * Return target element.
           * @return {Element}
           */
          ;

          _proto8.getTarget = function getTarget() {
            var t = this.oe.target;

            if (!t) {
              t = this.oe.srcElement;
            }

            while (t && t.nodeType === 3) {
              t = t.parentNode;
            }

            return t;
          }
          /**
           * Return related element.
           * @return {Element}
           */
          ;

          _proto8.getRelated = function getRelated() {
            var r = null;

            switch (this.type) {
              case 'mouseover':
              case 'pointerover':
              case 'MSPointerOver':
                r = this.oe.relatedTarget;

                if (!r) {
                  r = this.oe.fromElement;
                }

                break;

              case 'mouseout':
              case 'pointerout':
              case 'MSPointerOut':
                r = this.oe.relatedTarget;

                if (!r) {
                  r = this.oe.toElement;
                }

                break;

              default:
                return r;
            }

            try {
              while (r && r.nodeType === 3) {
                r = r.parentNode;
              }
            } catch (ex) {
              r = null;
            }

            return r;
          }
          /**
           * Return clicked button
           *  1 - left, 2 - middle, 3 - right
           *
           * @returns  {integer}   button index
           */
          ;

          _proto8.getButton = function getButton() {
            var result = this.oe.which;

            if (!this.oe.which && this.oe.button !== UND) {
              if (this.oe.button & 1) {
                result = 1;
              } else if (this.oe.button & 2) {
                result = 3;
              } else if (this.oe.button & 4) {
                result = 2;
              } else {
                result = 0;
              }
            }

            return result;
          }
          /**
           * Return true if it's a Touch/Pointer event.
           * @return {Boolean}
           */
          ;

          _proto8.isTouchEvent = function isTouchEvent() {
            return this.oe.pointerType && (this.oe.pointerType === 'touch' || this.oe.pointerType === this.oe.MSPOINTER_TYPE_TOUCH) || /touch/i.test(this.type);
          }
          /**
           * Return true if it's a primary Touch/Pointer event.
           * @return {Boolean}
           */
          ;

          _proto8.isPrimaryTouch = function isPrimaryTouch() {
            if (this.oe.pointerType) {
              return (this.oe.pointerType === 'touch' || this.oe.MSPOINTER_TYPE_TOUCH === this.oe.pointerType) && this.oe.isPrimary;
            } else if (this.oe instanceof WIN.TouchEvent) {
              return this.oe.changedTouches.length === 1 && (this.oe.targetTouches.length ? this.oe.targetTouches[0].identifier === this.oe.changedTouches[0].identifier : true);
            }

            return false;
          }
          /**
           * Return reference to the primary Touch/Pointer event.
           * @return {Object}
           */
          ;

          _proto8.getPrimaryTouch = function getPrimaryTouch() {
            var result = null;

            if (this.oe.pointerType) {
              if (this.oe.isPrimary && (this.oe.pointerType === 'touch' || this.oe.MSPOINTER_TYPE_TOUCH === this.oe.pointerType)) {
                result = this.oe;
              }
            } else if (this.oe instanceof WIN.TouchEvent) {
              result = this.oe.changedTouches[0];
            }

            return result;
          }
          /**
           * Return identifier of the primary Touch/Pointer event.
           * @return {Int}
           */
          ;

          _proto8.getPrimaryTouchId = function getPrimaryTouchId() {
            var result = null;

            if (this.oe.pointerType) {
              if (this.oe.isPrimary && (this.oe.pointerType === 'touch' || this.oe.MSPOINTER_TYPE_TOUCH === this.oe.pointerType)) {
                result = this.oe.pointerId;
              }
            } else if (this.oe instanceof WIN.TouchEvent) {
              result = this.oe.changedTouches[0].identifier;
            }

            return result;
          };

          return MagicEvent;
        }();

        $J.Events.MagicEvent = MagicEvent;
        /* Extend Element and Document prototypes */

        $J._event_add_ = 'addEventListener';
        $J._event_del_ = 'removeEventListener';
        $J._event_prefix_ = '';

        if (!DOC.addEventListener) {
          $J._event_add_ = 'attachEvent';
          $J._event_del_ = 'detachEvent';
          $J._event_prefix_ = 'on';
        }

        var Custom = /*#__PURE__*/function () {
          "use strict";

          function Custom(e) {
            this.$J_TYPE = 'event.custom';
            this.magicEvent = e.$J_TYPE === 'event' ? e : e.magicEvent;
            this.type = this.magicEvent.type; // this.target = this.magicEvent.oe.target;

            this.x = this.magicEvent.oe.x;
            this.y = this.magicEvent.oe.y;
            this.button = this.magicEvent.getButton();
            this.timeStamp = this.magicEvent.oe.timeStamp;
            this.relatedTarget = this.magicEvent.getRelated();
            this.isQueueStopped = this.magicEvent.isQueueStopped; // TODO $J.$false

            this.events = [];
          }

          var _proto9 = Custom.prototype;

          _proto9.getOriginEvent = function getOriginEvent() {
            return this.magicEvent.getOriginEvent();
          };

          _proto9.pushToEvents = function pushToEvents(e) {
            var eventCopy = e;
            this.events.push(eventCopy);
          };

          _proto9.stop = function stop() {
            return this.stopDistribution().stopDefaults();
          };

          _proto9.stopDistribution = function stopDistribution() {
            this.events.forEach(function (e) {
              try {
                e.stopDistribution();
              } catch (ex) {// empty
              }
            });
            return this;
          };

          _proto9.stopDefaults = function stopDefaults() {
            this.events.forEach(function (e) {
              try {
                e.stopDefaults();
              } catch (ex) {// empty
              }
            });
            return this;
          };

          _proto9.stopQueue = function stopQueue() {
            this.isQueueStopped = $J.$true;
            this.magicEvent.stopQueue();
            return this;
          }
          /**
           * Return mouse/pointer coordinates relative to the viewport.
           * @return {Object}
           */
          ;

          _proto9.getClientXY = function getClientXY() {
            return {
              x: this.clientX || this.magicEvent.oe.clientX,
              y: this.clientY || this.magicEvent.oe.clientY
            };
          }
          /**
           * Return mouse/pointer coordinates relative to the viewport, including scroll offset.
           * @return {Object}
           */
          ;

          _proto9.getPageXY = function getPageXY() {
            return {
              x: this.x,
              y: this.y
            };
          };

          _proto9.getTarget = function getTarget() {
            return this.target || this.magicEvent.oe.target;
          };

          _proto9.getRelated = function getRelated() {
            return this.relatedTarget;
          };

          _proto9.getButton = function getButton() {
            return this.button;
          };

          _proto9.getOriginalTarget = function getOriginalTarget() {
            var result = UND;

            if (this.events.length > 0) {
              result = this.events[0].getTarget();
            }

            return result;
          }
          /**
           * Return true if it's a Touch/Pointer event.
           * @return {Boolean}
           */
          ;

          _proto9.isTouchEvent = function isTouchEvent() {
            return this.magicEvent.isTouchEvent();
          }
          /**
           * Return true if it's a primary Touch/Pointer event.
           * @return {Boolean}
           */
          ;

          _proto9.isPrimaryTouch = function isPrimaryTouch() {
            return this.magicEvent.isPrimaryTouch();
          }
          /**
           * Return reference to the primary Touch/Pointer event.
           * @return {Object}
           */
          ;

          _proto9.getPrimaryTouch = function getPrimaryTouch() {
            return this.magicEvent.getPrimaryTouch();
          }
          /**
           * Return identifier of the primary Touch/Pointer event.
           * @return {Int}
           */
          ;

          _proto9.getPrimaryTouchId = function getPrimaryTouchId() {
            return this.magicEvent.getPrimaryTouchId();
          };

          return Custom;
        }();

        $J.Events.Custom = Custom;
        $J.Events.handlers = {};
        /**
         * Dom ready custom event implementation
         */

        (function ($J) {
          if (DOC.readyState === 'interactive' || DOC.readyState === 'complete') {
            setTimeout(function () {
              return $J.browser.onready();
            }, 0);
          } else {
            $J.$(DOC).addEvent('readystatechange', function (event) {
              if (event.getTarget().readyState === 'interactive' || event.getTarget().readyState === 'complete') {
                $J.browser.onready();
              }
            });
            $J.$(DOC).addEvent('DOMContentLoaded', $J.browser.onready);
            $J.$(WIN).addEvent('load', $J.browser.onready);
          }
        })(magicJS);
        /* eslint-env es6 */

        /* eslint no-restricted-properties: [2, {"object": "Math.pow"}] */

        /* global magicJS, DOC */


        (function ($J) {
          var RADIUS_THRESHOLD = 5; // Click radius  // Click speed threshold

          var TIME_THRESHOLD = 300; // Click speed threshold

          var BtnClick = /*#__PURE__*/function (_$J$Events$Custom) {
            "use strict";

            bHelpers.inheritsLoose(BtnClick, _$J$Events$Custom);

            function BtnClick(e, target) {
              var _this12;

              _this12 = _$J$Events$Custom.call(this, e) || this;
              var r = e.getPageXY();
              _this12.type = 'btnclick';
              _this12.x = r.x;
              _this12.y = r.y;
              _this12.clientX = e.oe.clientX;
              _this12.clientY = e.oe.clientY;
              _this12.target = target.node;

              _this12.pushToEvents(e);

              return _this12;
            }

            return BtnClick;
          }($J.Events.Custom);

          var _options = {
            threshold: TIME_THRESHOLD,
            // Click speed threshold
            button: 1 // left button

          };

          var onclick = function (e) {
            e.stopDefaults();
          };

          var handle = function (e) {
            var btnclickEvent;
            var r;
            var options = this.fetch('event:btnclick:options');

            if (e.type !== 'dblclick' && e.getButton() !== options.button) {
              return;
            }

            if (this.fetch('event:btnclick:ignore')) {
              this.del('event:btnclick:ignore');
              return;
            }

            if (e.type === 'mousedown') {
              // e.stop(); // will it cause problems? but if we need to stop mousedown user wont be able to do this, as we don't pass it
              btnclickEvent = new BtnClick(e, this);
              this.store('event:btnclick:btnclickEvent', btnclickEvent);
            } else if (e.type === 'mouseup') {
              btnclickEvent = this.fetch('event:btnclick:btnclickEvent');

              if (!btnclickEvent) {
                return;
              }

              r = e.getPageXY();
              this.del('event:btnclick:btnclickEvent');
              btnclickEvent.pushToEvents(e); // if (e.timeStamp - btnclickEvent.timeStamp <= options.threshold && btnclickEvent.x == r.x && btnclickEvent.y == r.y) {

              if (e.timeStamp - btnclickEvent.timeStamp <= options.threshold && Math.sqrt(Math.pow(r.x - btnclickEvent.x, 2) + Math.pow(r.y - btnclickEvent.y, 2)) <= RADIUS_THRESHOLD) {
                this.callEvent('btnclick', btnclickEvent);
              } // Release mousedrag event


              $(DOC).callEvent('mouseup', e);
            } else if (e.type === 'dblclick') {
              // fire another btnclick because IE doesn't fire second mousedown on double click (and second click too)
              btnclickEvent = new BtnClick(e, this);
              this.callEvent('btnclick', btnclickEvent);
            }
          };

          var handler = {
            add: function (options) {
              this.store('event:btnclick:options', $J.extend($J.detach(_options), options || {}));
              this.addEvent('mousedown', handle, 1);
              this.addEvent('mouseup', handle, 1);
              this.addEvent('click', onclick, 1);
            },
            remove: function () {
              this.removeEvent('mousedown', handle);
              this.removeEvent('mouseup', handle);
              this.removeEvent('click', onclick);
            }
          };
          $J.Events.handlers.btnclick = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* global magicJS, DOC */


        (function ($J) {
          var Mousedrag = /*#__PURE__*/function (_$J$Events$Custom2) {
            "use strict";

            bHelpers.inheritsLoose(Mousedrag, _$J$Events$Custom2);

            function Mousedrag(e, target, state) {
              var _this13;

              _this13 = _$J$Events$Custom2.call(this, e) || this;
              var r = e.getPageXY();
              _this13.x = r.x;
              _this13.y = r.y;
              _this13.type = 'mousedrag';
              _this13.clientX = e.clientX;
              _this13.clientY = e.clientY;
              _this13.target = target.node;
              _this13.state = state; // dragmove / dragend

              _this13.dragged = false;

              _this13.pushToEvents(e);

              return _this13;
            }

            return Mousedrag;
          }($J.Events.Custom);

          var handleMouseDown = function (e) {
            if (e.getButton() !== 1) {
              return;
            } // e.stopDefaults();


            var dragEvent = new Mousedrag(e, this, 'dragstart');
            this.store('event:mousedrag:dragstart', dragEvent); // this.callEvent('mousedrag', dragEvent);
          };

          var handleMouseUp = function (e) {
            var dragEvent;
            dragEvent = this.fetch('event:mousedrag:dragstart');

            if (!dragEvent) {
              return;
            }

            e.stopDefaults();
            dragEvent = new Mousedrag(e, this, 'dragend');
            this.del('event:mousedrag:dragstart');
            this.callEvent('mousedrag', dragEvent);
          };

          var handleMouseMove = function (e) {
            var dragEvent;
            dragEvent = this.fetch('event:mousedrag:dragstart');

            if (!dragEvent) {
              return;
            }

            e.stopDefaults();

            if (!dragEvent.dragged) {
              dragEvent.dragged = true;
              this.callEvent('mousedrag', dragEvent); // send dragstart
            }

            dragEvent = new Mousedrag(e, this, 'dragmove');
            this.callEvent('mousedrag', dragEvent);
          };

          var handler = {
            add: function () {
              var move = handleMouseMove.bind(this);
              var end = handleMouseUp.bind(this);
              this.addEvent('mousedown', handleMouseDown, 1);
              this.addEvent('mouseup', handleMouseUp, 1);
              $(DOC).addEvent('mousemove', move, 1);
              $(DOC).addEvent('mouseup', end, 1);
              this.store('event:mousedrag:listeners:document:move', move);
              this.store('event:mousedrag:listeners:document:end', end);
            },
            remove: function () {
              var f = function () {};

              this.removeEvent('mousedown', handleMouseDown);
              this.removeEvent('mouseup', handleMouseUp);
              $(DOC).removeEvent('mousemove', this.fetch('event:mousedrag:listeners:document:move') || f);
              $(DOC).removeEvent('mouseup', this.fetch('event:mousedrag:listeners:document:end') || f);
              this.del('event:mousedrag:listeners:document:move');
              this.del('event:mousedrag:listeners:document:end');
            }
          };
          $J.Events.handlers.mousedrag = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* global magicJS */


        (function ($J) {
          var Dblbtnclick = /*#__PURE__*/function (_$J$Events$Custom3) {
            "use strict";

            bHelpers.inheritsLoose(Dblbtnclick, _$J$Events$Custom3);

            function Dblbtnclick(e, target) {
              var _this14;

              _this14 = _$J$Events$Custom3.call(this, e) || this;
              var r = e.getPageXY();
              _this14.x = r.x;
              _this14.y = r.y;
              _this14.type = 'dblbtnclick';
              _this14.clientX = e.clientX;
              _this14.clientY = e.clientY;
              _this14.target = target.node;
              _this14.timedout = false;
              _this14.tm = null;

              _this14.pushToEvents(e);

              return _this14;
            }

            return Dblbtnclick;
          }($J.Events.Custom);

          var _options = {
            threshold: 200
          };

          var handle = function (e) {
            var _this15 = this;

            var event = this.fetch('event:dblbtnclick:event');
            var options = this.fetch('event:dblbtnclick:options');

            if (!event) {
              // first click
              event = new Dblbtnclick(e, this);
              event.tm = setTimeout(function () {
                event.timedout = true;
                e.isQueueStopped = $J.$false;

                _this15.callEvent('btnclick', e);

                _this15.del('event:dblbtnclick:event');
              }, options.threshold + 10);
              this.store('event:dblbtnclick:event', event);
              e.stopQueue();
            } else {
              clearTimeout(event.tm);
              this.del('event:dblbtnclick:event');

              if (!event.timedout) {
                // double click detected within threshold timeout
                event.pushToEvents(e);
                e.stopQueue().stop();
                this.callEvent('dblbtnclick', event);
              } else {// double click timed out
              }
            }
          };

          var handler = {
            add: function (options) {
              this.store('event:dblbtnclick:options', $J.extend($J.detach(_options), options || {}));
              this.addEvent('btnclick', handle, 1); // we should be first handler in queue or this wont work
            },
            remove: function () {
              this.removeEvent('btnclick', handle);
            }
          };
          $J.Events.handlers.dblbtnclick = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* global magicJS */

        /* eslint no-restricted-properties: [2, {"object": "Math.pow"}] */

        /* eslint no-unused-vars: ["error", { "args": "none" }] */


        (function ($J) {
          // Tap thresholds
          var RADIUS_THRESHOLD = 10;
          var TIME_THRESHOLD = 200;

          var Tap = /*#__PURE__*/function (_$J$Events$Custom4) {
            "use strict";

            bHelpers.inheritsLoose(Tap, _$J$Events$Custom4);

            function Tap(e, target) {
              var _this16;

              _this16 = _$J$Events$Custom4.call(this, e) || this;
              var touch = e.getPrimaryTouch();
              _this16.type = 'tap';
              _this16.id = touch.pointerId || touch.identifier;
              _this16.x = touch.pageX;
              _this16.y = touch.pageY;
              _this16.pageX = touch.pageX;
              _this16.pageY = touch.pageY;
              _this16.clientX = touch.clientX;
              _this16.clientY = touch.clientY;
              _this16.button = 0;
              _this16.target = target.node;

              _this16.pushToEvents(e);

              return _this16;
            }

            return Tap;
          }($J.Events.Custom);

          var onClick = function (e) {
            e.stopDefaults();
          };

          var onTouchStart = function (e) {
            if (!e.isPrimaryTouch()) {
              this.del('event:tap:event');
              return;
            }

            this.store('event:tap:event', new Tap(e, this)); // Prevent btnclick event

            this.store('event:btnclick:ignore', true);
          };

          var onTouchEnd = function (e) {
            // let now = $J.now();
            var event = this.fetch('event:tap:event'); // let options = this.fetch('event:tap:options');

            if (!event || !e.isPrimaryTouch()) {
              return;
            }

            this.del('event:tap:event');

            if (event.id === e.getPrimaryTouchId() && e.timeStamp - event.timeStamp <= TIME_THRESHOLD && Math.sqrt(Math.pow(e.getPrimaryTouch().pageX - event.x, 2) + Math.pow(e.getPrimaryTouch().pageY - event.y, 2)) <= RADIUS_THRESHOLD) {
              this.del('event:btnclick:btnclickEvent');
              e.stop();
              event.pushToEvents(e);
              this.callEvent('tap', event);
            }
          };

          var handler = {
            add: function (options) {
              this.addEvent(['touchstart', 'pointerdown'], onTouchStart, 1);
              this.addEvent(['touchend', 'pointerup'], onTouchEnd, 1);
              this.addEvent('click', onClick, 1);
            },
            remove: function () {
              this.removeEvent(['touchstart', 'pointerdown'], onTouchStart);
              this.removeEvent(['touchend', 'pointerup'], onTouchEnd);
              this.removeEvent('click', onClick);
            }
          };
          $J.Events.handlers.tap = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* global magicJS */


        (function ($J) {
          var Dbltap = /*#__PURE__*/function (_$J$Events$Custom5) {
            "use strict";

            bHelpers.inheritsLoose(Dbltap, _$J$Events$Custom5);

            function Dbltap(e, target) {
              var _this17;

              _this17 = _$J$Events$Custom5.call(this, e) || this;
              _this17.type = 'dbltap';
              _this17.x = e.x;
              _this17.y = e.y;
              _this17.clientX = e.clientX;
              _this17.clientY = e.clientY;
              _this17.target = target.node;
              _this17.timedout = false;
              _this17.tm = null;

              _this17.pushToEvents(e);

              return _this17;
            }

            return Dbltap;
          }($J.Events.Custom);

          var _options = {
            threshold: 300
          };

          var handle = function (e) {
            var _this18 = this;

            var event = this.fetch('event:dbltap:event');
            var options = this.fetch('event:dbltap:options');

            if (!event) {
              // first tap
              event = new Dbltap(e, this);
              event.tm = setTimeout(function () {
                event.timedout = true;
                e.isQueueStopped = $J.$false;

                _this18.callEvent('tap', e);
              }, options.threshold + 10);
              this.store('event:dbltap:event', event);
              e.stopQueue();
            } else {
              clearTimeout(event.tm);
              this.del('event:dbltap:event');

              if (!event.timedout) {
                // double tap detected within threshold timeout
                event.pushToEvents(e);
                e.stopQueue().stop();
                this.callEvent('dbltap', event);
              } else {// double tap timed out
              }
            }
          };

          var handler = {
            add: function (options) {
              this.store('event:dbltap:options', $J.extend($J.detach(_options), options || {}));
              this.addEvent('tap', handle, 1); // we should be first handler in queue or this wont work
            },
            remove: function () {
              this.removeEvent('tap', handle);
            }
          };
          $J.Events.handlers.dbltap = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* eslint no-restricted-properties: [2, {"object": "Math.pow"}] */

        /* global magicJS, DOC */


        (function ($J) {
          var RADIUS_THRESHOLD = 10;

          var Touchdrag = /*#__PURE__*/function (_$J$Events$Custom6) {
            "use strict";

            bHelpers.inheritsLoose(Touchdrag, _$J$Events$Custom6);

            function Touchdrag(e, target, state) {
              var _this19;

              _this19 = _$J$Events$Custom6.call(this, e) || this;
              var touch = e.getPrimaryTouch();
              _this19.type = 'touchdrag';
              _this19.id = touch.pointerId || touch.identifier;
              _this19.clientX = touch.clientX;
              _this19.clientY = touch.clientY;
              _this19.pageX = touch.pageX;
              _this19.pageY = touch.pageY;
              _this19.x = touch.pageX;
              _this19.y = touch.pageY;
              _this19.button = 0;
              _this19.target = target.node;
              _this19.state = state; // dragmove / dragend

              _this19.dragged = false;

              _this19.pushToEvents(e);

              return _this19;
            }

            return Touchdrag;
          }($J.Events.Custom);

          var onTouchStart = function (e) {
            // if ( !isPrimaryTouch(e) ) {
            if (!e.isPrimaryTouch()) {
              return;
            }

            var dragEvent = new Touchdrag(e, this, 'dragstart');
            this.store('event:touchdrag:dragstart', dragEvent);
          };

          var onTouchEnd = function (e) {
            var dragEvent;
            dragEvent = this.fetch('event:touchdrag:dragstart');

            if (!dragEvent || !dragEvent.dragged || dragEvent.id !== e.getPrimaryTouchId()) {
              return;
            }

            dragEvent = new Touchdrag(e, this, 'dragend');
            this.del('event:touchdrag:dragstart');
            this.callEvent('touchdrag', dragEvent);
          };

          var onTouchMove = function (e) {
            var dragEvent;
            dragEvent = this.fetch('event:touchdrag:dragstart');

            if (!dragEvent || !e.isPrimaryTouch()) {
              return;
            }

            if (dragEvent.id !== e.getPrimaryTouchId()) {
              this.del('event:touchdrag:dragstart');
              return;
            }

            if (!dragEvent.dragged && Math.sqrt(Math.pow(e.getPrimaryTouch().pageX - dragEvent.x, 2) + Math.pow(e.getPrimaryTouch().pageY - dragEvent.y, 2)) > RADIUS_THRESHOLD) {
              dragEvent.dragged = true;
              this.callEvent('touchdrag', dragEvent); // send dragstart
            }

            if (!dragEvent.dragged) {
              return;
            }

            dragEvent = new Touchdrag(e, this, 'dragmove');
            this.callEvent('touchdrag', dragEvent);
          };

          var handler = {
            add: function () {
              var move = onTouchMove.bind(this);
              var end = onTouchEnd.bind(this);
              this.addEvent(['touchstart', 'pointerdown'], onTouchStart, 1);
              this.addEvent(['touchend', 'pointerup'], onTouchEnd, 1);
              this.addEvent(['touchmove', 'pointermove'], onTouchMove, 1);
              this.store('event:touchdrag:listeners:document:move', move);
              this.store('event:touchdrag:listeners:document:end', end);
              $(DOC).addEvent('pointermove', move, 1);
              $(DOC).addEvent('pointerup', end, 1);
            },
            remove: function () {
              var f = function () {};

              this.removeEvent(['touchstart', 'pointerdown'], onTouchStart);
              this.removeEvent(['touchend', 'pointerup'], onTouchEnd);
              this.removeEvent(['touchmove', 'pointermove'], onTouchMove);
              $(DOC).removeEvent('pointermove', this.fetch('event:touchdrag:listeners:document:move') || f, 1);
              $(DOC).removeEvent('pointerup', this.fetch('event:touchdrag:listeners:document:end') || f, 1);
              this.del('event:touchdrag:listeners:document:move');
              this.del('event:touchdrag:listeners:document:end');
            }
          };
          $J.Events.handlers.touchdrag = handler;
        })(magicJS);
        /* global DOC, magicJS */

        /* eslint-disable indent */

        /* eslint-disable dot-notation */

        /* eslint no-unused-vars: ["error", { "args": "none" }] */

        /* eslint no-restricted-properties: [2, {"object": "Math.pow"}] */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


        (function ($J) {
          var baseSpace = null;
          var $ = $J.$;

          var distance = function (point1, point2) {
            var x = point2.x - point1.x;
            var y = point2.y - point1.y;
            return Math.sqrt(x * x + y * y);
          };

          var getSpace = function (targetTouches, variables) {
            var ts = Array.prototype.slice.call(targetTouches);
            var diffX = Math.abs(ts[1].pageX - ts[0].pageX);
            var diffY = Math.abs(ts[1].pageY - ts[0].pageY);

            var _x = Math.min(ts[1].pageX, ts[0].pageX) + diffX / 2;

            var _y = Math.min(ts[1].pageY, ts[0].pageY) + diffY / 2;

            var result = 0;
            variables.points = [ts[0], ts[1]]; // result = Math.PI * Math.pow(distance({ x: ts[0].pageX, y: ts[1].pageX }, { x: ts[0].pageY, y: ts[1].pageY }) / 2, 2);
            // result = Math.pow(Math.max(diffX, diffY), 2);

            result = Math.pow(distance({
              x: ts[0].pageX,
              y: ts[0].pageY
            }, {
              x: ts[1].pageX,
              y: ts[1].pageY
            }), 2); // result = (Math.abs(ts[0].pageX - ts[1].pageX) || 1) * (Math.abs(ts[0].pageY - ts[1].pageY) || 1);

            variables.centerPoint = {
              x: _x,
              y: _y
            };
            variables.x = variables.centerPoint.x;
            variables.y = variables.centerPoint.y;
            return result;
          };

          var getScale = function (space) {
            return space / baseSpace;
          };

          var getTouches = function (e, cache) {
            var result;
            var originEvent = e.getOriginEvent();

            if (originEvent.targetTouches && originEvent.changedTouches) {
              if (originEvent.targetTouches) {
                result = originEvent.targetTouches;
              } else {
                result = originEvent.changedTouches;
              }

              result = Array.prototype.slice.call(result);
            } else {
              // fucking ie 11 does not support Array.from()
              result = [];

              if (cache) {
                cache.forEach(function (v) {
                  result.push(v);
                });
              }
            }

            return result;
          };

          var cacheEvent = function (e, cache, justSame) {
            var result = false;

            if (e.pointerId && e.pointerType === 'touch' && (!justSame || cache.has(e.pointerId))) {
              cache.set(e.pointerId, e);
              result = true;
            }

            return result;
          };

          var removeCache = function (e, cache) {
            if (e.pointerId && e.pointerType === 'touch' && cache && cache.has(e.pointerId)) {
              // compressor does not want to compress
              cache['delete'](e.pointerId);
            }
          };

          var getEventId = function (e) {
            var result;

            if (e.pointerId && e.pointerType === 'touch') {
              result = e.pointerId;
            } else {
              result = e.identifier;
            }

            return result;
          };

          var addActivePoints = function (targetTouches, container) {
            var i;
            var id;
            var result = false;

            for (i = 0; i < targetTouches.length; i++) {
              if (container.length === 2) {
                break;
              } else {
                id = getEventId(targetTouches[i]);

                if (!$J.contains(container, id)) {
                  container.push(id);
                  result = true;
                }
              }
            }

            return result;
          };

          var getIds = function (targetTouches) {
            var result = [];
            targetTouches.forEach(function (value) {
              result.push(getEventId(value));
            });
            return result;
          };

          var removeActivePoint = function (targetTouches, container) {
            var i;
            var ids;
            var result = false;

            if (container) {
              ids = getIds(targetTouches);

              for (i = 0; i < container.length; i++) {
                if (!$J.contains(ids, container[i])) {
                  container.splice(i, 1);
                  result = true;
                  break;
                }
              }
            }

            return result;
          };

          var getActivePoints = function (targetTouches, container) {
            var i;
            var result = [];

            for (i = 0; i < targetTouches.length; i++) {
              if ($J.contains(container, getEventId(targetTouches[i]))) {
                result.push(targetTouches[i]);

                if (result.length === 2) {
                  break;
                }
              }
            }

            return result;
          };

          var removePinchEnd = function (el) {
            var target = el.fetch('event:pinch:target');

            if (target) {
              target.removeEvent(['touchend'], el.fetch('event:pinch:listeners:document:end'));
            }

            el.del('event:pinch:target');
          };

          var clearCache = function (el) {
            var cache = el.fetch('event:pinch:cache');

            if (cache) {
              cache.clear();
            }

            el.del('event:pinch:cache');
          };

          var Pinch = /*#__PURE__*/function (_$J$Events$Custom7) {
            "use strict";

            bHelpers.inheritsLoose(Pinch, _$J$Events$Custom7);

            function Pinch(e, target, state, variables) {
              var _this20;

              _this20 = _$J$Events$Custom7.call(this, e) || this;
              _this20.type = 'pinch';
              _this20.target = target.node;
              _this20.state = state; // pinchmove / pinchend / pinchresize

              _this20.x = variables.x;
              _this20.y = variables.y;
              _this20.scale = variables.scale;
              _this20.space = variables.space;
              _this20.zoom = variables.zoom;
              _this20.state = state;
              _this20.centerPoint = variables.centerPoint;
              _this20.points = variables.points;

              _this20.pushToEvents(e);

              return _this20;
            }

            return Pinch;
          }($J.Events.Custom);

          var _variables = {
            x: 0,
            y: 0,
            space: 0,
            scale: 1,
            zoom: 0,
            startSpace: 0,
            startScale: 1,
            started: false,
            dragged: false,
            points: [],
            centerPoint: {
              x: 0,
              y: 0
            }
          };

          var setVariables = function (targetTouches, variables) {
            var lastSpace = variables.space;

            if (targetTouches.length > 1) {
              variables.space = getSpace(targetTouches, variables);

              if (!variables.startSpace) {
                variables.startSpace = variables.space;
              }

              if (lastSpace > variables.space) {
                variables.zoom = -1;
              } else if (lastSpace < variables.space) {
                variables.zoom = 1;
              } else {
                variables.zoom = 0;
              }

              variables.scale = getScale(variables.space);
            } else {
              variables.points = [];
            }
          }; // const onClick = function (e) { e.stop(); };


          var onTouchMove = function (e) {
            var pinchEvent;
            var variables = this.fetch('event:pinch:variables');
            var cache = this.fetch('event:pinch:cache');
            var currentActivePoints = this.fetch('event:pinch:activepoints');

            if (!variables) {
              variables = $J.extend({}, $J.detach(_variables));
            }

            if (variables.started) {
              if (e.pointerId && !cacheEvent(e, cache, true)) {
                return;
              }

              e.stop();
              setVariables(getActivePoints(getTouches(e, cache), currentActivePoints), variables);
              pinchEvent = new Pinch(e, this, 'pinchmove', variables);
              this.callEvent('pinch', pinchEvent);
            }
          };

          var onTouchStart = function (e) {
            var pinchEventStart;
            var variables;
            var cache = this.fetch('event:pinch:cache');
            var currentActivePoints = this.fetch('event:pinch:activepoints');

            if (e.pointerType === 'mouse') {
              return;
            }

            if (!currentActivePoints) {
              currentActivePoints = [];
              this.store('event:pinch:activepoints', currentActivePoints);
            }

            if (!cache) {
              cache = new Map();
              this.store('event:pinch:cache', cache);
            }

            if (!this.fetch('event:pinch:target')) {
              this.store('event:pinch:target', $(e.getTarget()));
              $(e.getTarget()).addEvent(['touchend'], this.fetch('event:pinch:listeners:document:end'), 1);
            }

            cacheEvent(e, cache);
            var targetTouches = getTouches(e, cache);
            addActivePoints(targetTouches, currentActivePoints);

            if (targetTouches.length === 2) {
              pinchEventStart = this.fetch('event:pinch:pinchstart');
              variables = this.fetch('event:pinch:variables');

              if (!variables) {
                variables = $J.extend({}, $J.detach(_variables));
              }

              setVariables(getActivePoints(targetTouches, currentActivePoints), variables);

              if (!pinchEventStart) {
                pinchEventStart = new Pinch(e, this, 'pinchstart', variables);
                this.store('event:pinch:pinchstart', pinchEventStart);
                this.store('event:pinch:variables', variables);
                baseSpace = variables.space;
                this.callEvent('pinch', pinchEventStart);
                variables.started = true;
              }
            }
          };

          var onTouchEnd = function (e) {
            var pinchEvent;

            var _event;

            var cache = this.fetch('event:pinch:cache');

            if (e.pointerType === 'mouse' || e.pointerId && (!cache || !cache.has(e.pointerId))) {
              return;
            }

            pinchEvent = this.fetch('event:pinch:pinchstart');
            var variables = this.fetch('event:pinch:variables');
            var currentActivePoints = this.fetch('event:pinch:activepoints');
            var targetTouches = getTouches(e, cache);
            removeCache(e, cache);
            var removingResult = removeActivePoint(targetTouches, currentActivePoints);

            if (!pinchEvent || !variables || !variables.started || !removingResult || !currentActivePoints) {
              return;
            }

            if (removingResult) {
              addActivePoints(targetTouches, currentActivePoints);
            }

            _event = 'pinchend';

            if (targetTouches.length > 1) {
              _event = 'pinchresize';
            } else {
              this.del('event:pinch:pinchstart');
              this.del('event:pinch:variables');
              this.del('event:pinch:activepoints');
              clearCache(this);
              removePinchEnd(this);
            }

            setVariables(getActivePoints(targetTouches, currentActivePoints), variables);
            pinchEvent = new Pinch(e, this, _event, variables);
            this.callEvent('pinch', pinchEvent);
          };

          var handler = {
            add: function (options) {
              if (!baseSpace) {
                baseSpace = function () {
                  var s = $J.W.getSize();
                  s.width = Math.min(s.width, s.height);
                  s.height = s.width; // var s = { width: 375, height: 812 };

                  return Math.pow(distance({
                    x: 0,
                    y: 0
                  }, {
                    x: s.width,
                    y: s.height
                  }), 2);
                }();
              }

              var move = onTouchMove.bind(this);
              var end = onTouchEnd.bind(this); // this.addEvent(['click', 'tap'], onClick, 1);

              this.addEvent(['touchstart', 'pointerdown'], onTouchStart, 1); // this.addEvent(['touchend', 'pointerup'], onTouchEnd, 1);

              this.addEvent(['pointerup'], onTouchEnd, 1);
              this.addEvent(['touchmove', 'pointermove'], onTouchMove, 1);
              this.store('event:pinch:listeners:document:move', move);
              this.store('event:pinch:listeners:document:end', end);
              $(DOC).addEvent('pointermove', move, 1);
              $(DOC).addEvent('pointerup', end, 1);
            },
            remove: function () {
              var f = function () {}; // this.removeEvent(['click', 'tap'], onClick);


              this.removeEvent(['touchstart', 'pointerdown'], onTouchStart); // this.removeEvent(['touchend', 'pointerup'], onTouchEnd);

              this.removeEvent(['pointerup'], onTouchEnd);
              this.removeEvent(['touchmove', 'pointermove'], onTouchMove);
              $(DOC).removeEvent('pointermove', this.fetch('event:pinch:listeners:document:move') || f, 1);
              $(DOC).removeEvent('pointerup', this.fetch('event:pinch:listeners:document:end') || f, 1);
              this.del('event:pinch:listeners:document:move');
              this.del('event:pinch:listeners:document:end');
              removePinchEnd(this);
              clearCache(this);
              this.del('event:pinch:variables');
              this.del('event:pinch:activepoints');
              this.del('event:pinch:pinchstart');
            }
          };
          $J.Events.handlers.pinch = handler;
        })(magicJS);
        /* eslint-env es6 */

        /* global magicJS, DOC, UND */


        (function ($J) {
          var eventType = 'wheel';

          if (!('onwheel' in DOC || $J.browser.ieMode > 8)) {
            eventType = 'mousewheel';
          }

          var Mousescroll = /*#__PURE__*/function (_$J$Events$Custom8) {
            "use strict";

            bHelpers.inheritsLoose(Mousescroll, _$J$Events$Custom8);

            function Mousescroll(e, target, delta, deltaX, deltaY, deltaZ, deltaFactor) {
              var _this21;

              _this21 = _$J$Events$Custom8.call(this, e) || this;
              var r = e.getPageXY();
              _this21.x = r.x;
              _this21.y = r.y;
              _this21.type = 'mousescroll'; // this.timeStamp = e.timeStamp;

              _this21.target = target.node;
              _this21.delta = delta || 0;
              _this21.deltaX = deltaX || 0;
              _this21.deltaY = deltaY || 0;
              _this21.deltaZ = deltaZ || 0;
              _this21.deltaFactor = deltaFactor || 0;
              _this21.deltaMode = e.deltaMode || 0;
              _this21.isMouse = false;

              _this21.pushToEvents(e);

              return _this21;
            }

            return Mousescroll;
          }($J.Events.Custom);

          var lowestDelta;
          var resetDeltaTimer;

          var resetDelta = function () {
            lowestDelta = null;
          };

          var isMouse = function (deltaFactor, deltaMode) {
            return deltaFactor > 50 || deltaMode === 1 && !($J.browser.platform === 'win' && deltaFactor < 1) // Firefox
            || deltaFactor % 12 === 0 // Safari
            || deltaFactor % 4.000244140625 === 0; // Chrome on OS X
          };

          var handle = function (e) {
            var delta = 0;
            var deltaX = 0;
            var deltaY = 0;
            var absDelta = 0;
            var originEvent = e.getOriginEvent(); // DomMouseScroll event

            if (originEvent.detail) {
              deltaY = e.detail * -1;
            } // mousewheel event


            if (originEvent.wheelDelta !== UND) {
              deltaY = originEvent.wheelDelta;
            }

            if (originEvent.wheelDeltaY !== UND) {
              deltaY = originEvent.wheelDeltaY;
            }

            if (originEvent.wheelDeltaX !== UND) {
              deltaX = originEvent.wheelDeltaX * -1;
            } // wheel event


            if (originEvent.deltaY) {
              deltaY = -1 * originEvent.deltaY;
            }

            if (originEvent.deltaX) {
              deltaX = originEvent.deltaX;
            }

            if (deltaY === 0 && deltaX === 0) {
              return;
            }

            delta = deltaY === 0 ? deltaX : deltaY;
            absDelta = Math.max(Math.abs(deltaY), Math.abs(deltaX));

            if (!lowestDelta || absDelta < lowestDelta) {
              lowestDelta = absDelta;
            }

            var calc = delta > 0 ? 'floor' : 'ceil';
            delta = Math[calc](delta / lowestDelta);
            deltaX = Math[calc](deltaX / lowestDelta);
            deltaY = Math[calc](deltaY / lowestDelta);

            if (resetDeltaTimer) {
              clearTimeout(resetDeltaTimer);
            }

            resetDeltaTimer = setTimeout(resetDelta, 200);

            var _event = new Mousescroll(e, this, delta, deltaX, deltaY, 0, lowestDelta);

            _event.isMouse = isMouse(lowestDelta, originEvent.deltaMode || 0);
            this.callEvent('mousescroll', _event);
          };

          var handler = {
            add: function () {
              this.addEvent(eventType, handle, 1);
            },
            remove: function () {
              this.removeEvent(eventType, handle, 1);
            }
          };
          $J.Events.handlers.mousescroll = handler;
        })(magicJS);
        /**
         * Do the last things. Extend window, document, etc.
         */


        $J.W = $J.$(WIN);
        $J.D = $J.$(DOC);
        $J.U = UND;
        $J.DPPX = window.devicePixelRatio >= 2 ? 2 : 1; // Dots per px. 2 - is equal to Retina.;

        return magicJS;
      }();
      /* eslint no-throw-literal: "off"*/

      /* eslint no-restricted-properties: "off" */

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint consistent-return: "off"*/

      /* eslint class-methods-use-this: "off"*/

      /* eslint no-unused-expressions: "off"*/

      /* eslint no-undef: "off"*/

      /* eslint no-shadow: ["error", { "allow": ["t", duration] }]*/

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint-env es6*/


      (function ($J) {
        if (!$J) {
          throw 'MagicJS not found';
        }

        if ($J.FX) {
          return;
        }

        var $ = $J.$;
        /**
         * Basic transition effects
         * @class
         * @constant
         * @static
         */

        var TRANSITION = {
          linear: 'linear',
          sineIn: 'easeInSine',
          sineOut: 'easeOutSine',
          expoIn: 'easeInExpo',
          expoOut: 'easeOutExpo',
          quadIn: 'easeInQuad',
          quadOut: 'easeOutQuad',
          cubicIn: 'easeInCubic',
          cubicOut: 'easeOutCubic',
          backIn: 'easeInBack',
          backOut: 'easeOutBack',
          elasticIn: function (p, x) {
            x = x || [];
            return Math.pow(2, 10 * --p) * Math.cos(20 * p * Math.PI * (x[0] || 1) / 3);
          },
          elasticOut: function (p, x) {
            return 1 - TRANSITION.elasticIn(1 - p, x);
          },
          bounceIn: function (p) {
            for (var a = 0, b = 1; 1; a += b, b /= 2) {
              if (p >= (7 - 4 * a) / 11) {
                return b * b - Math.pow((11 - 6 * a - 11 * p) / 4, 2);
              }
            }
          },
          bounceOut: function (p) {
            return 1 - TRANSITION.bounceIn(1 - p);
          },
          none: function (x) {
            return 0;
          }
        };
        /**
         * @class
         * Class that applies animation to an element
         * @example
         * simple usage:
         * new $J.FX(el1), {
         *  'duration': 400
         * }).start({width:[startWidth, endWidth]});
         * @constructs
         * @param {String|Element} el Element to applied an effect
         * @param [opt] Options
         * @param {Number} opt.fps FPS
         * @param {Number} opt.duration Effect duration in miliseconds
         * @param {Function|String} opt.transition  Easing function
         * @param {Function|String} opt.cycles  The number of times the animation should repeat. Default is 1
         * @param {String} opt.direction  Indicates how the animation should play each cycle. Possible values:
         *                  normal - Default. The animation should play forward each cycle.
         *                  alternate - The animation should reverse direction each cycle.
         *                  reverse - The animation plays backward each cycle.
         *                  alternate-reverse - The animation starts backward, then continues to alternate.
         *                  continuous - The animation plays forward continuously (w/o cycles)
         *                  continuous-reverse - The animation plays backward continuously (w/o cycles)
         * @param {Function} opt.onStart Callback called when animation starts
         * @param {Function} opt.onComplete Callback called when animation completes
         * @param {Function} opt.onBeforeRender Callback called before each step of changing CSS properties
         * @param {Function} opt.onAfterRender Callback called after each step of changing CSS properties
         * @param {Boolean} opt.roundCss Use Math.round() when calculating css steps values
         */

        var FX = /*#__PURE__*/function () {
          "use strict";

          function FX(el
          /* can be array */
          , opt) {
            var _this22 = this;

            this.styles = null;
            this.cubicBezier = null;
            this.easeFn = null;
            this.state = 0; // 0 - init,  1 - started, 2 - started, 3 - ended

            this.pStyles = []; // styles set in percent

            this.alternate = false;
            this.continuous = false;
            this.startTime = null;
            this.finishTime = null;
            this.options = {
              fps: 60,
              duration: 600,
              // transition: function(x) {return  -(Math.cos(Math.PI * x) - 1) / 2},
              transition: 'ease',
              cycles: 1,
              direction: 'normal',
              // normal | reverse | alternate | alternate-reverse | continuous | continuous-reverse
              onStart: function () {},
              onComplete: function () {},
              onBeforeRender: function () {},
              onAfterRender: function () {},
              forceAnimation: false,
              roundCss: false // use Math.round() when calculating css steps values

            };
            this.els = [];

            if (!Array.isArray(el)) {
              el = [el];
            }

            el.forEach(function (_el) {
              if (_el) {
                _this22.els.push($(_el));
              }
            });
            this.options = $J.extend(this.options, opt);
            this.timer = false;
            this.setTransition(this.options.transition);

            if ($J.typeOf(this.options.cycles) === 'string') {
              this.options.cycles = this.options.cycles === 'infinite' ? Infinity : parseInt(this.options.cycles, 10) || 1;
            }
          }

          FX.getTransition = function getTransition() {
            return TRANSITION;
          };

          var _proto10 = FX.prototype;

          _proto10.setTransition = function setTransition(easing) {
            this.options.transition = easing; // this.easeFn = this.cubicBezierAtTime;

            this.easeFn = FX.cubicBezierAtTime;

            var _easing = TRANSITION[this.options.transition] || this.options.transition;

            if ($J.typeOf(_easing) === 'function') {
              this.easeFn = _easing;
            } else {
              this.cubicBezier = this.parseCubicBezier(_easing) || this.parseCubicBezier('ease');
            }
          }
          /**
           * Start animation
           */
          ;

          _proto10.start = function start(styles
          /**Hash*/
          ) {
            var _this23 = this;

            var runits = /\%$/;
            var s;
            var i;

            if (this.state === 2) {
              return this;
            }

            this.state = 1;
            this.cycle = 0;
            this.alternate = $J.contains(['alternate', 'alternate-reverse'], this.options.direction);
            this.continuous = $J.contains(['continuous', 'continuous-reverse'], this.options.direction);

            if (!styles) {
              styles = {};
            }

            if (!Array.isArray(styles)) {
              styles = [styles];
            }

            this.styles = styles;
            var l = this.styles.length;
            this.pStyles = new Array(l);

            for (i = 0; i < l; i++) {
              this.pStyles[i] = {};

              for (s in this.styles[i]) {
                if (runits.test(this.styles[i][s][0])) {
                  this.pStyles[s] = true;
                }

                if ($J.contains(['reverse', 'alternate-reverse', 'continuous-reverse'], this.options.direction)) {
                  this.styles[i][s].reverse();
                }
              }
            }

            this.startTime = $J.now();
            this.finishTime = this.startTime + this.options.duration;
            this.options.onStart();

            if (this.options.duration === 0) {
              // apply all styles immediately
              this.render(1.0);
              this.options.onComplete(this.els.length < 2 ? this.els[0] : this.els);
            } else {
              this.state = 2;

              if (!this.options.forceAnimation && $J.browser.features.requestAnimationFrame) {
                this.timer = $J.browser.requestAnimationFrame.call($J.W.node, this.loop.bind(this));
              } else {
                this.timer = setInterval(function () {
                  _this23.loop();
                }, Math.round(1000 / this.options.fps));
              }
            }

            return this;
          };

          _proto10.stopAnimation = function stopAnimation() {
            if (this.timer) {
              if (!this.options.forceAnimation && $J.browser.features.requestAnimationFrame && $J.browser.cancelAnimationFrame) {
                $J.browser.cancelAnimationFrame.call($J.W.node, this.timer);
              } else {
                clearInterval(this.timer);
              }

              this.timer = false;
            }
          }
          /**
           * Stop animation
           */
          ;

          _proto10.stop = function stop(complete
          /** Boolean*/
          ) {
            if ($J.contains([0, 3], this.state)) {
              return this;
            }

            if (!$J.defined(complete)) {
              complete = false;
            }

            this.stopAnimation();
            this.state = 3;

            if (complete) {
              this.render(1.0); // clearTimeout(this._completeTimer);
              // this._completeTimer = setTimeout(() => {

              this.options.onComplete(this.els.length < 2 ? this.els[0] : this.els); // }, 10);
            }

            return this;
          }
          /**
           * @ignore
           */
          ;

          _proto10.loop = function loop() {
            var _now = $J.now();

            var i;
            var dx = (_now - this.startTime) / this.options.duration;
            var cycle = Math.floor(dx);

            if (_now >= this.finishTime && cycle >= this.options.cycles) {
              this.stopAnimation();
              this.render(1.0); // clearTimeout(this._completeTimer);
              // this._completeTimer = setTimeout(() => {

              this.options.onComplete(this.els.length < 2 ? this.els[0] : this.els); // }, 10);

              return this;
            }

            if (this.alternate && this.cycle < cycle) {
              for (i = 0; i < this.styles.length; i++) {
                for (var s in this.styles[i]) {
                  this.styles[i][s].reverse();
                }
              }
            }

            this.cycle = cycle;

            if (!this.options.forceAnimation && $J.browser.features.requestAnimationFrame) {
              this.timer = $J.browser.requestAnimationFrame.call($J.W.node, this.loop.bind(this));
            }

            this.render((this.continuous ? cycle : 0) + this.easeFn(dx % 1, this.options.duration, this.cubicBezier));
          }
          /**
           * ignore
           */
          ;

          _proto10.render = function render(dx) {
            var i;
            var css = [];

            var _el;

            var _css;

            var l = this.els.length;

            for (i = 0; i < l; i++) {
              css.push(this.renderOverLoad(dx, this.els[i], this.styles[i], this.pStyles[i]));
            }

            _el = this.els;
            _css = css;

            if (l < 2) {
              _el = this.els[0];
              _css = css[0];
            }

            this.options.onBeforeRender(_css, _el);
            this.set(css);
            this.options.onAfterRender(_css, _el);
          }
          /**
           * ignore
           */
          ;

          _proto10.renderOverLoad = function renderOverLoad(dx, el, styles, pStyles) {
            var css = {};
            var change = dx; // eslint-disable-line no-unused-vars

            var s;

            for (s in styles) {
              if (s === 'opacity') {
                css[s] = Math.round(this.calc(styles[s][0], styles[s][1], dx) * 100) / 100;
              } else {
                css[s] = this.calc(styles[s][0], styles[s][1], dx); // if (this.options.roundCss) { css[s] = Math.round(css[s]); } // если двигать кубиком базье в процентах - то без округления лучше двигает
                // Styles defined in percent. Ap

                pStyles[s] && (css[s] += '%');
              }
            }

            return css;
          }
          /**
           * @ignore
           */
          ;

          _proto10.calc = function calc(from, to, dx) {
            from = parseFloat(from);
            to = parseFloat(to);
            return (to - from) * dx + from;
          }
          /**
           * @ignore
          */
          ;

          _proto10.set = function set(css) {
            for (var i = 0; i < this.els.length; i++) {
              this.els[i].setCss(css[i]);
            }

            return this;
          }
          /**
           *
           * Parse timing function string
           *
           * @ignore
           * @example
           * 'cubic-bezier(.0,1.0,.34,.1)'
           * 'ease-in-out'
           */
          ;

          _proto10.parseCubicBezier = function parseCubicBezier(cubicbezier) {
            var i;
            var points = null;

            if ($J.typeOf(cubicbezier) !== 'string') {
              return null;
            }

            switch (cubicbezier) {
              // Standard
              case 'linear':
                points = $([0.000, 0.000, 1.000, 1.000]);
                break;

              case 'ease':
                points = $([0.250, 0.100, 0.250, 1.000]);
                break;

              case 'ease-in':
                points = $([0.420, 0.000, 1.000, 1.000]);
                break;

              case 'ease-out':
                points = $([0.000, 0.000, 0.580, 1.000]);
                break;

              case 'ease-in-out':
                points = $([0.420, 0.000, 0.580, 1.000]);
                break;
              // Sine
              // case 'easeInSine':
              //     points = $([0.470, 0.000, 0.745, 0.715]);
              //     break;
              // case 'easeOutSine':
              //     points = $([0.39, 0.575, 0.565, 1.000]);
              //     break;
              // case 'easeInOutSine':
              //     points = $([0.445, 0.050, 0.550, 0.950]);
              //     break;
              // Quad
              // case 'easeInQuad':
              //     points = $([0.550, 0.085, 0.680, 0.530]);
              //     break;
              // case 'easeOutQuad':
              //     points = $([0.250, 0.460, 0.450, 0.940]);
              //     break;
              // case 'easeInOutQuad':
              //     points = $([0.455, 0.030, 0.515, 0.955]);
              //     break;
              // Cubic
              // case 'easeInCubic':
              //     points = $([0.550, 0.055, 0.675, 0.190]);
              //     break;
              // case 'easeOutCubic':
              //     points = $([0.215, 0.610, 0.355, 1.000]);
              //     break;
              // case 'easeInOutCubic':
              //     points = $([0.645, 0.045, 0.355, 1.000]);
              //     break;
              // Quart
              // case 'easeInQuart':
              //     points = $([0.895, 0.030, 0.685, 0.220]);
              //     break;
              // case 'easeOutQuart':
              //     points = $([0.165, 0.840, 0.440, 1.000]);
              //     break;
              // case 'easeInOutQuart':
              //     points = $([0.770, 0.000, 0.175, 1.000]);
              //     break;
              // Quint
              // case 'easeInQuint':
              //     points = $([0.755, 0.050, 0.855, 0.060]);
              //     break;
              // case 'easeOutQuint':
              //     points = $([0.230, 1.000, 0.320, 1.000]);
              //     break;
              // case 'easeInOutQuint':
              //     points = $([0.860, 0.000, 0.070, 1.000]);
              //     break;
              // Expo
              // case 'easeInExpo':
              //     points = $([0.950, 0.050, 0.795, 0.035]);
              //     break;
              // case 'easeOutExpo':
              //     points = $([0.190, 1.000, 0.220, 1.000]);
              //     break;
              // case 'easeInOutExpo':
              //     points = $([1.000, 0.000, 0.000, 1.000]);
              //     break;
              // Circ
              // case 'easeInCirc':
              //     points = $([0.600, 0.040, 0.980, 0.335]);
              //     break;
              // case 'easeOutCirc':
              //     points = $([0.075, 0.820, 0.165, 1.000]);
              //     break;
              // case 'easeInOutCirc':
              //     points = $([0.785, 0.135, 0.150, 0.860]);
              //     break;
              // Back
              // case 'easeInBack':
              //     points = $([0.600, -0.280, 0.735, 0.045]);
              //     break;
              // case 'easeOutBack':
              //     points = $([0.175, 0.885, 0.320, 1.275]);
              //     break;
              // case 'easeInOutBack':
              //     points = $([0.680, -0.550, 0.265, 1.550]);
              //     break;

              default:
                cubicbezier = cubicbezier.replace(/\s/g, '');

                if (cubicbezier.match(/^cubic-bezier\((?:-?[0-9\.]{0,}[0-9]{1,},){3}(?:-?[0-9\.]{0,}[0-9]{1,})\)$/)) {
                  points = cubicbezier.replace(/^cubic-bezier\s*\(|\)$/g, '').split(',');

                  for (i = points.length - 1; i >= 0; i--) {
                    points[i] = parseFloat(points[i]);
                  }
                }

            }

            return $(points);
          } // From: http://www.netzgesta.de/dev/cubic-bezier-timing-function.html
          // 1:1 conversion to js from webkit source files
          // UnitBezier.h, WebCore_animation_AnimationBase.cpp
          ;

          FX.cubicBezierAtTime = function cubicBezierAtTime(t, duration, cubicBezier) {
            var ax = 0;
            var bx = 0;
            var cx = 0;
            var ay = 0;
            var by = 0;
            var cy = 0; // `ax t^3 + bx t^2 + cx t' expanded using Horner's rule.

            var sampleCurveX = function (t) {
              return ((ax * t + bx) * t + cx) * t;
            };

            var sampleCurveY = function (t) {
              return ((ay * t + by) * t + cy) * t;
            };

            var sampleCurveDerivativeX = function (t) {
              return (3.0 * ax * t + 2.0 * bx) * t + cx;
            }; // The epsilon value to pass given that the animation is going to run over |dur| seconds. The longer the
            // animation, the more precision is needed in the timing function result to avoid ugly discontinuities.


            var solveEpsilon = function (duration) {
              return 1.0 / (200.0 * duration);
            }; // const solve = (x, epsilon) => {
            //     return sampleCurveY(solveCurveX(x, epsilon));
            // };
            // Given an x value, find a parametric value it came from.


            var solveCurveX = function (x, epsilon) {
              var t0;
              var t1;
              var t2;
              var x2;
              var d2;
              var i;

              var fabs = function (n) {
                if (n >= 0) {
                  return n;
                }

                return 0 - n;
              }; // First try a few iterations of Newton's method -- normally very fast.


              for (t2 = x, i = 0; i < 8; i++) {
                x2 = sampleCurveX(t2) - x;

                if (fabs(x2) < epsilon) {
                  return t2;
                }

                d2 = sampleCurveDerivativeX(t2);

                if (fabs(d2) < 1e-6) {
                  break;
                }

                t2 -= x2 / d2;
              } // Fall back to the bisection method for reliability.


              t0 = 0.0;
              t1 = 1.0;
              t2 = x;

              if (t2 < t0) {
                return t0;
              }

              if (t2 > t1) {
                return t1;
              }

              while (t0 < t1) {
                x2 = sampleCurveX(t2);

                if (fabs(x2 - x) < epsilon) {
                  return t2;
                }

                if (x > x2) {
                  t0 = t2;
                } else {
                  t1 = t2;
                }

                t2 = (t1 - t0) * 0.5 + t0;
              }

              return t2; // Failure.
            };

            var solve = function (x, epsilon) {
              return sampleCurveY(solveCurveX(x, epsilon));
            }; // Calculate the polynomial coefficients, implicit first and last control points are (0,0) and (1,1).


            cx = 3.0 * cubicBezier[0];
            bx = 3.0 * (cubicBezier[2] - cubicBezier[0]) - cx;
            ax = 1.0 - cx - bx;
            cy = 3.0 * cubicBezier[1];
            by = 3.0 * (cubicBezier[3] - cubicBezier[1]) - cy;
            ay = 1.0 - cy - by; // Convert from input time to parametric value in curve, then from that to output time.

            return solve(t, solveEpsilon(duration));
          };

          return FX;
        }();

        $J.FX = FX;
      })(magicJS);
      /*eslint no-throw-literal: "off"*/

      /*eslint quote-props: ["off"]*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /*eslint guard-for-in: "off"*/

      /*eslint no-continue: "off"*/

      /*eslint no-else-return: "off"*/

      /*eslint no-undef: "off"*/

      /*eslint consistent-return: "off"*/

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /*eslint no-prototype-builtins: "off"*/

      /*eslint dot-notation: ["off"]*/

      /*eslint-env es6*/


      (function ($J) {
        if (!$J) {
          throw 'MagicJS not found';
        }

        if ($J.Options) {
          return;
        }

        var $ = $J.$;
        var globalValue = null;
        var dataTypes = {
          'boolean': 1,
          'array': 2,
          'number': 3,
          'function': 4,
          'url': 5,
          'string': 100
        };

        var isAbsoluteUrl = function (v) {
          return /^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/i.test(v);
        };

        var typeValidators = {
          'boolean': function (option, v, strict) {
            if ($J.typeOf(v) !== 'boolean') {
              if (strict || $J.typeOf(v) !== 'string') {
                return false;
              } else if (!/^(true|false)$/.test(v)) {
                return false;
              } else {
                v = !v.replace(/true/i, '').trim();
              }
            }

            if (option.hasOwnProperty('enum') && !$J.contains(option['enum'], v)) {
              return false;
            }

            globalValue = v;
            return true;
          },
          'url': function (option, v, strict) {
            var result = false;

            if ($J.typeOf(v) === 'string' && isAbsoluteUrl(v)) {
              if (option.hasOwnProperty('enum')) {
                if ($J.contains(option['enum'], v)) {
                  result = true;
                }
              } else {
                result = true;
              }
            }

            return result;
          },
          'string': function (option, v, strict) {
            if ($J.typeOf(v) !== 'string') {
              return false;
            } else if (option.hasOwnProperty('enum') && !$J.contains(option['enum'], v)) {
              return false;
            } else {
              globalValue = '' + v;
              return true;
            }
          },
          'number': function (option, v, strict) {
            var r = /%$/;
            var percent = $J.typeOf(v) === 'string' && r.test(v); // if (strict && typeof(v) !== 'number') {

            if (strict && !'number' === typeof v) {
              // eslint-disable-line valid-typeof
              return false;
            }

            v = parseFloat(v);

            if (isNaN(v)) {
              return false;
            }

            if (isNaN(option.minimum)) {
              option.minimum = Number.NEGATIVE_INFINITY;
            }

            if (isNaN(option.maximum)) {
              option.maximum = Number.POSITIVE_INFINITY;
            }

            if (option.hasOwnProperty('enum') && !$J.contains(option['enum'], v)) {
              return false;
            }

            if (option.minimum > v || v > option.maximum) {
              return false;
            }

            globalValue = percent ? v + '%' : v;
            return true;
          },
          'array': function (option, v, strict) {
            if ($J.typeOf(v) === 'string') {
              try {
                v = v.replace(/'/g, '"');
                v = $J.W.node.JSON.parse(v);
              } catch (ex) {
                return false;
              }
            }

            if ($J.typeOf(v) === 'array') {
              globalValue = v;
              return true;
            } else {
              return false;
            }
          },
          'function': function (option, v, strict) {
            if ($J.typeOf(v) === 'function') {
              globalValue = v;
              return true;
            }

            return false;
          }
        };
        /**
         * Validate parameter value
         * @param  {object} param  parameter definition
         * @param  {mixed} value  [description]
         * @param  {boolean} strict Should stict validation be applied
         * @return {boolean}        [description]
         */

        var validateParamValue = function (param, value, strict) {
          var opts = param.hasOwnProperty('oneOf') ? param.oneOf : [param];

          if ($J.typeOf(opts) !== 'array') {
            return false;
          }

          for (var i = 0, l = opts.length - 1; i <= l; i++) {
            if (typeValidators[opts[i].type](opts[i], value, strict)) {
              return true;
            }
          }

          return false;
        };
        /**
         * Normalize schema parameter definition
         * @param  {object} param parameter defition
         * @return {object} normalized parameter definition
         */


        var normalizeParam = function (param) {
          var i;
          var j;
          var oneOf; // eslint-disable-line no-unused-vars

          var l;
          var temp;

          if (param.hasOwnProperty('oneOf')) {
            l = param.oneOf.length;

            for (i = 0; i < l; i++) {
              for (j = i + 1; j < l; j++) {
                if (dataTypes[param.oneOf[i]['type']] > dataTypes[param.oneOf[j].type]) {
                  temp = param.oneOf[i];
                  param.oneOf[i] = param.oneOf[j];
                  param.oneOf[j] = temp;
                }
              }
            }
          }

          return param;
        };
        /**
         * Validate parameter definition
         * @param  {object} param parameter definition
         * @return {boolean}     [description]
         */


        var validateSchemaParam = function (param) {
          // validate types
          var opts = param.hasOwnProperty('oneOf') ? param.oneOf : [param];

          if ($J.typeOf(opts) !== 'array') {
            return false;
          }

          for (var i = opts.length - 1; i >= 0; i--) {
            if (!opts[i].type || !dataTypes.hasOwnProperty(opts[i].type)) {
              return false;
            } // validate enum option if present


            if ($J.defined(opts[i]['enum'])) {
              if ($J.typeOf(opts[i]['enum']) !== 'array') {
                return false;
              }

              for (var j = opts[i]['enum'].length - 1; j >= 0; j--) {
                if (!typeValidators[opts[i].type]({
                  'type': opts[i].type
                }, opts[i]['enum'][j], true)) {
                  return false;
                }
              }
            }
          } // validate default value


          if (param.hasOwnProperty('defaults') && !validateParamValue(param, param['defaults'], true)) {
            return false;
          }

          return true;
        };

        var isDefaults = function (obj) {
          var i;
          var result = false;

          for (i in obj) {
            if (i === 'defaults') {
              result = true;
              break;
            }
          }

          return result;
        };

        var parseObj = function (obj) {
          var result = {};

          var parseVars = function (map, pathTo) {
            var prop;

            var _pathTo;

            for (prop in map) {
              _pathTo = pathTo.slice(0);

              if ($J.typeOf(map[prop]) !== 'object' || isDefaults(map[prop])) {
                _pathTo.push(prop);

                result[_pathTo.join('.')] = map[prop];
              } else {
                _pathTo.push(prop);

                parseVars(map[prop], _pathTo);
              }
            }
          };

          parseVars(obj, []);
          return result;
        };

        var convertToDeepObj = function (obj) {
          var key;
          var result = {};

          var setObjValue = function (arr, value) {
            var tmp = result;
            var l = arr.length;

            if (arr[l - 1].trim() === '') {
              arr.splice(l - 1, 1);
            }

            arr.forEach(function (v, index) {
              if (index === l - 1) {
                tmp[v] = value;
              } else {
                if (!tmp[v]) {
                  tmp[v] = {};
                }

                tmp = tmp[v];
              }
            });
          };

          for (key in obj) {
            if (Object.prototype.hasOwnProperty.call(obj, key)) {
              setObjValue(key.split('.'), obj[key]);
            }
          }

          return result;
        };

        var normalizeString = function (str) {
          return $J.camelize((str + '').trim());
        };

        var Options = /*#__PURE__*/function () {
          "use strict";

          function Options(schema) {
            this.schema = {};
            this.options = {};
            this.parseSchema(schema);
          }

          var _proto11 = Options.prototype;

          _proto11.parseSchema = function parseSchema(schema, force) {
            var i;
            var key;
            schema = parseObj(schema);

            for (i in schema) {
              if (!schema.hasOwnProperty(i)) {
                continue;
              }

              key = normalizeString(i);

              if (!this.schema.hasOwnProperty(key) || force) {
                this.schema[key] = normalizeParam(schema[i]);

                if (!validateSchemaParam(this.schema[key])) {
                  throw 'Incorrect definition of the \'' + i + '\' parameter in ' + schema;
                } // Preserve existing option value


                if ($J.defined(this.options[key])) {
                  if (!this.checkValue(key, this.options[key])) {
                    this.options[key] = $J.U;
                  }
                } else {
                  this.options[key] = $J.U;
                }
              }
            }
          };

          _proto11.set = function set(id, value) {
            id = normalizeString(id);

            if ($J.typeOf(value) === 'string') {
              value = value.trim();
            }

            if (this.schema.hasOwnProperty(id)) {
              globalValue = value;

              if (validateParamValue(this.schema[id], value)) {
                this.options[id] = globalValue;
              }

              globalValue = null;
            }
          };

          _proto11.get = function get(id) {
            id = normalizeString(id);

            if (this.schema.hasOwnProperty(id)) {
              return $J.defined(this.options[id]) ? this.options[id] : this.schema[id]['defaults'];
            }
          };

          _proto11.fromJSON = function fromJSON(obj) {
            obj = parseObj(obj);

            for (var i in obj) {
              this.set(i, obj[i]);
            }
          };

          _proto11.getJSON = function getJSON() {
            var json = $J.extend({}, this.options);

            for (var i in json) {
              if (json[i] === $J.U && this.schema[i]['defaults'] !== $J.U) {
                json[i] = this.schema[i]['defaults'];
              }
            }

            return convertToDeepObj(json);
          }
          /**
           * Set options from string
           * @param    str     {String} String with options. Example - "param1:value1;param2:value2;param3:value3; ...."
           * @param    exclude {Object} Object with regexps for options which we want to exclude. Example - { nameOfRegExp1: new RegExp('param2', 'g') }
           * @returns          {Object} Object with options which were excluded. Example - { nameOfRegExp1: 'param2:value2;' }
           */
          ;

          _proto11.fromString = function fromString(str, exclude) {
            var _this24 = this;

            var result = {};

            if (!exclude) {
              exclude = {};
            }

            var check = function (substr) {
              var key;
              var _result = true;
              substr = substr.trim();

              for (key in exclude) {
                if (Object.prototype.hasOwnProperty.call(exclude, key)) {
                  if (exclude[key].test && exclude[key].test(substr)) {
                    if (!result[key]) {
                      result[key] = '';
                    }

                    result[key] += substr + ';';
                    _result = false;
                    break;
                  }
                }
              }

              return _result;
            };

            str.split(';').forEach(function (chunk) {
              if (check(chunk)) {
                chunk = chunk.split(':');

                _this24.set(chunk.shift().trim(), chunk.join(':'));
              }
            });
            return result;
          };

          _proto11.checkValue = function checkValue(id, value) {
            var result = false;
            id = normalizeString(id);

            if ($J.typeOf(value) === 'string') {
              value = value.trim();
            }

            if (this.schema.hasOwnProperty(id)) {
              globalValue = value;

              if (validateParamValue(this.schema[id], value)) {
                result = true;
              }

              globalValue = null;
            }

            return result;
          };

          _proto11.exists = function exists(id) {
            id = normalizeString(id);
            return this.schema.hasOwnProperty(id);
          };

          _proto11.isset = function isset(id) {
            id = normalizeString(id);
            return this.exists(id) && $J.defined(this.options[id]);
          };

          _proto11.remove = function remove(id) {
            id = normalizeString(id);

            if (this.exists(id)) {
              delete this.options[id];
              delete this.schema[id];
            }
          };

          return Options;
        }();

        $J.Options = Options;
      })(magicJS);

      return magicJS;
    });
    Sirv.define('globalVariables', ['bHelpers', 'magicJS'], function (bHelpers, magicJS) {
      var moduleName = 'globalVariables';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global $J, $ */

      /* eslint-disable no-lonely-if */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "GLOBAL_VARIABLES" }] */

      var smv = 'smv';
      var GLOBAL_VARIABLES = {
        smv: smv,
        CSS_RULES_ID: 'sirv-core-css-reset',
        SIRV_HTTP_PROTOCOL: 'https:',
        SIRV_ASSETS_URL: '',
        SIRV_BASE_URL: '',
        CSS_CURSOR_ZOOM_IN: smv + '-cursor-zoom-in',
        CSS_CURSOR_FULSCREEN_ALWAYS: smv + '-cursor-fullscreen-always',
        // eslint-disable-next-line
        REG_URL_QUERY_STRING: /([^\?]+)\??([^\?]+)?/,
        FULLSCREEN_VIEWERS_IDs_ARRAY: [],
        CUSTOM_DEPENDENCIES: null,
        MIN_RATIO: 1.2,

        /**
         * slideShownBy
         * 0 - state of hiden slide
         * 1 - slider wants the slide
         * 2 - custumer wants the slide
         * 3 - first slide
         * 4 - disable or enable slide
         */
        SLIDE_SHOWN_BY: {
          NONE: 0,
          AUTOPLAY: 1,
          USER: 2,
          INIT: 3,
          ENABLE: 4
        },
        VIDEO: {
          NONE: 0,
          PLAY: 1,
          PAUSE: 2,
          PLAYING: 3
        },
        FULLSCREEN: {
          CLOSED: 0,
          OPENING: 1,
          OPENED: 2,
          CLOSING: 3
        },
        APPEARANCE: {
          HIDDEN: 0,
          SHOWING: 1,
          SHOWN: 2,
          HIDING: 3
        },
        SLIDE: {
          TYPES: {
            NONE: 0,
            HTML: 1,
            IMAGE: 2,
            PANZOOM: 3,
            ZOOM: 4,
            SPIN: 5,
            VIDEO: 6
          },
          NAMES: ['none', 'html', 'image', 'panzoom', 'zoom', 'spin', 'video']
        }
      };
      return GLOBAL_VARIABLES;
    });
    Sirv.define('globalFunctions', ['bHelpers', 'magicJS', 'globalVariables', 'helper', 'Promise!'], function (bHelpers, magicJS, globalVariables, helper, Promise) {
      var moduleName = 'globalFunctions';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global $ */

      /* global $J */

      /* global globalVariables */

      /* global helper */

      /* eslint-disable no-restricted-syntax */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint-disable no-unused-vars */
      // const SIRV_CSS = {
      //     src: 'viewer.full.css',
      //     state: -1
      // };

      var adjustURLProto = function (url) {
        var result = url.replace(/^(https?:)?/, 'https:');

        if (/^(http(s)?:)?\/\/[^/]+?sirv\.localhost(:\d+)?\/.*$/i.test(url)) {
          // dev env on localhost
          result = url.replace(/^(https?:)?/, 'http:');
        }

        return result;
      };

      var sanitizeURLComponent = function (str) {
        try {
          str = decodeURIComponent(str);
        } catch (ex) {
          /* empty */
        }

        return encodeURIComponent(str);
      };

      var sanitizeURL = function (url) {
        return url.replace(/^((?:https?:)?\/\/)([^/].*)/, function (match, proto, uri) {
          return proto + uri.split('/').map(function (str, index) {
            if (index === 0) {
              return str;
            }

            return sanitizeURLComponent(str);
          }).join('/');
        });
      };

      var RootDOM = /*#__PURE__*/function () {
        "use strict";

        function RootDOM() {
          this.CSSMap = {};
          this.sirvNodesMap = new WeakMap();
          this.rootNodesMap = new Map();
          this.rootNodes = []; // ie11 does not support this.rootNodesCollection.keys()

          this.sirvCSSSrc = 'viewer.full.css';
          this.mainCSSID = 'sirv-stylesheet-sirv';
        }

        RootDOM.getShadowDOM = function getShadowDOM(node
        /* Element which has 'Sirv' class name */
        ) {
          node = $(node).node;
          var result = false;
          var parent = node.parentNode;

          if (parent && window.ShadowRoot) {
            if (parent instanceof window.ShadowRoot) {
              result = parent;
            } else {
              result = RootDOM.getShadowDOM(parent);
            }
          }

          return result;
        };

        var _proto12 = RootDOM.prototype;

        _proto12.rootContains = function rootContains(node) {
          return this.rootNodes.some(function (root) {
            if (root === $J.D.node) {
              root = $J.D.node.body;
            }

            if (root) {
              return root.contains(node);
            }

            return false;
          });
        };

        _proto12.addModuleCSSByName = function addModuleCSSByName(moduleName, functionOfCssString, id, position) {
          if (!this.CSSMap[moduleName]) {
            this.CSSMap[moduleName] = {
              functionOfCssString: functionOfCssString,
              id: id,
              position: position
            };
          }
        };

        _proto12.getRootNode = function getRootNode(node
        /* Element which has 'Sirv' class name */
        ) {
          node = $(node).node;
          var shadowDOM = RootDOM.getShadowDOM(node);
          var rootNode = shadowDOM || $J.D.node;

          if (!this.rootNodesMap.has(rootNode)) {
            this.rootNodesMap.set(rootNode, {
              isResetCSSAdded: false,
              isVideoCSSAdded: false,
              isSirvAdAdded: false,
              styles: {},
              modulesCss: {},
              isShadowDOM: !!shadowDOM
            });
            this.rootNodes.push(rootNode);
          }

          return rootNode;
        }
        /*
            Attach node to root node
        */
        ;

        _proto12.attachNode = function attachNode(node
        /* Element which has 'Sirv' class name */
        ) {
          node = $(node).node;

          if (!this.sirvNodesMap.has(node)) {
            var rootNode = this.getRootNode(node);
            this.sirvNodesMap.set(node, rootNode);
          }
        }
        /*
            Detach node from root node
        */
        ;

        _proto12.detachNode = function detachNode(node
        /* Element which has 'Sirv' class name */
        ) {
          node = $(node).node;
          return this.sirvNodesMap.delete(node);
        };

        _proto12.addCSSStringToHtml = function addCSSStringToHtml() {
          this.addCSSString($J.D.node.head || $J.D.node.body);
        };

        _proto12.addCSSString = function addCSSString(node
        /* Element which has 'Sirv' class name */
        ) {
          var _this25 = this;

          if (!node) {
            node = $J.D.node.head || $J.D.node.body;
          }

          node = $(node).node;
          var root = this.sirvNodesMap.get(node);
          var rootObject = this.rootNodesMap.get(root);
          var shadowRoot = null;

          if (rootObject.isShadowDOM) {
            shadowRoot = root;
          }

          helper.objEach(this.CSSMap, function (key, value) {
            if (!rootObject.modulesCss[key]) {
              rootObject.modulesCss[key] = 1;
              helper.addCss(value.functionOfCssString(), value.id, value.position, shadowRoot, '#' + _this25.mainCSSID);
            }
          });
        };

        _proto12.addMainStyleToHtml = function addMainStyleToHtml() {
          this.resetGlobalCSS($J.D.node.head || $J.D.node.body);
          this.addStyle($J.D.node.head || $J.D.node.body, globalVariables.SIRV_ASSETS_URL + this.sirvCSSSrc, this.mainCSSID, '#' + globalVariables.CSS_RULES_ID);
        };

        _proto12.addMainStyle = function addMainStyle(node
        /* Element which has 'Sirv' class name */
        ) {
          this.addMainStyleToHtml();
          this.resetGlobalCSS(node);
          return this.addStyle(node, globalVariables.SIRV_ASSETS_URL + this.sirvCSSSrc, this.mainCSSID, '#' + globalVariables.CSS_RULES_ID);
        };

        _proto12.addStyle = function addStyle(node
        /* Element which has 'Sirv' class name */
        , url, id, querySelector) {
          node = $(node).node;
          var root = this.sirvNodesMap.get(node);
          var rootObject = this.rootNodesMap.get(root);

          if (!rootObject.styles[id]) {
            rootObject.styles[id] = new Promise(function (resolve, reject) {
              var _shadowRoot = null;

              if (rootObject.isShadowDOM) {
                _shadowRoot = root;
              }

              helper.loadStylesheet(url, id, _shadowRoot, querySelector).then(resolve).catch(reject);
            });
          }

          return rootObject.styles[id];
        };

        _proto12.resetGlobalCSS = function resetGlobalCSS(node
        /* Element which has 'Sirv' class name */
        ) {
          if (!node) {
            node = $J.D.node.head || $J.D.node.body;
          }

          node = $(node).node;
          var root = this.sirvNodesMap.get(node);
          var rootObject = this.rootNodesMap.get(root);

          if (rootObject.isResetCSSAdded) {
            return;
          }

          rootObject.isResetCSSAdded = true;
          var shadowRoot = null;

          if (rootObject.isShadowDOM) {
            shadowRoot = root;
          }

          $J.addCSS('.smv', {
            display: 'flex !important'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.smv.smv-selectors-top', {
            'flex-direction': 'column-reverse'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.smv.smv-selectors-left', {
            'flex-direction': 'row-reverse'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.smv.smv-selectors-right', {
            'flex-direction': 'row'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.smv.smv-selectors-bottom', {
            'flex-direction': 'column'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.smv-slides-box', {
            'flex-grow': 1,
            'flex-shrink': 1
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('figure > .Sirv', {
            'vertical-align': 'top'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv > iframe, .Sirv > video', {
            'display': 'none'
          }, globalVariables.CSS_RULES_ID, shadowRoot); // Hide custom thumbnail content until the viewer initialized.

          $J.addCSS(':not(.smv) smv-thumbnail', {
            'display': 'none'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv, .Sirv .smv-component', {
            '-webkit-box-sizing': 'border-box !important',
            '-moz-box-sizing': 'border-box !important',
            'box-sizing': 'border-box !important'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('div.Sirv, div.Sirv div.smv-component, figure.Sirv, div.smv-component', {
            width: '100%',
            height: '100%',
            margin: 0,
            'text-align': 'center'
          }, globalVariables.CSS_RULES_ID, shadowRoot); // It was added in 'fix video empty height' commit
          // I do not know why I added it, but it break Sirv if block where Sirv is has height. See test/zoom-test.html
          // $J.addCSS('div.Sirv', {
          //     'block-size': 'auto'
          // }, globalVariables.CSS_RULES_ID, shadowRoot);

          $J.addCSS('div.Sirv', {
            'max-height': '100%',
            'block-size': 'inherit'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv img', {
            'width': '100%',
            'height': '100%'
          }, globalVariables.CSS_RULES_ID, shadowRoot); // ResponsiveImage

          $J.addCSS('img.Sirv, .Sirv img', {
            'max-width': '100%'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('img.Sirv:not([width]):not([height])', {
            'width': '100%'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('img.Sirv', {
            'display': 'inline-block',
            'font-size': 0,
            'line-height': 0
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv.smv-bg-image.smv-bg-contain, .Sirv.smv-bg-image.smv-bg-cover', {
            'background-repeat': 'no-repeat',
            'background-position': 'center'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv.smv-bg-image.smv-bg-contain', {
            'background-size': 'contain'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('.Sirv.smv-bg-image.smv-bg-cover', {
            'background-size': 'cover'
          }, globalVariables.CSS_RULES_ID, shadowRoot); // $J.addCSS('img.Sirv[width], .Sirv img[width], img.Sirv[height], .Sirv img[height]', {
          //     'max-width': 'none'
          // }, globalVariables.CSS_RULES_ID, shadowRoot);

          $J.addCSS('img.Sirv:not([src]), img.Sirv.sirv-image-loading:not([src])', {
            'opacity': '0' // 'transition': 'opacity 0.5s linear'

          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('img.Sirv.sirv-image-loaded', {
            'opacity': '1',
            'transition': 'opacity 0.5s linear'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
        };

        _proto12.showSirvAd = function showSirvAd(node
        /* Element which has 'Sirv' class name */
        , targetNode, landing, desc) {
          if (/^my.sirv.(com|localhost)$/i.test($J.D.node.location.hostname)) {
            // do not show Ad inside web app
            return;
          }

          if (!node) {
            node = $J.D.node.head || $J.D.node.body;
          }

          node = $(node).node;
          var root = this.sirvNodesMap.get(node);
          var rootObject = this.rootNodesMap.get(root);
          var shadowRoot = null;

          if (rootObject.isShadowDOM) {
            shadowRoot = root;
          }

          var crId = 'sirvCR' + Math.floor(Math.random() * $J.now());
          var BRAND_LOGO = {
            width: 90,
            height: 18,
            src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAAkCAYAAAAgqxBxAAAMJ0lEQVR4nO1ce5AUxRnv4yH4wCfREogIqFHOI94uVoSNMnFvZ6e/30+TGB/BRFPRUomWRiMKd2tUTKEWKlGSCBKCxtJSSKkxKLhnKqaiJvgOYjSAAhdQ8EDkIYgm8fLH9hzNZGZn9+68o8r5VU3V7fbXX389+5vu79FzSiVIkCBBggQJegiu6w4DMIlkkeRKklsBbCG5EsAzJKeJyCnldDiOs5/neaO6y+YECUJBciaAz0i2xV0AFmut+wV1iMhoAK1GZqnjOAN7Yi4JvsDQWu9PckkIaTcBWAbgHZI7Am1vKqV6BXUBWBzQ87MemFKCLzJIvhIg671a63Gu6+7ryziOMxBAA4DpADYDuDRC14qArl9130wSfOEhIpcFCPjduD75fP5gx3H2C2sDcJal62MAx3W91QkShKMGwDqL0DO7QimAsQAubGhoOKIr9CVIUBHy+XxtYHUe3tM2JUjQYWitT7PI/EFP25MgQadA8kxrhd7mOE6fnrYpk8kMEJHRnud9padtSRADkm0NDQ0HRLU3NDQcAWBzd9njed7XbZdDa31SZ3WKSB2AR80133GcA+1213W/bLXf5H+fzWYPATAHwAdmx1jjt+Xz+YMBPALgIZIPxxV2gkhNLp6TamqeV18oPlxfKM7p7BwTGOxphM5kMgNI/tdyO57urE7bjTHXYLsdwHFW2/umz5BAcNoGYIvfx3GcPradJP9cjU2pQnFdqtDclio0t9UXis93do4JDPY0QiulFIB7AkS6Kb5XNLTWp1r6Pslms4fZ7SQHW+RcaL5bGXgI/gNgmVKqxu8nIj+xZTKZzIBK7Plq45PH+GROFZrbUpOL6c7ML4GFPZHQjuMcCODfAUI9lsvlBnVEXxyhXdc9lOQnfgGHZKP1MP0GwNhcLjcon88frqxKZD6fPzzgHp1TiT31heYpu1bn5tWVTqKfiAw1N6EmTh7AQQCGl/txuwqmwjU87NxBEFrrfp7nHWl+hOA8anK53CARGVpB8FRDcrCIDLXHrZbQ/n0123bsfe0oAJwccl5jB8lpWush1eiKI3Q2mz3EKqOvB7DTkPkHFdj5nKV7QSX2pJqKS9tX56ZiIcrokQCeBnAQybnGsKUAVgFYJyITwvp5npcl+aI5vLKE5EZzyCVjGV0AMCOsP8lbSD4c0fZrABf6n0UkZ8ZoIfmqGWt2Op3ex+4H4HXHcfqIyDUkN5JcYUq7x1kyFwNYTfKfJJcAaAXQpEJIJiJXkHwXwCqSb5B8n+TMdDq9D4CdlRDacZz9ANxN8n1zX1cDeE9ErvLHBPAQgO9H6TIrWktwvlEwxZDWEGJ/AuC+Sit+cYQ2nNkecHNmVaKb5EVWn521tbV7lZOvb1w40nY3aictCC/0iEgdyQ0A/iIil6TT6b5W2wkkV4jINYE+3zE/rqhdROhtSqUbtNauUu2Rd0vIsDWGVOtDyq41ANb5qR6t9bcArNFaj/MFMpnMAADzADxlja9ItgC4EsDvABwUHBTATwG8TPJo/zsTxLwAYGpAdgrJN0Skzv/OcZz+ACaSXEByaxyhzcOwSEQm2DuByR68TvIW8/lsAM9E6SJ5LYD7otrDYDINs0JI7V932b91GCohNICPLJntjuP0r9S+atyOVFOx0O5uNBWfixQ0hG4jeWNYu+d5o0hu9yeTTqf3IblRa31qmDzJMwGsMU9cbwCbXdc91pbRWmdIPgtgnoicbbcBON5/CMzq1gpgbHAcQ67V/sNjxm4B8HrY0661HklyY/BHMfdgKMkdxtdTnucdSXK71npE2ByNvxjrcvjEidAxnOQO13WH1dbW7kVyg+u6wyJk3wRwctRY5SAiJwCYjdI56OAJvGX5fL42qm+1hAYwrxrbAPze6ju/nGyqqfiWRegLyk24zvw4kbV6AM8DuMDIjwfwUoyhy0WE5u/5InJFYMw7jVtwUdDtMCvsHCN3HoDIpxHA7SR/6X82hL48Yp53AvhFGV3NvptjVuHHomSNu1URoT3PO7HMmE8AmGj+niEiNwRltNYnAViuOul3mxXxRpJbg25I1IPbAUJfXY1NZqdvLwZFxUappkWjdvnOzZ8edfnC6BjKbH8flRsYwAwA083f0wH8PEZ+Ns3ZWQAXAHjCau4FYC3Jo3O53CAAmwPB1gKYU2IA7gFwa9Q4JC8ybof/uSWqoADghXLbGoC7ReRm8/dDACZFyWaz2cMqJXS5ABbAFN+V0FrXk1ypAsQFMEtEJkfpqBau6x4K4NHASr1GKdU7KNsBQp9RjS2O4/Qnuc3vLyLfDJOzsxuppubyu4Ah9JoYmetI3q+UUiQfjLvBAG4CMFsppXK53CD76UMpCn/Fkn1Oa32aUkql0+m+JpAaaNoeB/ABgHfCLuPHP+vrItli+7wBm9YanzZK14cA7jZ6/ogykbopDlSS5fi43H0yxz3bI3yWAl7H/zxmzJi9WQpuB4cq6AQAzAmQ+sqgTLWE1lrrDtjxgEXo34bJpArFt31CnzB5kVNWoSF0a8yg15Oc6xuAUlagnPxUWIfBAfwdwDfM3zNINlrjX+Xr1lpnALxs9XtcRK4xNy70spPyMYReo7V2y+nyswgA/kTy/Kj5pdPpvhUSeme5+0Tyx7ZrA+ByAPda92Z8YHfrUgBYbhH67WB7tYT23cxqICJeIKjcLY1a11g81vKdy/LUV1gH4NNy+VgAs/3tWERu9lffKARXcZZSdD9TpZzuu7SyDCYgW6+U6iUik20XA6Uo/ZbYSewapxyhXwBwViV6AMwjeW1Uu18YqMTlKJdqA3Cbvyso1e7nbrQerCeq3carQcgLAbsdOe0OQiulFMkPfR2e52XttlSheJuVe55WyaTqSLbl8/lUmQFXWEFeA4BVKuQdNKXat+P1dj5aRE4h+azWuh7AayH6X/Q870SSf7AnJCLjSb4aO4ldeiIJTXKaH2zGwQSskUEhAFThQ4+LkgHwkoicF/huvoic6zjOQJLvxuVnOwOTlrVTZ67d3l2ENjFXqNtR3/TUivYVunHhyEomVYfS28FzI9rPBbDayln2YqkgEfoeGoBJxm1oD27MFr3e+OKNwT4s5VmvN25BexA1ZsyYvY3v+73YiajyhNZajzC+fH2cHq31EJJbtdahNxDAkwA+q4TQiEhHkRSSG4N5eK21NoHxpSTviLO1MzDpSTvjIQFbuoXQIvI1a5wdjqPavYX6QnGOIXRlC5sh9FIAj5C8S0SOUUrVmGN+l7JUKBkX7GMIeoPrusPS6XTffD5/FIBbAaxFSCUKpWLHWtvd8GH6rgWwKNhm/OpWAFO01iMcx+njOE5/z/NGAZgoIqN92XKENnb/EECriEwwgVZNJpMZYFJjU13XPdSSnQBgDYAzDOl6marqAyYF+I8KfOjnSc4FMMcUino1NDQcgFLmp9UPhgPobYLUJQCOj9LfFRCR0Tahg7t0dxHa6HrP13O6m835348qPHNSqtDclmpsjnQBg5OqA7DKlIyvMpH2BgDvoVT4iFrxhgCYhVIpd5MJMO7yixNBkPw2ylS7ANwXtRKb1W4mgOVmrLUk/yoi12mtv2SN8WBUccIaJ43SWdwWAJtYKqcXReSyYIoNQN6sxuvMQ7UYpkRtHoB9w0cppcdMhbWGpfTiYuu+PgIg8qQYgNsBLC43j64AgIJF2K3BymE3E/rWMLfjsInFfeubiu+OaipW9nCb1TasPJ2ghwDgSRG55PMcw8Q6G6yA8N6gTHcS2vbnAWyy21JNi0aps+b/X548SlFC6D0IxlXZorXev5p+psQ93XabomCyKX8LuBtHBeW6k9BG37JdAaoberQiFgmh9yyQvCMuLRoGa8veZty38wEcr7XeX2vdz8REYwFMZalYY6frQkvW3U1olkrzJZt4etX3QCmVEHpPgO+7m8LP5rDAOQ4mHgg7VbeVpYrq9rB2BE4ZBuw61ZL7NO74aGcJ7bruMGu8dR1SkhC654HSwagtJP8F4PSO6NBanwbg6QhSh12vRGRZdtMZ6LNbCd7kytssQo/viO02ALy5y+1gWfui0Ls73jZJEIvKgp4YaK1HAPgRyftReivkDZJvAXgNwFMicnOlb1obf34igKsBXBmsejqO019ErjAyE9EF/9wGwMVmV9nGzzkPnyBBggQJugP/A94x91x//ZrKAAAAAElFTkSuQmCC'
          };
          $J.addCSS('#' + crId, {
            display: 'inline-block !important;',
            visibility: 'visible !important;',
            'z-index': '2147483647 !important;',
            width: 'auto !important;',
            height: 'auto !important;',
            'max-width': 'none !important;',
            'max-height': 'none !important;',
            transform: 'none !important;',
            left: 'auto !important;',
            top: 'auto !important;',
            bottom: '8 !important;',
            right: '8 !important;',
            margin: 'auto !important',
            padding: '0 !important',
            opacity: '1 !important;'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          $J.addCSS('#crSirv' + crId + ' > img', {
            display: 'inline-block !important;',
            visibility: 'visible !important;',
            position: 'static !important;',
            width: '90px !important;',
            height: '18px !important;',
            'max-width': 'none !important;',
            'max-height': 'none !important;',
            transform: 'none !important;',
            margin: '0 !important',
            padding: '0 !important'
          }, globalVariables.CSS_RULES_ID, shadowRoot);
          var el = $J.$new('a', {
            id: crId,
            href: landing,
            target: '_blank'
          });
          el.attr('style', 'position: absolute !important; opacity: 1 !important');
          el.setCss({
            display: 'inline-block',
            overflow: 'hidden',
            visibility: 'visible',
            'font-size': 0,
            'font-weight': 'normal',
            'font-family': 'sans-serif',
            bottom: 8,
            right: 8,
            margin: 'auto',
            width: 'auto',
            height: 'auto',
            transform: 'none',
            'z-index': 2147483647
          }).appendTo(targetNode).addEvent('tap btnclick', function (e) {
            e.stopDistribution();
            $J.W.node.open(el.attr('href'));
          }).append($J.$new('img', BRAND_LOGO).setProps({
            alt: desc
          }));
        };

        return RootDOM;
      }();

      var GLOBAL_FUNCTIONS = {
        rootDOM: new RootDOM(),
        viewerFilters: [],
        getNodeWithSirvClassName: function (node) {
          var result = null;

          if (node) {
            node = $(node);

            if (node.hasClass('Sirv')) {
              result = node.node;
            } else {
              result = GLOBAL_FUNCTIONS.getNodeWithSirvClassName(node.node.parentNode);
            }
          }

          return result;
        },
        iconsHash: {
          nodes: [],
          elements: [[{
            classes: ['smv-arrow-control']
          }, {
            classes: ['smv-arrow']
          }, {
            classes: ['smv-icon']
          }], [{
            classes: ['smv-button-fullscreen-open']
          }, {
            classes: ['smv-icon']
          }], [{
            classes: ['smv-button-fullscreen-close']
          }, {
            classes: ['smv-icon']
          }], [{
            classes: ['smv-thumbnails']
          }, {
            classes: ['smv-selector'],
            attrs: [{
              name: 'data-type',
              value: 'spin'
            }]
          }]],
          waitBody: function () {
            return new Promise(function (resolve, reject) {
              var body = document.body;

              if (body) {
                resolve(body);
              } else {
                setTimeout(function () {
                  GLOBAL_FUNCTIONS.iconsHash.waitBody().then(resolve);
                }, 16);
              }
            });
          },
          make: function () {
            GLOBAL_FUNCTIONS.iconsHash.elements.forEach(function (data) {
              var elements = [];
              data.reverse().forEach(function (el) {
                var node = $J.$new('div');

                if (el.classes) {
                  el.classes.forEach(function (className) {
                    node.addClass(className);
                  });
                }

                if (el.attrs) {
                  el.attrs.forEach(function (attr) {
                    node.attr(attr.name, attr.value);
                  });
                }

                elements.push(node);
              });

              for (var i = 1, l = elements.length; i < l; i++) {
                elements[i].append(elements[i - 1]);
              }

              GLOBAL_FUNCTIONS.iconsHash.nodes.push(elements[elements.length - 1]);
            });
            GLOBAL_FUNCTIONS.iconsHash.nodes.forEach(function (el) {
              el.setCss({
                top: '-10000px',
                left: '-10000px',
                width: '10px',
                height: '10px',
                position: 'absolute',
                visibility: 'hodden',
                opacity: 0
              });
              GLOBAL_FUNCTIONS.iconsHash.waitBody().finally(function () {
                $J.$($J.D.node.body).append(el);
              });
            });
          },
          remove: function () {
            if (GLOBAL_FUNCTIONS.iconsHash.nodes.length) {
              GLOBAL_FUNCTIONS.iconsHash.nodes.forEach(function (el) {
                el.remove();
              });
              GLOBAL_FUNCTIONS.iconsHash.nodes = [];
            }
          }
        },
        adjustURL: function (url) {
          if (!/^(http(s)?:)?\/\//.test(url)) {
            url = globalVariables.SIRV_BASE_URL + url;
          }

          return adjustURLProto(url).replace(/([^:])\/+/g, '$1/');
        },
        normalizeURL: function (url) {
          return sanitizeURL(adjustURLProto(url));
        }
      };
      GLOBAL_FUNCTIONS.rootDOM.attachNode($J.D.node.head || $J.D.node.body);
      return GLOBAL_FUNCTIONS;
    });

    var _this = this;

    Sirv.define('helper', ['require', 'bHelpers', 'magicJS', 'globalVariables', 'Promise!'], function (sirvRequire, bHelpers, magicJS, globalVariables, Promise) {
      var moduleName = 'helper';
      var $J = magicJS;
      var $ = $J.$;
      var helper = {};
      /* global $J, helper */

      /* eslint-env es6 */

      var WaitToStart = /*#__PURE__*/function () {
        "use strict";

        function WaitToStart() {
          this.started = false;
          this.callbacks = [];
        }

        var _proto = WaitToStart.prototype;

        _proto.wait = function wait(cb) {
          if (this.started) {
            cb();
          } else {
            this.callbacks.push(cb);
          }
        };

        _proto.start = function start() {
          if (!this.started) {
            this.started = true;
            this.callbacks.forEach(function (cb) {
              return cb();
            });
          }
        };

        _proto.destroy = function destroy() {
          this.callbacks = [];
        };

        return WaitToStart;
      }();

      helper.WaitToStart = WaitToStart;
      /* global $J, helper */

      /* eslint-env es6 */
      // helper.addCss = (css, id, position) => {
      //     if (!position) { position = 'top'; }
      //     const stl = $J.$new('style', { id: (id || 'sirv-module-' + helper.generateUUID()), type: 'text/css' }).appendTo((document.head || document.body), position);
      //     stl.node.innerHTML = css;
      //     return stl;
      // };

      helper.addCss = function (css, id, position, root, selector) {
        var rootNode = document.head || document.body;
        var stl = $J.$new('style', {
          type: 'text/css'
        });
        stl.attr('id', id || 'sirv-module-' + stl.$J_UUID);

        if (!position) {
          position = 'top';
        }

        if (root) {
          rootNode = $(root).node || root;
        }

        var nextSibling;

        if (position === 'top') {
          nextSibling = rootNode.firstChild;
        }

        var addAfter = rootNode.querySelector(selector);

        if (addAfter && addAfter.nextSibling) {
          nextSibling = addAfter.nextSibling;
        }

        rootNode.insertBefore(stl.node, nextSibling);
        stl.node.innerHTML = css;
        return stl;
      };
      /* eslint-env es6 */

      /* global helper */


      helper.cleanQueryString = function (str) {
        str = str.replace(/&+/g, '&');
        str = str.replace(/&$/, '');
        str = str.replace(/\?&/, '?');
        str = str.replace(/profile=&|profile=$/g, '');
        str = str.replace(/image=&/g, 'image&');
        str = str.replace(/image=$/g, 'image');
        return str;
      };
      /* eslint-env es6 */

      /* global helper */


      helper.createReadOnlyProp = function (obj, name, value) {
        Object.defineProperty(obj, name, {
          value: value,
          writable: false
        });
      };
      /* global $J, helper */

      /* eslint-env es6 */
      // Returns if a value is an object


      var isObject = function (value) {
        return value && typeof value === 'object' && value.constructor === Object;
      };
      /**
       * Creates a debounced function that delays invoking `func` until after `wait`
       * milliseconds have elapsed since the last time the debounced function was
       * invoked, or until the next browser frame is drawn. The debounced function
       * comes with a `cancel` method to cancel delayed `func` invocations and a
       * `flush` method to immediately invoke them. Provide `options` to indicate
       * whether `func` should be invoked on the leading and/or trailing edge of the
       * `wait` timeout. The `func` is invoked with the last arguments provided to the
       * debounced function. Subsequent calls to the debounced function return the
       * result of the last `func` invocation.
       *
       * **Note:** If `leading` and `trailing` options are `true`, `func` is
       * invoked on the trailing edge of the timeout only if the debounced function
       * is invoked more than once during the `wait` timeout.
       *
       * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
       * until the next tick, similar to `setTimeout` with a timeout of `0`.
       *
       * If `wait` is omitted in an environment with `requestAnimationFrame`, `func`
       * invocation will be deferred until the next frame is drawn (typically about
       * 16ms).
       *
       * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
       * for details over the differences between `debounce` and `throttle`.
       *
       * @since 0.1.0
       * @category Function
       * @param {Function} func The function to debounce.
       * @param {number} [wait=0]
       *  The number of milliseconds to delay; if omitted, `requestAnimationFrame` is
       *  used (if available).
       * @param {Object} [options={}] The options object.
       * @param {boolean} [options.leading=false]
       *  Specify invoking on the leading edge of the timeout.
       * @param {number} [options.maxWait]
       *  The maximum time `func` is allowed to be delayed before it's invoked.
       * @param {boolean} [options.trailing=true]
       *  Specify invoking on the trailing edge of the timeout.
       * @returns {Function} Returns the new debounced function.
       * @example
       *
       * // Avoid costly calculations while the window size is in flux.
       * jQuery(window).on('resize', debounce(calculateLayout, 150))
       *
       * // Invoke `sendMail` when clicked, debouncing subsequent calls.
       * jQuery(element).on('click', debounce(sendMail, 300, {
       *   'leading': true,
       *   'trailing': false
       * }))
       *
       * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
       * const debounced = debounce(batchLog, 250, { 'maxWait': 1000 })
       * const source = new EventSource('/stream')
       * jQuery(source).on('message', debounced)
       *
       * // Cancel the trailing debounced invocation.
       * jQuery(window).on('popstate', debounced.cancel)
       *
       * // Check for pending invocations.
       * const status = debounced.pending() ? "Pending..." : "Ready"
       */


      helper.debounce = function (func, wait, options) {
        var lastArgs;
        var lastThis;
        var maxWait;
        var result;
        var timerId;
        var lastCallTime;
        var lastInvokeTime = 0;
        var leading = false;
        var maxing = false;
        var trailing = true; // Bypass `requestAnimationFrame` by explicitly setting `wait=0`.
        // const useRAF = (!wait && wait !== 0 && typeof root.requestAnimationFrame === 'function');

        var useRAF = !wait && wait !== 0 && $J.browser.features.requestAnimationFrame;

        if (typeof func !== 'function') {
          throw new TypeError('Expected a function');
        }

        wait = +wait || 0;

        if (isObject(options)) {
          leading = !!options.leading;
          maxing = 'maxWait' in options;
          maxWait = maxing ? Math.max(+options.maxWait || 0, wait) : maxWait;
          trailing = 'trailing' in options ? !!options.trailing : trailing;
        }

        var invokeFunc = function (time) {
          var args = lastArgs;
          var thisArg = lastThis;
          lastArgs = $J.U;
          lastThis = lastArgs;
          lastInvokeTime = time;
          result = func.apply(thisArg, args);
          return result;
        };

        var startTimer = function (pendingFunc, _wait) {
          if (useRAF) {
            $J.browser.cancelAnimationFrame(timerId);
            return $J.browser.requestAnimationFrame(pendingFunc);
          }

          return setTimeout(pendingFunc, _wait);
        };

        var cancelTimer = function (id) {
          if (useRAF) {
            $J.browser.cancelAnimationFrame(id);
          } else {
            clearTimeout(id);
          }
        };

        var remainingWait = function (time) {
          var timeSinceLastCall = time - lastCallTime;
          var timeSinceLastInvoke = time - lastInvokeTime;
          var timeWaiting = wait - timeSinceLastCall;
          return maxing ? Math.min(timeWaiting, maxWait - timeSinceLastInvoke) : timeWaiting;
        };

        var shouldInvoke = function (time) {
          var timeSinceLastCall = time - lastCallTime;
          var timeSinceLastInvoke = time - lastInvokeTime; // Either this is the first call, activity has stopped and we're at the
          // trailing edge, the system time has gone backwards and we're treating
          // it as the trailing edge, or we've hit the `maxWait` limit.

          return lastCallTime === $J.U || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;
        };

        var trailingEdge = function (time) {
          timerId = $J.U; // Only invoke if we have `lastArgs` which means `func` has been
          // debounced at least once.

          if (trailing && lastArgs) {
            return invokeFunc(time);
          }

          lastArgs = $J.U;
          lastThis = lastArgs;
          return result;
        };

        var timerExpired = function () {
          var time = Date.now();

          if (shouldInvoke(time)) {
            return trailingEdge(time);
          } // Restart the timer.


          timerId = startTimer(timerExpired, remainingWait(time));
          return $J.U;
        };

        var leadingEdge = function (time) {
          // Reset any `maxWait` timer.
          lastInvokeTime = time; // Start the timer for the trailing edge.

          timerId = startTimer(timerExpired, wait); // Invoke the leading edge.

          return leading ? invokeFunc(time) : result;
        };

        var cancel = function () {
          if (timerId !== $J.U) {
            cancelTimer(timerId);
          }

          lastInvokeTime = 0;
          lastArgs = $J.U;
          lastCallTime = lastArgs;
          lastThis = lastArgs;
          timerId = lastArgs;
        };

        var flush = function () {
          return timerId === $J.U ? result : trailingEdge(Date.now());
        };

        var pending = function () {
          return timerId !== $J.U;
        };

        var debounced = function () {
          var time = Date.now();
          var isInvoking = shouldInvoke(time);

          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
            args[_key] = arguments[_key];
          }

          lastArgs = args;
          lastThis = _this;
          lastCallTime = time;

          if (isInvoking) {
            if (timerId === $J.U) {
              return leadingEdge(lastCallTime);
            }

            if (maxing) {
              // Handle invocations in a tight loop.
              timerId = startTimer(timerExpired, wait);
              return invokeFunc(lastCallTime);
            }
          }

          if (timerId === $J.U) {
            timerId = startTimer(timerExpired, wait);
          }

          return result;
        };

        debounced.cancel = cancel;
        debounced.flush = flush;
        debounced.pending = pending;
        return debounced;
      };
      /* global $, $J, helper */

      /* eslint-env es6 */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */


      helper.deepExtend = function () {
        var extend = function (extendingObject, source) {
          var type = $J.typeOf(source);

          if (!$J.defined(extendingObject)) {
            if (type === 'array') {
              extendingObject = [];
            } else {
              extendingObject = {};
            }
          }

          if (type === 'array') {
            source.forEach(function (value, index) {
              var _type = $J.typeOf(value); // if (!$J.contains(extendingObject, value)) {


              if (_type === 'array' && $J.typeOf(extendingObject[index]) === 'array' || _type === 'object' && $J.typeOf(extendingObject[index]) === 'object') {
                extendingObject[index] = extend(extendingObject[index], value);
              } else {
                extendingObject.push(value);
              } // }

            });
          } else {
            helper.objEach(source, function (key, value, index) {
              var _type = $J.typeOf(value);

              if (_type === 'array' || _type === 'object') {
                extendingObject[key] = extend(extendingObject[key], value);
              } else {
                extendingObject[key] = value;
              }
            });
          }

          return extendingObject;
        };

        return function () {
          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            args[_key2] = arguments[_key2];
          }

          var result = null;
          args = $J.$A(args);

          if (args.length) {
            result = args.shift();
            args.forEach(function (value) {
              var _type = $J.typeOf(value);

              if (_type === 'array' || _type === 'object') {
                result = extend(result, value);
              }
            });
          }

          return result;
        };
      }();
      /* global $J, helper */

      /* eslint-env es6 */


      helper.fixSize = function (node, size) {
        node = $(node);

        var checkAuto = function (_node, side) {
          return _node.attr(side) === 'auto';
        };

        var correctSizeValue = function (value) {
          if (value <= 4) {
            value = 0;
          }

          return value;
        };

        ['width', 'height'].forEach(function (side) {
          if ($J.browser.ieMode && !node.attr('src')) {
            if (checkAuto(node, side)) {
              size[side] = 0;
            }
          }

          if (size[side] === 0) {
            // check "width" / "height" attribute
            size[side] = helper.imageLib.getPartSize(node, side);
          }

          size[side] = correctSizeValue(size[side]);
        });
        return size;
      };
      /* global $J, helper */

      /* eslint-env es6 */


      helper.generateUUID = function () {
        return parseInt(Math.random() * 10000000, 10);
      };
      /* global helper */

      /* eslint-env es6 */


      helper.getArrayIndex = function (index, length) {
        index %= length;

        if (index < 0) {
          index += length;
        }

        return index;
      };
      /* global $J, helper */

      /* eslint-env es6 */


      helper.getDPPX = function (value, maxValue, upscale) {
        var result = maxValue / value;
        var count = 100;

        if (result >= $J.DPPX || upscale) {
          result = $J.DPPX;
        } else {
          result *= count;
          result = Math.ceil(result) / count;
        }

        return result;
      };
      /* global helper */

      /* global $ */

      /* eslint-env es6 */


      helper.getMatrix = function (node) {
        var result = null;
        var is3D;
        var matrix = $(node).getCss('transform') + '';

        var getNumber = function (str) {
          return parseFloat(str.trim());
        };

        var getTrObj = function (arrIndexes, arr) {
          var _result = {};
          var axises = ['x', 'y', 'z'];
          arrIndexes.forEach(function (v, i) {
            _result[axises[i]] = getNumber(arr[v]);
          });
          return _result;
        };

        if (matrix !== 'none') {
          result = {};
          matrix = matrix.split('(')[1];
          matrix = matrix.split(')')[0];
          matrix = matrix.split(',');
          is3D = matrix.length > 6;
          result.transform = getTrObj(is3D ? [12, 13, 14] : [4, 5], matrix);
          result.scale = getTrObj(is3D ? [0, 5, 10] : [0, 3], matrix);
        }

        return result;
      };
      /* global $J, helper, Promise */

      /* eslint no-throw-literal: "off" */

      /* eslint-env es6 */


      helper.getRemoteData = function () {
        var __XMLHttpRequest = function (url) {
          return new Promise(function (resolve, reject) {
            var xhr = null;

            if ($J.browser.features.xhr2) {
              xhr = new XMLHttpRequest();
            } else if (window.XDomainRequest) {
              xhr = new XDomainRequest();
            }

            if (xhr) {
              xhr.onerror = function (e) {
                reject(e || true);
              };

              xhr.onload = function (e) {
                try {
                  if (xhr.status === 200) {
                    var value = JSON.parse(xhr.responseText);
                    resolve(value);
                  } else {
                    throw {
                      status: xhr.status,
                      data: e
                    };
                  }
                } catch (_err) {
                  reject(_err);
                }
              };

              xhr.open('GET', url);

              if (undefined !== xhr.responseType) {
                xhr.responseType = 'text';
              }

              xhr.send(null);
            } else {
              reject(true);
            }
          });
        };

        var getByFetch = function (url, referrerPolicy) {
          return fetch(url, {
            referrerPolicy: referrerPolicy || 'no-referrer-when-downgrade'
          }).then(function (response) {
            if (response.status === 200) {
              return response.json();
            }

            throw {
              status: response.status,
              data: response
            };
          });
        };

        var getData = window.fetch ? getByFetch : __XMLHttpRequest;

        var __jsonp = function (url, callbackName) {
          return new Promise(function (resolve, reject) {
            var scriptOk = false;
            var script = document.createElement('script');

            if (!window[callbackName]) {
              window[callbackName] = function () {
                scriptOk = true;
                delete window[callbackName];
                document.body.removeChild(script);
                resolve(arguments.length <= 0 ? undefined : arguments[0]);
              };
            }

            var checkCallback = function () {
              if (scriptOk) return;
              delete window[callbackName];
              document.body.removeChild(script);
              reject(url);
            };

            script.onreadystatechange = function () {
              if (_this.readyState === 'complete' || _this.readyState === 'loaded') {
                _this.onreadystatechange = null;
                setTimeout(checkCallback, 0);
              }
            };

            script.onerror = checkCallback;
            script.onload = checkCallback;
            script.src = url + '&callback=' + callbackName;
            document.body.appendChild(script);
          });
        };

        return function (url, callbackName
        /* for jsonp */
        , referrerPolicy) {
          return new Promise(function (resolve, reject) {
            getData(url, referrerPolicy).then(resolve).catch(function (err) {
              if (err && err.status && $J.contains([404, 200], err.status)) {
                reject(err);
              } else {
                // eslint-disable-next-line no-console
                console.log('XHR error. Switching to JSONP.');

                if (!callbackName) {
                  callbackName = 'sirv_data_' + helper.generateUUID();
                }

                __jsonp(url, callbackName).then(resolve).catch(reject);
              }
            });
          });
        };
      }();
      /* global helper */

      /* global $ */

      /* eslint-env es6 */


      helper.getSirvType = function () {
        var isNotEmptyString = function (str) {
          var result = false;

          if (str) {
            str += '';
            result = str.trim() !== '';
          }

          return result;
        };

        return function (node) {
          node = $(node);
          var tmp = node.attr('data-type') || node.attr('data-effect');
          var viewContent = node.fetch('view-content');
          var result = null;
          var componentType;
          var imgSrc;

          if (isNotEmptyString(tmp) && tmp !== 'static') {
            var index = globalVariables.SLIDE.NAMES.indexOf(tmp);
            componentType = index >= 0 ? index : globalVariables.SLIDE.TYPES.ZOOM;
            tmp = node.attr('data-src');

            if (isNotEmptyString(tmp)) {
              imgSrc = tmp;
            } else {
              tmp = $(node.node.getElementsByTagName('img')[0]);

              if (tmp.attr) {
                imgSrc = tmp.attr('src') || tmp.attr('data-src');
              }
            }
          } else {
            tmp = node.attr('data-src');

            if (isNotEmptyString(tmp)) {
              if (helper.isSpin(tmp) && node.getTagName() !== 'img' || viewContent === globalVariables.SLIDE.TYPES.SPIN) {
                componentType = globalVariables.SLIDE.TYPES.SPIN;
                imgSrc = tmp;
              } else if (helper.isVideo(tmp)) {
                componentType = globalVariables.SLIDE.TYPES.VIDEO;
                imgSrc = tmp;
              } else {
                imgSrc = tmp;
                componentType = globalVariables.SLIDE.TYPES.IMAGE;

                if (viewContent) {
                  componentType = viewContent;
                }
              }
            } else {
              tmp = node.attr('src');

              if (isNotEmptyString(tmp) && node.getTagName() === 'img') {
                imgSrc = tmp;
                componentType = globalVariables.SLIDE.TYPES.IMAGE;
              }
            }
          }

          if (componentType) {
            result = {
              type: componentType,
              imgSrc: imgSrc
            };
          }

          return result;
        };
      }();
      /* global $J, $ */

      /* eslint no-restricted-syntax: ["error", "FunctionExpression", "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint no-prototype-builtins: "off" */

      /* eslint lines-around-directive: ["off"] */

      /* eslint strict: ["off"] */

      /* eslint-env es6 */


      if (!$J.hashKeys) {
        if (Object.keys) {
          $J.hashKeys = Object.keys;
        } else {
          (function () {
            'use strict';

            var hasOwnProperty = Object.prototype.hasOwnProperty;
            var hasDontEnumBug = !{
              toString: null
            }.propertyIsEnumerable('toString');
            var dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'];
            var dontEnumsLength = dontEnums.length;
            return function (obj) {
              if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {
                throw new TypeError('Object.keys called on non-object');
              }

              var result = [];
              var prop;
              var i;

              for (prop in obj) {
                if (hasOwnProperty.call(obj, prop)) {
                  result.push(prop);
                }
              }

              if (hasDontEnumBug) {
                for (i = 0; i < dontEnumsLength; i++) {
                  if (hasOwnProperty.call(obj, dontEnums[i])) {
                    result.push(dontEnums[i]);
                  }
                }
              }

              return result;
            };
          })();
        }
      }
      /* global $, $J, helper */

      /* eslint-env es6 */


      helper.imageLib = {
        isNumber: function (value) {
          return /(px|%)$/.test(value);
        },
        getSize: function (node, count) {
          // eslint-disable-next-line
          return new Promise(function (resolve, reject) {
            var size = $(node).getInnerSize();

            if (!count) {
              count = 100;
            }

            count -= 1;

            if (!size.width && !size.height && count > 0) {
              setTimeout(function () {
                helper.imageLib.getSize(node, count).then(resolve);
              }, 16);
            } else {
              resolve(size);
            }
          });
        },
        // just for pixels
        getBackgroundValue: function (value) {
          var result = null;

          if (value && /px$/.test(value)) {
            result = parseInt(value, 10);
          }

          return result;
        },
        // just for pixels
        getBackgroundSize: function (node) {
          var result = null;
          var value = $(node).getCss('background-size');

          if (value) {
            value = value.split(',')[0].split(' ');
            var w = helper.imageLib.getBackgroundValue((value[0] || '').trim());
            var h = helper.imageLib.getBackgroundValue((value[1] || '').trim());

            if (w !== null) {
              result = {
                width: w
              };
            }

            if (h !== null) {
              if (!result) {
                result = {};
              }

              result.height = h;
            }
          }

          return result;
        },
        calcProportionalBackgroundSize: function (bgSize, infoSize) {
          var result = {
            width: infoSize.width,
            height: infoSize.height
          };

          if (bgSize.width && infoSize.width > bgSize.width) {
            result.width = bgSize.width;
            result.height = bgSize.width * infoSize.height / infoSize.width;
          }

          if (bgSize.height && infoSize.height > bgSize.height) {
            result.height = bgSize.height;
            result.width = bgSize.height * infoSize.width / infoSize.height;
          }

          return result;
        },
        getBackgroundPositionValue: function (value) {
          var result;

          switch (value) {
            case 'top':
            case 'left':
              result = 0;
              break;

            case 'center':
              result = 50;
              break;

            case 'right':
            case 'bottom':
              result = 100;
              break;

            default:
              if (helper.imageLib.isNumber(value)) {
                result = parseInt(value, 10);
              } else {
                result = 0;
              }

          }

          return result;
        },
        getBackgroundPosition: function (node) {
          var x = {
            side: 'left',
            position: 0,
            sign: '%'
          };
          var y = {
            side: 'top',
            position: 0,
            sign: '%'
          };
          var xIndex = 0;
          var yIndex = 1;
          var value = $(node).getCss('background-position');

          if (value) {
            value = value.replace(/important/, '');
            value = value.replace(/!/g, '');
            value = value.trim();
            value = value.replace(/\s+/g, ' ');
            value = value.split(' ');

            if (value.length > 2) {
              xIndex = 1;
              yIndex = 3;

              if ($J.contains(['left', 'right'], value[0])) {
                x.side = value[0];
              }

              if ($J.contains(['top', 'bottom'], value[2])) {
                y.side = value[2];
              }
            }

            x.position = helper.imageLib.getBackgroundPositionValue(value[xIndex]);
            y.position = helper.imageLib.getBackgroundPositionValue(value[yIndex]);

            if (/px$/.test(value[xIndex])) {
              x.sign = 'px';
            }

            if (/px$/.test(value[yIndex])) {
              y.sign = 'px';
            }
          }

          return {
            x: x,
            y: y
          };
        },
        getPartSize: function (node, side) {
          var result = 0,
              value;

          if ($J.browser.ieMode) {
            value = (node.currentStyle[side] || '0').replace(/px$/, '');
          } else {
            value = (node.getCss(side) || '0').replace(/px$/, '');
          }

          if (isFinite(value)) {
            result = Math.round(parseFloat(value)) - parseFloat(node.getCss('border-top-width') || 0) - parseFloat(node.getCss('border-bottom-width') || 0) - parseFloat(node.getCss('padding-top') || 0) - parseFloat(node.getCss('padding-bottom') || 0);
          }

          return result;
        },
        checkMaxSize: function (size, originSize, dppx) {
          var firstSide, secondSide;

          if (size.width > originSize.width * dppx || size.height > originSize.height * dppx) {
            if (size.width > originSize.width) {
              firstSide = 'width';
              secondSide = 'height';
            } else {
              firstSide = 'height';
              secondSide = 'width';
            }

            size[firstSide] = originSize[firstSide];

            if (size[secondSide]) {
              size[secondSide] = originSize[secondSide];
            }

            size.round = false;
          }

          return size;
        },
        calcImageProportion: function (firstSide, secondSide, proportionSize, baseFirstSize) {
          var prop = proportionSize[secondSide] / proportionSize[firstSide];
          var result = {};
          result[firstSide] = baseFirstSize;
          result[secondSide] = parseInt(prop * result[firstSide], 10);
          return result;
        },
        contain: function (imageSize, containerSize) {
          var result = {
            width: imageSize.width,
            height: imageSize.height
          };

          if (containerSize.width && result.width > containerSize.width) {
            result = helper.imageLib.calcImageProportion('width', 'height', result, containerSize.width);
          }

          if (containerSize.height && result.height > containerSize.height) {
            result = helper.imageLib.calcImageProportion('height', 'width', result, containerSize.height);
          }

          return result;
        },
        cover: function (imageSize, containerSize) {
          var result = {
            width: imageSize.width,
            height: imageSize.height
          };

          if (containerSize.width && result.width < containerSize.width) {
            result = helper.imageLib.calcImageProportion('width', 'height', result, containerSize.width);
          }

          if (containerSize.height && result.height < containerSize.height) {
            result = helper.imageLib.calcImageProportion('height', 'width', result, containerSize.height);
          }

          return result;
        },
        calcProportionSize: function (size, originSize, fitSize) {
          var result = {};
          var w = originSize.width;
          var h = originSize.height;
          var wh = w / h;
          var hw = h / w;

          var setW = function () {
            result.height = size.height;
            result.width = parseInt(wh * size.height, 10);
          };

          var setH = function () {
            result.width = size.width;
            result.height = parseInt(hw * size.width, 10);
          };

          if (size.width > w || size.height > h) {
            if (size.width > w) {
              size.width = w;

              if (size.height) {
                if (size.height > h) {
                  size.height = h;
                } else {
                  setW();
                }
              }
            } else {
              size.height = h;

              if (size.width) {
                if (size.width > w) {
                  size.width = w;
                } else {
                  setH();
                }
              }
            }
          }

          if (size.width || size.height) {
            if (size.width && size.height) {
              // if (Math.abs(size.width / size.height - wh) <= Math.abs(size.height / size.width - hw)) {
              if (size.width / size.height - wh <= size.height / size.width - hw) {
                setH();
              } else {
                setW();
              }
            } else if (!size.width) {
              setW();
            } else {
              setH();
            }
          }

          if (fitSize) {
            if (helper.imageLib.isNumber(fitSize.width) && helper.imageLib.isNumber(fitSize.height)) {
              w = parseInt(fitSize.width, 10);

              if (/%$/.test(fitSize.width)) {
                w = w / 100 * size.width;
              }

              h = parseInt(fitSize.height, 10);

              if (/%$/.test(fitSize.height)) {
                h = h / 100 * size.height;
              }

              if (w < originSize.width / originSize.height * h) {
                result = helper.imageLib.calcImageProportion('width', 'height', originSize, w);
              } else {
                result = helper.imageLib.calcImageProportion('height', 'width', originSize, h);
              }
            } else {
              if (helper.imageLib.isNumber(fitSize.width)) {
                w = parseInt(fitSize.width, 10);

                if (/%$/.test(fitSize.width)) {
                  w = w / 100 * size.width;
                }

                result = helper.imageLib.calcImageProportion('width', 'height', originSize, w);
              }

              if (helper.imageLib.isNumber(fitSize.height)) {
                h = parseInt(fitSize.height, 10);

                if (/%$/.test(fitSize.height)) {
                  h = h / 100 * size.height;
                }

                result = helper.imageLib.calcImageProportion('height', 'width', originSize, h);
              }

              if ($J.contains([fitSize.width, fitSize.height], 'initial')) {
                result.width = originSize.width;
                result.height = originSize.height;
              } else if ($J.contains([fitSize.width, fitSize.height], 'cover')) {
                result = helper.imageLib.cover(result, size);
              } else if ($J.contains([fitSize.width, fitSize.height], 'contain')) {
                result = helper.imageLib.contain(result, size);
              }
            }
          }

          return result;
        }
      };
      /* eslint-env es6 */

      /* global $, $J, helper */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none"}] */

      /* eslint no-empty: "error"*/

      helper.InViewModule = function () {
        var elementIsShown = function (node) {
          var result = true;

          if (node.getTagName() !== 'body') {
            if (node.getCss('display') === 'none') {
              result = false;
            } else {
              result = elementIsShown($(node.node.parentNode));
            }
          }

          return result;
        };

        var Timer = /*#__PURE__*/function () {
          "use strict";

          function Timer() {
            this.timer = null;
            this.started = false;
            this.list = [];
          }

          var _proto2 = Timer.prototype;

          _proto2._startTimer = function _startTimer() {
            var _this2 = this;

            if (this.list.length) {
              clearTimeout(this.timer);
              this.timer = setTimeout(function () {
                _this2._check();

                if (_this2.started) {
                  _this2._startTimer();
                }
              }, 500);
            }
          };

          _proto2._check = function _check() {
            this.list.forEach(function (obj) {
              var isShown = elementIsShown(obj.obj.node);
              var callCB = isShown !== obj.obj.isShown;
              obj.obj.isShown = isShown;

              if (callCB) {
                obj.callback(obj.obj);
              }
            });
          };

          _proto2.push = function push(obj, cb) {
            var insideObj = {
              obj: obj,
              callback: cb
            };
            this.list.push(insideObj);

            if (!this.started) {
              this.started = true;

              this._startTimer();
            }
          };

          _proto2.remove = function remove(node) {
            for (var i = 0, l = this.list.length; i < l; i++) {
              if (this.list[i].obj.node.node === node) {
                this.list.splice(i, 1);
                break;
              }
            }

            if (!this.list.length) {
              this.started = false;
            }
          };

          return Timer;
        }();

        var timerInstance = new Timer();

        var getPercent = function (full, current) {
          var result = 0;

          if (full > 0) {
            result = current / full;
          }

          return result;
        };

        var checkValue = function (value) {
          var result = null;

          if (value !== null) {
            value = parseFloat(value);

            if (!isNaN(value)) {
              if (value < 0) {
                value = 0;
              }

              if (value > 1) {
                value = 1;
              }

              result = value;
            }
          }

          return result;
        };

        var getRootSize = function (node) {
          if (!node) {
            node = window;
          }

          return {
            width: node.offsetWidth || node.innerWidth || document.documentElement.clientWidth,
            height: node.offsetHeight || node.innerHeight || document.documentElement.clientHeight
          };
        };

        var getRootData = function (node, pos, size) {
          var tmp;
          var result = $J.extend({}, pos);

          try {
            tmp = $(node).getBoundingClientRect();
            result.top += tmp.top;
            result.left += tmp.left;
          } catch (e) {
            /* empty */
          }

          result = $J.extend(result, size);
          return result;
        }; // px and % only


        var checkRootMargin = function (value) {
          var result = [];
          var l;
          var i;

          var f = function () {
            return 0;
          };

          if (value && !Array.isArray(value)) {
            if ($J.typeOf(value) === 'number') {
              value = [value];
            } else if ($J.typeOf(value) === 'string') {
              value = value.split(' ');
              l = value.length;

              for (i = 0; i < l; i++) {
                value[i] = value[i].trim();
              }
            } else {
              value = null;
            }
          }

          if (Array.isArray(value)) {
            l = value.length;

            if (l > 4) {
              l = 4;
            }

            value.forEach(function (v) {
              if ($J.contains(['string', 'number'], $J.typeOf(v))) {
                var number = parseInt(v, 10);

                if (/%$/.test(v)) {
                  result.push(function (width) {
                    return width / 100 * number;
                  });
                } else {
                  result.push(function (width) {
                    return number;
                  });
                }
              } else {
                result.push(f);
              }
            }); // [top, right, bottom, left]

            switch (l) {
              case 1:
                result.push(result[0]);
                result.push(result[0]);
                result.push(result[0]);
                break;

              case 2:
                result.push(result[0]);
                result.push(result[1]);
                break;

              case 3:
                result.push(result[1]);
                break;
              // no default
            }
          } else {
            result = [f, f, f, f];
          }

          return result;
        };

        var checkThreshold = function (value) {
          var result = [];
          var tmp;

          if (Array.isArray(value)) {
            value.forEach(function (v) {
              tmp = checkValue(v);

              if (tmp !== null && !$J.contains(result, tmp)) {
                result.push(tmp);
              }
            });
          } else {
            result = [0];
          }

          return result;
        };

        var getIntersectionRatio = function (rect, viewPortSize) {
          var width;
          var height;
          var rw = rect.width || 1;
          var rh = rect.height || 1;
          width = Math.min(rect.left + rw, viewPortSize.left + viewPortSize.width) - Math.max(rect.left, viewPortSize.left);
          height = Math.min(rect.top + rh, viewPortSize.top + viewPortSize.height) - Math.max(rect.top, viewPortSize.top);

          if (width < 0) {
            width = 0;
          }

          if (height < 0) {
            height = 0;
          }

          return getPercent(rw * rh, width * height);
        };

        var checkThresholdQueue = function (arr, lastIntersectionRatio, currentIntersectionRatio) {
          var result = false;
          var i;
          var l = arr.length;

          if (lastIntersectionRatio !== currentIntersectionRatio) {
            if (lastIntersectionRatio < currentIntersectionRatio) {
              for (i = 0; i < l; i++) {
                if (arr[i] === 0 && lastIntersectionRatio === 0 || lastIntersectionRatio < arr[i] && arr[i] <= currentIntersectionRatio) {
                  result = true;
                  break;
                }
              }
            } else {
              for (i = 0; i < l; i++) {
                if (arr[i] === 1 && lastIntersectionRatio === 1 || lastIntersectionRatio > arr[i] && arr[i] >= currentIntersectionRatio) {
                  result = true;
                  break;
                }
              }
            }
          }

          return result;
        };

        var FakeIntersectionObserver = /*#__PURE__*/function () {
          "use strict";

          function FakeIntersectionObserver(callback, options) {
            this.callback = callback;
            this.options = $J.extend({
              rootMargin: '0px',
              threshold: [0],
              root: null
            }, options || {});
            this.options.rootMargin = checkRootMargin(this.options.rootMargin);
            this.options.threshold = checkThreshold(this.options.threshold);
            this.nodeList = [];
            this.last = [];
            this.viewPortSize = {
              top: 0,
              left: 0,
              width: 0,
              height: 0
            };
            this.correctPosition = {
              top: 0,
              left: 0
            };
            this.eventWasAdded = false;
            this.bindedRender = this._render.bind(this);
            this.bindedResize = this._resize.bind(this);

            this._resize();
          }

          var _proto3 = FakeIntersectionObserver.prototype;

          _proto3._setEvents = function _setEvents(e) {
            if (!this.eventWasAdded) {
              this.eventWasAdded = true;
              $(window).addEvent('resize', this.bindedResize);
              $(this.options.root || window).addEvent('scroll', this.bindedRender);
            }
          };

          _proto3._removeEvents = function _removeEvents(e) {
            if (this.eventWasAdded) {
              this.eventWasAdded = false;
              $(window).removeEvent('resize', this.bindedResize);
              $(this.options.root || window).removeEvent('scroll', this.bindedRender);
            }
          };

          _proto3._resize = function _resize(e) {
            var m = this.options.rootMargin;
            var rootSize = getRootSize(this.options.root);
            $(m).map(function (v) {
              return v(rootSize.width);
            });
            this.correctPosition = {
              top: 0 - m[0](rootSize.width),
              left: 0 - m[1](rootSize.width)
            };
            this.viewPortSize = {
              width: rootSize.width + m[1](rootSize.width) + m[3](rootSize.width),
              height: rootSize.height + m[0](rootSize.width) + m[2](rootSize.width)
            };
          };

          _proto3._renderElement = function _renderElement(nodeObj) {
            var result = null;

            if (nodeObj.isShown) {
              var rootData = getRootData(this.options.root, this.correctPosition, this.viewPortSize);
              var intersectionRatio = getIntersectionRatio(nodeObj.node.node.getBoundingClientRect(), rootData);

              if (checkThresholdQueue(this.options.threshold, nodeObj.intersectionRatio, intersectionRatio)) {
                nodeObj.intersectionRatio = intersectionRatio;
                result = {
                  target: nodeObj.node.node,
                  intersectionRatio: nodeObj.intersectionRatio,
                  isIntersecting: nodeObj.intersectionRatio > 0
                };
              }
            }

            return result;
          };

          _proto3._render = function _render() {
            var _this3 = this;

            var changedNodes = [];
            this.nodeList.forEach(function (node) {
              var result = _this3._renderElement(node);

              if (result) {
                changedNodes.push(result);
              }
            });

            if (changedNodes.length) {
              this.last = changedNodes;
              this.callback(changedNodes);
            }
          };

          _proto3.takeRecords = function takeRecords() {
            this._render();

            return this.last;
          };

          _proto3.observe = function observe(node) {
            var _this4 = this;

            var cbData;
            node = $(node);
            node = {
              node: node,
              isShown: elementIsShown(node),
              intersectionRatio: 0,
              isIntersecting: false
            };
            timerInstance.push(node, function (_node) {
              var result = _this4._renderElement(_node);

              if (result) {
                _this4.last = [result];

                _this4.callback([result]);
              }
            });
            this.nodeList.push(node);

            this._setEvents();

            var result = this._renderElement(node);

            if (result) {
              cbData = result;
            } else {
              cbData = {
                target: node.node.node,
                intersectionRatio: 0,
                isIntersecting: false
              };
            }

            this.callback([cbData]);
          };

          _proto3.unobserve = function unobserve(node) {
            var nodes = [];
            node = $(node);
            this.nodeList.forEach(function (obj) {
              nodes.push(obj.node.node);
            });
            var index = nodes.indexOf(node.node);
            timerInstance.remove(node.node);

            if (index > -1) {
              this.nodeList.splice(index, 1);
            }

            if (!this.nodeList.length) {
              this._removeEvents();
            }
          };

          _proto3.disconnect = function disconnect() {
            this.nodeList.forEach(function (node) {
              timerInstance.remove(node.node);
            });
            this.nodeList = [];

            this._removeEvents();
          };

          return FakeIntersectionObserver;
        }();

        var Instance = /*#__PURE__*/function () {
          "use strict";

          function Instance(callback, options) {
            var IntersectionObserverClass = window.IntersectionObserver || FakeIntersectionObserver;
            this.observer = new IntersectionObserverClass(callback, options || {});
          }

          Instance.isInView = function isInView(node) {
            var rect = $(node).getBoundingClientRect();
            return (rect.top >= 0 || rect.top - rect.bottom < rect.top) && rect.left >= 0 && rect.top <= (window.innerHeight || document.documentElement.clientHeight);
          };

          var _proto4 = Instance.prototype;

          _proto4.takeRecords = function takeRecords() {
            return this.observer.takeRecords();
          };

          _proto4.observe = function observe(target) {
            if (target.node) {
              target = target.node;
            }

            this.observer.observe(target);
          };

          _proto4.unobserve = function unobserve(target) {
            this.observer.unobserve(target);
          };

          _proto4.disconnect = function disconnect() {
            this.observer.disconnect();
          };

          return Instance;
        }();

        return Instance;
      }();
      /* global $J, helper */

      /* eslint-env es6 */


      helper.isIe = function () {
        return $J.browser.uaName === 'edge' || $J.browser.uaName === 'ie' && $J.contains([10, 11], $J.browser.uaVersion);
      };
      /* global helper */

      /* eslint-env es6 */


      helper.isPercentage = function (value) {
        return /^([-]?[0-9]*\.?[0-9]+)%$/.test('' + value);
      };
      /* global $J, helper */

      /* eslint-env es6 */


      helper.isSVG = function (url) {
        var result = false;

        if (url) {
          url = url.split('?')[0];
          url = url.split('.');
          url = url[url.length - 1];
          result = /svg/i.test(url);
        }

        return result;
      };
      /* global helper */

      /* eslint-env es6 */


      helper.isSpin = function (str) {
        str = (str || '').split('?')[0];
        return /([^#?]+)\/?([^#?]+\.spin)(\?([^#]*))?(#(.*))?$/.test(str);
      };
      /* global helper */

      /* eslint-env es6 */


      helper.isVideo = function (str) {
        str = (str || '').split('?')[0];
        return /([^#?]+)\/?([^#?]+\.(mp4|mov|avi|m4v|mkv|webm|wmv|ogv|ogg))(\?([^#]*))?(#(.*))?$/i.test(str);
      };
      /* global helper */

      /* global $J */

      /* global $ */

      /* eslint-env es6 */


      helper.loadImage = function (sources) {
        return new Promise(function (resolve, reject) {
          var img;
          var container;
          var createContainer = false;

          if ($J.contains(['array', 'string'], $J.typeOf(sources))) {
            if ($J.typeOf(sources) === 'string') {
              sources = [sources];
            }

            img = $J.$new('img').setCss({
              maxWidth: 'none',
              maxHeight: 'none'
            });
            img.attr('referrerpolicy', 'no-referrer-when-downgrade');
            createContainer = true;
          } else {
            img = $(sources);

            if (!img.node.parentNode) {
              createContainer = true;
            }
          }

          if (createContainer) {
            container = $J.$new('div').setCss({
              top: '-10000px',
              left: '-10000px',
              width: '10px',
              height: '10px',
              position: 'absolute',
              overflow: 'hidden'
            });
            container.append(img);
            $($J.D.node.body).append(container);
          } // if (!img.complete || $J.browser.engine === 'gecko') {


          if (!img.node.complete || !img.node.src) {
            var handler = function (e) {
              img.removeEvent('load error', handler);

              if (e.type === 'error') {
                reject({
                  error: e
                });
              } else {
                resolve({
                  image: e,
                  size: {
                    width: img.node.naturalWidth || img.node.width,
                    height: img.node.naturalHeight || img.node.height
                  }
                });
              }

              if (container) {
                container.remove();
              }
            };

            img.addEvent('load error', handler);

            if (container && $J.typeOf(sources) === 'array') {
              img.attr('src', sources[0]);

              if (sources[1]) {
                // img.attr('srcset', encodeURI(sources[1]) + ' 2x');
                img.attr('srcset', sources[1] + ' 2x');
              }
            }
          } else {
            if (container) {
              container.remove();
            }

            resolve({
              image: null,
              size: img.getSize()
            });
          }
        });
      };
      /* global $J, helper */

      /* eslint-env es6 */


      helper.loadStylesheet = function (url, id, shadowRoot, selector) {
        return new Promise(function (resolve, reject) {
          var alreadyIncluded = false;
          var rootElement = shadowRoot || $J.D.node;
          $J.$A(rootElement.querySelectorAll('link')).forEach(function (link) {
            var href = $(link).attr('href') || '';

            if ($J.getAbsoluteURL(href) === $J.getAbsoluteURL(url)) {
              alreadyIncluded = true;
            }
          });

          if (alreadyIncluded) {
            resolve();
          } else {
            var slink = $J.$new('link');

            if (id !== $J.U) {
              slink.node.id = id;
            }

            slink.node.rel = 'stylesheet';
            slink.node.type = 'text/css';

            slink.node.onload = function () {
              resolve();
            };

            slink.node.onerror = function (e) {
              reject(e);
            };

            slink.node.href = url;
            var root = $J.D.node.head || $J.D.node.getElementsByTagName('head')[0] || $J.D.node.body || $J.D.node.documentElement;

            if (shadowRoot) {
              root = shadowRoot;
            }

            var nextSibling = root.firstChild;
            var addAfter = root.querySelector(selector);

            if (addAfter && addAfter.nextSibling) {
              nextSibling = addAfter.nextSibling;
            }

            root.insertBefore(slink.node, nextSibling);
          }
        });
      };
      /* global helper */

      /* eslint-env es6 */


      helper.makeQueryblePromise = function (promise) {
        if (promise.isResolved) {
          return promise;
        }

        var isPending = true;
        var isRejected = false;
        var isFulfilled = false;
        var result = promise.then(function (res) {
          isPending = false;
          isFulfilled = true;
          return res;
        }, function (err) {
          isPending = false;
          isRejected = true;
          return err;
        });

        result.isFulfilled = function () {
          return isFulfilled;
        };

        result.isPending = function () {
          return isPending;
        };

        result.isRejected = function () {
          return isRejected;
        };

        return result;
      };
      /* global helper */

      /* eslint no-restricted-syntax: ["error", "FunctionExpression", "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint-env es6 */


      helper.objEach = function (obj, cb) {
        var index = 0;

        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) {
            cb(key, obj[key], index);
            index += 1;
          }
        }
      };
      /* global $, $J, helper */

      /* eslint quote-props: ["off", "always"] */

      /* eslint-env es6 */


      helper.paramsFromQueryString = function () {
        var IMG_OPTION_ALIAS = {
          w: 'scale.width',
          h: 'scale.height',
          cw: 'crop.width',
          ch: 'crop.height',
          cx: 'crop.x',
          cy: 'crop.y',
          q: 'quality',
          s: 'size',
          // p         : 'profile', // WE SHOULD UPDATE NGINX CONFIGS FOR THIS
          text: 'text.text',
          watermark: 'watermark.image',
          'watermark.w': 'watermark.scale.width',
          'watermark.h': 'watermark.scale.height',
          'watermark.cw': 'watermark.crop.width',
          'watermark.ch': 'watermark.crop.height',
          'watermark.cx': 'watermark.crop.x',
          'watermark.cy': 'watermark.crop.y'
        }; // fix: if the '<meta http-equiv="Content-Type" content="text/html;charset=utf-8">' is absent

        var decodeURIComponentX = function (str) {
          var out = '';
          var i = 0;
          var l;
          var x;
          var arr = str.split(/(%(?:D0|D1)%.{2})/);

          for (l = arr.length; i < l; i++) {
            try {
              x = decodeURIComponent(arr[i]);
            } catch (e) {
              x = arr[i];
            }

            out += x;
          }

          return out;
        };
        /**
         * Converts query string to Object
         * @param  {String} query   Query string
         * @return {Object}
         */


        return function (query) {
          var params = {};

          if (query) {
            $(query.split('&')).forEach(function (pair) {
              var setting = pair.split('='); // Convert option alias to a real name

              setting[0] = IMG_OPTION_ALIAS[setting[0]] || setting[0];
              setting[0].trim().split('.').reduce(function (res, val, ind, col) {
                if (/^\d$/.test(val)) {
                  // save text.0.text='hello' as object and then convert to array
                  res.__toArray = true;
                }

                if (res[val] === undefined) {
                  if (ind < col.length - 1) {
                    res[val] = {};
                  } else {
                    // res[val] = decodeURIComponent(setting[1] || '');
                    res[val] = decodeURIComponentX(setting[1] || '');
                  }
                }

                return res[val];
              }, params);
            });
            $($J.hashKeys(params)).forEach(function (key) {
              var objKeys;

              if (typeof params[key] === 'object' && params[key].__toArray) {
                delete params[key].__toArray;
                objKeys = $J.hashKeys(params[key]);
                params[key] = $(objKeys).map(function (idx) {
                  return params[key][idx];
                });
              }
            });
          }

          return params;
        };
      }();
      /* global $, $J, helper */

      /* eslint no-restricted-syntax: ["error", "FunctionExpression", "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint no-continue: "off" */

      /* eslint no-loop-func: "off" */

      /* eslint-env es6 */

      /**
       * Convert JSON data to query string
       * @param  {Object} data - JSON data
       * @param  {String} [prefix] Prefix added to parameter name in query string
       * @return {[type]}          Query string.
       */


      helper.paramsToQueryString = function () {
        var URL_OPTIONS_ALIASES = {
          'scale.width': 'w',
          'scale.height': 'h',
          'crop.width': 'cw',
          'crop.height': 'ch',
          'crop.x': 'cx',
          'crop.y': 'cy',
          'quality': 'q',
          'size': 's',
          'text.text': 'text',
          'watermark.image': 'watermark',
          'watermark.scale.width': 'watermark.w',
          'watermark.scale.height': 'watermark.h',
          'watermark.crop.width': 'watermark.cw',
          'watermark.crop.height': 'watermark.ch',
          'watermark.crop.x': 'watermark.cx',
          'watermark.crop.y': 'watermark.cy'
        };

        var paramsToQueryString = function (data, prefix) {
          var k;
          var value;
          var results = [];

          for (k in data) {
            if (!Object.prototype.hasOwnProperty.call(data, k)) {
              continue;
            }

            if ((k + '').substring(0, 2) === '$J') {
              continue;
            }

            value = data[k];

            if ($J.typeOf(value) === 'object') {
              value = paramsToQueryString(value, (prefix || '') + k + '.');
              results.push(value);
            } else if ($J.typeOf(value) === 'array') {
              $(value).forEach(function (item, idx) {
                value = paramsToQueryString(item, (prefix || '') + k + '.' + idx + '.');
                results.push(value);
              });
            } else {
              // results.push((prefix || '') + k + '=' + encodeURIComponent(value));
              var paramName = (prefix || '') + k;
              paramName = URL_OPTIONS_ALIASES[paramName] || paramName;
              results.push(paramName + '=' + encodeURIComponent(value));
            }
          }

          return results.join('&');
        };

        return paramsToQueryString;
      }();
      /* global helper */

      /* eslint no-restricted-properties: "off" */

      /* eslint-env es6 */


      helper.round = function (value, count, noTail) {
        var v;

        if (!count) {
          count = 0;
        }

        v = Math.pow(10, count);

        if (noTail) {
          v = parseInt(value * v, 10) / v;
        } else {
          v = Math.round(value * v) / v;
        }

        return v;
      };
      /* global helper */

      /* eslint-env es6 */


      helper.roundSize = function (value, roundValue) {
        if (!roundValue) {
          roundValue = 100;
        }

        if (value) {
          value = Math.ceil(value / roundValue) * roundValue;
        }

        return value;
      };
      /* global $J, helper */

      /* global globalVariables */

      /* eslint new-parens: "off" */

      /* eslint-env es6 */


      helper.sendRawStats = function (statsData, useBeacon) {
        try {
          var xhr = null;
          var endpoint = ($J.browser.ieMode < 11 ? globalVariables.SIRV_HTTP_PROTOCOL : 'https:') + '//stats.sirv.com/' + +new Date();

          if (useBeacon === true && navigator.sendBeacon) {
            navigator.sendBeacon(endpoint, helper.paramsToQueryString(statsData));
            return;
          }

          if ($J.browser.features.xhr2) {
            xhr = new XMLHttpRequest();
          } else if ($J.W.node.XDomainRequest) {
            xhr = new XDomainRequest();
          }

          if (!xhr) {
            return;
          }

          xhr.open('POST', endpoint);

          if (xhr.responseType !== undefined) {
            xhr.responseType = 'text';
          }

          xhr.send(helper.paramsToQueryString(statsData));
        } catch (ex) {//empty
        }
      };
      /* global $J, helper */

      /* eslint-env es6 */


      helper.sliderLib = {
        // getIndexFromDirection: (currentIndex, direction, length, loop) => {
        //     let index = currentIndex;
        //     switch (direction) {
        //         case 'next':
        //             index += 1;
        //             break;
        //         case 'prev':
        //             index -= 1;
        //             break;
        //         default:
        //             return currentIndex;
        //     }
        //     if (loop) {
        //         index = helper.getArrayIndex(index, length);
        //     } else {
        //         if (index < 0) {
        //             index = 0;
        //         } else if (index > length - 1) {
        //             index = length - 1;
        //         }
        //     }
        //     return index;
        // },
        findIndex: function (value, currentIndex, l, loop) {
          var result = null;

          if ($J.typeOf(value) === 'string') {
            switch (value) {
              case 'next':
                value = currentIndex + 1;
                break;

              case 'prev':
                value = currentIndex - 1;
                break;
              // no default
            }
          }

          if ($J.typeOf(value) === 'number') {
            result = value;

            if (result < 0) {
              if (loop) {
                result = helper.getArrayIndex(result, l);
              } else {
                result = 0;
              }
            } else if (value >= l) {
              if (loop) {
                result = helper.getArrayIndex(result, l);
              } else {
                result = l - 1;
              }
            }
          }

          return result;
        },
        // getDirectionFromIndex: function (currentIndex, index, length, loop) {
        //     var direction = 'next', fl, rl;
        //     function getForwardLeft() {
        //         var result;
        //         if (index < currentIndex) {
        //             result = currentIndex - index;
        //         } else {
        //             result = length - index + currentIndex;
        //         }
        //         return result;
        //     }
        //     function getForwardRight() {
        //         var result;
        //         if (currentIndex < index) {
        //             result = index - currentIndex;
        //         } else {
        //             result = length - currentIndex + index;
        //         }
        //         return result;
        //     }
        //     if (loop) {
        //         fl = getForwardLeft();
        //         rl = getForwardRight();
        //         if (fl === rl && currentIndex > index || fl < rl) {
        //             direction = 'prev';
        //         }
        //     } else {
        //         if (index < currentIndex) { direction = 'prev'; }
        //     }
        //     return direction;
        // },
        getSrc: function (src) {
          var result = null;

          if ($J.defined(src) && (src + '').trim() !== '') {
            result = src + '';
          }

          return result;
        }
      };
      /* global $, $J, helper */

      /* eslint-env es6 */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      helper.sortSlidesByOrder = function (order, slides) {
        var oldSlidesArr = slides.slice();
        var newSlidesArr = [];

        if (order && order.length) {
          for (var i = 0, l = Math.min(order.length, oldSlidesArr.length); i < l; i++) {
            for (var j = 0, l2 = oldSlidesArr.length; j < l2; j++) {
              if (globalVariables.SLIDE.NAMES.indexOf(order[i]) === oldSlidesArr[j].type && oldSlidesArr[j].enabled) {
                newSlidesArr.push(oldSlidesArr[j]);
                oldSlidesArr.splice(j, 1);
                break;
              }
            }
          }
        }

        oldSlidesArr.forEach(function (item) {
          newSlidesArr.push(item);
        });
        return newSlidesArr;
      };
      /* global $J, helper */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint-env es6 */

      /* eslint-env es6 */


      helper.spinLib = function () {
        // eslint-disable-next-line no-unused-vars
        var FULLSCREEN_PERCENT_WITHOUT_ACTION = 15; // 0% - 100%

        var sirvlib = {
          calcProportionSize: function (spinSize, originSize, isFullscreen, oldSize) {
            var width = originSize.width;
            var height = originSize.height;
            var tmp; // if (isFullscreen) {
            //     if (spinSize.width > spinSize.height) {
            //         spinSize.height -= 20;
            //     } else {
            //         spinSize.width -= 20;
            //     }
            // }

            if (width > spinSize.width) {
              tmp = height / width;
              width = spinSize.width;
              height = parseInt(width * tmp, 10);
            }

            if (height > spinSize.height) {
              tmp = width / height;
              height = spinSize.height;
              width = parseInt(height * tmp, 10);
            }
            /* eslint-disable */
            // if (isFullscreen) {


            if (oldSize) {// if (oldSize.width / (originSize.width / 100) >= 100 - spinLib.FULLSCREEN_PERCENT_WITHOUT_ACTION) {
              //     width = oldSize.width;
              //     height = oldSize.height;
              // }
            } else {
              if (originSize.width < width) {
                width = originSize.width;
                height = originSize.height;
              }
            } // }

            /* eslint-enable */


            return {
              width: width,
              height: height
            };
          },
          reverse: function (col, row, arr) {
            if (col) {
              for (var i = 0, l = arr.length; i < l; i++) {
                arr[i].reverse();
              }
            }

            if (row) {
              arr.reverse();
            }

            return arr;
          },
          getNextIndex: function (currentValue, value, direction, length, loop) {
            var result;

            if (direction) {
              if (direction === 'next') {
                result = currentValue + value;

                if (loop) {
                  result = helper.getArrayIndex(result, length);
                } else if (result >= length) {
                  result = length - 1;
                }
              } else {
                result = currentValue - value;

                if (loop) {
                  result = helper.getArrayIndex(result, length);
                } else if (result < 0) {
                  result = 0;
                }
              }
            } else {
              result = value;

              if (loop) {
                result = helper.getArrayIndex(result, length);
              } else {
                if (result >= length) {
                  result = length - 1;
                }

                if (result < 0) {
                  result = 0;
                }
              }
            }

            return result;
          },
          getUrl: function (path) {
            var url = path;
            url = url.split('/');
            url.splice(url.length - 1, 1);
            url = url.join('/');
            url = url.replace(/https?:/, '');
            return url;
          },
          swapLayers: function (layers, revers) {
            var result = layers;

            if (revers) {
              result = {};
              helper.objEach(layers, function (rowKey, rowValue) {
                helper.objEach(rowValue, function (colKey, colValue) {
                  if (!result[colKey]) {
                    result[colKey] = {};
                  }

                  result[colKey][rowKey] = colValue;
                });
              });
            }

            return result;
          },
          getMaxCount: function (layers) {
            var result = 0;
            helper.objEach(layers, function (key, value, index) {
              var l = $J.hashKeys(value).length;

              if (result < l) {
                result = l;
              }
            });
            return result;
          },
          correctArray: function (keysArray, count) {
            var i;
            var result = [];
            var correctCount = count - keysArray.length;
            var diff;
            var l = keysArray.length;
            var curr;
            var next;

            if (correctCount > 0) {
              for (i = 0; i < l - 1; i++) {
                curr = parseInt(keysArray[i], 10);
                next = parseInt(keysArray[i + 1], 10);
                diff = next - curr - 1;
                result.push(keysArray[i]);

                if (diff > 0) {
                  if (correctCount > 0) {
                    if (diff > correctCount) {
                      diff = correctCount;
                    }

                    while (diff > 0) {
                      diff -= 1;
                      correctCount -= 1;
                      result.push(keysArray[i]);
                    }
                  }
                }
              }

              result.push(keysArray[l - 1]);

              if (correctCount > 0) {
                diff = parseInt(keysArray[0], 10) - 1;

                if (diff > 0) {
                  while (diff > 0) {
                    diff -= 1;
                    correctCount -= 1;
                    result.unshift(keysArray[0]);
                  }
                }

                if (correctCount > 0) {
                  while (correctCount > 0) {
                    correctCount -= 1;
                    result.push(keysArray[keysArray.length - 1]);
                  }
                }
              }
            } else {
              result = JSON.parse(JSON.stringify(keysArray));
            }

            return result;
          },
          getFrames: function (frames, count) {
            var result = {};
            var newKeys = sirvlib.correctArray($J.hashKeys(frames), count);
            $(newKeys).forEach(function (value, index) {
              result[index + 1 + ''] = frames[value];
            });
            return result;
          },
          checkLayers: function (layers) {
            var result = {};
            var count = sirvlib.getMaxCount(layers);
            helper.objEach(layers, function (key, value, index) {
              result[index + 1 + ''] = sirvlib.getFrames(value, count);
            });
            return result;
          }
        };
        return sirvlib;
      }();
      /* eslint-env es6 */

      /* global $, $J, helper */

      /* global sirvRequire */

      /* eslint quote-props: ["off", "always"]*/

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /*eslint no-lonely-if: "off"*/

      /* eslint-disable no-multi-spaces */

      /* eslint-disable no-use-before-define */


      helper.videoModule = function () {
        var vimeoPromise = null;
        var youtubePromise = null;
        var sources = {};
        var youtubeImgs = {
          'thumb1': '1.jpg',
          // 120x90
          'thumb2': '2.jpg',
          // 120x90
          'thumb3': '3.jpg',
          // 120x90
          'def0': '0.jpg',
          // 480x360
          'def1': 'default.jpg',
          // 120x90
          'middleQuality': 'mqdefault.jpg',
          // 320x180
          'highQuality': 'hqdefault.jpg',
          // 480x360
          'maxSize': 'maxresdefault.jpg' // 1920x1080

        };

        var getVimeoJSON = function (url) {
          return new Promise(function (resolve, reject) {
            var xhttp = new XMLHttpRequest();
            xhttp.open('GET', url, true);

            xhttp.onreadystatechange = function () {
              if (xhttp.readyState === 4) {
                if (xhttp.status === 200) {
                  try {
                    var result = JSON.parse(xhttp.responseText)[0];
                    resolve(result);
                  } catch (e) {
                    reject(null);
                  }
                }
              }
            };

            xhttp.send(true);
          });
        };

        var isHtmlVideo = function (node) {
          node = $(node);
          return node && node.getTagName && node.getTagName() === 'video';
        };

        var getYouTobeId = function (url) {
          var result = null;
          url = url.replace(/(>|<)/gi, '').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);

          if (url[2] !== undefined) {
            url = url[2].split(/[^0-9a-z_\-]/i);

            if (url.length && url[0]) {
              result = url[0];
            }
          }

          return result;
        };

        var getVimeoId = function (url) {
          var result = null;
          url = url.match(/(?:https?:\/\/)?(?:www.)?(?:player.)?vimeo.com\/(?:[a-z]*\/)*([0-9]{6,11})[?]?.*/)[1];

          if (url) {
            result = url;
          }

          return result;
        };

        var getSrc = function (node) {
          var result = null;
          var children;
          var child;

          if ($J.typeOf(node) === 'string') {
            result = node;
          } else {
            node = $(node);

            if (node && $J.typeOf(node.node) === 'element') {
              if ($J.contains(['iframe', 'div'], node.getTagName())) {
                result = node.attr('src') || node.attr('data-src');
              } else if (isHtmlVideo(node)) {
                result = node.attr('src') || node.attr('data-src');

                if (!result) {
                  result = null;
                  children = $J.$A(node.node.children);

                  do {
                    child = $(children.shift());

                    if (child && $J.typeOf(child.node) === 'element' && child.getTagName() === 'source') {
                      result = child.attr('src') || child.attr('data-src');
                    }
                  } while (!result && child);
                }
              }
            }
          }

          return result;
        };

        var getAPI = function (node) {
          var result = null;

          if (api.isVideo(node)) {
            switch (api.getType(node)) {
              case 'video':
                result = Promise.resolve();
                break;

              case 'vimeo':
                if (!vimeoPromise) {
                  // if (!$J.W.node.Vimeo || ($J.W.node.Vimeo && !$J.W.node.Vimeo.Player)) {
                  vimeoPromise = new Promise(function (resolve, reject) {
                    sirvRequire(['Vimeo'], function (p) {
                      resolve({
                        Player: p
                      } || $J.W.node.Vimeo);
                    });
                  }); // } else {
                  //     vimeoPromise = Promise.resolve($J.W.node.Vimeo);
                  // }
                }

                result = vimeoPromise;
                break;

              case 'youtube':
                if (!youtubePromise) {
                  if (!$J.W.node.YT) {
                    youtubePromise = new Promise(function (resolve, reject) {
                      var f = function () {};

                      var existingEvent = $J.W.node.onYouTubeIframeAPIReady || f;

                      $J.W.node.onYouTubeIframeAPIReady = function () {
                        existingEvent();
                        resolve($J.W.node.YT);
                      };

                      if (!document.querySelector('script[src$="youtube.com/iframe_api"]')) {
                        $J.$new('script', {
                          src: 'https://www.youtube.com/iframe_api'
                        }).appendTo($J.D.node.body);
                      }
                    });
                  } else {
                    youtubePromise = Promise.resolve($J.W.node.YT);
                  }
                }

                result = youtubePromise;
                break;
              // no default
            }
          } else {
            result = Promise.reject(true
            /*error*/
            );
          }

          return result;
        };

        var api = {
          aspectratio: 9 / 16,
          getAspectRatio: function (src) {
            return new Promise(function (resolve, reject) {
              var id;
              src = getSrc(src);

              if (src) {
                if (sources[src]) {
                  resolve(sources[src].aspectratio);
                }
              }

              var type = api.getType(src);

              if (type === 'vimeo') {
                id = getVimeoId(src);

                if (id) {
                  getVimeoJSON('https://vimeo.com/api/v2/video/' + id + '.json').then(function (data) {
                    resolve(data ? data.height / data.width : api.aspectratio);
                  }).catch(function (error) {
                    reject(error);
                  });
                } else {
                  resolve(api.aspectratio);
                }
              } else {
                resolve(api.aspectratio);
              }
            });
          },
          getId: function (src) {
            var result = null;

            if (api.isVideo(src)) {
              src = getSrc(src);

              switch (api.getType(src)) {
                case 'youtube':
                  result = getYouTobeId(src);
                  break;

                case 'vimeo':
                  result = getVimeoId(src);
                  break;
                // no default
              }
            }

            return result;
          },
          isVideo: function (src) {
            var result = false;

            if (isHtmlVideo(src)) {
              result = true;
            } else {
              src = getSrc(src);

              if (src) {
                result = $J.contains(['youtube', 'vimeo'], api.getType(src));
              }
            }

            return result;
          },
          getType: function (src) {
            var result = null;

            if (isHtmlVideo(src)) {
              result = 'video';
            } else {
              src = getSrc(src);

              if (src) {
                if (/^(https?:)?\/\/((www\.)?youtube\.com|youtu\.be)\//.test(src)) {
                  result = 'youtube';
                } else if (/^(https?:)?\/\/((www|player)\.)?vimeo\.com\//.test(src)) {
                  result = 'vimeo';
                }
              }
            }

            return result;
          },
          getImageSrc: function (src, getAll) {
            return new Promise(function (resolve, reject) {
              var type;
              var thumbUrl = null;
              var id;
              var node;

              if (src && $(src) && $J.typeOf($(src).node) === 'element') {
                node = src;
              }

              src = getSrc(src);

              if (src) {
                if (sources[src]) {
                  if (getAll) {
                    if (sources[src].all) {
                      resolve(sources[src].all);
                      return;
                    }
                  } else {
                    if (sources[src].url) {
                      resolve(sources[src].url);
                      return;
                    } else if (sources[src].all) {
                      resolve(sources[src].all.thumbnail.url);
                      return;
                    }
                  }
                }

                type = api.getType(node || src);

                switch (type) {
                  case 'youtube':
                    id = getYouTobeId(src);

                    if (id) {
                      if (getAll) {
                        thumbUrl = {
                          thumbnail: {
                            url: 'https://img.youtube.com/vi/' + id + '/' + youtubeImgs.def1,
                            width: 120,
                            height: 90
                          },
                          medium: {
                            url: 'https://img.youtube.com/vi/' + id + '/' + youtubeImgs.def0,
                            width: 480,
                            height: 360
                          }
                        };
                      } else {
                        thumbUrl = 'https://img.youtube.com/vi/' + id + '/' + youtubeImgs.def1;
                      }

                      if (!sources[src]) {
                        sources[src] = {};
                      }

                      sources[src].aspectratio = api.aspectratio;

                      if (getAll) {
                        sources[src].all = thumbUrl;
                      } else {
                        sources[src].url = thumbUrl;
                      }
                    }

                    resolve(thumbUrl);
                    break;

                  case 'vimeo':
                    id = getVimeoId(src);

                    if (id) {
                      thumbUrl = 'https://vimeo.com/api/v2/video/' + id + '.json';
                      getVimeoJSON(thumbUrl).then(function (data) {
                        var imgUrl = null;

                        if (data) {
                          if (getAll) {
                            imgUrl = {
                              thumbnail: {
                                url: data.thumbnail_small,
                                width: 100,
                                height: 75
                              },
                              medium: {
                                url: data.thumbnail_medium,
                                width: 200,
                                height: 150
                              }
                            };
                          } else {
                            imgUrl = data.thumbnail_small;
                          }
                        }

                        if (imgUrl) {
                          if (!sources[src]) {
                            sources[src] = {};
                          }

                          if (getAll) {
                            sources[src].all = imgUrl;
                          } else {
                            sources[src].url = imgUrl;
                          }

                          sources[src].aspectratio = data.height / data.width;
                        }

                        resolve(imgUrl);
                      }).catch(reject);
                    } else {
                      resolve(thumbUrl);
                    }

                    break;

                  case 'video':
                    if (node) {
                      node = $(node.node.cloneNode(true));

                      if (node.attr) {
                        thumbUrl = node.attr('poster');
                      }

                      if (thumbUrl && thumbUrl.trim() !== '') {
                        if (!sources[src]) {
                          sources[src] = {};
                        }

                        sources[src].aspectratio = api.aspectratio;

                        if (getAll) {
                          sources[src].all = {
                            thumbnail: {
                              url: thumbUrl,
                              width: 200,
                              height: 150
                            },
                            medium: {
                              url: thumbUrl,
                              width: 200,
                              height: 150
                            }
                          };
                          resolve(sources[src].all);
                        } else {
                          sources[src].url = thumbUrl;
                          resolve(thumbUrl);
                        }
                      } else {
                        var timeOfPoster = 0;
                        var canvas = $J.$new('canvas');
                        var context = canvas.node.getContext('2d');

                        var clear = function () {
                          // $J.$A(node.node.children).forEach(function (child) {
                          //     child = $(child)
                          //     if (child && child.getTagName() === 'source') {
                          //         child.removeEvent('abort error');
                          //     }
                          // });
                          node.removeEvent('loadedmetadata loadeddata abort error stalled');
                          node.remove();
                        };

                        var addSrc = function () {
                          var _src = node.attr('data-src');

                          if (_src) {
                            node.attr('src', _src);
                          }

                          $J.$A(node.node.children).forEach(function (child) {
                            child = $(child);

                            if (child && child.getTagName() === 'source') {
                              _src = child.attr('data-src');

                              if (_src) {
                                child.attr('src', _src);
                              }
                            }
                          });
                        };

                        addSrc();
                        node.setCss({
                          top: -100000,
                          left: -100000,
                          width: 200,
                          height: 150,
                          position: 'absolute'
                        });
                        node.muted = true;
                        node.addEvent('loadedmetadata', function (e) {
                          var size = node.getSize();

                          if (!size.width || !size.height) {
                            size.width = 200;
                            size.height = 150;
                          }

                          node.setCss({
                            width: size.width,
                            height: size.height
                          });
                          canvas.node.width = size.width;
                          canvas.node.height = size.height;

                          if (timeOfPoster < node.node.duration) {
                            node.node.currentTime = timeOfPoster;
                          }
                        }); // $J.$A(node.node.children).forEach(function (child) {
                        //     child = $(child);
                        //     if (child && child.getTagName() === 'source') {
                        //         child.addEvent('abort error', function (e) {
                        //             clear();
                        //             callback(null);
                        //         });
                        //     }
                        // });

                        node.addEvent('loadeddata', function (e) {
                          node.currentTime = timeOfPoster;
                        });
                        node.addEvent('abort error stalled', function (e) {
                          clear();
                          reject(null);
                        });
                        node.addEvent('seeked', function (e) {
                          context.drawImage(node.node, 0, 0, canvas.node.width, canvas.node.height);
                          clear();

                          try {
                            thumbUrl = canvas.node.toDataURL();
                          } catch (ex) {// empty
                          }

                          if (thumbUrl) {
                            if (!sources[src]) {
                              sources[src] = {};
                            }

                            sources[src].aspectratio = api.aspectratio;

                            if (getAll) {
                              sources[src].all = {
                                thumbnail: {
                                  url: thumbUrl,
                                  width: 200,
                                  height: 150
                                },
                                medium: {
                                  url: thumbUrl,
                                  width: 200,
                                  height: 150
                                }
                              };
                              resolve(sources[src].all);
                            } else {
                              sources[src].url = thumbUrl;
                              resolve(thumbUrl);
                            }
                          } else {
                            resolve(thumbUrl);
                          }
                        });
                        node.appendTo($J.D.node.body);
                        node.node.load();
                      }
                    } else {
                      resolve(thumbUrl);
                    }

                    break;

                  default:
                    resolve(thumbUrl);
                }
              } else {
                resolve(thumbUrl);
              }
            });
          },
          getSrc: getSrc,
          getAPI: getAPI
        };
        return api;
      }();

      return helper;
    });
    Sirv.define('EventEmitter', ['bHelpers', 'magicJS', 'helper'], function (bHelpers, magicJS, helper) {
      var moduleName = 'EventEmitter';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global helper */

      /* eslint-disable indent */

      /* eslint-disable no-console */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars

      var EventObject = /*#__PURE__*/function () {
        "use strict";

        function EventObject(type, direction, data) {
          this.type = type;
          this.direction = direction;
          this.propagation = true;
          this.nextCalls = true;
          this.emptyEvent = true;
          this.data = $J.extend(data, {
            eventType: this.type,
            eventDirection: this.direction,
            stopEmptyEvent: this.stopEmptyEvent.bind(this),
            stopPropagation: this.stopPropagation.bind(this),
            stopNextCalls: this.stopNextCalls.bind(this),
            stop: this.stop.bind(this),
            stopAll: this.stopAll.bind(this)
          });
        }

        var _proto13 = EventObject.prototype;

        _proto13.copyData = function copyData() {
          var result = {};
          helper.objEach(this.data, function (key, value) {
            if (!$J.contains(['eventDirection', 'stopEmptyEvent', 'stopPropagation', 'stopNextCalls', 'stop', 'stopAll'], key)) {
              result[key] = value;
            }
          });
          return result;
        };

        _proto13.getCustomData = function getCustomData() {
          return this.data;
        };

        _proto13.getDirection = function getDirection() {
          return this.direction;
        };

        _proto13.isEmptyEventStopped = function isEmptyEventStopped() {
          return !this.emptyEvent;
        };

        _proto13.isPropagationStopped = function isPropagationStopped() {
          return !this.propagation;
        };

        _proto13.isNextCallsStopped = function isNextCallsStopped() {
          return !this.nextCalls;
        };

        _proto13.stopEmptyEvent = function stopEmptyEvent() {
          this.emptyEvent = false;
        };

        _proto13.stopPropagation = function stopPropagation() {
          this.propagation = false;
        };

        _proto13.stopNextCalls = function stopNextCalls() {
          this.nextCalls = false;
        };

        _proto13.stop = function stop() {
          this.stopPropagation();
          this.stopEmptyEvent();
        };

        _proto13.stopAll = function stopAll() {
          this.stop();
          this.stopNextCalls();
        };

        return EventObject;
      }();
      /* eslint-env es6 */

      /* global EventObject */

      /* eslint-disable indent */

      /* eslint-disable no-console */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var correctName = function (name, defaultName) {
        if ($J.typeOf(name) === 'string') {
          name = name.trim();

          if (name === '') {
            name = defaultName;
          }
        } else {
          name = defaultName;
        }

        return name;
      }; // eslint-disable-next-line no-unused-vars


      var EmitterInstance = /*#__PURE__*/function () {
        "use strict";

        function EmitterInstance() {
          this.__parent = null;
          this.__childs = $([]);
          this.__subscribers = {};
          this.__NAME_OF_EMPTY_EVENT = '__empty__';
        }

        var _proto14 = EmitterInstance.prototype;

        _proto14.__setChild = function __setChild(child) {
          this.__childs.push(child);
        };

        _proto14.__removeChild = function __removeChild(child) {
          var idx = this.__childs.indexOf(child);

          if (idx !== -1) {
            this.__childs.splice(idx, 1);
          }
        };

        _proto14.setParent = function setParent(parent) {
          this.__parent = parent;

          this.__parent.__setChild(this);
        };

        _proto14.__removeParent = function __removeParent() {
          if (this.__parent) {
            this.__parent.__removeChild(this);

            this.__parent = null;
          }
        };

        _proto14.__callNext = function __callNext(event) {
          if (!event.isPropagationStopped()) {
            if (event.getDirection() === 'up') {
              if (this.__parent) {
                this.__parent.__next(event);
              }
            } else {
              this.__childs.forEach(function (child) {
                child.__next(event);
              });
            }
          }
        };

        _proto14.__next = function __next(event) {
          var callbacks = this.__subscribers[event.type];
          event = new EventObject(event.type, event.direction, event.copyData());

          if (callbacks) {
            for (var i = 0; i < callbacks.length; i++) {
              callbacks[i](event.getCustomData(), event, this);

              if (event.isNextCallsStopped()) {
                break;
              }
            }
          }

          if (Object.prototype.hasOwnProperty.call(this.__subscribers, this.__NAME_OF_EMPTY_EVENT) && !event.isEmptyEventStopped()) {
            for (var _i2 = 0; _i2 < this.__subscribers[this.__NAME_OF_EMPTY_EVENT].length; _i2++) {
              this.__subscribers[this.__NAME_OF_EMPTY_EVENT][_i2](event.getCustomData());
            }
          }

          this.__callNext(event);
        };

        _proto14.emit = function emit(type, data) {
          // up
          if (!data || $J.typeOf(data) !== 'object') {
            if ($J.typeOf(type) === 'object') {
              data = type;
              type = null;
            } else {
              data = {};
            }
          }

          type = correctName(type, this.__NAME_OF_EMPTY_EVENT);

          this.__callNext(new EventObject(type, 'up', data));
        };

        _proto14.broadcast = function broadcast(type, data) {
          // down
          if (!data || $J.typeOf(data) !== 'object') {
            if ($J.typeOf(type) === 'object') {
              data = type;
              type = null;
            } else {
              data = {};
            }
          }

          type = correctName(type, this.__NAME_OF_EMPTY_EVENT);

          this.__callNext(new EventObject(type, 'down', data));
        };

        _proto14.on = function on(type, fn) {
          var self = this;

          if ($J.typeOf(type) === 'function') {
            fn = type;
            type = null;
          }

          if (!fn) {
            return null;
          }

          type = correctName(type, this.__NAME_OF_EMPTY_EVENT);

          if (!this.__subscribers[type]) {
            this.__subscribers[type] = [];
          }

          this.__subscribers[type].push(fn);

          return function () {
            return self.off(type, fn);
          };
        };

        _proto14.off = function off(type, fn) {
          var idx;

          if ($J.typeOf(type) === 'function') {
            fn = type;
            type = null;
          }

          type = correctName(type, this.__NAME_OF_EMPTY_EVENT);

          if (!fn) {
            delete this.__subscribers[type];
          } else if (Object.prototype.hasOwnProperty.call(this.__subscribers, type)) {
            idx = this.__subscribers[type].indexOf(fn);

            if (idx !== -1) {
              this.__subscribers[type].splice(idx, 1);
            }
          }
        };

        _proto14.destroy = function destroy() {
          this.__removeParent();

          this.__childs = $([]);
          this.__subscribers = {};
        };

        return EmitterInstance;
      }();

      return EmitterInstance;
    });
    Sirv.define('EventManager', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'EventEmitter', 'helper'], function (bHelpers, magicJS, globalVariables, globalFunctions, EventEmitter, helper) {
      var moduleName = 'EventManager';
      var $J = magicJS;
      var $ = $J.$;
      /* global $, $J, EventEmitter, helper */

      /* eslint-env es6 */
      // eslint-disable-next-line no-unused-vars

      var EventManager = /*#__PURE__*/function (_EventEmitter) {
        "use strict";

        bHelpers.inheritsLoose(EventManager, _EventEmitter);

        function EventManager(items) {
          var _this26;

          _this26 = _EventEmitter.call(this) || this;
          _this26.items = items;
          _this26.events = {
            lazyimage: {},
            viewer: {},
            spin: {},
            // viewer component
            zoom: {},
            // viewer component
            image: {},
            // viewer component
            video: {} // viewer component

          };
          _this26.reversedEvents = [];

          _this26.setEvents();

          return _this26;
        }

        EventManager.eventsNameParser = function eventsNameParser(eventName) {
          var result = null;

          if (eventName && $J.typeOf(eventName) === 'string') {
            result = eventName.split(':').map(function (v) {
              return v.trim();
            }).filter(function (v) {
              return v !== '';
            });

            if (/sirv/i.test(result[0])) {
              result.shift();
            }

            if (result.length < 2) {
              result = null;
            }
          }

          return result;
        }
        /**
         * Trigger a DOM event
         * @param {String} eventType A name of the event.
         * @param {DOM Element} element The targe DOM element.
         * @param {Object} [detail] Additional event details.
         * @param {Boolean} [bubbles] Defines whether the event should bubble up through the event chain or not.
         * @param {Boolean} [cancelable] Defines whether the event can be canceled.
         */
        ;

        EventManager.triggerCustomEvent = function triggerCustomEvent(eventType, element, detail, bubbles, cancelable) {
          if (bubbles === $J.U) {
            bubbles = true;
          }

          if (cancelable === $J.U) {
            cancelable = true;
          }

          var event;

          try {
            event = new CustomEvent(eventType, {
              bubbles: bubbles,
              cancelable: cancelable,
              detail: detail
            });
          } catch (e) {
            try {
              event = $J.D.createEvent('Event');
              event.initEvent(eventType, bubbles, cancelable);
              event.detail = detail;
            } catch (ex) {
              /* empty */
            }
          }

          if (event) {
            element.node.dispatchEvent(event);
          }
        };

        var _proto15 = EventManager.prototype;

        _proto15.addReverseEvent = function addReverseEvent(eventName, callback, componentName) {
          this.reversedEvents.push({
            eventName: eventName,
            componentName: componentName,
            callback: callback
          });
        };

        _proto15.callReverseCallback = function callReverseCallback(componentName, eventName, eventData) {
          var result = false;

          for (var i = 0, l = this.reversedEvents.length; i < l; i++) {
            if (this.reversedEvents[i].componentName === componentName && this.reversedEvents[i].eventName === eventName) {
              this.reversedEvents[i].callback(eventData);
              this.reversedEvents.splice(i, 1);
              result = true;
              break;
            }
          }

          return result;
        };

        _proto15.setEvents = function setEvents() {
          var _this27 = this;

          this.on('destroy', function (e) {
            e.stopAll();
            globalFunctions.stop(e.data.node, 'viewer');
          });
          /*
              'onLoad'
          */

          this.on('imagePublicEvent', function (e) {
            e.stopAll();

            var isReversed = _this27.callReverseCallback('lazyimage', e.data.type, e.data.image);

            if (!isReversed) {
              EventManager.triggerCustomEvent('sirv:lazyimage:' + e.data.type, e.data.node, $J.extend({}, e.data.image));
              var evs = _this27.events.lazyimage[e.data.type];

              if (evs) {
                evs.forEach(function (callback) {
                  callback(e.data.image);
                });
              }
            }
          });
          /*
              viewer events
              'ready', 'fullscreenIn', 'fullscreenOut', 'beforeSlideIn', 'beforeSlideOut', 'afterSlideIn', 'afterSlideOut', 'enableItem', 'disableItem'
          */

          this.on('viewerPublicEvent', function (e) {
            e.stopAll();
            var node;
            var type;
            var eventData;
            var componentName = 'viewer';

            if (e.data.slider.type === 'componentEvent') {
              type = e.data.type;
              eventData = $J.extend({}, e.data.slide[e.data.slide.component]);
              componentName = e.data.slide.component;

              if (e.data.node) {
                node = e.data.componentEventData.node;
              }

              helper.objEach(e.data.componentEventData, function (key, value) {
                if (key === 'node') {
                  if (e.data.node) {
                    eventData[key] = value.node;
                  }
                } else if (key !== 'type') {
                  eventData[key] = value;
                }
              });
            } else {
              type = e.data.slider.type;

              if (type === 'ready') {
                globalFunctions.iconsHash.remove();
              }

              if (e.data.node) {
                node = e.data.node;
              }

              if (e.data.slider) {
                eventData = e.data.slider;

                if (type === 'sendStats') {
                  eventData.statsData = e.data.event;
                }
              }

              if ($J.contains(['beforeSlideIn', 'beforeSlideOut', 'afterSlideIn', 'afterSlideOut', 'enableItem', 'disableItem', 'thumbnailClick'], type)) {
                eventData = e.data.slide;
              }
            }

            var isReversed = _this27.callReverseCallback(componentName, type, eventData);

            if (!isReversed) {
              if (node) {
                EventManager.triggerCustomEvent('sirv:' + componentName + ':' + type, node, $J.extend({}, eventData));
              }

              var evs = _this27.events[componentName][type];

              if (evs) {
                evs.forEach(function (callback) {
                  callback(eventData);
                });
              }
            }
          });
          this.on(function (e) {
            e.stopAll();
          });
        };

        _proto15.addEvent = function addEvent(eventName, callback) {
          var _this28 = this;

          var result = function () {
            return false;
          };

          var events = EventManager.eventsNameParser(eventName);

          if (events && this.events[events[0]] && callback) {
            if (!this.events[events[0]][events[1]]) {
              this.events[events[0]][events[1]] = [];
            }

            this.events[events[0]][events[1]].push(callback);

            if ($J.contains(['ready', 'init', 'onLoad'], events[1])) {
              var itemName = events[0] === 'lazyimage' ? 'image' : 'viewer';

              if (itemName === 'viewer' && events[1] !== 'onLoad' || events[1] === 'onLoad' && itemName === 'image') {
                /*
                    we need the timeout because every event returns function which can remove this event
                     for example:
                    if event 'ready' already was
                    and we set new one
                    the variable 'removeReadyEvent' will be undefined
                     const removeReadyEvent = Sirv.on('viewer:ready', (e) => {
                        removeReadyEvent();
                    });
                */
                setTimeout(function () {
                  var items = _this28.items[itemName];
                  items.forEach(function (item) {
                    if (item.checkReadiness(events[1], events[0])) {
                      _this28.addReverseEvent(events[1], callback, events[0]);

                      item.sendEvent(events[1], events[0]);
                    }
                  });
                }, 0);
              }
            }

            result = function () {
              return _this28.removeEvent(eventName, callback);
            };
          }

          return result;
        };

        _proto15.removeEvent = function removeEvent(eventName, callback) {
          var events = EventManager.eventsNameParser(eventName);

          if (events && this.events[events[0]] && this.events[events[0]][events[1]]) {
            if (callback) {
              var index = this.events[events[0]][events[1]].indexOf(callback);

              if (index >= 0) {
                this.events[events[0]][events[1]].splice(index, 1);
                return true;
              }
            } else {
              delete this.events[events[0]][events[1]];
              return true;
            }
          }

          return false;
        };

        return EventManager;
      }(EventEmitter);

      return EventManager;
    });
    Sirv.define('ContextMenu', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions'], function (bHelpers, magicJS, globalVariables, globalFunctions) {
      var moduleName = 'ContextMenu';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var getViewPort = function (pad) {
        var size = $J.W.getSize();
        var scroll = $J.W.getScroll();
        pad = pad || 0;
        return {
          left: pad,
          right: size.width - pad,
          top: pad,
          bottom: size.height - pad,
          x: scroll.x,
          y: scroll.y
        };
      }; // eslint-disable-next-line no-unused-vars


      var ContextmenuInstance = /*#__PURE__*/function () {
        "use strict";

        function ContextmenuInstance(target, data, cssPrefix) {
          if (undefined === cssPrefix) {
            cssPrefix = 'magic';
          }

          this.CSS_CLASS = cssPrefix + '-contextmenu';
          this.target = target; // Menu container

          this.conext = null;
          this.overlay = null;
          this.items = {}; // this.data = data;

          this.active = false;
          this.showBind = null;
          this.hideBind = null;
          this.hideOnScrollBind = null;
          this.canShow = true;
          this.position = {
            top: null,
            left: null
          };
          this.fullScreenBox = null;
          this.setup(data || []);
        }

        var _proto16 = ContextmenuInstance.prototype;

        _proto16.isExist = function isExist(idOfItem) {
          return !!this.items[idOfItem];
        };

        _proto16.setup = function setup(data) {
          var _this29 = this;

          this.context = $J.$new('ul').addClass(this.CSS_CLASS).addEvent('contextmenu dragstart selectstart', function (e) {
            e.stop();
          });
          data.forEach(function (item) {
            _this29.addItem(item);
          });
          this.hideFX = new $J.FX(this.context, {
            duration: 200,
            onComplete: function () {
              _this29.context.remove();
            }
          });
          this.target.addEvent('contextmenu', this.showBind = this.show.bind(this)); // this.overlay = $J.$new('div').setCss({
          //     'background-image': 'url(\'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=\')',
          //     display: 'block',
          //     overflow: 'hidden',
          //     'z-index': '2147483647',
          //     position: 'fixed',
          //     top: 0, bottom: 0, left: 0, right: 0,
          //     width: 'auto', height: 'auto'
          // })

          this.overlay = $J.$new('div').addClass(this.CSS_CLASS + '-overlay').addEvent('click contextmenu', this.hide.bind(this)) // .addEvent('', this.hideBind = this.hide.bind(this))
          .addEvent('mousescroll', function (e) {
            e.stop(); // this.hide();

            $(e).events[0].stop().stopQueue();
          });
          this.hideBind = $(function (e) {
            if (!_this29.active) {
              return;
            }

            e.stop();

            if (e.getOriginEvent().keyCode === 27) {
              // Esc
              _this29.hide();
            }
          }).bind(this);
          $J.W.addEvent('keydown', this.hideBind, 1); // eslint-disable-next-line no-unused-vars

          this.hideOnScrollBind = $(function (e) {
            if (!_this29.active) {
              return;
            }

            _this29.hide();
          }).bind(this);
          $J.W.addEvent('scroll', this.hideOnScrollBind);
        };

        _proto16.addItem = function addItem(data) {
          var _ = this;

          var item = $J.$new('li').appendTo(this.context);

          if ($J.defined(data.separator)) {
            item.addClass('menu-separator');
          } else if ($J.defined(data.label)) {
            item.append($J.D.node.createTextNode(data.label));

            if ($J.defined(data.disabled) && data.disabled === true) {
              item.attr('disabled', true);
            }

            if ($J.typeOf(data.action) === 'function') {
              // item.addEvent('click', (e) {
              item.addEvent('btnclick', function (e) {
                e.stop();

                if (!item.attr('disabled')) {
                  _.hide();

                  data.action.call(data.action, _.position);
                }
              });
            }
          }

          if ($J.defined(data.hidden) && data.hidden === true) {
            item.setCss({
              display: 'none'
            });
          }

          var id = data.id || 'item-' + Math.floor(Math.random() * $J.now());
          this.items[id] = item;
          return id;
        };

        _proto16.hideItem = function hideItem(id) {
          if (this.items[id]) {
            $(this.items[id]).setCss({
              display: 'none'
            });
          }
        };

        _proto16.showItem = function showItem(id) {
          if (this.items[id]) {
            $(this.items[id]).setCss({
              display: ''
            });
          }
        };

        _proto16.disableItem = function disableItem(id) {
          if (this.items[id]) {
            $(this.items[id]).attr('disabled', true);
          }
        };

        _proto16.enableItem = function enableItem(id) {
          if (this.items[id]) {
            $(this.items[id]).removeAttr('disabled');
          }
        };

        _proto16.show = function show(e) {
          var _parent = $J.D.node.body;

          if (!this.canShow) {
            return;
          }

          this.hideFX.stop();

          if ($J.browser.fullScreen.enabled()) {
            if (this.fullScreenBox || $J.D.msFullscreenElement) {
              _parent = this.fullScreenBox || $J.D.msFullscreenElement;
            }
          }

          this.overlay.appendTo(_parent);
          this.context.setCss({
            top: -10000
          }).appendTo(_parent); // this.context.setCss({ top: -10000 }).appendTo(this.overlay);

          var pos = e.getClientXY();
          var left = pos.x;
          var top = pos.y;
          var page = e.getPageXY();
          this.position.top = page.y;
          this.position.left = page.x;
          var viewport = getViewPort(5);
          var size = this.context.getSize();

          if (viewport.right < left + size.width) {
            left -= size.width;
          }

          if (viewport.bottom < top + size.height) {
            top = viewport.bottom - size.height;
          }

          this.context.setCss({
            top: top,
            left: left,
            display: 'block',
            opacity: 1
          }); // if (8 !== $J.browser.ieMode) {
          //     $($J.browser.getDoc()).setCss({ 'overflow': 'hidden' });
          // }

          this.active = true;
        };

        _proto16.hide = function hide(e) {
          if (!this.active) {
            return;
          }

          this.overlay.remove(); // if (8 !== $J.browser.ieMode) {
          //     $($J.browser.getDoc()).setCss({ 'overflow': '' });
          // }

          this.hideFX.start({
            'opacity': [1, 0]
          });
          this.active = false;

          if (e) {
            e.stopDefaults();

            if (e.type === 'contextmenu') {
              var p = e.getPageXY();
              var r = this.target.getRect();

              if (r.left <= p.x && r.right >= p.x && r.top <= p.y && r.bottom >= p.y) {
                this.show(e);
              }
            }
          }
        };

        _proto16.setCanShow = function setCanShow(canShow) {
          this.canShow = canShow;
        };

        _proto16.setFullScreenBox = function setFullScreenBox(fullScreenBox) {
          this.setFullScreenBox = fullScreenBox;
        };

        _proto16.destroy = function destroy() {
          this.target.removeEvent('contextmenu', this.showBind);
          $J.W.removeEvent('keydown', this.hideBind).removeEvent('scroll', this.hideOnScrollBind);

          try {
            this.context.kill();
          } catch (ex) {// empty
          }

          try {
            this.overlay.kill();
          } catch (ex) {// empty
          }
        };

        return ContextmenuInstance;
      }();

      return ContextmenuInstance;
    });
    Sirv.define('BaseInstance', ['bHelpers', 'magicJS', 'EventEmitter', 'helper'], function (bHelpers, magicJS, EventEmitter, helper) {
      var moduleName = 'BaseInstance';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* global EventEmitter, helper */

      /* eslint-disable class-methods-use-this */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var DEFAULT_PREFIX = 'smv-';

      var BaseInstance = /*#__PURE__*/function (_EventEmitter2) {
        "use strict";

        bHelpers.inheritsLoose(BaseInstance, _EventEmitter2);

        function BaseInstance(node, options, defaultSchema) {
          var _this30;

          _this30 = _EventEmitter2.call(this) || this;
          _this30.defaultSchema = defaultSchema;
          _this30.options = options;
          _this30.instanceNode = $(node);
          _this30.instanceUrl = _this30.instanceNode.attr('data-src') || _this30.instanceNode.attr('src') || _this30.instanceNode.attr('data-bg-src');
          _this30.option = null;
          _this30._isReady = false;
          _this30.id = null;
          _this30.isCustomId = false;
          _this30.isStartedFullInit = false;
          _this30.isStarted = false;
          _this30.destroyed = false;
          _this30.referrerPolicy = _this30.instanceNode.attr('data-referrerpolicy') || _this30.instanceNode.attr('referrerpolicy') || 'no-referrer-when-downgrade';
          _this30.instanceOptions = _this30.makeOptions();

          _this30.createOptionFunction();

          _this30.api = {
            isReady: _this30.isReady.bind(bHelpers.assertThisInitialized(_this30)),
            resize: _this30.resize.bind(bHelpers.assertThisInitialized(_this30)),
            getOptions: _this30.getOptions.bind(bHelpers.assertThisInitialized(_this30))
          };
          return _this30;
        }

        var _proto17 = BaseInstance.prototype;

        _proto17.setOptions = function setOptions(optInstance, common, local, attr) {
          optInstance.fromJSON(common);
          optInstance.fromString(local);
          optInstance.fromString(attr);
          return optInstance;
        };

        _proto17.makeGlobalOptions = function makeGlobalOptions(optionsInstance) {
          var o = this.options.options;
          return this.setOptions(optionsInstance, o.common.common, o.local.common, this.instanceNode.attr('data-options') || '');
        };

        _proto17.makeMobileOptions = function makeMobileOptions(optionsInstance) {
          var o = this.options.options;
          return this.setOptions(optionsInstance, o.common.mobile, o.local.mobile, this.instanceNode.attr('data-mobile-options') || '');
        };

        _proto17.makeOptions = function makeOptions() {
          var options = new $J.Options(this.defaultSchema);
          options = this.makeGlobalOptions(options);

          if ($J.browser.touchScreen && $J.browser.mobile) {
            options = this.makeMobileOptions(options);
          }

          return options;
        };

        _proto17.getOptionsForStartFullInit = function getOptionsForStartFullInit(options) {
          if (options) {
            this.options.options = options;
            this.instanceOptions = this.makeOptions();
            this.createOptionFunction();
          }
        };

        _proto17.isReady = function isReady() {
          return this._isReady;
        };

        _proto17.getOptions = function getOptions() {
          return this.instanceOptions.getJSON();
        };

        _proto17.resize = function resize() {
          if (this._isReady) {
            return this.onResize();
          }

          return false;
        };

        _proto17.onResize = function onResize() {
          return true;
        };

        _proto17.getImageClassContainer = function getImageClassContainer() {
          return {};
        };

        _proto17.checkImage = function checkImage(setts, dontLoad) {
          var result;
          var imageClass = this.getImageClassContainer();

          if (dontLoad) {
            result = imageClass.isExist(setts); // because we do not load images with imageclass
          } else {
            result = imageClass.isLoaded(setts);
          }

          return result;
        };

        _proto17.getId = function getId(idPrefix, df) {
          this.id = this.instanceNode.attr('id');

          if (!this.id) {
            this.isCustomId = true;

            if (!idPrefix) {
              idPrefix = 'component-';
            }

            if (!df) {
              df = DEFAULT_PREFIX;
            }

            this.id = df + idPrefix + helper.generateUUID();
            this.id = this.id.trim();
            this.instanceNode.attr('id', this.id);
          }
        };

        _proto17.createOptionFunction = function createOptionFunction() {
          var _this31 = this;

          this.option = function () {
            if (arguments.length > 1) {
              return _this31.instanceOptions.set(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]);
            }

            return _this31.instanceOptions.get(arguments.length <= 0 ? undefined : arguments[0]);
          };
        };

        _proto17.startFullInit = function startFullInit(options) {
          if (this.destroyed || this.isStartedFullInit) {
            return;
          }

          this.isStartedFullInit = true;
          this.getOptionsForStartFullInit(options);
        };

        _proto17.getOriginImageUrl = function getOriginImageUrl() {} // instance 'start' metod rename to 'run'
        ;

        _proto17.run = function run() {
          if (!this.isStarted) {
            this.isStarted = true;
            return true;
          }

          return false;
        };

        _proto17.done = function done() {
          this._isReady = true;
        };

        _proto17.destroy = function destroy() {
          this.destroyed = true;
          this.isStarted = false;
          this._isReady = false;
          this.isStartedFullInit = false;

          if (this.isCustomId) {
            this.instanceNode.removeAttr('id');
            this.isCustomId = false;
          }

          this.instanceNode = null;

          _EventEmitter2.prototype.destroy.call(this);
        };

        return BaseInstance;
      }(EventEmitter);

      return BaseInstance;
    });
    Sirv.define('Instance', ['bHelpers', 'magicJS', 'Promise!', 'globalVariables', 'BaseInstance', 'helper'], function (bHelpers, magicJS, Promise, globalVariables, BaseInstance, helper) {
      var moduleName = 'Instance';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* global BaseInstance */

      /* global helper */

      /* eslint-disable class-methods-use-this */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars

      var createError = function (name) {
        return new Error('This method \'' + name + '\' is not implemented.');
      };

      var Instance = /*#__PURE__*/function (_BaseInstance) {
        "use strict";

        bHelpers.inheritsLoose(Instance, _BaseInstance);

        function Instance(node, options, defaultSchema) {
          var _this32;

          _this32 = _BaseInstance.call(this, node, options, defaultSchema) || this;
          _this32.type = globalVariables.SLIDE.TYPES.NONE;
          _this32.always = options.always;
          _this32.quality = options.quality;
          _this32.hdQuality = options.hdQuality;
          _this32.isHDQualitySet = options.isHDQualitySet;
          _this32.isFullscreenEnabled = options.isFullscreen;
          _this32.dataAlt = null;
          _this32.isSlideShown = false;
          _this32.isInView = false;
          _this32.preload = false;
          _this32.firstSlideAhead = false;
          _this32.infoSize = null;
          _this32.pinchCloud = null;
          _this32.onLoad = false;
          _this32.waitToStart = new helper.WaitToStart();
          _this32.waitGettingInfo = new helper.WaitToStart();
          _this32.gettingInfoPromise = null;
          _this32.fullscreenState = globalVariables.FULLSCREEN.CLOSED;

          _this32.on('stats', function (e) {
            e.data.component = globalVariables.SLIDE.NAMES[_this32.type];
          });

          return _this32;
        }

        var _proto18 = Instance.prototype;

        _proto18.sendEvent = function sendEvent(typeOfEvent, data) {
          if (!data) {
            data = {};
          }

          if (!data.event) {
            data.event = {};
          }

          data.id = this.id;
          data.url = this.instanceUrl;
          data.event.timestamp = +new Date();
          data.event.type = globalVariables.SLIDE.NAMES[this.type] + ':' + typeOfEvent;
          this.emit('componentEvent', {
            data: {
              type: typeOfEvent,
              data: data
            }
          });
        };

        _proto18.onStartActions = function onStartActions() {};

        _proto18.onStopActions = function onStopActions() {};

        _proto18.onInView = function onInView(value) {};

        _proto18.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {};

        _proto18.onAfterFullscreenIn = function onAfterFullscreenIn(data) {};

        _proto18.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {};

        _proto18.onAfterFullscreenOut = function onAfterFullscreenOut(data) {};

        _proto18.onMouseAction = function onMouseAction(type) {};

        _proto18.onSecondSelectorClick = function onSecondSelectorClick() {};

        _proto18.onStopContext = function onStopContext() {};

        _proto18.loadContent = function loadContent() {
          return true;
        };

        _proto18.loadThumbnail = function loadThumbnail() {
          if (!this.destroyed) {
            this.waitToStart.start();
            return true;
          }

          return false;
        };

        _proto18.startGettingInfo = function startGettingInfo() {
          if (!this.destroyed) {
            this.waitGettingInfo.start();
            return true;
          }

          return false;
        };

        _proto18.startFullInit = function startFullInit(options) {
          var _this33 = this;

          if (this.isStartedFullInit) {
            return;
          }

          _BaseInstance.prototype.startFullInit.call(this, options);

          if (options) {
            this.always = options.always;
          }

          this.dataAlt = this.instanceNode.attr('data-alt');
          this.on('startActions', function (e) {
            e.stop();
            _this33.isSlideShown = true;

            _this33.onStartActions(e.who);
          });
          this.on('stopActions', function (e) {
            e.stop();
            _this33.isSlideShown = false;

            _this33.onStopActions();
          });
          this.on('inView', function (e) {
            e.stop();
            var iv = e.data;

            _this33.onInView(iv);

            _this33.isInView = iv;
          });
          this.setEvents();
        };

        _proto18.isFullscreenActionEnded = function isFullscreenActionEnded() {
          return $J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.OPENED], this.fullscreenState);
        };

        _proto18.setEvents = function setEvents() {
          var _this34 = this;

          this.on('beforeFullscreenIn', function (e) {
            e.stop();

            if (_this34.fullscreenState === globalVariables.FULLSCREEN.OPENED || _this34.destroyed) {
              return;
            }

            _this34.fullscreenState = globalVariables.FULLSCREEN.OPENING;

            _this34.onBeforeFullscreenIn(e.data);
          });
          this.on('afterFullscreenIn', function (e) {
            e.stop();

            if (!_this34.destroyed) {
              _this34.fullscreenState = globalVariables.FULLSCREEN.OPENED;

              _this34.onAfterFullscreenIn(e.data);
            }
          });
          this.on('beforeFullscreenOut', function (e) {
            e.stop();

            if (_this34.fullscreenState === globalVariables.FULLSCREEN.CLOSED || _this34.destroyed) {
              return;
            }

            _this34.fullscreenState = globalVariables.FULLSCREEN.CLOSING;

            _this34.onBeforeFullscreenOut(e.data);
          });
          this.on('afterFullscreenOut', function (e) {
            e.stop();

            if (!_this34.destroyed) {
              _this34.fullscreenState = globalVariables.FULLSCREEN.CLOSED;

              _this34.onAfterFullscreenOut(e.data);
            }
          });
        };

        _proto18.getOriginImageUrl = function getOriginImageUrl() {
          throw createError('getInfoSize');
        };

        _proto18.getSelectorImgUrl = function getSelectorImgUrl(data) {
          return Promise.reject(createError('getSelectorImgUrl'));
        };

        _proto18.getInfoSize = function getInfoSize() {
          return Promise.reject(createError('getInfoSize'));
        };

        _proto18.run = function run(isShown, preload, firstSlideAhead) {
          var result = _BaseInstance.prototype.run.call(this);

          if (result) {
            this.isSlideShown = isShown;
            this.preload = preload;
            this.firstSlideAhead = firstSlideAhead;

            if (!this.firstSlideAhead) {
              this.waitToStart.start();
            }
          }

          return result;
        };

        _proto18.getThumbnailData = function getThumbnailData() {
          return {
            src: null
          };
        };

        _proto18.getSocialButtonData = function getSocialButtonData(data) {
          var opt = data;

          if (this.infoSize.width < data.width || this.infoSize.height < data.height) {
            opt.width = this.infoSize.width;
            opt.height = this.infoSize.height;
          }

          var thumbnailData = this.getThumbnailData(opt);
          return thumbnailData.src;
        };

        _proto18.createPinchEvent = function createPinchEvent(node) {
          var _this35 = this;

          var pinchCloud = {
            isAdded: false,
            pinch: false,
            scale: 0,
            block: false,
            onPinchStart: function (e) {},
            onPinchResize: function (e) {},
            onPinchMove: function (e) {},
            onPinchEnd: function (e) {
              if (pinchCloud.pinch) {
                pinchCloud.pinch = false;

                _this35.sendEvent('pinchEnd');
              }

              pinchCloud.block = false;
            },
            handler: function (e) {
              switch (e.state) {
                case 'pinchstart':
                  pinchCloud.onPinchStart(e);
                  break;

                case 'pinchresize':
                  pinchCloud.onPinchResize(e);
                  break;

                case 'pinchmove':
                  pinchCloud.onPinchMove(e);
                  break;

                case 'pinchend':
                  pinchCloud.onPinchEnd(e);
                  break;

                default:
              }

              if (pinchCloud.pinch) {
                e.stop();
              }
            },
            addEvent: function () {
              if (!pinchCloud.isAdded && $J.browser.touchScreen) {
                node.addEvent('pinch', pinchCloud.handler);
                pinchCloud.isAdded = true;
              }
            },
            removeEvent: function () {
              if (pinchCloud.isAdded) {
                node.removeEvent('pinch', pinchCloud.handler);
                pinchCloud.isAdded = false;
                pinchCloud.block = false;
                pinchCloud.pinch = false;
              }
            }
          };
          pinchCloud.addEvent();
          this.pinchCloud = pinchCloud;
        };

        _proto18.done = function done() {
          var _this36 = this;

          _BaseInstance.prototype.done.call(this);

          this.createPinchEvent();
          this.on('resize', function (e) {
            e.stop();

            _this36.onResize();
          });
          this.on('stopContext', function (e) {
            e.stop();

            _this36.onStopContext();
          });
          this.on('secondSelectorClick', function (e) {
            e.stopAll();

            _this36.onSecondSelectorClick();
          });
          this.on('mouseAction', function (e) {
            e.stop();

            _this36.onMouseAction(e.data.type);
          });
          this.on('dragEvent', function (e) {
            e.stop();

            if (_this36.pinchCloud) {
              if (e.data.type === 'dragstart') {
                _this36.pinchCloud.removeEvent();
              } else if (e.data.type === 'dragend') {
                _this36.pinchCloud.addEvent();
              }
            }
          });
          this.sendEvent('ready');
        };

        _proto18.sendContentLoadedEvent = function sendContentLoadedEvent() {
          if (!this.onLoad) {
            this.onLoad = true;
            this.sendEvent('contentLoaded');
          }
        };

        _proto18.destroy = function destroy() {
          this.off('stats');
          this.off('startActions');
          this.off('stopActions');
          this.off('inView');
          this.off('resize');
          this.off('stopContext');
          this.off('secondSelectorClick');
          this.off('mouseAction');
          this.off('dragEvent');
          this.off('beforeFullscreenIn');
          this.off('afterFullscreenIn');
          this.off('beforeFullscreenOut');
          this.off('afterFullscreenOut');
          this.pinchCloud = null;
          this.isSlideShown = false;

          _BaseInstance.prototype.destroy.call(this);

          this.waitGettingInfo.destroy();
          this.waitGettingInfo = null;
          this.waitToStart.destroy();
          this.waitToStart = null;
          this.gettingInfoPromise = null;
        };

        return Instance;
      }(BaseInstance);

      return Instance;
    });
    Sirv.define('HotspotInstance', ['bHelpers', 'magicJS', 'Promise!', 'Instance'], function (bHelpers, magicJS, Promise, Instance) {
      var moduleName = 'HotspotInstance';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* global Instance */

      /* eslint-disable class-methods-use-this */

      /* eslint-disable no-unused-vars */

      /* eslint no-console: ["error", { allow: ["warn"] }] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var warn = function (v1, v2) {
        console.warn('sirv.js: The ' + v1 + ' method is deprecated and will be removed. \r\n           Use ' + v2 + ' instead.');
      }; // eslint-disable-next-line no-unused-vars


      var HotspotInstance = /*#__PURE__*/function (_Instance) {
        "use strict";

        bHelpers.inheritsLoose(HotspotInstance, _Instance);

        function HotspotInstance(node, options, defaultSchema) {
          var _this37;

          _this37 = _Instance.call(this, node, options, defaultSchema) || this; // this variable is usin in spin, zoom and image component

          _this37.hotspots = null; // API

          var this_ = bHelpers.assertThisInitialized(_this37);
          _this37.api = $J.extend(_this37.api, {
            addHotspot: function (hotspotsData) {
              warn('.addHotspot()', '.hotspots.add()');
              this_.hotspots.api.add(hotspotsData);

              if (this_.isInView && this_.isSlideShown) {
                this_.hotspots.showNeededElements();
              }
            },
            removeHotspot: function (index) {
              warn('.removeHotspot()', '.hotspots.remove()');
              this_.hotspots.api.remove(index);
            },
            removeAllHotspots: function () {
              warn('.removeAllHotspots()', '.hotspots.removeAll()');
              this_.hotspots.api.removeAll();
            },
            getHotspots: function () {
              warn('.getHotspots()', '.hotspots.list()');
              return this_.hotspots.api.list();
            }
          });
          return _this37;
        }

        var _proto19 = HotspotInstance.prototype;

        _proto19.createHotspotsClass = function createHotspotsClass(HotspotsClass, hotspotOptions) {
          var _this38 = this;

          this.hotspots = new HotspotsClass(hotspotOptions);
          this.hotspots.setParent(this);
          this.on('hotspotActivate', function (e) {
            e.stopAll();

            _this38.onHotspotActivate(e.data);

            _this38.sendEvent('hotspotOpened');
          });
          this.on('hotspotDeactivate', function (e) {
            e.stopAll();

            _this38.onHotspotDeactivate(e.data);

            _this38.sendEvent('hotspotClosed');
          });
          this.api = $J.extend(this.api, {
            hotspots: this.hotspots.api
          });
          var this_ = this;

          this.api.hotspots.add = function (hsData) {
            if (hsData) {
              var clientRect = null;

              if (!this_.hotspots.getHotspots().length) {
                var parentContainer = _this38.getParentContainer();

                clientRect = this_.hotspots.getRightBoundengClientRect(_this38.getContainerForBoundengClientRect());
                this_.hotspots.appendTo(parentContainer);
              }

              this_.hotspots.addHotspot(hsData);
              this_.hotspots.setContainerSize(clientRect);
              this_.hotspots.showAll();

              if (this_.isInView && this_.isSlideShown) {
                this_.hotspots.showNeededElements();
              }
            }
          };
        };

        _proto19.getContainerForBoundengClientRect = function getContainerForBoundengClientRect() {
          return this.getParentContainer();
        };

        _proto19.done = function done() {
          if (!this._isReady && !this.destroyed) {
            var parentContainer = this.getParentContainer();

            if (this.hotspots) {
              if (this.hotspotsData && this.hotspotsData.length) {
                this.hotspots.appendTo(parentContainer);
              }

              this.hotspots.createHotspots(this.hotspotsData);

              if (this.nativeFullscreen) {
                this.hotspots.changeBoxContainerParent(true);
              }

              this.hotspots.showAll();
            }
          }

          _Instance.prototype.done.call(this);
        };

        _proto19.getParentContainer = function getParentContainer() {
          var parentContainer = this.instanceNode;

          if (parentContainer.getTagName() === 'img') {
            parentContainer = $(parentContainer.node.parentNode);
          }

          return parentContainer;
        };

        _proto19.onHotspotActivate = function onHotspotActivate(data) {};

        _proto19.onHotspotDeactivate = function onHotspotDeactivate(data) {};

        _proto19.onStartActions = function onStartActions() {
          if (this.hotspots && this.isInView && this.isSlideShown) {
            this.hotspots.showNeededElements();
          }

          _Instance.prototype.onStartActions.call(this);
        };

        _proto19.onStopActions = function onStopActions() {
          if (this.hotspots) {
            this.hotspots.hideActiveHotspotBox(true);
          }

          _Instance.prototype.onStopActions.call(this);
        };

        _proto19.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {
          if (this.hotspots) {
            this.hotspots.hideActiveHotspotBox();

            if (this.nativeFullscreen) {
              this.hotspots.changeBoxContainerParent(true);
            }
          }
        };

        _proto19.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {
          if (this.hotspots) {
            this.hotspots.hideActiveHotspotBox();

            if (this.nativeFullscreen) {
              this.hotspots.changeBoxContainerParent();
            }
          }
        };

        _proto19.onAfterFullscreenOut = function onAfterFullscreenOut(data) {
          if (this.hotspots && this.isInView && this.isSlideShown) {
            this.hotspots.showNeededElements();
          }
        };

        _proto19.destroy = function destroy() {
          if (this.hotspots) {
            this.hotspots.destroy();
          }

          this.hotspots = null;
          this.off('hotspotActivate');
          this.off('hotspotDeactivate');

          _Instance.prototype.destroy.call(this);
        };

        return HotspotInstance;
      }(Instance);

      return HotspotInstance;
    });
    Sirv.define('Zoominstance', ['bHelpers', 'magicJS', 'HotspotInstance', 'ImageZoom'], function (bHelpers, magicJS, HotspotInstance, ImageZoom) {
      var moduleName = 'Zoominstance';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* global HotspotInstance */

      /* global ImageZoom */

      /* eslint-disable class-methods-use-this */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars

      var ZoomInstance = /*#__PURE__*/function (_HotspotInstance) {
        "use strict";

        bHelpers.inheritsLoose(ZoomInstance, _HotspotInstance);

        function ZoomInstance(node, options, defaultSchema) {
          var _this39;

          _this39 = _HotspotInstance.call(this, node, options, defaultSchema) || this;
          _this39.zoom = null;
          _this39.upscale = false;
          _this39.defaultZoomOptions = {}; // this.zoomContainer = options.lensContainer;

          _this39.zoomContainer = _this39.instanceNode;
          _this39.zoomClassName = 'smv-zoomed-in';
          _this39.api = $J.extend(_this39.api, {
            zoomIn: _this39.zoomIn.bind(bHelpers.assertThisInitialized(_this39)),
            zoomOut: _this39.zoomOut.bind(bHelpers.assertThisInitialized(_this39)),
            isZoomed: _this39.isZoomed.bind(bHelpers.assertThisInitialized(_this39)) // new

          });
          return _this39;
        }

        var _proto20 = ZoomInstance.prototype;

        _proto20.setDefaultZoomOptions = function setDefaultZoomOptions() {
          this.defaultZoomOptions = {
            test: false,
            upscale: this.upscale,
            smoothing: true
          };
        };

        _proto20.createZoom = function createZoom(zoomNode, options) {
          if (!this.destroyed) {
            var zoomOptions = $J.extend({}, this.defaultZoomOptions);

            if (options) {
              zoomOptions = $J.extend(zoomOptions, options);
            }

            this.zoom = new ImageZoom(this.instanceNode, zoomOptions);
            this.zoom.setParent(this);
            return zoomOptions;
          }

          return null;
        };

        _proto20.onZoomGetImage = function onZoomGetImage(e) {
          e.data.exactSize = true;
          e.data.maxSize = false;
          e.data.round = false;
          e.data.callbackData = {
            lens: true,
            indexX: e.data.indexX,
            indexY: e.data.indexY,
            level: e.data.level,
            number: e.data.number,
            map: e.data.map
          };
        };

        _proto20.onZoomCancelLoadingOfTiles = function onZoomCancelLoadingOfTiles(e) {
          if (!e.data.callbackData) {
            e.data.callbackData = {};
          }

          e.data.callbackData.lens = true;
        };

        _proto20.onZoomBeforeShow = function onZoomBeforeShow(e) {};

        _proto20.onZoomShown = function onZoomShown(e) {};

        _proto20.onZoomHidden = function onZoomHidden(e) {};

        _proto20.setZoomEvents = function setZoomEvents() {
          var _this40 = this;

          if (!this.zoom) {
            return;
          }

          this.on('zoomGetImage', function (e) {
            e.stopAll();

            _this40.onZoomGetImage(e);
          });
          this.on('zoomCancelLoadingOfTiles', function (e) {
            e.stopAll();

            _this40.onZoomCancelLoadingOfTiles(e);
          });
          this.on('zoomBeforeShow', function (e) {
            e.stopAll();

            _this40.onZoomBeforeShow(e);
          });
          this.on('zoomShown', function (e) {
            e.stopAll();

            _this40.onZoomShown(e);
          });
          this.on('zoomHidden', function (e) {
            e.stopAll();

            _this40.onZoomHidden(e);
          });
        };

        _proto20.zoomIn = function zoomIn() {
          if (this._isReady) {
            return true;
          }

          return false;
        };

        _proto20.zoomOut = function zoomOut() {
          if (this._isReady) {
            return true;
          }

          return false;
        }
        /**
         * Current zoom level from 0.00 to 1.00
         * 0.00 - size of base image is equal size of zoom image
         * 1.00 - max zoom
         */
        ;

        _proto20.getZoomData = function getZoomData() {
          if (this._isReady && this.zoom) {
            return this.zoom.getZoomData();
          }

          return 0;
        } // isZoomShown => isZoomed
        ;

        _proto20.isZoomed = function isZoomed() {
          if (this._isReady && this.zoom) {
            return this.zoom.isShown() || this.zoom.isShowing();
          }

          return false;
        };

        _proto20.isZoomSizeExist = function isZoomSizeExist() {
          return false;
        };

        _proto20.clearZoom = function clearZoom() {
          if (this.zoom) {
            this.off('zoomGetImage');
            this.off('zoomCancelLoadingOfTiles');
            this.off('zoomBeforeShow');
            this.off('zoomShown');
            this.off('zoomHidden');
            this.zoom.destroy();
            this.zoom = null;
          }
        };

        _proto20.destroy = function destroy() {
          this.clearZoom();

          _HotspotInstance.prototype.destroy.call(this);
        };

        return ZoomInstance;
      }(HotspotInstance);

      return ZoomInstance;
    });
    Sirv.define('Hotspot', ['bHelpers', 'globalFunctions', 'magicJS', 'EventEmitter', 'helper', 'Promise!'], function (bHelpers, globalFunctions, magicJS, EventEmitter, helper, Promise) {
      var moduleName = 'Hotspot';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global EventEmitter */

      /* global helper */

      /* eslint-disable no-restricted-syntax */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Hotspot" }] */

      var CSS_HOTSPOT_POINTER = 'sirv-hotspot-pointer';
      var CSS_HOTSPOT_POINTER_BACKWARD_COMPATIBILITY = 'hotspot-pointer';
      var CSS_HOTSPOT_TOOLTIP = 'sirv-hotspot-tooltip';
      var CSS_HOTSPOT_DEFAULT = 'pulsating-point';
      var CSS_HOTSPOT_BOX = 'sirv-hotspot-box';
      var CSS_HOTSPOT_WRAPPER = 'sirv-hotspot-box-wrapper';
      var CSS_HOTSPOT_BUTTON_CLOSE = 'sirv-hotspot-close-button';
      var CSS_HOTSPOT_CONTENT = 'sirv-hotspot-box-content';
      var CSS_HOTSPOT_BOX_OUT_OF_WIDTH = 'sirv-hotspot-box-out-of-width';
      var CSS_HOTSPOT_BOX_OUT_OF_HEIGHT = 'sirv-hotspot-box-out-of-height';
      var OVERWRITE_POINTER_EVENT = 'sirv-hotspot-overwrite-pointer-event';
      var STATES = {
        AUTO: 0,
        VISIBLE: 1
      };

      var Hotspot = /*#__PURE__*/function (_EventEmitter3) {
        "use strict";

        bHelpers.inheritsLoose(Hotspot, _EventEmitter3);

        function Hotspot(container, hotspotData, index) {
          var _this41;

          _this41 = _EventEmitter3.call(this) || this;
          _this41.container = container;
          _this41.hotspotData = hotspotData;
          _this41.id = index;
          _this41.box = null;
          _this41.boxContainer = $J.D.node.body;
          _this41.baseBoxSize = null;
          _this41.tooltip = null;
          _this41.version = 1;
          _this41.pointer = null;
          _this41.hotspotSettings = {};
          _this41.dX = 1;
          _this41.dY = 1;
          _this41.isActive = false;
          _this41.isDisabled = false;
          _this41.isPointerInDoc = false;
          _this41.isHovered = false;
          _this41.isShown = false;
          _this41.isBoxContent = false;
          _this41.tooltipState = STATES.AUTO;
          _this41.boxState = STATES.AUTO;

          _this41.init();

          return _this41;
        }

        var _proto21 = Hotspot.prototype;

        _proto21.isTooltipHovered = function isTooltipHovered() {
          return this.isHovered;
        };

        _proto21.isBoxActivated = function isBoxActivated() {
          return this.isActive;
        };

        _proto21.isBoxAlwaysVisible = function isBoxAlwaysVisible() {
          return this.boxState === STATES.VISIBLE;
        };

        _proto21.isTooltipAlwaysVisible = function isTooltipAlwaysVisible() {
          return this.tooltipState === STATES.VISIBLE;
        };

        _proto21.init = function init() {
          this.setVersion();
          this.parseHotspotData();
          this.createBlocks();
          this.setEvents();
          this.createBox();
        };

        _proto21.setVersion = function setVersion() {
          if (this.hotspotData.style || this.hotspotData.tooltip || this.hotspotData.box && this.hotspotData.box.content) {
            this.version = 2;
          }
        };

        _proto21.parseHotspotData = function parseHotspotData() {
          var _this42 = this;

          helper.objEach(this.hotspotData, function (key) {
            _this42.hotspotSettings[key] = _this42.hotspotData[key];
          });
          this.hotspotSettings.pointerPositionPercentage = {
            top: helper.isPercentage('' + this.hotspotSettings.pointer.y),
            left: helper.isPercentage('' + this.hotspotSettings.pointer.x)
          };
        };

        _proto21.createBlocks = function createBlocks() {
          this.pointer = $J.$new('div').addClass(CSS_HOTSPOT_POINTER).attr('data-spot-id', this.id);
          this.pointer.addClass(CSS_HOTSPOT_POINTER_BACKWARD_COMPATIBILITY);

          if (this.version > 1 && this.hotspotSettings.tooltip && this.hotspotSettings.tooltip.content) {
            this.tooltip = $J.$new('div').addClass(CSS_HOTSPOT_TOOLTIP).changeContent(this.hotspotSettings.tooltip.content);

            if (this.hotspotSettings.tooltip.style) {
              this.tooltip.addClass(CSS_HOTSPOT_TOOLTIP + '--' + this.hotspotSettings.tooltip.style);
            }
          }
        };

        _proto21.setTooltipPosition = function setTooltipPosition() {
          if (this.tooltip) {
            var pointerXY = this.pointer.getRect();
            var cssTooltip = {
              top: 0,
              left: 0
            };
            cssTooltip.top = this.hotspotSettings.tooltip.style ? pointerXY.top : pointerXY.bottom;
            cssTooltip.left = this.hotspotSettings.tooltip.style ? (pointerXY.left + pointerXY.right) / 2 : pointerXY.right;

            if ($J.$(this.boxContainer).getTagName() !== 'body') {
              pointerXY = this.pointer.node.getBoundingClientRect();
              cssTooltip.top = this.hotspotSettings.tooltip.style ? pointerXY.top - this.container.node.getBoundingClientRect().top : pointerXY.bottom - this.container.node.getBoundingClientRect().top;
              cssTooltip.left = this.hotspotSettings.tooltip.style ? pointerXY.left - this.container.node.getBoundingClientRect().left + pointerXY.width / 2 : pointerXY.left - this.container.node.getBoundingClientRect().left + pointerXY.width;
            }

            this.tooltip.setCss(cssTooltip);
          }
        };

        _proto21.showTooltip = function showTooltip() {
          if (!this.isHovered && !this.isDisabled) {
            if (this.tooltip) {
              this.setTooltipPosition();
              this.tooltip.appendTo(this.boxContainer).addClass(CSS_HOTSPOT_TOOLTIP + '-visible');
              this.isHovered = true;
              this.emit('hotspotHovered', {
                data: {
                  hotspot: this
                }
              });
            }
          }
        };

        _proto21.setEvents = function setEvents() {
          var _this43 = this;

          this.pointer.addEvent('click mousedown', function (e) {
            e.stop();
          });
          this.pointer.addEvent('btnclick tap', function (e) {
            if (e.getButton() === 3) {
              return true;
            }

            if (_this43.hotspotSettings.link) {
              $J.W.node.open(_this43.hotspotSettings.link);
              e.stop();
            } else if (_this43.isBoxContent) {
              e.stop();

              _this43.showBox();
            }

            return false;
          });

          if ($J.browser.uaName === 'edge' || $J.browser.ieMode) {
            this.pointer.addEvent('mousedown', function (e) {
              e.stopDistribution();
            });
          }

          if (this.hotspotSettings.tooltip && this.hotspotSettings.tooltip.content) {
            this.pointer.addEvent('mouseenter', function (e) {
              _this43.showTooltip();
            });
            this.pointer.addEvent('mouseleave', function () {
              if (_this43.tooltipState !== STATES.VISIBLE) {
                _this43.hideTooltip();

                _this43.isHovered = false;

                _this43.emit('hotspotLeft', {
                  data: {
                    hotspot: _this43
                  }
                });
              }
            });
          }

          var resizeTimer;
          $($J.W).addEvent('resize', function (e) {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function () {
              if (_this43.isActive) {
                var hotspotInfo = _this43.hotspotSettings;

                if (hotspotInfo) {
                  _this43.box.setCss(_this43.correctBoxPosition(_this43.getBoxPosition(hotspotInfo)));
                }
              }
            }, 42);
          });
        };

        _proto21.createBox = function createBox() {
          var _this44 = this;

          var boxContent = null;

          if (this.version > 1 && this.hotspotSettings.box && this.hotspotSettings.box.content) {
            boxContent = this.hotspotSettings.box.content;
          } else if (this.hotspotSettings.data) {
            boxContent = this.hotspotSettings.data;
          }

          this.box = $J.$new('div').addClass(CSS_HOTSPOT_BOX);

          if (boxContent) {
            this.isBoxContent = true;
            var wrapper = $J.$new('div').addClass(CSS_HOTSPOT_WRAPPER).append($J.$new('div').addEvent('btnclick tap', function (e) {
              if (_this44.boxState !== STATES.VISIBLE) {
                e.stop();

                _this44.hideBox(true);
              }
            }).addClass(CSS_HOTSPOT_BUTTON_CLOSE));
            var content = $J.$new('div').addClass(CSS_HOTSPOT_CONTENT).changeContent(boxContent + '').addEvent('click', function (e) {
              e.stopDistribution();
            });
            wrapper.append(content);
            this.box.append(wrapper);
          }

          this.box.setCss({
            top: '-10000px',
            left: '-10000px',
            position: 'absolute',
            opacity: 0
          });
        };

        _proto21.getBoxPosition = function getBoxPosition(hotspotInfo) {
          var result = {
            top: 0,
            left: 0,
            transform: ''
          };

          if (hotspotInfo && hotspotInfo.box) {
            var boxX = hotspotInfo.box.x;
            var boxY = hotspotInfo.box.y;

            if (this.hotspotSettings.box.fixed) {
              var boxBoundaries = this.container.getRect();
              result.position = 'absolute';

              if ($J.$(this.boxContainer).getTagName() !== 'body') {
                switch (boxY) {
                  case 'top':
                    result.top = 0;
                    break;

                  case 'bottom':
                    result.top = boxBoundaries.bottom - boxBoundaries.top;
                    result.transform += ' translateY(-100%)';
                    break;

                  case 'center':
                    result.top = (0 + (boxBoundaries.bottom - boxBoundaries.top)) / 2;
                    result.transform += ' translateY(-50%)';
                    break;

                  default:
                    result.top = 0 + (parseFloat(boxY) || 0);
                }

                switch (boxX) {
                  case 'left':
                    result.left = 0;
                    break;

                  case 'right':
                    result.left = boxBoundaries.right - boxBoundaries.left;
                    result.transform += ' translateX(-100%)';
                    break;

                  case 'center':
                    result.left = (boxBoundaries.right - boxBoundaries.left) / 2;
                    result.transform += ' translateX(-50%)';
                    break;

                  default:
                    result.left = boxBoundaries.left + (parseFloat(boxX) || 0);
                }
              } else {
                switch (boxY) {
                  case 'top':
                    result.top = boxBoundaries.top;
                    break;

                  case 'bottom':
                    result.top = boxBoundaries.bottom;
                    result.transform += ' translateY(-100%)';
                    break;

                  case 'center':
                    result.top = (boxBoundaries.top + boxBoundaries.bottom) / 2;
                    result.transform += ' translateY(-50%)';
                    break;

                  default:
                    result.top = boxBoundaries.top + (parseFloat(boxY) || 0);
                }

                switch (boxX) {
                  case 'left':
                    result.left = boxBoundaries.left;
                    break;

                  case 'right':
                    result.left = boxBoundaries.right;
                    result.transform += ' translateX(-100%)';
                    break;

                  case 'center':
                    result.left = (boxBoundaries.left + boxBoundaries.right) / 2;
                    result.transform += ' translateX(-50%)';
                    break;

                  default:
                    result.left = boxBoundaries.left + (parseFloat(boxX) || 0);
                }
              }
            } else {
              var pointerXY = this.pointer.getPosition();
              var scroll = $J.W.getScroll();
              result.left = pointerXY.left - scroll.x + (parseFloat(boxX) || 0);
              result.top = pointerXY.top - scroll.y + (parseFloat(boxY) || 0);
            }
          }

          return result;
        };

        _proto21.correctBoxPosition = function correctBoxPosition(position) {
          if (this.hotspotSettings.box && !this.hotspotSettings.box.fixed) {
            this.box.removeClass(CSS_HOTSPOT_BOX_OUT_OF_WIDTH);
            this.box.removeClass(CSS_HOTSPOT_BOX_OUT_OF_HEIGHT);
            var wSize = $J.W.getSize();

            if (this.baseBoxSize.width > wSize.width) {
              this.box.addClass(CSS_HOTSPOT_BOX_OUT_OF_WIDTH);
            } else if (position.left + this.baseBoxSize.width > wSize.width) {
              position.left = wSize.width - this.baseBoxSize.width;
            }

            if (this.baseBoxSize.height > wSize.height) {
              this.box.addClass(CSS_HOTSPOT_BOX_OUT_OF_HEIGHT);
            } else if (position.top + this.baseBoxSize.height > wSize.height) {
              position.top = wSize.height - this.baseBoxSize.height;
            }
          }

          return position;
        };

        _proto21.setBoxPosition = function setBoxPosition() {
          var boxCss = {
            transform: ''
          };
          boxCss = this.correctBoxPosition(this.getBoxPosition(this.hotspotSettings));
          this.box.setCssProp('position', '');
          this.box.setCss(boxCss).getSize();
        };

        _proto21.showBox = function showBox() {
          if (this.isActive || this.isDisabled) {
            return;
          }

          if (this.tooltip && this.tooltipState === STATES.AUTO) {
            this.tooltip.removeClass(CSS_HOTSPOT_TOOLTIP + '-visible');
          }

          this.box.setCss({
            opacity: 0
          });
          this.box.appendTo(this.boxContainer);
          this.setBaseBoxSize(this.box.getSize());
          this.setBoxPosition();
          this.box.setCss({
            opacity: 1
          });
          this.isActive = true;
          this.emit('hotspotActivate', {
            data: {
              hotspot: this
            }
          });
        };

        _proto21.hideBox = function hideBox(fade) {
          var _this45 = this;

          if (this.isActive) {
            if (fade) {
              if (this.box) {
                this.box.setCssProp('opacity', 0);
              }

              setTimeout(function () {
                _this45.hideBox();
              }, 300);
              return this.id;
            }

            if (this.box) {
              this.box.remove();
            }

            this.isActive = false;
            this.emit('hotspotDeactivate', {
              data: {
                hotspot: this
              }
            });
          }

          return this.id;
        };

        _proto21.changeBoxContainer = function changeBoxContainer(container) {
          this.boxContainer = container != null ? container : $J.D.node.body;
        };

        _proto21.setBaseBoxSize = function setBaseBoxSize(size, force) {
          if (size && force || !this.baseBoxSize) {
            this.baseBoxSize = {
              width: size.width,
              height: size.height
            };
          }
        };

        _proto21.setHotspotSettings = function setHotspotSettings(settings) {
          for (var item in settings) {
            if ({}.hasOwnProperty.call(settings, item)) {
              this.hotspotSettings[item] = settings[item];
            }
          }
        };

        _proto21.getHotspotSettings = function getHotspotSettings(settings) {
          return this.hotspotSettings;
        };

        _proto21.setAspectRatio = function setAspectRatio(x, y) {
          this.dX = x;
          this.dY = y;
        };

        _proto21.setPointerPosition = function setPointerPosition() {
          var hss = this.hotspotSettings;

          if (hss) {
            this.pointer.setCss({
              top: hss.pointerPositionPercentage.top ? hss.pointer.y : Math.ceil(hss.pointer.y * this.dY),
              left: hss.pointerPositionPercentage.left ? hss.pointer.x : Math.ceil(hss.pointer.x * this.dX)
            });
          }
        };

        _proto21.showPointer = function showPointer() {
          if (this.hotspotSettings && !this.isDisabled) {
            this.pointer.addClass(CSS_HOTSPOT_DEFAULT);
            this.setPointerPosition();

            if (this.hotspotSettings.style || this.hotspotSettings.pointer.style) {
              var dataStyle = this.hotspotSettings.style;

              if (!dataStyle) {
                dataStyle = this.hotspotSettings.pointer.style;
              }

              this.pointer.addClass(dataStyle);
            }

            if (!this.isPointerInDoc) {
              this.isPointerInDoc = true;
              this.pointer.appendTo(this.container);
            }
          } else {
            this.hidePointer();
          }
        };

        _proto21.hidePointer = function hidePointer() {
          if (this.isPointerInDoc) {
            this.isPointerInDoc = false;
            this.pointer.remove();
          }
        };

        _proto21.isHotspotShown = function isHotspotShown() {
          return this.isShown;
        };

        _proto21.show = function show() {
          if (!this.isDisabled && !this.isShown) {
            this.isShown = true;
            this.showPointer();

            if (this.boxState === STATES.SHOW) {
              this.showBox();
            }

            if (this.tooltipState === STATES.SHOW) {
              this.showTooltip();
            }
          }
        };

        _proto21.hide = function hide() {
          if (this.isShown) {
            this.isShown = false;
            this.hideBox();
            this.hideTooltip();
            this.hidePointer();
          }
        };

        _proto21.isEnabled = function isEnabled() {
          return !this.isDisabled;
        };

        _proto21.enable = function enable() {
          if (this.isDisabled) {
            this.isDisabled = false; // this.show();
          }
        };

        _proto21.disable = function disable() {
          if (!this.isDisabled) {
            this.isDisabled = true;
            this.hide();
          }
        };

        _proto21.hideTooltip = function hideTooltip() {
          if (this.isHovered) {
            this.isHovered = false;

            if (this.tooltip) {
              this.tooltip.removeClass(CSS_HOTSPOT_TOOLTIP + '-visible');
            }
          }
        };

        _proto21.overridePointerEvent = function overridePointerEvent() {
          if (!this.isBoxAlwaysVisible() && !this.isTooltipAlwaysVisible()) {
            this.container.addClass(OVERWRITE_POINTER_EVENT);
          }
        };

        _proto21.removeOverridePointerEvent = function removeOverridePointerEvent() {
          this.container.removeClass(OVERWRITE_POINTER_EVENT);
        };

        _proto21.getId = function getId() {
          return this.id;
        };

        _proto21.setId = function setId(id) {
          this.id = id;
        };

        _proto21.setState = function setState(settings, dontShow) {
          // For popup, tooltip, pointer - 1 - 'visible' | 0 - 'initial'
          if (this.boxState !== settings.popup) {
            this.boxState = settings.popup;

            if (settings.popup === STATES.VISIBLE) {
              if (!dontShow) {
                this.showBox();
              }
            } else {
              this.hideBox();
            }
          }

          if (this.tooltipState !== settings.tooltip) {
            this.tooltipState = settings.tooltip;

            if (settings.tooltip === STATES.VISIBLE) {
              if (!dontShow) {
                this.showTooltip();
              }
            } else {
              this.hideTooltip();
            }
          }
        };

        _proto21.rewriteAttrPointer = function rewriteAttrPointer(attr) {
          var attribute = attr || this.id;
          this.pointer.attr('data-spot-id', attribute);
        };

        _proto21.getHotspotPointer = function getHotspotPointer() {
          return this.pointer;
        };

        _proto21.destroy = function destroy() {
          this.hideBox();
          this.hideTooltip();
          this.hotspotData = null;
          this.container = null;
          this.id = null;
          this.pointer.clearEvents();

          if (this.tooltip) {
            this.tooltip.clearEvents();
          }

          this.pointer.remove();
          this.box = null;
          this.boxContainer = null;
          this.baseBoxSize = null;
          this.tooltip = null;
          this.version = null;
          this.pointer = null;
          this.hotspotSettings = null;
          this.isActive = false;
          this.isDisabled = false;
          this.isPointerInDoc = false;
          this.isHovered = false;

          _EventEmitter3.prototype.destroy.call(this);
        };

        return Hotspot;
      }(EventEmitter);

      return Hotspot;
    });
    Sirv.define('Hint', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper) {
      var moduleName = 'Hint';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars

      var HintInstance = /*#__PURE__*/function () {
        "use strict";

        function HintInstance(parent, options) {
          this.parent = $(parent);
          this.options = $J.extend({
            html: 'hint',
            showClass: 'show',
            additionalClass: null,
            autohide: 3500
          }, options || {});
          this.instanceNode = $J.$new('div').addClass('sirv-hint');
          this.hintContainer = $J.$new('span').addClass('sirv-hint-message');
          this.inDoc = false;
          this.isShown = false;
          this.timer = null;
          this.instanceNode.addClass(this.options.additionalClass);
          this.hintContainer.node.innerHTML = this.options.html;
          this.instanceNode.append(this.hintContainer);
        }

        var _proto22 = HintInstance.prototype;

        _proto22.getAutoHideTime = function getAutoHideTime() {
          return this.options.autohide;
        };

        _proto22.getActionTime = function getActionTime() {
          var result = 0;
          var value = this.instanceNode.getCss('transition');

          try {
            value = value.split(' ')[1];
          } catch (e) {
            value = 0;
          }

          if (value) {
            value = value.trim();

            if (/m?s$/.test(value)) {
              if (/s$/.test(value)) {
                result = parseFloat(value);
                result *= 1000;
              } else {
                result = parseInt(value, 10);
              }
            }
          }

          return result;
        };

        _proto22.getMovingTime = function getMovingTime() {
          return this.getAutoHideTime() + this.getActionTime();
        };

        _proto22.append = function append() {
          if (!this.inDoc) {
            this.inDoc = true;
            this.parent.append(this.instanceNode);
          }
        };

        _proto22.removeEvent = function removeEvent() {
          this.instanceNode.removeEvent('transitionend');
        };

        _proto22.show = function show() {
          var _this46 = this;

          this.append();
          clearTimeout(this.timer);
          this.timer = null;
          this.instanceNode.getSize(); // render

          this.removeEvent();
          this.instanceNode.addClass(this.options.showClass);
          this.isShown = true;

          if (this.options.autohide) {
            this.timer = setTimeout(function () {
              _this46.hide();
            }, this.options.autohide);
          }
        };

        _proto22.hide = function hide() {
          var _this47 = this;

          if (this.inDoc) {
            this.removeEvent();
            clearTimeout(this.timer);
            this.timer = null;
            this.instanceNode.addEvent('transitionend', function (e) {
              e.stop();

              _this47.removeEvent();

              _this47.inDoc = false;

              _this47.instanceNode.remove();
            });
            this.instanceNode.removeClass(this.options.showClass);
            this.isShown = false;
          }
        };

        _proto22.destroy = function destroy() {
          this.instanceNode.setCssProp('transitionend', 'none');
          this.hide();
          this.removeEvent();
          this.hintContainer.remove();
          this.hintContainer.node.innerHTML = '';
          this.instanceNode.remove();
          this.inDoc = false;
        };

        return HintInstance;
      }();

      return HintInstance;
    });
    Sirv.define('ResponsiveImage', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'Promise!', 'helper', 'EventEmitter'], function (bHelpers, magicJS, globalVariables, globalFunctions, Promise, helper, EventEmitter) {
      var moduleName = 'ResponsiveImage';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global Promise */

      /* global helper */

      /* eslint-disable indent */

      /* eslint-disable no-lonely-if*/

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /*
          Image class
              params:
                  name - name of image
                  url - image url,
                  srcSettings - settings which has current image
                  srcsetSettings - x2 settings which has current image
      */
      // eslint-disable-next-line no-unused-vars

      var requestCORSIfNotSameOrigin = function (img, url) {
        if (new URL(url).origin !== $J.W.location.origin) {
          img.crossOrigin = '';
        }
      };

      var getUrl = function (url, settings) {
        // let result = url + ('?' + paramsToQueryString(settings).replace(/(?:\?|&)profile\=$/, ''));
        var result = url + ('?' + helper.paramsToQueryString(settings));
        result = helper.cleanQueryString(result);
        return result;
      }; // eslint-disable-next-line no-unused-vars


      var _Image = /*#__PURE__*/function () {
        "use strict";

        function _Image(name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy) {
          this.name = name;
          this.state = 0; // not-loaded = 0, loading = 1, loaded = 2, error = 3

          this.imageNode = null;
          this.size = {
            width: 0,
            height: 0
          };
          this.loader = null;
          this.callbacks = [];
          this.srcSettings = srcSettings;
          this.srcsetSettings = srcsetSettings;
          this.dontLoad = dontLoad;
          this.dppx = this.srcsetSettings ? this.srcsetSettings.dppx : 1;
          this.referrerPolicy = referrerPolicy;

          if (srcSettings.profile === '') {
            delete srcSettings.profile;
          }

          if (srcsetSettings && srcsetSettings.profile === '') {
            delete srcsetSettings.profile;
          }

          this.src = getUrl(url, srcSettings);
          this.srcset = null;

          if (srcsetSettings) {
            this.srcset = getUrl(url, srcsetSettings.settings);
          }
        }

        var _proto23 = _Image.prototype;

        _proto23.load = function load() {
          var _this48 = this;

          return new Promise(function (resolve, reject) {
            if (_this48.dontLoad) {
              resolve(_this48);
            } else if (!_this48.state) {
              _this48.state = 1;
              _this48.imageNode = $(new Image());

              _this48.imageNode.attr('referrerpolicy', _this48.referrerPolicy || 'no-referrer-when-downgrade');

              _this48.imageNode.addEvent('load', function (e) {
                e.stop();
                _this48.state = 2;
                _this48.size = {
                  width: _this48.imageNode.node.naturalWidth || _this48.imageNode.node.width,
                  height: _this48.imageNode.node.naturalHeight || _this48.imageNode.node.height
                };

                if ($J.browser.uaName === 'safari') {
                  var correct = false;

                  if (_this48.srcSettings.scale.width) {
                    if (_this48.size.width > _this48.srcSettings.scale.width + 5) {
                      correct = true;
                    }
                  } else {
                    if (_this48.size.height > _this48.srcSettings.scale.height + 5) {
                      correct = true;
                    }
                  }

                  if (correct) {
                    _this48.size.width /= _this48.dppx;
                    _this48.size.height /= _this48.dppx;
                  }
                }

                resolve(_this48);
              });

              _this48.imageNode.addEvent('error', function (e) {
                e.stop();
                _this48.state = 3;
                _this48.imageNode = null;
                reject(_this48);
              }); // requestCORSIfNotSameOrigin(this.imageNode.node, this.src);


              _this48.setSrc();

              _this48.setSrcset();
            } else {
              resolve(_this48);
            }
          });
        };

        _proto23.setSrc = function setSrc() {
          this.imageNode.node.src = this.src;
        };

        _proto23.setSrcset = function setSrcset() {
          if (this.srcset) {
            // TODO because amount of tiles are different between 1x image and 1.5x image
            // this.imageNode.node.srcset = encodeURI(this.srcset) + ' 2x';
            // this.imageNode.node.srcset = this.srcset + ' 2x';
            this.imageNode.node.srcset = this.srcset + ' ' + this.dppx + 'x';
          }
        };

        _proto23.isLoading = function isLoading() {
          return this.state === 1;
        };

        _proto23.destroy = function destroy() {
          if (this.state === 1 && this.imageNode) {
            this.imageNode.attr('src', 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=');
          }

          this.state = 0;
        };

        return _Image;
      }();
      /* eslint-env es6 */

      /* global _Image */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars


      var _TileImage = /*#__PURE__*/function (_Image2) {
        "use strict";

        bHelpers.inheritsLoose(_TileImage, _Image2);

        function _TileImage(name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy, tileName) {
          var _this49;

          _this49 = _Image2.call(this, name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy) || this;
          _this49.tileName = tileName; // name of tile

          return _this49;
        }

        var _proto24 = _TileImage.prototype;

        _proto24.setSrc = function setSrc() {
          if (this.dppx === 1) {
            // TODO because amount of tiles are different between 1x image and 1.5x image
            _Image2.prototype.setSrc.call(this);
          }
        };

        return _TileImage;
      }(_Image);
      /* eslint-env es6 */

      /* global _Image, _TileImage, helper, EventEmitter */

      /* eslint-disable indent */

      /* eslint-disable no-console */

      /* eslint-disable no-lonely-if */

      /* eslint no-prototype-builtins: "off" */

      /* eslint no-useless-escape: "off" */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint class-methods-use-this: ["off", { "_createImageData": ["error"] }] */

      /*
          RImage class
          params:
              source - sirv image url
              o - options
              infoId - id for info object (to save in global object IMAGE_INFO) or will be generated automatically
      
          public functions:
              getClearSizeWithoutProcessingSettings
              isExist
              isLoaded
              isReady
              getOriginSize
              sendLoad
              cancelLoadingImage
              getImageName
              getImage
              getOriginImageUrl
              getProcessingSettings
              getThumbnail
              destroy
      
          public events:
              'imageOnload' - fire when the image was loaded
      
          example:
          this.images = {
              '123234345456' (it is name of image): {
                  serverWidth: 150,
                  serverHeight: 150,
                  image: _Image class
              },
          };
      
      */


      var splitOptions = function (imageSettings, dppx) {
        var src = $J.extend({}, imageSettings);
        var srcset;
        delete src.src;
        delete src.srcset;
        src.imageSettings = $J.extend({}, (imageSettings == null ? void 0 : imageSettings.imageSettings) || {});

        if (dppx > 1) {
          srcset = JSON.parse(JSON.stringify(src));

          if (srcset.width) {
            srcset.width = parseInt(srcset.width * dppx, 10);
          }

          if (srcset.height) {
            srcset.height = parseInt(srcset.height * dppx, 10);
          }

          if (srcset.imageSettings.crop) {
            if (srcset.imageSettings.crop.width) {
              srcset.imageSettings.crop.width = parseInt(srcset.imageSettings.crop.width * dppx, 10);
            }

            if (srcset.imageSettings.crop.height) {
              srcset.imageSettings.crop.height = parseInt(srcset.imageSettings.crop.height * dppx, 10);
            }
          }

          srcset.dppx = dppx;
        }

        src.imageSettings = $J.extend(src.imageSettings, imageSettings.src);

        if (srcset && imageSettings.srcset) {
          srcset.imageSettings = $J.extend(srcset.imageSettings, imageSettings.srcset);
        }

        return {
          src: src,
          srcset: srcset
        };
      };

      var getOriginUrl = function (source) {
        return source.split('?')[0];
      };

      var toPercentageString = function (v) {
        return (v * 100).toFixed(4) + '%';
      };

      var _getImageName = function (url) {
        var hash;
        var result = null; // eslint-disable-line prefer-const, no-unused-vars

        url = url.replace('\?+', '?');
        url = url.replace('&+', '&');
        url = url.split('?');
        hash = url[1];
        url = url[0];
        hash = hash.split('&');
        hash = hash.sort();
        return '' + $J.getHashCode(url + '?' + hash.join('&'));
      };

      var getPropFromCrop = function (obj, name) {
        var result = null;

        if (obj && obj.crop && obj.crop[name]) {
          result = obj.crop[name];
        }

        return result;
      };

      var mixSettings = function (info, defaultImageSettings, imageSettings) {
        var result = helper.deepExtend({}, defaultImageSettings);

        if (info && info.imageSettings.processingSettings) {
          if (!result.crop) {
            result.crop = {};
          }

          result.crop = helper.deepExtend(result.crop, info.cropSettings); // if (result.crop) {
          //     if (result.crop.width && /100(\.0*)?%/.test(result.crop.width)) {
          //         delete result.crop.width;
          //     }
          //     if (result.crop.height && /100(\.0*)?%/.test(result.crop.height)) {
          //         delete result.crop.height;
          //     }
          // }

          if (!result.canvas) {
            result.canvas = {};
          }

          result.canvas = helper.deepExtend(result.canvas, info.canvasSettings);

          if (!result.frame) {
            result.frame = {};
          }

          result.frame = helper.deepExtend(result.frame, info.frameSettings);

          if (!result.scale) {
            result.scale = {};
          }

          if (!result.scale.option) {
            result.scale.option = 'fill';
          }
        }

        if (imageSettings.width && imageSettings.width !== 'auto') {
          result.scale.width = imageSettings.width;
        }

        if (imageSettings.height && imageSettings.height !== 'auto') {
          result.scale.height = imageSettings.height;
        }

        if (imageSettings.imageSettings) {
          result = helper.deepExtend(result, imageSettings.imageSettings);
        } // if (getPropFromCrop(defaultImageSettings, 'type') === 'focalpoint' || getPropFromCrop(info.imageSettings.processingSettings, 'type') === 'focalpoint') {
        //     const x = getPropFromCrop(defaultImageSettings, 'x') || getPropFromCrop(info.imageSettings.processingSettings, 'x');
        //     if (x) {
        //         result.crop.x = x;
        //     }
        //     const y = getPropFromCrop(defaultImageSettings, 'y') || getPropFromCrop(info.imageSettings.processingSettings, 'y');
        //     if (y) {
        //         result.crop.y = y;
        //     }
        //     result.scale = {};
        // }


        return result;
      };

      var INFO = 'sirv_image_info_';
      var IMAGE_INFO = {}; // eslint-disable-next-line no-unused-vars

      var RImage = /*#__PURE__*/function (_EventEmitter4) {
        "use strict";

        bHelpers.inheritsLoose(RImage, _EventEmitter4);

        function RImage(source, o) {
          var _this50;

          _this50 = _EventEmitter4.call(this) || this;

          if ($J.typeOf(source) !== 'string') {
            source = $(source).attr('src');
          }

          _this50.o = $J.extend({
            type: 'main',
            infoId: 'sirv-image-' + helper.generateUUID(),
            imageSettings: {},
            round: true,
            dontLoad: false,
            convertSmallerSideToZero: true,
            referrerPolicy: 'no-referrer-when-downgrade',

            /*
                loadNewImage:
                true - if image is missing - load image
                false - if image is missing but if bigger image is exist give large image else load image
            */
            loadNewImage: false
          }, o);
          _this50.imageInfoPromise = null;
          _this50.images = {};
          _this50.originUrl = getOriginUrl($J.getAbsoluteURL(source));
          _this50.infoUrl = _this50.originUrl + '?nometa&info';
          _this50.imageSettings = $J.extend({}, _this50.o.imageSettings);
          return _this50;
        }

        RImage.roundImageSize = function roundImageSize(size, originSize) {
          var tmp;

          if (!originSize) {
            originSize = {
              width: Number.MAX_VALUE,
              height: Number.MAX_VALUE
            };
          }

          if (size.width && size.height) {
            if (size.width >= size.height) {
              tmp = helper.roundSize(size.width);

              if (tmp <= originSize.width) {
                size.height = Math.floor(size.height / size.width * tmp);
                size.width = tmp;
              }
            } else {
              tmp = helper.roundSize(size.height);

              if (tmp <= originSize.height) {
                // size.width = Math.round((size.width / size.height) * tmp);
                // firefox
                // fix 'https://github.com/sirv/sirv.js/issues/148'
                // We need to use 'Math.floor' because this image 'https://demo.sirv.com/demo/vax/2759311-g.jpg?scale.option=fill&h=500' has wrong size in zoom
                size.width = Math.floor(size.width / size.height * tmp);
                size.height = tmp;
              }
            }
          } else if (size.width) {
            tmp = helper.roundSize(size.width);

            if (tmp <= originSize.width) {
              size.width = tmp;
            }
          } else if (size.height) {
            tmp = helper.roundSize(size.height);

            if (tmp <= originSize.height) {
              size.height = tmp;
            }
          }

          return size;
        };

        var _proto25 = RImage.prototype;

        _proto25._convertImageSettings = function _convertImageSettings(imageSettings) {
          var setSize = function (obj, size) {
            if (size.width) {
              obj.width = size.width;
            }

            if (size.height) {
              obj.height = size.height;
            }
          };

          if (!imageSettings) {
            imageSettings = {};
          }

          imageSettings = $J.extend({}, imageSettings); // correct tile size if we have canvas border

          var tmp = this.getClearSizeWithoutProcessingSettings({
            width: imageSettings.width,
            height: imageSettings.height
          });
          setSize(imageSettings, tmp);
          var result = splitOptions(imageSettings, imageSettings.dppx);

          if (imageSettings.round || !imageSettings.hasOwnProperty('round') && this.o.round) {
            var originSize = this.getOriginSize();
            tmp = RImage.roundImageSize(result.src, originSize);
            setSize(result, tmp);

            if (result.srcset) {
              tmp = RImage.roundImageSize(result.srcset, originSize);
              setSize(result, tmp);
            }
          }

          return result;
        };

        _proto25._mixSettings = function _mixSettings(settings) {
          return mixSettings(IMAGE_INFO[this.o.infoId], this.imageSettings, settings);
        };

        _proto25._calcProcessingSettings = function _calcProcessingSettings() {
          var info = IMAGE_INFO[this.o.infoId];
          var cropSettings = {};
          var canvasSettings = {};
          var frameSettings = {};

          if (!info.imageSettings.viewer) {
            info.imageSettings.viewer = {};
          }

          var viewer = info.imageSettings.viewer;
          var originSize = {
            width: info.imageSettings.original.width,
            height: info.imageSettings.original.height,
            widthScale: 1,
            heightScale: 1
          };

          if (viewer.scale) {
            if (viewer.scale.width) {
              originSize.width *= viewer.scale.width;
            }

            if (viewer.scale.height) {
              originSize.height *= viewer.scale.height;
            }
          }

          originSize.widthScale = originSize.width / info.imageSettings.width;
          originSize.heightScale = originSize.height / info.imageSettings.height;

          if (viewer.crop) {
            if (viewer.crop.width) {
              cropSettings.width = toPercentageString(viewer.crop.width);
            }

            if (viewer.crop.height) {
              cropSettings.height = toPercentageString(viewer.crop.height);
            }

            if (viewer.crop.x) {
              cropSettings.x = toPercentageString(viewer.crop.x);
            }

            if (viewer.crop.y) {
              cropSettings.y = toPercentageString(viewer.crop.y);
            }
          }

          if (viewer.canvas) {
            if (viewer.canvas.width) {
              canvasSettings.width = toPercentageString(viewer.canvas.width);
            }

            if (viewer.canvas.height) {
              canvasSettings.height = toPercentageString(viewer.canvas.height);
            }

            if (viewer.canvas.border) {
              canvasSettings.border = {};

              if (viewer.canvas.border.width) {
                canvasSettings.border.width = toPercentageString(viewer.canvas.border.width);
              }

              if (viewer.canvas.border.height) {
                canvasSettings.border.height = toPercentageString(viewer.canvas.border.height);
              }
            }
          }

          if (viewer.frame && viewer.frame.width) {
            frameSettings.width = toPercentageString(viewer.frame.width);
          }

          info = $J.extend(info, {
            cropSettings: cropSettings,
            canvasSettings: canvasSettings,
            frameSettings: frameSettings,
            originSize: originSize
          });
        };

        _proto25._addImage = function _addImage(name, imageSettings) {
          var _this51 = this;

          var dontLoad = $J.defined(imageSettings.src.dontLoad) ? imageSettings.src.dontLoad : this.o.dontLoad;

          var getSettings = function (sett) {
            var result = _this51._mixSettings(sett);

            if (result.scale && result.scale.width && result.scale.height && result.scale.option !== 'ignore') {
              if (result.scale.width >= result.scale.height) {
                if (_this51.o.convertSmallerSideToZero) {
                  result.scale.height = 0;
                }
              } else {
                if (_this51.o.convertSmallerSideToZero) {
                  result.scale.width = 0;
                }
              }
            }

            return result;
          };

          var src = getSettings(imageSettings.src);
          var srcset = null;
          var tile;
          var tileName = null;

          if (imageSettings.src.imageSettings && imageSettings.src.imageSettings.tile) {
            tile = imageSettings.src.imageSettings.tile;
            tileName = tile.number + '';
          }

          if (imageSettings.srcset) {
            srcset = {
              dppx: imageSettings.srcset.dppx,
              settings: getSettings(imageSettings.srcset)
            };
          }

          var imageInstance = null;

          if (tileName === null) {
            imageInstance = new _Image(name, this.originUrl, src, srcset, dontLoad, this.o.referrerPolicy);
          } else {
            imageInstance = new _TileImage(name, this.originUrl, src, srcset, dontLoad, this.o.referrerPolicy, tileName);
          }

          this.images[name] = {
            serverWidth: imageSettings.src.width,
            serverHeight: imageSettings.src.height,
            image: imageInstance
          };
          return this.images[name];
        };

        _proto25._load = function _load(name, imageSettings) {
          var _this52 = this;

          var img = this._addImage(name, imageSettings);

          var eventName;
          var instance;
          img.image.load().then(function (imgInst) {
            instance = imgInst;
            eventName = 'imageOnload';

            if (instance instanceof _Image) {
              _this52.someImageIsLoaded = true;
            }
          }).catch(function (imgInst) {
            instance = imgInst;
            eventName = 'imageOnerror';
          }).finally(function () {
            if (instance instanceof _Image) {
              _this52.someImageIsComplete = true;
            }

            var image = _this52.images[instance.name];

            if (image) {
              _this52.emit(eventName, {
                data: _this52._createImageData(image, imageSettings.src.callbackData)
              });
            }
          });
        };

        _proto25._createImageData = function _createImageData(img, callbackData) {
          var obj = img.image;
          var result = {
            callbackData: callbackData,
            name: obj.name,
            tileName: obj.tileName,
            tile: obj instanceof _TileImage,
            node: obj.imageNode,
            serverWidth: img.serverWidth,
            serverHeight: img.serverHeight,
            width: obj.size.width,
            height: obj.size.height,
            src: obj.src,
            srcset: obj.srcset,
            state: obj.state,
            dppx: obj.dppx || 1
          };
          return result;
        };

        _proto25._filter = function _filter(isTile) {
          var result = [];
          helper.objEach(this.images, function (key, image) {
            if (image.image instanceof _TileImage === !!isTile) {
              result.push(image);
            }
          });
          return result;
        };

        _proto25.getCropPosition = function getCropPosition() {
          var info = IMAGE_INFO[this.o.infoId];
          var x = getPropFromCrop(this.imageSettings, 'x');

          if (x && !/%$/.test(x)) {
            x = toPercentageString(x / info.originSize.width);
          }

          var y = getPropFromCrop(this.imageSettings, 'y');

          if (y && !/%$/.test(y)) {
            y = toPercentageString(y / info.originSize.height);
          }

          return {
            x: x || info.cropSettings.x,
            y: y || info.cropSettings.y,
            type: getPropFromCrop(this.imageSettings, 'type') || getPropFromCrop(info.imageSettings.processingSettings, 'type')
          };
        }
        /**
         * Is image exist with current size or more
         *
         * @param {Object}    Image settings object to check
         *
         * @returns {boolean} - Returns true if the image is exist
         */
        ;

        _proto25.isExist = function isExist(imageSettings) {
          imageSettings = this._convertImageSettings(imageSettings);
          var name = this.getImageName(imageSettings.src);
          var result = Object.prototype.hasOwnProperty.call(this.images, name);

          if (!result) {
            if (!(imageSettings.src.imageSettings && imageSettings.src.imageSettings.tile) && imageSettings.src.width) {
              var images = this._filter(false);

              result = this._getBiggerImage(imageSettings.src.width, images);
            }
          }

          return !!result;
        }
        /**
         * Is image exist with current size
         *
         * @param {Object}    Image settings object to check
         *
         * @returns {boolean} - Returns true if the image is loaded
         */
        ;

        _proto25.isLoaded = function isLoaded(imageSettings) {
          imageSettings = this._convertImageSettings(imageSettings);
          var result = this.images[this.getImageName(imageSettings.src)];

          if (result) {
            result = result.image.state === 2;
          }

          return !!result;
        }
        /**
         * Some of image is loaded
         *
         * @returns {boolean} - Returns true if some of image is loaded
         */
        ;

        _proto25.isReady = function isReady() {
          return this.someImageIsLoaded;
        };

        _proto25.isComplete = function isComplete() {
          return this.someImageIsComplete;
        }
        /**
         * Returns origin size of image from image info
         *
         * @returns {Hash} Size of the image  {width: x, height: x}
         */
        ;

        _proto25.getOriginSize = function getOriginSize() {
          var result = null;
          var info = null;

          if (IMAGE_INFO[this.o.infoId]) {
            info = IMAGE_INFO[this.o.infoId].imageSettings;
          }

          if (info) {
            var width;
            var height;

            if (info.processingSettings) {
              width = info.width;
              height = info.height;
            } else {
              width = info.original.width;
              height = info.original.height;
            }

            result = {
              width: width,
              height: height
            };
          }

          return result;
        };

        _proto25.getImageInfo = function getImageInfo() {
          var _this53 = this;

          if (!this.imageInfoPromise) {
            this.imageInfoPromise = new Promise(function (resolve, reject) {
              var url = _this53.originUrl;
              var hash = $J.getHashCode(_this53.infoUrl.replace(/^http(s)?:\/\//, ''));
              var imageSettings = helper.paramsToQueryString(_this53.imageSettings);

              if (imageSettings !== '') {
                url += '?' + imageSettings;
                url += '&';
              } else {
                url += '?';
              }

              url += 'nometa&info=' + INFO + hash + '_' + _this53.o.type;
              url = helper.cleanQueryString(url);
              helper.getRemoteData(url, 'image_info_' + helper.generateUUID(), _this53.o.referrerPolicy).then(function (data) {
                if (!data.width || data._isplaceholder) {
                  reject(data);
                } else {
                  IMAGE_INFO[_this53.o.infoId] = {
                    imageSettings: data
                  };

                  _this53._calcProcessingSettings();

                  resolve(IMAGE_INFO[_this53.o.infoId]);
                }
              }).catch(reject);
            });
          }

          return this.imageInfoPromise;
        };

        _proto25._getBiggerImage = function _getBiggerImage(width, images, dontLoad) {
          var result = null;

          if (!width) {
            width = 0;
          }

          if (!images) {
            images = this.images;
          }

          if (dontLoad === $J.U) {
            dontLoad = this.o.dontLoad;
          }

          helper.objEach(images, function (key, value) {
            if (width < value.serverWidth) {
              if ((value.image.state === 2 || dontLoad) && (!result || result.serverWidth > value.serverWidth)) {
                result = value;
              }
            }
          });
          return result;
        };

        _proto25.sendLoad = function sendLoad(imageSettings) {
          var img;
          imageSettings = this._convertImageSettings(imageSettings);
          img = this.images[this.getImageName(imageSettings.src)];

          if (!img) {
            img = this._getBiggerImage(imageSettings.src.width);
          }

          this.emit('imageOnload', {
            data: this._createImageData(img, imageSettings.src.callbackData)
          });
        }
        /**
         * Cancels loading image if it is
         *
         * @param {Object}    Image settings object to cansel
         */
        ;

        _proto25.cancelLoadingImage = function cancelLoadingImage(imageSettings) {
          imageSettings = this._convertImageSettings(imageSettings);
          var name = this.getImageName(imageSettings.src);
          var img = this.images[name];

          if (img) {
            if (img.image.isLoading()) {
              img.image.destroy();
              delete this.images[name];
            }
          }
        }
        /**
         * Returns image name
         *
         * @param {Object}    Image settings object
         *
         * @returns {String} name of image
         */
        ;

        _proto25.getImageName = function getImageName(imageSettings) {
          var result = _getImageName(helper.cleanQueryString(this.originUrl + ('?' + helper.paramsToQueryString(this._mixSettings(imageSettings)))));

          return result;
        };

        _proto25.getClearSizeWithoutProcessingSettings = function getClearSizeWithoutProcessingSettings(size) {
          var result = {};
          var info = IMAGE_INFO[this.o.infoId];

          if (size.width) {
            result.width = Math.round(size.width * info.originSize.widthScale);
          }

          if (size.height) {
            result.height = Math.round(size.height * info.originSize.heightScale);
          }

          return result;
        }
        /*
         * Returns image object if it is exist or load image if it isn't
         *
         * @param {Object}    Image settings object
         *
         * @returns {object or null} Returns image object
             imageOptions {
                width: 42,
                height: 42,
                round: true/false(default false) - round max size to 100
                maxSize: true/false(default true), - if the size of image is not exist send image with bigger size
                 additionalImageSettings = {
                    ...
                    quality: 1,
                    tile: {}
                    ...
                }
            }
        */
        ;

        _proto25.getImage = function getImage(imageSettings) {
          var options = this._convertImageSettings(imageSettings);

          var dontLoad = $J.defined(options.src.dontLoad) ? options.src.dontLoad : this.o.dontLoad;
          var name = this.getImageName(options.src);
          var result = this.images[name];

          if (!result) {
            this._load(name, $J.extend({}, options));
          }

          if (result && result.image.state < 2 && !dontLoad) {
            result = null;
          }

          if (!result && (options.src.maxSize || !this.o.loadNewImage)) {
            if (options.src.exactSize) {
              if (dontLoad) {
                result = this.images[name];
              }
            } else {
              result = this._getBiggerImage(null, null, dontLoad);
            }
          }

          if (result) {
            result = this._createImageData(result, options.src.callbackData);
          }

          return result;
        }
        /**
        * Returns origin url of image
        *
        * @returns {String} url
        */
        ;

        _proto25.getOriginImageUrl = function getOriginImageUrl() {
          var result = null;

          if (this.originUrl) {
            result = this.originUrl;
          }

          return result;
        }
        /**
         * Returns current processing settings
         *
         * @returns {object} processing settings
         */
        ;

        _proto25.getProcessingSettings = function getProcessingSettings() {
          var info = IMAGE_INFO[this.o.infoId];
          return {
            crop: info.cropSettings,
            cropClear: info.cropSettingsClear,
            canvas: info.canvasSettings,
            canvasClear: info.canvasSettingsClear
          };
        };

        _proto25.getDescription = function getDescription() {
          var result = null;
          var info = IMAGE_INFO[this.o.infoId];

          if (info) {
            result = info.imageSettings.original.description || null;
          }

          return result;
        }
        /**
         * Get thambnail urls (src, srcset)
         *
         * @param {Object}    Options for the image
         *
         * @returns {Object}  src, srcset and other datas
         */
        ;

        _proto25.getThumbnail = function getThumbnail(imageSettings) {
          var _this54 = this;

          var result = {
            imageSettings: null,
            size: null,
            src: null,
            srcset: null
          };

          if (IMAGE_INFO[this.o.infoId]) {
            var options = splitOptions(imageSettings, $J.DPPX);
            var srcset = null;
            var convertSmallerSideToZero = this.o.convertSmallerSideToZero;
            var originUrl = imageSettings.originUrl || this.originUrl;

            var getSrc = function (_size, _imageSettings) {
              var settings = {
                scale: {
                  option: 'fill'
                }
              };

              if (_size.width || _size.height) {
                if (_size.width && _size.height) {
                  settings.scale.width = _size.width;
                  settings.scale.height = _size.height;
                } else {
                  var _tmp2 = _size.width || _size.height;

                  settings.scale.width = _tmp2;
                  settings.scale.height = _tmp2;
                }
              }

              if (_size.width === _size.height) {
                if (imageSettings.crop) {
                  settings.crop = {
                    x: 'center',
                    y: 'center',
                    width: _size.width,
                    height: _size.height
                  };
                } else {
                  settings.scale.option = 'fit';

                  if (!settings.canvas) {
                    settings.canvas = {};
                  }

                  settings.canvas.width = _size.width;
                  settings.canvas.height = _size.height;
                }
              }

              if (settings.scale) {
                if (imageSettings.width && imageSettings.height) {
                  if (IMAGE_INFO[_this54.o.infoId].imageSettings.original.width >= IMAGE_INFO[_this54.o.infoId].imageSettings.original.height) {
                    if (convertSmallerSideToZero) {
                      settings.scale.height = 0;
                    }
                  } else {
                    if (convertSmallerSideToZero) {
                      settings.scale.width = 0;
                    }
                  }
                } else if (imageSettings.width) {
                  if (convertSmallerSideToZero) {
                    settings.scale.height = 0;
                  }
                } else if (imageSettings.height) {
                  if (convertSmallerSideToZero) {
                    settings.scale.width = 0;
                  }
                }
              }

              if (_imageSettings) {
                settings = $J.extend(settings, _imageSettings);
              }

              var tmp = settings;
              settings = {};
              settings.imageSettings = tmp;
              settings = _this54._mixSettings(settings);

              if (settings.text) {
                delete settings.text;
              }

              if (!imageSettings.watermark && settings.watermark) {
                delete settings.watermark;
              }

              return helper.paramsToQueryString(settings);
            };

            var getSize = function (is) {
              var r = {};

              if (is.width) {
                r.width = is.width;
              }

              if (is.height) {
                r.height = is.height;
              }

              return r;
            };

            if (options.src.crop || options.src.width && options.src.height) {
              convertSmallerSideToZero = false;
            }

            result = {
              callbackData: imageSettings.callbackData,
              size: getSize(options.src.imageSettings),
              src: helper.cleanQueryString(originUrl + '?' + getSrc(getSize(options.src), options.src.imageSettings))
            };

            if ($J.DPPX > 1) {
              srcset = getSrc(getSize(options.srcset), options.srcset.imageSettings);

              if (srcset) {
                result.srcset = helper.cleanQueryString(originUrl + '?' + srcset);
              }
            }
          }

          return result;
        };

        _proto25.getAccountInfo = function getAccountInfo() {
          var result = {};
          var info = IMAGE_INFO[this.o.infoId];

          if (info) {
            result.account = info.imageSettings.account;
            result.branded = info.imageSettings.branded;
          }

          return result;
        };

        _proto25.destroy = function destroy() {
          helper.objEach(this.images, function (key, img) {
            img.image.destroy();
          });
          this.images = {};
          this.someImageIsLoaded = false;
          this.someImageIsComplete = false;

          if (IMAGE_INFO[this.infoId]) {
            delete IMAGE_INFO[this.infoId];
            this.infoId = null;
          }

          _EventEmitter4.prototype.destroy.call(this);
        };

        return RImage;
      }(EventEmitter);

      return RImage;
    });
    Sirv.define('Loader', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'EventEmitter'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, EventEmitter) {
      var moduleName = 'Loader';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global EventEmitter */

      /* global $J */

      /* global $ */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint dot-notation: ["error", { "allowKeywords": false }]*/
      // eslint-disable-next-line no-unused-vars

      var Loader = /*#__PURE__*/function (_EventEmitter5) {
        "use strict";

        bHelpers.inheritsLoose(Loader, _EventEmitter5);

        function Loader(parent, options) {
          var _this55;

          _this55 = _EventEmitter5.call(this) || this;
          _this55.parentNode = $(parent);
          _this55.options = $J.extend({
            width: null,
            height: null,
            'class': null
          }, options || {});
          _this55.node = $J.$new('div').addClass('smv-loader');
          _this55.type = 'simple';
          _this55.inDoc = false;

          if (_this55.options['class']) {
            _this55.node.addClass(_this55.options['class']);
          }

          if (_this55.options.width) {
            _this55.node.setCssProp('width', _this55.options.width);
          }

          if (_this55.options.height) {
            _this55.node.setCssProp('height', _this55.options.height);
          }

          return _this55;
        }

        var _proto26 = Loader.prototype;

        _proto26.append = function append() {
          if (!this.inDoc) {
            this.inDoc = true;
            this.parentNode.append(this.node);
          }
        };

        _proto26.show = function show() {
          this.append();
          this.node.setCss({
            display: '',
            visibility: 'visible'
          });
        };

        _proto26.hide = function hide() {
          this.node.setCss({
            display: 'none',
            visibility: 'hidden'
          });
        };

        _proto26.destroy = function destroy() {
          this.hide();
          this.node.remove();
          this.node = null;
          this.inDoc = false;

          _EventEmitter5.prototype.destroy.call(this);
        };

        return Loader;
      }(EventEmitter);

      return Loader;
    });
    Sirv.define('RoundLoader', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Loader'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, Loader) {
      var moduleName = 'RoundLoader';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global Loader */

      /* global $J */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var SHOW_CLASS = 'smv-show'; // eslint-disable-next-line no-unused-vars

      var RoundLoader = /*#__PURE__*/function (_Loader) {
        "use strict";

        bHelpers.inheritsLoose(RoundLoader, _Loader);

        function RoundLoader(parent, options) {
          var _this56;

          _this56 = _Loader.call(this, parent, options) || this;
          _this56.type = 'round';
          _this56.state = globalVariables.APPEARANCE.HIDDEN;
          _this56.timer = null;
          _this56.loaderElement = $J.$new('div');

          _this56.addClass();

          _this56.node.append(_this56.loaderElement);

          return _this56;
        }

        var _proto27 = RoundLoader.prototype;

        _proto27.addClass = function addClass() {
          this.node.addClass('smv-round-loader');
        };

        _proto27.isHiding = function isHiding() {
          return this.state === globalVariables.APPEARANCE.HIDING;
        };

        _proto27.show = function show() {
          var _this57 = this;

          if ($J.contains([globalVariables.APPEARANCE.SHOWING, globalVariables.APPEARANCE.SHOWN], this.state)) {
            return;
          }

          this.state = globalVariables.APPEARANCE.SHOWING;
          this.timer = setTimeout(function () {
            _this57.timer = null;

            _this57.append();

            _this57.node.removeEvent('transitionend');

            _this57.node.addEvent('transitionend', function (e) {
              e.stop();
              _this57.state = globalVariables.APPEARANCE.SHOWN;
            });

            _this57.node.getSize(); // render


            _this57.node.addClass(SHOW_CLASS);
          }, 250);
        };

        _proto27.hide = function hide(force) {
          var _this58 = this;

          if (this.state === globalVariables.APPEARANCE.HIDDEN && !force) {
            return;
          }

          clearTimeout(this.timer);
          this.node.removeEvent('transitionend');

          if (this.state !== globalVariables.APPEARANCE.SHOWN) {
            force = true;
          }

          this.state = globalVariables.APPEARANCE.HIDING;

          if (!force) {
            this.node.addEvent('transitionend', function (e) {
              e.stop();

              _this58.node.remove();

              _this58.inDoc = false;
              _this58.state = globalVariables.APPEARANCE.HIDDEN;
            });
          } else {
            this.node.remove();
            this.inDoc = false;
            this.state = globalVariables.APPEARANCE.HIDDEN;
          }

          this.node.removeClass(SHOW_CLASS);
        };

        _proto27.destroy = function destroy() {
          this.hide(true);
          this.state = globalVariables.APPEARANCE.HIDDEN;
          this.node.innerHTML = '';

          _Loader.prototype.destroy.call(this);
        };

        return RoundLoader;
      }(Loader);

      return RoundLoader;
    });
    Sirv.define('ProgressLoader', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'RoundLoader'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, RoundLoader) {
      var moduleName = 'ProgressLoader';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global RoundLoader, helper, $J, $ */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var svgNS = 'http://www.w3.org/2000/svg';

      var setDefaultOptions = function (options) {
        if (!options) {
          options = {};
        }

        if (!options.width) {
          options.width = 44;
        }

        if (!options.height) {
          options.height = 44;
        }

        if (!options.max) {
          options.max = 0;
        }

        return options;
      };

      var createSvg = function (name, attributes) {
        var el = $($J.D.node.createElementNS(svgNS, name));

        if (!attributes) {
          attributes = {};
        }

        helper.objEach(attributes, function (key, value) {
          el.attr(key, value);
        });
        return el;
      };

      var getStrokeDashoffset = function (max, percent) {
        return max - max / 100 * percent;
      };

      var getPercent = function (max, value) {
        return Math.round(100 / (max / value));
      };

      var PROGRESS = {
        START: 0,
        LOADING: 1,
        END: 2
      }; // eslint-disable-next-line no-unused-vars

      var ProgressLoader = /*#__PURE__*/function (_RoundLoader) {
        "use strict";

        bHelpers.inheritsLoose(ProgressLoader, _RoundLoader);

        function ProgressLoader(parent, options) {
          var _this59;

          options = setDefaultOptions(options);
          _this59 = _RoundLoader.call(this, parent, options) || this;
          _this59.type = 'progress';
          _this59.lineSize = 125;
          _this59.currentLineSize = 125;
          _this59.currentPersent = 0;
          _this59.currentValue = 0;
          _this59.progressState = PROGRESS.START;
          _this59.maxOpacityFlag = false;
          _this59.maxOpacity = 1;
          _this59.circles = [];
          _this59.size = {
            width: _this59.options.width,
            height: _this59.options.height
          };
          _this59.state = globalVariables.APPEARANCE.HIDDEN;

          _this59._createCircles();

          return _this59;
        }

        var _proto28 = ProgressLoader.prototype;

        _proto28.addClass = function addClass() {
          this.node.addClass('smv-progress-loader');
        };

        _proto28._createCircles = function _createCircles() {
          this.p = '<span class="smv-pl-text-percent">%</span>';
          this.loaderElement.addClass('smv-pl-wrapper');
          this.circleWrapper = $J.$new('div').addClass('smv-pl-circle-wrapper');
          var size = this.size.width;
          var halfSize = size / 2;
          this.circles.push(createSvg('circle', {
            'class': 'smv-pl-pie',
            r: halfSize - 2,
            cx: halfSize,
            cy: halfSize
          }));
          this.circles.push(createSvg('circle', {
            'class': 'smv-pl-slice',
            r: halfSize - 2,
            cx: halfSize,
            cy: halfSize
          }));
          this.svg = createSvg('svg', {
            'class': 'smv-pl-indicator',
            viewBox: '0 0 ' + size + ' ' + size
          });
          this.circles[1].node.style.strokeDasharray = this.lineSize;
          this.circles[1].node.style.strokeDashoffset = this.lineSize;
          $(this.circles[1]).addEvent('transitionend', function (e) {
            e.stop();
          }).setCssProp('transition', 'stroke-dashoffset .1s linear');
          $(this.svg).append(this.circles[0]);
          $(this.svg).append(this.circles[1]);
          this.textWrapper = $J.$new('div').addClass('smv-pl-text-wrapper');
          this.text = $J.$new('span').addClass('smv-pl-text');
          this.text.changeContent(this.currentPersent + this.p);
          this.textWrapper.append(this.text);
          this.circleWrapper.append(this.svg);
          this.loaderElement.append(this.circleWrapper);
          this.loaderElement.append(this.textWrapper);
        };

        _proto28.append = function append() {
          if (this.progressState !== PROGRESS.END) {
            _RoundLoader.prototype.append.call(this);
          }
        };

        _proto28.progress = function progress() {
          if (this.progressState !== PROGRESS.END) {
            this.progressState = PROGRESS.LOADING;
            this.currentValue += 1;
            this.currentPersent = getPercent(this.options.max, this.currentValue);
            this.currentLineSize = getStrokeDashoffset(this.lineSize, this.currentPersent);
            this.circles[1].node.style.strokeDashoffset = this.currentLineSize;
            this.text.node.innerHTML = this.currentPersent + this.p;

            if (this.currentValue === this.options.max) {
              this.progressState = PROGRESS.END;
              this.hide();
            }
          }
        };

        _proto28.setMaxOpacity = function setMaxOpacity(opacity) {
          if (!this.maxOpacityFlag && this.loaderElement) {
            this.maxOpacity = opacity;
            this.maxOpacityFlag = true;
            this.loaderElement.setCssProp('opacity', opacity);
          }
        };

        _proto28.isEnded = function isEnded() {
          return this.currentValue === this.options.max;
        };

        _proto28.isStarted = function isStarted() {
          return this.currentValue > 0;
        };

        _proto28.finishOff = function finishOff() {
          this.currentValue = this.options.max;
        };

        _proto28.isShow = function isShow() {
          return this.state === globalVariables.APPEARANCE.SHOWN;
        };

        _proto28.show = function show() {
          if (this.state === globalVariables.APPEARANCE.SHOWN) {
            return;
          }

          this.state = globalVariables.APPEARANCE.SHOWN;
          this.append();
          this.loaderElement.getSize();
          this.loaderElement.removeEvent('transitionend');
          this.loaderElement.addEvent('transitionend', function (e) {
            e.stop();
          });
          this.loaderElement.setCss({
            display: 'block',
            opacity: this.maxOpacity,
            transform: 'scale(1)'
          });
        };

        _proto28.hide = function hide(force) {
          var _this60 = this;

          if (this.state === globalVariables.APPEARANCE.HIDDEN && !force || !this.inDoc) {
            return;
          }

          var countOfTransitionEvents = 0;
          this.state = globalVariables.APPEARANCE.HIDDEN;
          clearTimeout(this.timer);
          this.timer = setTimeout(function () {
            _this60.loaderElement.removeEvent('transitionend');

            _this60.loaderElement.addEvent('transitionend', function (e) {
              e.stop();
              countOfTransitionEvents += 1;

              if (countOfTransitionEvents < 2) {
                return;
              }

              _this60.loaderElement.removeEvent('transitionend');

              _this60.loaderElement.setCssProp('display', 'none');
            });

            _this60.loaderElement.setCss({
              opacity: 0,
              transform: 'scale(0)'
            });
          }, force ? 0 : 400);
        };

        _proto28.getProgressState = function getProgressState() {
          return this.progressState;
        };

        _proto28.destroy = function destroy() {
          this.hide(true);
          clearTimeout(this.timer);
          this.currentPersent = 0;
          this.currentValue = 0;
          this.progressState = PROGRESS.START;
          this.state = globalVariables.APPEARANCE.HIDDEN;
          this.loaderElement.removeEvent('transitionend');
          this.loaderElement.node.innerHTML = '';
          this.loaderElement = null;
          this.circleWrapper = null;
          this.textWrapper = null;
          this.circles = [];
          this.svg = null;
          this.text = null;
          this.inDoc = false;

          _RoundLoader.prototype.destroy.call(this);
        };

        return ProgressLoader;
      }(RoundLoader);

      return ProgressLoader;
    });
    Sirv.define('ComponentLoader', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'RoundLoader'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, RoundLoader) {
      var moduleName = 'ComponentLoader';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global RoundLoader */

      /* global $J */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var setDefaultOptions = function (options) {
        if (!options) {
          options = {};
        }

        if (!options.width) {
          options.width = '100%';
        }

        if (!options.height) {
          options.height = '100%';
        }

        return options;
      }; // eslint-disable-next-line no-unused-vars


      var ComponentLoader = /*#__PURE__*/function (_RoundLoader2) {
        "use strict";

        bHelpers.inheritsLoose(ComponentLoader, _RoundLoader2);

        function ComponentLoader(parent, options) {
          var _this61;

          options = setDefaultOptions(options);
          _this61 = _RoundLoader2.call(this, parent, options) || this;
          _this61.type = 'component';

          _this61.loaderElement.addClass('smv-bounce-wrapper').append($J.$new('div').addClass('smv-bounce1')).append($J.$new('div').addClass('smv-bounce2'));

          return _this61;
        }

        var _proto29 = ComponentLoader.prototype;

        _proto29.addClass = function addClass() {
          this.node.addClass('smv-component-loader');
        };

        _proto29.destroy = function destroy() {
          this.loaderElement.removeClass('smv-bounce-wrapper');
          this.loaderElement.node.innerHTML = '';

          _RoundLoader2.prototype.destroy.call(this);
        };

        return ComponentLoader;
      }(RoundLoader);

      return ComponentLoader;
    });
    Sirv.define('ImageZoom', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'EventEmitter'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, EventEmitter) {
      var moduleName = 'ImageZoom';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global helper */

      /* eslint-disable no-unused-vars */

      var CURSOR_STATES = {
        canZoom: 'smv-cursor-zoom',
        zoomIn: 'smv-cursor-zoom-in',
        zoomOut: 'smv-cursor-zoom-out',
        drag: 'smv-cursor-dragging'
      };
      var TOUCH = 'mousedrag touchdrag';
      var TOUCHEND = helper.isIe() ? 'pointerup' : 'touchend';
      var MOVE = 'mousemove';

      if (helper.isIe()) {
        MOVE = 'pointermove';
      }

      var getPercentValue = function (value, percent) {
        return value / 100 * percent;
      };

      var getDifference = function (bigValue, smallValue) {
        return (bigValue - smallValue) / 2;
      };

      var checkImagePosition = function (value, minPos, maxPos, lensSize) {
        if (value > minPos) {
          value = minPos;
        }

        if (value + maxPos < lensSize) {
          value = lensSize - maxPos;
        }

        return value;
      };

      var getPercent = function (value, size) {
        return value / size * 100;
      };

      var checkRange = function (value, min, max) {
        if (value < min) {
          value = min;
        }

        if (value > max) {
          value = max;
        }

        return value;
      };

      var calcScale = function (baseSize, currentSize) {
        return currentSize / baseSize;
      };

      var getLevels = function (minSize, maxSize) {
        var levelsNumber = Math.max(1, Math.round(Math.log(Math.max(maxSize.width / minSize.width, maxSize.height / minSize.height)) / Math.LN2));
        var levelWidth = maxSize.width;
        var levelHeight = maxSize.height;
        var result = [];

        while (levelsNumber > 0) {
          levelsNumber -= 1;
          result.push({
            width: levelWidth,
            height: levelHeight
          });
          levelWidth = parseInt(levelWidth / 2, 10);
          levelHeight = parseInt(levelHeight / 2, 10);
        }

        return result;
      };
      /* eslint-env es6 */

      /* global EventEmitter */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint class-methods-use-this: ["off", { "_setItemClass": ["error"] }] */

      /* start-removable-tile-helper-block */
      // eslint-disable-next-line no-unused-vars


      var ZoomHelper = /*#__PURE__*/function (_EventEmitter6) {
        "use strict";

        bHelpers.inheritsLoose(ZoomHelper, _EventEmitter6);

        function ZoomHelper(options) {
          var _this62;

          _this62 = _EventEmitter6.call(this) || this;
          _this62.o = $J.extend({
            maxTileSize: 15,
            minTileSize: 5
          }, options || {});
          _this62.inDoc = false;
          _this62.container = $J.$new('div').addClass('zoom-helper');
          _this62.header = $J.$new('div').addClass('z-helper-head');
          _this62.zoom = $J.$new('span').addClass('z-zoom');
          _this62.tileSize = {
            width: 0,
            height: 0
          };
          _this62.levels = {};
          return _this62;
        }

        var _proto30 = ZoomHelper.prototype;

        _proto30._createHead = function _createHead() {
          var tmp = $J.$new('div');
          tmp.innerHTML = 'Zoom: ';
          tmp.append(this.zoom);
          this.setZoom(0);
          this.header.append(tmp);
          tmp = $J.$new('div');
          tmp.innerHTML = '<div class="z-status z-canceled-color"></div> - canceled';
          this.header.append(tmp);
          tmp = $J.$new('div');
          tmp.innerHTML = '<div class="z-status z-loading-color"></div> - loading';
          this.header.append(tmp);
          tmp = $J.$new('div');
          tmp.innerHTML = '<div class="z-status z-loaded-color"></div> - loaded';
          this.header.append(tmp);
        };

        _proto30._calcSizeOfTile = function _calcSizeOfTile(levelSize) {
          var _this63 = this;

          var getSize = function (sizeOfPart, aspectRatio) {
            var result = parseInt(sizeOfPart * aspectRatio, 10);

            if (result < _this63.o.minTileSize) {
              result = _this63.o.minTileSize;
            }

            return result;
          };

          var w;
          var h;

          if (levelSize.width > levelSize.height) {
            w = this.o.maxTileSize;
            h = getSize(w, levelSize.height / levelSize.width);
          } else {
            h = this.o.maxTileSize;
            w = getSize(h, levelSize.width / levelSize.height);
          }

          return {
            width: w,
            height: h
          };
        };

        _proto30._createTile = function _createTile(c, r, options) {
          var getSize = function (isLast, size) {
            return isLast ? function () {
              var s = parseInt(size / 2, 10);

              if (s < 3) {
                s = 3;
              }

              return s;
            }() : size;
          };

          var checkSize = function (l, t) {
            return l % t < t / 2;
          };

          var w = getSize(options.cols - 1 === c && checkSize(options.levelSize.width, options.tileSize.width), this.tileSize.width);
          var h = getSize(options.rows - 1 === r && checkSize(options.levelSize.height, options.tileSize.height), this.tileSize.height);
          var node = $J.$new('div').addClass('z-tile');
          node.setCss({
            top: r * this.tileSize.height + 'px',
            left: c * this.tileSize.width + 'px',
            width: w + 'px',
            height: h + 'px'
          });
          return {
            currentClass: null,
            width: w,
            height: h,
            col: c,
            row: r,
            node: node
          };
        };

        _proto30._show = function _show(level) {
          if (!level) {
            return;
          }

          if (!this.inDoc) {
            this.inDoc = true;

            this._createHead();

            this.container.append(this.header);
            $($J.D.node.body).append(this.container);
          }

          if (!level.inDoc) {
            level.inDoc = true;
            this.container.append(level.node);
            this.container.setCssProp('max-height', $J.W.innerHeight - 55 + 'px');
          }
        };

        _proto30._setItemClass = function _setItemClass(level, col, row, _class) {
          var tile = level.tiles[row][col];

          if (tile.currentClass !== _class) {
            if (tile.currentClass) {
              tile.node.removeClass(tile.currentClass);
            }

            tile.currentClass = _class;
            tile.node.addClass(_class);
          }
        };

        _proto30.setZoom = function setZoom(zoom) {
          // zoom = zoom + '';
          zoom += '';

          if (zoom.length < 2) {
            zoom += '.0';
          }

          this.zoom.innerHTML = zoom;
        };

        _proto30.createLevel = function createLevel(options) {
          var _this64 = this;

          var node = $J.$new('div').addClass('z-level');
          var body = $J.$new('div').addClass('z-body');

          var createTiles = function (cols, rows) {
            var i;
            var j;
            var arr = [];

            for (j = 0; j < rows; j++) {
              var arr2 = [];

              for (i = 0; i < cols; i++) {
                var tile = _this64._createTile(i, j, options);

                body.append(tile.node);
                arr2.push(tile);
              }

              arr.push(arr2);
            }

            return arr;
          };

          var head = $J.$new('div').addClass('z-head');
          var statusContainer = $J.$new('div').addClass('z-status');
          var tmp = $J.$new('div');
          tmp.innerHTML = 'Level: ' + options.level;
          head.append(tmp);
          tmp = $J.$new('div');
          tmp.innerHTML = 'Shown:';
          tmp.append(statusContainer);
          head.append(tmp);
          tmp = $J.$new('div');
          tmp.innerHTML = options.levelSize.width + 'x' + options.levelSize.height;
          head.append(tmp);
          node.append(head);
          node.append(body);

          if (!this.tileSize.width) {
            this.tileSize = this._calcSizeOfTile(options.levelSize);
          }

          var tiles = createTiles(options.cols, options.rows);
          var last = tiles[options.rows - 1][options.cols - 1];
          body.setCss({
            width: (options.cols - 1) * this.tileSize.width + last.width + 'px',
            height: (options.rows - 1) * this.tileSize.height + last.height + 'px'
          });
          this.levels[options.level] = {
            inDoc: false,
            number: options.level,
            status: statusContainer,
            node: node,
            head: head,
            body: body,
            tiles: tiles
          }; // this._show(this.levels[options.level]);
        };

        _proto30.tileAction = function tileAction(data) {
          var level = this.levels[data.level + ''];

          var _class;

          switch (data.type) {
            case 0:
              // canceled
              _class = 'z-canceled-color';
              break;

            case 1:
              // loading
              _class = 'z-loading-color';
              break;

            case 2:
              // loaded
              _class = 'z-loaded-color';
              break;
            // no default
          }

          this._setItemClass(level, data.col, data.row, _class);
        };

        _proto30.setLevelState = function setLevelState(levelID, value) {
          var level = this.levels[levelID + ''];
          var _class = 'shown';

          if (value) {
            if (level.inDoc) {
              level.status.addClass(_class);
            }
          } else {
            level.status.removeClass(_class);
          }
        };

        _proto30.setData = function setData(data) {
          var level;

          if ($J.defined(data.level)) {
            level = this.levels[data.level + ''];
          }

          if (level) {
            this._show(level);
          }

          if (data.zoom) {
            this.setZoom(data.zoom);
          }

          if (level) {
            if ('col' in data) {
              this._setItemClass(level, data.col, data.row, 'z-loaded-color');
            }
          }

          if (level && $J.defined(data.levelStatus)) {
            this.setLevelState(data.level, data.levelStatus);
          }
        };

        _proto30.destroy = function destroy() {
          if (this.inDoc) {
            this.inDoc = false;
            this.zoom.remove();
            this.zoom.inneHTML = '';
            this.header.remove();
            this.header.inneHTML = '';
            this.container.remove();
            this.container.inneHTML = '';
            this.levels = {};
            this.tileSize = {
              width: 0,
              height: 0
            };
          }

          _EventEmitter6.prototype.destroy.call(this);
        };

        return ZoomHelper;
      }(EventEmitter);
      /* end-removable-tile-helper-block */


      var DeepZoom = function () {
        /* eslint-env es6 */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars
        var Camera = /*#__PURE__*/function () {
          "use strict";

          function Camera(options) {
            this.isInner = options.inner; // lengthOfRow

            this.rows = options.lengthOfRow; // lengthOfColumn

            this.cols = options.lengthOfColumn;
            this.size = {
              width: options.cameraWidth,
              height: options.cameraHeight
            }; // baseMapSize

            this.bMapS = {
              width: options.mapWidth,
              height: options.mapHeight
            }; // baseTileSize

            this.bTileS = {
              width: options.tileWidth,
              height: options.tileHeight
            }; // baseScale

            this.bScale = {
              x: options.scaleX,
              y: options.scaleY
            }; // mapSize

            this.mapS = {
              width: this.bMapS.width,
              height: this.bMapS.height
            }; // tileSize

            this.tileS = {
              width: this.bTileS.width,
              height: this.bTileS.height
            };
            this.baseLastTileSize = {
              width: this.bMapS.width - (this.cols - 1) * this.bTileS.width,
              height: this.bMapS.height - (this.rows - 1) * this.bTileS.height
            };
            this.lastTileSize = {
              width: this.baseLastTileSize.width,
              height: this.baseLastTileSize.height
            };
            this.position = {
              x: 0,
              y: 0
            };
            this.lastCorrectionPosition = {
              x: 0,
              y: 0
            };
            this.scale = {
              x: 0,
              y: 0
            };
            this.lastScale = 0;
            this.lastGlobaslScale = 0;
            this.count = {
              x: 0,
              y: 0
            };
            this.calcCount();
            this.shownTiles = {
              startX: 0,
              countX: this.count.x,
              startY: 0,
              countY: this.count.y
            };
          }

          Camera.getTileIndex = function getTileIndex(position, tileSize) {
            return Math.floor(position / tileSize);
          };

          Camera.getTileSize = function getTileSize(size, scale) {
            return size * scale;
          };

          var _proto31 = Camera.prototype;

          _proto31.checkTile = function checkTile(x, y) {
            var st = this.shownTiles;
            return st.startX <= x && st.startY <= y && st.startX + st.countX > x && st.startY + st.countY > y;
          };

          _proto31.calcCount = function calcCount() {
            this.count = {
              x: Math.ceil(this.size.width / this.tileS.width) + 1,
              y: Math.ceil(this.size.height / this.tileS.height) + 1
            };
          };

          _proto31.findShownTiles = function findShownTiles() {
            var p = this.position;
            var ts = this.tileS;
            var startX = 0;
            var startY = 0;
            var countX = this.count.x;
            var countY = this.count.y;

            if (p.x < 0) {
              startX = Camera.getTileIndex(Math.abs(p.x), ts.width);
            }

            if (p.y < 0) {
              startY = Camera.getTileIndex(Math.abs(p.y), ts.height);
            }

            if (startX + countX > this.cols) {
              countX = this.cols - startX;
            }

            if (startY + countY > this.rows) {
              countY = this.rows - startY;
            }

            this.shownTiles = {
              startX: startX,
              countX: countX,
              startY: startY,
              countY: countY
            };
          };

          _proto31.calcTileSize = function calcTileSize() {
            this.tileS.width = Camera.getTileSize(this.bTileS.width, this.scale.x);
            this.tileS.height = Camera.getTileSize(this.bTileS.height, this.scale.y);
            this.lastTileSize.width = Camera.getTileSize(this.baseLastTileSize.width, this.scale.x);
            this.lastTileSize.height = Camera.getTileSize(this.baseLastTileSize.height, this.scale.y);
          };

          _proto31.calcData = function calcData(position) {
            if (this.lastScale !== this.scale.x) {
              this.calcTileSize();
              this.calcCount();
              this.mapS.width = this.tileS.width * (this.cols - 1) + this.lastTileSize.width;
              this.mapS.height = this.tileS.height * (this.rows - 1) + this.lastTileSize.height;
              this.lastCorrectionPosition.x = (this.bMapS.width * this.bScale.x - this.mapS.width) / 2;
              this.lastCorrectionPosition.y = (this.bMapS.height * this.bScale.y - this.mapS.height) / 2;
              this.lastScale = this.scale.x;
            }

            this.position.x = position.x + this.lastCorrectionPosition.x;
            this.position.y = position.y + this.lastCorrectionPosition.y;
          };

          _proto31.setScale = function setScale(scale) {
            this.lastScale = this.scale.x;
            this.scale.x = scale.x * this.bScale.x;
            this.scale.y = scale.y * this.bScale.y;
          };

          _proto31.action = function action(position, scale) {
            if (this.lastGlobaslScale !== scale.x) {
              this.setScale(scale);
              this.lastGlobaslScale = scale.x;
            }

            this.calcData(position);
            this.findShownTiles();
          };

          _proto31.resize = function resize(viewPort) {
            this.size.width = viewPort.width;
            this.size.height = viewPort.height;
            this.calcCount();
            this.findShownTiles();
          };

          _proto31.setMapS = function setMapS(width, height) {
            if (width !== null && width !== undefined) {
              this.mapS.width = width;
            }

            if (height !== null && height !== undefined) {
              this.mapS.height = height;
            }
          };

          _proto31.getShownTiles = function getShownTiles() {
            return this.shownTiles;
          };

          _proto31.getMapS = function getMapS() {
            return this.mapS;
          };

          _proto31.destroy = function destroy() {
            this.shownTiles = $([]);
          };

          return Camera;
        }();
        /* eslint-env es6 */

        /* global Map */

        /* global EventEmitter */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


        var TILE_STATES = {
          NOT_LOADED: 0,
          LOADING: 1,
          LOADED: 2
        }; // eslint-disable-next-line no-unused-vars

        var Tile = /*#__PURE__*/function (_EventEmitter7) {
          "use strict";

          bHelpers.inheritsLoose(Tile, _EventEmitter7);

          function Tile(options) {
            var _this65;

            _this65 = _EventEmitter7.call(this) || this;
            _this65.id = options.id;
            _this65.index = {
              x: options.indexX,
              y: options.indexY
            };
            _this65.position = {
              x: options.x,
              y: options.y
            };
            _this65.size = {
              width: options.width,
              height: options.height
            };
            _this65.storage = options.storage;
            _this65.state = TILE_STATES.NOT_LOADED;
            _this65.node = null;

            if (_this65.storage.has(_this65.id)) {
              _this65.node = _this65.storage.get(_this65.id);
              _this65.state = TILE_STATES.LOADED;
            }

            return _this65;
          }

          var _proto32 = Tile.prototype;

          _proto32.isLoaded = function isLoaded() {
            return this.state === TILE_STATES.LOADED;
          };

          _proto32.addImageToStorage = function addImageToStorage() {
            if (!this.storage.has(this.id)) {
              this.storage.set(this.id, this.node);
            }
          };

          _proto32.load = function load() {
            if (this.state === TILE_STATES.NOT_LOADED) {
              this.state = TILE_STATES.LOADING;
              this.emit('getTile', {
                data: {
                  indexX: this.index.x,
                  indexY: this.index.y,
                  number: this.id
                }
              });
            }
          };

          _proto32.cancelLoading = function cancelLoading() {
            if (this.state === TILE_STATES.LOADING) {
              this.state = TILE_STATES.NOT_LOADED;
              this.emit('zoomCancelLoadingOfTiles', {
                data: {
                  indexX: this.index.x,
                  indexY: this.index.y,
                  number: this.id
                }
              });
            }
          };

          _proto32.setImage = function setImage(node) {
            if (this.state !== TILE_STATES.LOADED) {
              this.state = TILE_STATES.LOADED;
              this.node = $(node);
              this.addImageToStorage();
            }
          };

          _proto32.destroy = function destroy() {
            this.cancelLoading();
            this.storage = null;

            _EventEmitter7.prototype.destroy.call(this);
          };

          return Tile;
        }(EventEmitter);
        /* eslint-env es6 */
        // eslint-disable-next-line no-unused-vars


        var LevelView = /*#__PURE__*/function () {
          "use strict";

          function LevelView(parent, dppx) {
            this.p = $(parent);
            this.dppx = dppx; // wrapper

            this.w = $J.$new('div');
            this.cvs = $J.$new('canvas');
            this.ctx = this.cvs.node.getContext('2d');
            this.w.append(this.cvs);
          }

          var _proto33 = LevelView.prototype;

          _proto33.setIndex = function setIndex(index) {
            this.w.addClass('deepzoom-level-' + index);
            this.w.attr('z-index' + (index + 1));
          };

          _proto33.append = function append() {
            this.p.append(this.w);
          };

          _proto33.show = function show() {
            this.w.setCssProp('display', '');
          };

          _proto33.hide = function hide() {
            this.w.setCssProp('display', 'none');
          };

          _proto33.clear = function clear() {
            this.ctx.clearRect(0, 0, this.cvs.node.width, this.cvs.node.height);
          };

          _proto33.draw = function draw(scale, moveX, moveY) {
            this.ctx.setTransform(1, 0, 0, 1, 0, 0);
            this.clear();
            this.ctx.setTransform(scale.x, 0, 0, scale.y, moveX, moveY);
          };

          _proto33.drawTile = function drawTile(tileNode, tileSize, tilePosition) {
            if ($J.browser.uaName === 'edge' || $J.browser.uaName === 'ie') {
              if (this.dppx > 1) {
                this.ctx.drawImage(tileNode.node, 0, 0, tileSize.width, tileSize.height, tilePosition.x, tilePosition.y, tileSize.width, tileSize.height);
              } else {
                this.ctx.drawImage(tileNode.node, tilePosition.x, tilePosition.y, tileSize.width, tileSize.height);
              }
            } else {
              this.ctx.drawImage(tileNode.node, 0, 0, tileSize.width, tileSize.height, tilePosition.x, tilePosition.y, tileSize.width, tileSize.height);
            }
          };

          _proto33.setCanvasSize = function setCanvasSize(width, height) {
            this.cvs.setCss({
              width: width,
              height: height
            });
            this.cvs.attr('width', width * this.dppx);
            this.cvs.attr('height', height * this.dppx);
          };

          _proto33.destroy = function destroy() {
            this.cvs.remove();
            this.w.remove();
          };

          return LevelView;
        }();
        /* eslint-env es6 */

        /* global Map, Camera, Tile, zoomHelper, EventEmitter */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


        var TILES_HASH_STORAGE = new Map();

        var getCorrectedTileSize = function (value, dppx) {
          // return value * ((1 - (dppx - 1)) || 1);
          // dppx -= 1;
          // if (dppx <= 0) { dppx = 1; }
          // return value * dppx;
          return value / dppx;
        }; // eslint-disable-next-line no-unused-vars


        var Level = /*#__PURE__*/function (_EventEmitter8) {
          "use strict";

          bHelpers.inheritsLoose(Level, _EventEmitter8);

          function Level(view, options) {
            var _this66;

            _this66 = _EventEmitter8.call(this) || this;
            _this66.view = view;
            _this66.id = options.id; // number of level

            _this66.dppx = options.dppx;
            _this66.size = {
              width: options.width,
              height: options.height
            }; // size of level image
            // maxSize

            _this66.mSize = {
              width: options.maxWidth,
              height: options.maxHeight
            }; // size of biggest image
            // tileSize

            _this66.tSize = {
              width: options.tileWidth,
              height: options.tileHeight
            };
            _this66.tileImageSize = {
              width: options.tileImageWidth,
              height: options.tileImageHeight
            };
            _this66.layerSize = {
              width: options.layerWidth,
              height: options.layerHeight
            };
            _this66.hash = options.hash + '-' + (_this66.size.width + 'x' + _this66.size.height);

            if (!TILES_HASH_STORAGE.has(_this66.hash)) {
              TILES_HASH_STORAGE.set(_this66.hash, new Map());
            }

            _this66.scaleFactor = {
              x: (_this66.mSize.width - _this66.size.width) / _this66.size.width + 1,
              y: (_this66.mSize.height - _this66.size.height) / _this66.size.height + 1
            };
            _this66.maxDisplayedSize = {
              width: options.maxDisplayedWidth,
              height: options.maxDisplayedHeight
            };
            _this66.minDisplayedSize = {
              width: options.minDisplayedWidth,
              height: options.minDisplayedHeight
            };
            _this66.globalScale = {
              x: 1,
              y: 1
            };
            _this66.globalPosition = {
              x: 0,
              y: 0
            };

            _this66.view.setIndex(_this66.id);

            _this66.setLensSize(options.viewPortWidth, options.viewPortHeight);

            _this66.isAdded = false;
            _this66.isShown = false;
            _this66.tiles = _this66.calcTiles();
            _this66.countOfTiles = _this66.tiles.length * _this66.tiles[0].length;
            _this66.loadedTiles = 0;
            _this66.camera = new Camera({
              inner: options.inner,
              scaleX: _this66.scaleFactor.x,
              scaleY: _this66.scaleFactor.y,
              cameraWidth: options.viewPortWidth,
              cameraHeight: options.viewPortHeight,
              mapWidth: _this66.size.width,
              mapHeight: _this66.size.height,
              tileWidth: getCorrectedTileSize(_this66.tileImageSize.width, _this66.dppx),
              tileHeight: getCorrectedTileSize(_this66.tileImageSize.height, _this66.dppx),
              lengthOfRow: _this66.tiles.length,
              lengthOfColumn: _this66.tiles[0].length
            });
            /* start-removable-tile-helper-block */

            if (zoomHelper) {
              zoomHelper.createLevel({
                level: _this66.id,
                cols: _this66.tiles[0].length,
                rows: _this66.tiles.length,
                levelSize: {
                  width: _this66.size.width,
                  height: _this66.size.height
                },
                tileSize: {
                  width: _this66.tileImageSize.width,
                  height: _this66.tileImageSize.height
                }
              });
            }
            /* end-removable-tile-helper-block */


            return _this66;
          }

          var _proto34 = Level.prototype;

          _proto34.setEvents = function setEvents() {
            var _this67 = this;

            var ts = this.tileImageSize;
            this.on('getTile', function (e) {
              e.data.width = _this67.size.width;
              e.data.height = _this67.size.height;
              e.data.level = _this67.id;
              e.data.imageSettings = {
                tile: {
                  width: ts.width,
                  height: ts.height,
                  number: e.data.number
                }
              };

              if (_this67.dppx > 1) {
                e.data.dppx = _this67.dppx;
              }
              /* start-removable-tile-helper-block */


              if (zoomHelper) {
                zoomHelper.tileAction({
                  level: _this67.id,
                  col: e.data.indexX,
                  row: e.data.indexY,
                  type: 1
                });
              }
              /* end-removable-tile-helper-block */

            });
            this.on('zoomCancelLoadingOfTiles', function (e) {
              e.data.width = _this67.size.width;
              e.data.height = _this67.size.height;
              e.data.imageSettings = {
                tile: {
                  width: ts.width,
                  height: ts.height,
                  number: e.data.number
                }
              };
              /* start-removable-tile-helper-block */

              if (zoomHelper) {
                zoomHelper.tileAction({
                  level: _this67.id,
                  col: e.data.indexX,
                  row: e.data.indexY,
                  type: 0
                });
              }
              /* end-removable-tile-helper-block */

            });
          };

          _proto34.cancelLoadingOfTiles = function cancelLoadingOfTiles() {
            this.tiles.forEach(function (row) {
              row.forEach(function (tile) {
                tile.cancelLoading();
              });
            });
          };

          _proto34.setImage = function setImage(imageData) {
            var tile = this.tiles[imageData.indexY][imageData.indexX];

            if (!tile.isLoaded()) {
              this.loadedTiles += 1;
            }

            tile.setImage(imageData.node);

            if (this.isShown && this.camera.checkTile(imageData.indexX, imageData.indexY)) {
              this.drawTile(tile);
            }
            /* start-removable-tile-helper-block */


            if (zoomHelper) {
              zoomHelper.setData({
                level: this.id,
                col: imageData.indexX,
                row: imageData.indexY
              });
            }
            /* end-removable-tile-helper-block */

          };

          _proto34.append = function append() {
            if (!this.isAdded && this.isShown) {
              this.isAdded = true;
              this.setEvents();
              this.view.append();
            }
          };

          _proto34.calcTiles = function calcTiles() {
            var result = [];
            var ts = this.tileImageSize;
            var l1 = Math.ceil(this.layerSize.width / ts.width);
            var l2 = Math.ceil(this.layerSize.height / ts.height);

            for (var j = 0; j < l2; j++) {
              var arr = $([]);

              for (var i = 0; i < l1; i++) {
                var tile = new Tile({
                  y: j * ts.height,
                  x: i * ts.width,
                  indexX: i,
                  indexY: j,
                  id: j * l1 + i,
                  width: i !== l1 - 1 ? ts.width : this.layerSize.width - i * ts.width,
                  height: j !== l2 - 1 ? ts.height : this.layerSize.height - j * ts.height,
                  storage: TILES_HASH_STORAGE.get(this.hash)
                });
                tile.setParent(this);
                arr.push(tile);
              }

              result.push(arr);
            }

            return result;
          };

          _proto34.correctDPPXPosition = function correctDPPXPosition(pos, lensSize, imageSize) {
            var result = pos;

            if (this.dppx > 1) {
              var center = lensSize / 2;
              result = Math.abs(pos - center) / (imageSize / 100);
              result = center * this.dppx - imageSize * this.dppx / 100 * result;
            }

            return result;
          };

          _proto34.draw = function draw() {
            var _this68 = this;

            var c = this.camera;

            if (this.isShown) {
              this.view.draw(c.scale, this.correctDPPXPosition(c.position.x, c.size.width, c.mapS.width), this.correctDPPXPosition(c.position.y, c.size.height, c.mapS.height));
              this.eachTile(function (tile) {
                _this68.drawTile(tile);
              });
            }
          };

          _proto34.drawTile = function drawTile(tile) {
            if (tile && tile.isLoaded()) {
              this.view.drawTile(tile.node, tile.size, tile.position);
            }
          };

          _proto34.eachTile = function eachTile(callback) {
            var st = this.camera.getShownTiles();

            for (var y = 0, l = st.countY; y < l; y++) {
              for (var x = 0, l2 = st.countX; x < l2; x++) {
                callback(this.tiles[st.startY + y][st.startX + x]);
              }
            }
          };

          _proto34.checkSize = function checkSize() {
            var last = this.isShown;
            var mapSize = this.camera.getMapS();
            var v1 = mapSize.width <= this.maxDisplayedSize.width;
            var v2 = mapSize.height <= this.maxDisplayedSize.height;
            var v3 = mapSize.width > this.minDisplayedSize.width;
            var v4 = mapSize.height > this.minDisplayedSize.height;
            this.isShown = v1 && v2 && v3 && v4;

            if (last !== this.isShown) {
              if (this.isShown) {
                this.view.show();
              } else {
                this.view.hide();
              }

              if (!this.isShown) {
                this.cancelLoadingOfTiles();
              }
            }
          };

          _proto34.action = function action(position, scale) {
            this.globalPosition.x = position.x;
            this.globalPosition.y = position.y;
            this.globalScale.x = scale.x;
            this.globalScale.y = scale.y;
            this.camera.action(this.globalPosition, this.globalScale);

            if (this.camera.getMapS().width > this.mSize.width || this.camera.getMapS().height > this.mSize.height) {
              this.camera.setMapS(this.mSize.width, this.mSize.height);
            }

            this.checkSize();
            this.append();
            this.draw();
            /* start-removable-tile-helper-block */

            if (zoomHelper) {
              zoomHelper.setData({
                level: this.id,
                levelStatus: this.isShown
              });
            }
            /* end-removable-tile-helper-block */

          };

          _proto34.loadImages = function loadImages() {
            if (this.isShown && this.loadedTiles !== this.countOfTiles) {
              this.eachTile(function (tile) {
                tile.load();
              });
            }
          };

          _proto34.setLensSize = function setLensSize(width, height) {
            this.view.setCanvasSize(width, height);
          };

          _proto34.resize = function resize(cameraSize) {
            this.setLensSize(cameraSize.width, cameraSize.height);
            this.camera.resize(cameraSize);
            this.action(this.globalPosition, this.globalScale);
          };

          _proto34.destroy = function destroy() {
            this.off('getTile');
            this.off('zoomCancelLoadingOfTiles');
            this.isShown = false;
            this.camera.destroy();
            this.tiles.forEach(function (row) {
              row.forEach(function (tile) {
                tile.destroy();
              });
            });

            _EventEmitter8.prototype.destroy.call(this);
          };

          return Level;
        }(EventEmitter);
        /* eslint-env es6 */

        /* global Level */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars


        var ZoomView = /*#__PURE__*/function () {
          "use strict";

          function ZoomView(parentNode, classPrefix) {
            this.p = $(parentNode); // container

            this.c = $J.$new('div');
            this.c.addClass(classPrefix + '-deepzoom');
          }

          var _proto35 = ZoomView.prototype;

          _proto35.getContainer = function getContainer() {
            return this.c;
          };

          _proto35.show = function show() {
            this.p.append(this.c);
          };

          _proto35.hide = function hide() {
            this.c.remove();
          };

          _proto35.destroy = function destroy() {
            this.c.remove();
            this.c = null;
          };

          return ZoomView;
        }();
        /* eslint-env es6 */

        /* global Level, getPercentValue, zoomHelper, EventEmitter, helper, LevelView, calcScale, getLevels */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars


        var ZoomController = /*#__PURE__*/function (_EventEmitter9) {
          "use strict";

          bHelpers.inheritsLoose(ZoomController, _EventEmitter9);

          function ZoomController(view, options) {
            var _this69;

            _this69 = _EventEmitter9.call(this) || this;
            _this69.view = view;
            _this69.options = $J.extend({
              tiles: true,
              inner: true,
              tileSize: {
                width: 256,
                height: 256
              },
              minZoomFactor: 100,
              // px
              upscale: false
            }, options);
            _this69.hash = null;

            _this69.setDefaultVars();

            return _this69;
          }

          ZoomController.convertScaleToSize = function convertScaleToSize(size, scale) {
            return {
              width: helper.round(size.width * scale.x, 2),
              height: helper.round(size.height * scale.y, 2)
            };
          };

          var _proto36 = ZoomController.prototype;

          _proto36.setHash = function setHash(url) {
            // this.hash = '' + $J.getHashCode(url.split('?')[0]);
            this.hash = '' + $J.getHashCode(url);
          } // private
          ;

          _proto36.setDefaultVars = function setDefaultVars() {
            var _this70 = this;

            this.isShown = false;
            this.originSize = {
              width: 0,
              height: 0
            };
            this.maxSize = {
              width: 0,
              height: 0
            };
            this.minSize = {
              width: 0,
              height: 0
            };
            this.lensSize = {
              width: 0,
              height: 0
            };
            this.currentSize = {
              width: 0,
              height: 0
            };
            this.levels = $([]);
            this.on('getTile', function (e) {
              if (!_this70.options.tiles) {
                delete e.data.imageSettings.tile;
                delete e.data.number;
              }
            });
          } // private
          ;

          _proto36.createLevels = function createLevels() {
            var calcTileImageSize = function (value, dppx) {
              return dppx < 1.5 ? value : value * $J.DPPX;
            };

            var maxSize = this.maxSize;
            var minSize = this.minSize;

            if (!this.levels.length && maxSize.width - minSize.width > this.options.minZoomFactor) {
              var arr = [];

              if (this.options.inner) {
                arr = getLevels(minSize, maxSize, this.options.inner);
              } else {
                arr.push({
                  width: maxSize.width,
                  height: maxSize.height
                });
              }

              var tileSize = this.options.tileSize;

              for (var i = 0, l = arr.length; i < l; i++) {
                if (!this.options.tiles) {
                  tileSize = arr[i];
                }

                var _minSize = i + 1 < l - 1 ? arr[i + 1] : minSize;

                var _maxSize = i - 1 >= 0 ? arr[i - 1] : maxSize;

                var dppx = helper.getDPPX(arr[i].width, this.originSize.width, this.options.upscale);
                var levelView = new LevelView(this.view.getContainer(), dppx);

                var _level = new Level(levelView, {
                  id: l - i,
                  hash: this.hash,
                  dppx: dppx,
                  inner: this.options.inner,
                  width: arr[i].width,
                  height: arr[i].height,
                  maxWidth: this.maxSize.width,
                  maxHeight: this.maxSize.height,
                  layerWidth: Math.round(arr[i].width * dppx),
                  layerHeight: Math.round(arr[i].height * dppx),
                  maxDisplayedWidth: arr[i].width + getPercentValue(_maxSize.width - arr[i].width, 50),
                  maxDisplayedHeight: arr[i].height + getPercentValue(_maxSize.height - arr[i].height, 50),
                  minDisplayedWidth: _minSize.width + getPercentValue(arr[i].width - _minSize.width, 50),
                  minDisplayedHeight: _minSize.height + getPercentValue(arr[i].height - _minSize.height, 50),
                  tileWidth: tileSize.width,
                  tileHeight: tileSize.height,
                  tileImageWidth: calcTileImageSize(tileSize.width, dppx),
                  tileImageHeight: calcTileImageSize(tileSize.height, dppx),
                  viewPortWidth: this.lensSize.width,
                  viewPortHeight: this.lensSize.height
                });

                _level.setParent(this);

                this.levels.push({
                  view: levelView,
                  controller: _level
                });
              }

              this.levels.reverse();
            }
          };

          _proto36.getCurrentShownLevel = function getCurrentShownLevel() {
            var result = null;
            var l = this.levels.length;

            if (this.isShown) {
              for (var i = l - 1; i >= 0; i--) {
                if (this.levels[i].controller.isShown) {
                  result = this.levels[i].controller;
                  break;
                }
              }
            }

            return result;
          };

          _proto36.getScale = function getScale(direction) {
            var level = this.getCurrentShownLevel();
            var scale;
            var l = this.levels.length;

            switch (direction) {
              case 'zoomin':
                if (level) {
                  if (this.currentSize.width < level.size.width) {
                    scale = calcScale(this.maxSize.width, level.size.width);
                  } else if (level.id !== l) {
                    scale = calcScale(this.maxSize.width, this.levels[level.id].controller.size.width);
                  } else {
                    scale = calcScale(this.maxSize.width, this.levels[l - 1].controller.size.width);
                  }
                } else {
                  scale = calcScale(this.maxSize.width, this.levels[0].controller.size.width);
                }

                break;

              case 'zoomout':
                if (level) {
                  if (this.currentSize.width > level.size.width) {
                    scale = calcScale(this.maxSize.width, level.size.width);
                  } else if (level.id > 1) {
                    scale = calcScale(this.maxSize.width, this.levels[level.id - 2].controller.size.width);
                  } else {
                    scale = calcScale(this.maxSize.width, this.minSize.width);
                  }
                } else {
                  scale = calcScale(this.maxSize.width, this.minSize.width);
                }

                break;
              // no default
            }

            return scale;
          };

          _proto36.show = function show() {
            if (!this.isShown) {
              this.isShown = true;
              this.view.show();
            }

            return this;
          };

          _proto36.hide = function hide() {
            if (this.isShown) {
              this.isShown = false;
              this.view.hide();
              this.levels.forEach(function (level) {
                level.view.destroy();
                level.controller.destroy();
              });
              this.setDefaultVars();
            }

            return this;
          };

          _proto36.action = function action(position, scale) {
            if (this.isShown) {
              this.currentSize = ZoomController.convertScaleToSize(this.maxSize, scale);
              this.levels.forEach(function (level) {
                level.controller.action(position, scale);
              });
              /* start-removable-tile-helper-block */

              if (zoomHelper) {
                zoomHelper.setData({
                  zoom: helper.round(this.currentSize.width / this.minSize.width, 1, this.currentSize.width === this.maxSize.width)
                });
              }
              /* end-removable-tile-helper-block */

            }

            return this;
          };

          _proto36.setLensSize = function setLensSize(width, height) {
            this.lensSize.width = width;
            this.lensSize.height = height;
            return this;
          };

          _proto36.setMinSize = function setMinSize(width, height) {
            this.minSize.width = width;
            this.minSize.height = height;
            return this;
          };

          _proto36.setMaxSize = function setMaxSize(width, height, originWidth, originHeight) {
            this.maxSize.width = width;
            this.maxSize.height = height;
            this.originSize.width = originWidth;
            this.originSize.height = originHeight;
            this.createLevels();
            return this;
          };

          _proto36.loadImages = function loadImages() {
            if (this.isShown) {
              this.levels.forEach(function (level) {
                level.controller.loadImages();
              });
            }

            return this;
          };

          _proto36.setImage = function setImage(data) {
            if (this.isShown) {
              this.levels[data.level - 1].controller.setImage(data);
            }

            return this;
          };

          _proto36.resize = function resize() {
            var _this71 = this;

            if (this.isShown) {
              this.levels.forEach(function (level) {
                level.controller.resize(_this71.lensSize);
              });
            }

            return this;
          };

          _proto36.destroy = function destroy() {
            this.hide();
            this.off('getTile');
            this.off('zoomCancelLoadingOfTiles');

            _EventEmitter9.prototype.destroy.call(this);
          };

          return ZoomController;
        }(EventEmitter);
        /* eslint-env es6 */

        /* global EventEmitter */

        /* global ZoomView */

        /* global ZoomController */

        /* eslint-disable indent */

        /* eslint-disable no-lonely-if */

        /* eslint no-unused-vars: ["error", { "args": "none" }] */

        /* eslint guard-for-in: "off"*/

        /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars


        var DZoom = /*#__PURE__*/function (_EventEmitter10) {
          "use strict";

          bHelpers.inheritsLoose(DZoom, _EventEmitter10);

          function DZoom(parentNode, options) {
            var _this72;

            _this72 = _EventEmitter10.call(this) || this;
            _this72.view = new ZoomView(parentNode, 'sirv');
            _this72.controller = new ZoomController(_this72.view, options);

            _this72.controller.setParent(bHelpers.assertThisInitialized(_this72));

            return _this72;
          }

          var _proto37 = DZoom.prototype;

          _proto37.setLensSize = function setLensSize(width, height) {
            this.controller.setLensSize(width, height);
            return this;
          };

          _proto37.loadImages = function loadImages() {
            this.controller.loadImages();
            return this;
          };

          _proto37.getScale = function getScale(direction) {
            return this.controller.getScale(direction);
          };

          _proto37.setImage = function setImage(data) {
            this.controller.setImage(data);
            return this;
          };

          _proto37.setHash = function setHash(hash) {
            this.controller.setHash(hash);
            return this;
          };

          _proto37.setMinSize = function setMinSize(width, height) {
            this.controller.setMinSize(width, height);
            return this;
          };

          _proto37.setMaxSize = function setMaxSize(width, height, originWidth, originHeight) {
            this.controller.setMaxSize(width, height, originWidth, originHeight);
            return this;
          };

          _proto37.show = function show() {
            this.controller.show();
            return this;
          };

          _proto37.hide = function hide() {
            this.controller.hide();
            return this;
          };

          _proto37.action = function action(imageDPosition, dScale) {
            this.controller.action(imageDPosition, dScale);
            return this;
          };

          _proto37.resize = function resize() {
            this.controller.resize();
            return this;
          };

          _proto37.destroy = function destroy() {
            this.controller.destroy();
            this.controller = null;
            this.view.destroy();
            this.view = null;

            _EventEmitter10.prototype.destroy.call(this);
          };

          return DZoom;
        }(EventEmitter);

        return DZoom;
      }();

      var Eye = function () {
        /* eslint-env es6 */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars
        var View = /*#__PURE__*/function () {
          "use strict";

          function View(parent, hover) {
            this.pn = $(parent);
            var className = 'sirv-zoom-lens'; // container

            this.c = $J.$new('div');
            this.c.addClass(className + '-wrapper'); // insideContainer

            this.ic = $J.$new('div');
            this.ic.addClass(className);
            this.ic.appendTo(this.c);
            this.img = null; // blackAndWhiteImg

            this.bwImg = null;

            if (hover) {
              this.c.addEvent('mousedown', function (e) {
                e.stop();
              });
            }
          }

          var _proto38 = View.prototype;

          _proto38.setContainerPosition = function setContainerPosition() {
            if ($J.contains(['img', 'canvas'], this.pn.getTagName())) {
              var positon = this.pn.getPosition();
              var parentPosition = $(this.pn.node.parentNode).getPosition();
              this.c.setCss({
                top: positon.top - parentPosition.top,
                left: positon.left - parentPosition.left
              });
            }
          };

          _proto38.setImageSize = function setImageSize(size) {
            if (this.img) {
              // this.bwImg = $(this.img.cloneNode());
              // this.bwImg.addClass('sirv-filter-bw');
              [this.img, this.bwImg].forEach(function (img) {
                if (img) {
                  img.setCss({
                    top: 0,
                    left: 0,
                    width: size.width,
                    height: size.height,
                    position: 'absolute'
                  });
                }
              });
            }
          };

          _proto38.getContainerSize = function getContainerSize() {
            return this.pn.getSize(); // return {
            //     width: 132,
            //     height: 200
            // };
          };

          _proto38.setContainerSize = function setContainerSize(size) {
            this.c.setCss({
              width: size.width,
              height: size.height
            });
          };

          _proto38.setInsideContainerSize = function setInsideContainerSize(size) {
            this.ic.setCss({
              width: size.width,
              height: size.height
            });
          };

          _proto38.setInsideContainerFontSize = function setInsideContainerFontSize(size) {
            this.ic.setCssProp('font-size', Math.max(size.width, size.height) + 'px');
          };

          _proto38.setTransform = function setTransform(x, y) {
            this.ic.setCssProp('transform', 'translate3d(' + x + 'px,' + y + 'px, 0px)');

            if (this.img) {
              this.img.setCssProp('transform', 'translate3d(' + x * -1 + 'px, ' + y * -1 + 'px, 0px)');
            }
          };

          _proto38.show = function show(img, size) {
            if (img) {
              this.img = $(img);
            }

            this.setContainerPosition();
            this.setImageSize(size);

            if (this.img) {
              this.ic.append(this.img); // this.pn.append(this.bwImg);
            }

            var container = this.pn;

            if ($J.contains(['img', 'canvas'], container.getTagName())) {
              container = $(container.node.parentNode);
            }

            container.append(this.c);
          };

          _proto38.hide = function hide() {
            this.c.remove();

            if (this.img) {
              this.img.remove();
              this.img = null;

              if (this.bwImg) {
                this.bwImg.remove();
                this.bwImg = null;
              }
            }
          };

          _proto38.destroy = function destroy() {
            this.c.removeEvent('mousedown');
            this.c.remove();
          };

          return View;
        }();
        /* eslint-env es6 */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


        var difference = function (a, b) {
          return Math.abs(a - b);
        };

        var getAnimationValue = function (a, b, step) {
          return (a - b) * step;
        }; // eslint-disable-next-line no-unused-vars


        var Controller = /*#__PURE__*/function () {
          "use strict";

          function Controller(view) {
            this.view = view; // parentSize

            this.pSize = {
              width: 0,
              height: 0
            };
            this.inDoc = false;
            this.timer = null;
            this.isPlaying = false;
            this.pos = {
              x: null,
              y: null
            };
            this.dPos = {
              x: null,
              y: null
            };
            this.size = {
              width: 0,
              height: 0
            };
            this.dSize = {
              width: 0,
              height: 0
            };
          } // private


          var _proto39 = Controller.prototype;

          _proto39.doAnimation = function doAnimation() {
            var result = false;
            var minSize = 0.001;

            if (difference(this.pos.x, this.dPos.x) > minSize || difference(this.pos.y, this.dPos.y) > minSize || difference(this.size.width, this.dSize.width) > minSize || difference(this.size.height, this.dSize.height) > minSize) {
              result = true;
            }

            return result;
          } // private
          ;

          _proto39.animate = function animate() {
            var _this73 = this;

            this.isPlaying = true;
            var step = 0.4;
            var dx = getAnimationValue(this.pos.x, this.dPos.x, step);
            var dy = getAnimationValue(this.pos.y, this.dPos.y, step);
            var dw = getAnimationValue(this.size.width, this.dSize.width, step);
            var dh = getAnimationValue(this.size.height, this.dSize.height, step);
            this.dPos.x += dx;
            this.dPos.y += dy;
            this.dSize.width += dw;
            this.dSize.height += dh;
            this.setCss();

            if (this.doAnimation()) {
              this.timer = setTimeout(function () {
                _this73.animate();
              }, 16);
            } else {
              this.stopAnimation();
            }
          } // private
          ;

          _proto39.setCss = function setCss() {
            var s = this.size;
            var ds = this.dSize;

            if (difference(s.width, ds.width) > 0 || difference(s.height, ds.height) > 0) {
              this.view.setInsideContainerSize(ds);
              this.view.setInsideContainerFontSize(this.pSize);
            }

            this.view.setTransform(Math.round(this.dPos.x), Math.round(this.dPos.y));
          } // private
          ;

          _proto39.stopAnimation = function stopAnimation() {
            if (this.isPlaying) {
              this.isPlaying = false;
              clearTimeout(this.timer);
              this.dPos.x = this.pos.x;
              this.dPos.y = this.pos.y;
              this.dSize.width = this.size.width;
              this.dSize.height = this.size.height;
              this.setCss();
            }
          };

          _proto39.setSize = function setSize(size) {
            this.size.width = size.width;
            this.size.height = size.height;

            if (this.inDoc && this.dPos.x !== null) {
              if (!this.isPlaying) {
                this.animate();
              }
            }
          };

          _proto39.setPosition = function setPosition(x, y) {
            var s = this.size;
            var ps = this.pSize;

            var _x = x - s.width / 2;

            var _y = y - s.height / 2;

            if (_x < 0) {
              _x = 0;
            }

            if (_y < 0) {
              _y = 0;
            }

            if (_x > ps.width - s.width) {
              _x = ps.width - s.width;
            }

            if (_y > ps.height - s.height) {
              _y = ps.height - s.height;
            }

            this.pos.x = _x;
            this.pos.y = _y;

            if (this.dPos.x === null) {
              this.dPos.x = _x;
              this.dPos.y = _y;
            }

            if (this.inDoc) {
              if (!this.isPlaying) {
                this.animate();
              }
            }
          } // private
          ;

          _proto39.setContainerSize = function setContainerSize() {
            var ps = this.view.getContainerSize();
            this.pSize = ps;
            this.view.setContainerSize(ps);
            this.view.setInsideContainerFontSize(ps);
          };

          _proto39.show = function show(img) {
            if (!this.inDoc) {
              this.inDoc = true;
              this.setContainerSize();
              this.view.show(img, this.pSize);
            }
          };

          _proto39.hide = function hide() {
            if (this.inDoc) {
              this.inDoc = false;
              this.view.hide();
              this.pos = {
                x: null,
                y: null
              };
              this.dPos = {
                x: null,
                y: null
              };
              this.size = {
                width: 0,
                height: 0
              };
              this.dSize = {
                width: 0,
                height: 0
              };
            }
          };

          _proto39.resize = function resize() {
            if (this.inDoc) {
              this.setContainerSize();
              this.view.setContainerPosition();
            }
          };

          _proto39.destroy = function destroy() {
            this.stopAnimation();
            this.inDoc = false;
          };

          return Controller;
        }();
        /* eslint-env es6 */

        /* global View */

        /* global Controller */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars


        var _Eye = /*#__PURE__*/function () {
          "use strict";

          function _Eye(prentNode, hover) {
            this.view = new View(prentNode, hover);
            this.controller = new Controller(this.view);
          }

          var _proto40 = _Eye.prototype;

          _proto40.setEventToMainContainer = function setEventToMainContainer(name, callback) {
            this.view.c.addEvent(name, callback);
          };

          _proto40.removeEventToMainContainer = function removeEventToMainContainer(name, callback) {
            if (callback) {
              this.view.c.removeEvent(name, callback);
            } else {
              this.view.c.removeEvent(name);
            }
          };

          _proto40.clearEvents = function clearEvents() {
            this.view.c.clearEvents();
          };

          _proto40.getBoundaries = function getBoundaries() {
            return this.view.c.node.getBoundingClientRect();
          };

          _proto40.show = function show(img) {
            this.controller.show(img);
          };

          _proto40.hide = function hide() {
            this.controller.hide();
          };

          _proto40.setSize = function setSize(size) {
            this.controller.setSize(size);
          };

          _proto40.setPosition = function setPosition(x, y) {
            this.controller.setPosition(x, y);
          };

          _proto40.destroy = function destroy() {
            this.controller.destroy();
            this.view.destroy();
          };

          return _Eye;
        }();

        return _Eye;
      }();

      var ZoomMap = function () {
        /* eslint-env es6 */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars
        var View = /*#__PURE__*/function () {
          "use strict";

          function View(parent) {
            this.p = $(parent);
            var className = 'sirv-zoom-map'; // container

            this.c = $J.$new('div');
            this.c.addClass(className);
            this.lens = $J.$new('div');
            this.lens.addClass(className + '-lens');
            this.img = null;
            this.b = $($J.D.node.body);
            this.c.append(this.lens);
          }

          var _proto41 = View.prototype;

          _proto41.getRightPosition = function getRightPosition(x, y) {
            var rect = this.c.getRect();
            return {
              x: x - rect.left,
              y: y - rect.top
            };
          };

          _proto41.addDomEventToDocBody = function addDomEventToDocBody(eventName, callback) {
            this.b.addEvent(eventName, callback);
          };

          _proto41.removeDomEventToDocBody = function removeDomEventToDocBody(eventName, callback) {
            this.b.removeEvent(eventName, callback);
          };

          _proto41.addDomEventToLens = function addDomEventToLens(eventName, callback) {
            this.lens.addEvent(eventName, callback);
          };

          _proto41.addDomEvent = function addDomEvent(eventName, callback) {
            this.c.addEvent(eventName, callback);
          };

          _proto41.changeCursor = function changeCursor(value) {
            this.c.setCssProp('cursor', value);
          };

          _proto41.removeEvents = function removeEvents() {
            this.c.removeEvent('btnclick tap');
            this.c.removeEvent('mousedown touchstart');
            this.lens.removeEvent('mousedown touchstart');
            this.c.removeEvent('mousemove touchmove');
          };

          _proto41.setContainerCss = function setContainerCss(size) {
            this.c.setCss({
              width: size.width + 'px',
              height: size.height + 'px'
            });
          };

          _proto41.setLensCss = function setLensCss(lensPosition, lensSize, containerSize) {
            this.lens.setCss({
              top: lensPosition.top - 1 + 'px',
              left: lensPosition.left - 1 + 'px',
              width: lensSize.width + 'px',
              height: lensSize.height + 'px',
              'font-size': containerSize + 'px'
            });
          };

          _proto41.setImg = function setImg(src, srcset) {
            this.img = $J.$new('img', {
              'src': src
            });

            if (srcset) {
              this.img.attr('srcset', srcset + ' 2x');
            }

            this.c.append(this.img);
          } // private
          ;

          _proto41.removeEventTransitionEvent = function removeEventTransitionEvent() {
            this.c.removeEvent('transitionend');
          };

          _proto41.show = function show(callback) {
            var _this74 = this;

            this.c.setCss({
              opacity: 0,
              transition: 'opacity .3s linear'
            });
            this.p.append(this.c);
            this.c.getSize(); // render

            this.removeEventTransitionEvent();
            this.c.addEvent('transitionend', function (e) {
              e.stop();

              _this74.removeEventTransitionEvent();

              _this74.c.setCssProp('transition', '');

              _this74.addDomEvent('mousedown touchstart', function (_e) {
                _e.stop();
              });

              callback();
            });
            this.c.setCssProp('opacity', 1);
          };

          _proto41.hide = function hide(force, callback) {
            var _this75 = this;

            this.removeEventTransitionEvent();

            if (!force) {
              this.c.addEvent('transitionend', function (e) {
                e.stop();

                _this75._removeEventTransitionEvent();

                _this75.c.setCssProp('transition', '');

                _this75.c.remove();

                _this75.removeEvents();

                callback();
              });
            } else {
              this.c.remove();
              this.removeEvents();
              callback();
            }

            this.c.setCssProp('opacity', 0);
          };

          _proto41.destroy = function destroy() {
            this.c = null;
            this.lens = null;
          };

          return View;
        }();
        /* eslint-env es6 */

        /* global getPercent */

        /* global EventEmitter */

        /* global helper */

        /* global getPercentValue */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


        var getOffset = function (e) {
          var rect;
          var result = {
            x: 0,
            y: 0
          };
          var oe = e.getOriginEvent();

          if ($J.defined(oe.offsetX)) {
            result.x = oe.offsetX;
            result.y = oe.offsetY;
          } else {
            // rect = e.getTarget().getBoundingClientRect();
            rect = $(e.getTarget()).getPosition();
            result.x = oe.targetTouches[0].pageX - rect.left;
            result.y = oe.targetTouches[0].pageY - rect.top;
          }

          return result;
        };

        var betweenMinMax = function (value, min, max) {
          if (!$J.defined(min)) {
            min = 0;
          }

          if (!$J.defined(max)) {
            max = 100;
          }

          return Math.min(Math.max(value, min), max);
        }; // eslint-disable-next-line no-unused-vars


        var Controller = /*#__PURE__*/function (_EventEmitter11) {
          "use strict";

          bHelpers.inheritsLoose(Controller, _EventEmitter11);

          function Controller(view, options) {
            var _this76;

            _this76 = _EventEmitter11.call(this) || this;
            _this76.view = view;
            _this76.o = options;
            _this76.state = globalVariables.APPEARANCE.HIDDEN;
            _this76.scale = {
              x: 1,
              y: 1
            };
            _this76.viewPortSize = {
              width: 0,
              height: 0
            }; // bigImageSize

            _this76.bISize = {
              width: 0,
              height: 0
            }; // currentBigImageSize

            _this76.cBISize = {
              width: 0,
              height: 0
            }; // currentBigImagePosition

            _this76.cBIPosition = {
              top: 0,
              left: 0
            }; // currentMapContainerSize

            _this76.mapSize = {
              width: 0,
              height: 0
            }; // lensSize

            _this76.ls = {
              width: 0,
              height: 0
            }; // lensPosition

            _this76.lp = {
              top: 0,
              left: 0
            }; // correctLensPosition

            _this76.clp = {
              x: 0,
              y: 0
            };
            _this76.isDragMoved = false;
            return _this76;
          } // convert current percent to the center percent of map eye


          Controller.setInTheCenter = function setInTheCenter(value) {
            if (value < 50) {
              value = Math.max(value - (50 - value), 0);
            } else if (value > 50) {
              value = Math.min(value + (value - 50), 100);
            }

            return value;
          } // private
          ;

          var _proto42 = Controller.prototype;

          _proto42.getPercentPosition = function getPercentPosition(x, y) {
            var cms = this.mapSize;
            var pos = this.view.getRightPosition(x, y);
            x = betweenMinMax(helper.round(getPercent(pos.x, cms.width), 1));
            y = betweenMinMax(helper.round(getPercent(pos.y, cms.height), 1));
            return {
              x: x,
              y: y
            };
          } // private
          ;

          _proto42.isInside = function isInside(x, y) {
            var result = false;
            var lp = this.lp;
            var ls = this.ls;
            var pos = this.view.getRightPosition(x, y);

            if (lp.left < pos.x && lp.left + ls.width > pos.x && lp.top < pos.y && lp.top + ls.height > pos.y) {
              result = true;
            }

            return result;
          } // private
          ;

          _proto42.setEvents = function setEvents() {
            var _this77 = this;

            var count = 1;
            var isDragMoved = false;

            this.dragEndHandler = function (e) {
              if (isDragMoved) {
                e.stop();
                isDragMoved = false;
                _this77.clp = {
                  x: 0,
                  y: 0
                };

                _this77.view.changeCursor('');

                _this77.view.removeDomEventToDocBody(e.type, _this77.dragEndHandler);

                _this77.view.removeDomEventToDocBody('mouseout', _this77.mouseOutHandler);
              }
            };

            this.mouseOutHandler = function (event) {
              event.stop();

              if ((!event.oe.relatedTarget || event.oe.relatedTarget.tagName === 'HTML') && isDragMoved) {
                _this77.dragEndHandler(event);

                _this77.view.removeDomEventToDocBody('mouseup touchend', _this77.dragEndHandler);
              }
            };

            this.view.addDomEvent('btnclick tap', function (e) {
              e.stop(); // this.emit('zoomMapNewPosition', { data: this.getPercentPosition(e.x - this.ls.width / 2, e.y - this.ls.height / 2) });

              _this77.emit('zoomMapNewPosition', {
                data: _this77.getPercentPosition(e.x, e.y)
              });
            });
            this.view.addDomEventToLens('mousedown touchstart', function (e) {
              var pageXY = e.getPageXY();

              if (_this77.isInside(pageXY.x, pageXY.y)) {
                e.stop();
                count = 1;
                var offset = getOffset(e);
                _this77.clp.y = offset.y;
                _this77.clp.x = offset.x;
                isDragMoved = true;

                _this77.view.addDomEventToDocBody('mouseup touchend', _this77.dragEndHandler);

                _this77.view.addDomEventToDocBody('mouseout', _this77.mouseOutHandler);
              }
            });
            this.view.addDomEvent('mousemove touchmove', function (e) {
              if (isDragMoved) {
                if (count <= 0) {
                  e.stop();
                  var pageXY = e.getPageXY();

                  _this77.view.changeCursor('move'); // this.emit('zoomMapNewPosition', { data: this.getPercentPosition(pageXY.x - this.clp.x, pageXY.y - this.clp.y) });


                  _this77.emit('zoomMapNewPosition', {
                    data: _this77.getPercentPosition(pageXY.x, pageXY.y)
                  });
                }

                count--;
              }
            });
          } // private
          ;

          _proto42.calcMap = function calcMap(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight) {
            var cWidth = this.o.maxwidth;
            var cHeight = this.o.maxheight;

            if (zoomContainerWidth <= cWidth) {
              cWidth = zoomContainerWidth / 2;
              cHeight = cWidth * (imgHeight / imgWidth);
            }

            if (zoomContainerHeight <= cHeight) {
              cHeight = zoomContainerHeight / 2;
              cWidth = cHeight * (imgWidth / imgHeight);
            }

            if (cWidth / cHeight > imgWidth / imgHeight) {
              cWidth = cHeight * (imgWidth / imgHeight);
            } else {
              cHeight = cWidth * (imgHeight / imgWidth);
            }

            cWidth = parseInt(cWidth, 10);
            cHeight = parseInt(cHeight, 10);
            this.mapSize.width = cWidth;
            this.mapSize.height = cHeight;
            this.viewPortSize.width = zoomContainerWidth;
            this.viewPortSize.height = zoomContainerHeight;
            this.bISize.width = imgWidth;
            this.bISize.height = imgHeight;
          };

          _proto42.prepare = function prepare(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight) {
            this.calcMap(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight);
            this.view.setContainerCss(this.mapSize);
            this.emit('zoomGetImage', {
              data: {
                width: this.mapSize.width,
                height: this.mapSize.height
              }
            });
          };

          _proto42.setLensPosition = function setLensPosition(bigImageTop, bigImageLeft) {
            var top;
            var left;
            var bis = this.cBISize;
            var ms = this.mapSize;
            top = ms.height / bis.height * bigImageTop;
            left = ms.width / bis.width * bigImageLeft;
            this.cBIPosition.top = bigImageTop;
            this.cBIPosition.left = bigImageLeft;

            if (top < 0) {
              top = 0;
            }

            if (left < 0) {
              left = 0;
            }

            var ls = this.ls;

            if (top + ls.height > ms.height) {
              top = ms.height - ls.height;
            }

            if (left + ls.width > ms.width) {
              left = ms.width - ls.width;
            }

            this.lp.top = top;
            this.lp.left = left;
          };

          _proto42.setLensSize = function setLensSize(width, height) {
            this.cBISize.width = width;
            this.cBISize.height = height;
            var cm = this.mapSize;
            var vp = this.viewPortSize;
            this.ls.width = vp.width >= width ? cm.width : vp.width / width * cm.width;
            this.ls.height = vp.height >= height ? cm.height : vp.height / height * cm.height;
          };

          _proto42.move = function move(imgPos, scale) {
            var bis = this.bISize;
            var imgWidth = bis.width * scale.x;
            var imgHeight = bis.height * scale.y;
            var imgTop = Math.abs(imgPos.y + (bis.height - imgHeight) / 2);
            var imgLeft = Math.abs(imgPos.x + (bis.width - imgWidth) / 2);
            this.scale.x = scale.x;
            this.scale.y = scale.y;
            this.setLensSize(imgWidth, imgHeight);
            this.setLensPosition(imgTop, imgLeft);
            this.view.setLensCss(this.lp, this.ls, Math.max(this.mapSize.width, this.mapSize.height));
          };

          _proto42.show = function show() {
            var _this78 = this;

            if ($J.contains([globalVariables.APPEARANCE.SHOWING, globalVariables.APPEARANCE.SHOWN], this.state)) {
              return;
            }

            this.state = globalVariables.APPEARANCE.SHOWING;
            this.view.show(function () {
              _this78.setEvents();

              _this78.state = globalVariables.APPEARANCE.SHOWN;
            });
          };

          _proto42.hide = function hide(force) {
            var _this79 = this;

            if ($J.contains([globalVariables.APPEARANCE.HIDDEN, globalVariables.APPEARANCE.HIDING], this.state) && !force) {
              return;
            }

            this.state = globalVariables.APPEARANCE.HIDING;
            this.view.hide(force, function () {
              _this79.view.removeDomEventToDocBody('mouseup touchend', _this79.dragEndHandler);

              _this79.state = globalVariables.APPEARANCE.HIDDEN;
            });
          };

          _proto42.resize = function resize(maxWidth, maxHeight, imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight) {
            this.o.maxwidth = maxWidth;
            this.o.maxheight = maxHeight;
            this.calcMap(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight);
            this.view.setContainerCss(this.mapSize);
          };

          _proto42.destroy = function destroy() {
            this.hide(true);

            _EventEmitter11.prototype.destroy.call(this);
          };

          return Controller;
        }(EventEmitter);
        /* eslint-env es6 */

        /* global EventEmitter */

        /* global View */

        /* global Controller */

        /* eslint-disable indent */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
        // eslint-disable-next-line no-unused-vars


        var _ZoomMap = /*#__PURE__*/function (_EventEmitter12) {
          "use strict";

          bHelpers.inheritsLoose(_ZoomMap, _EventEmitter12);

          function _ZoomMap(parent, options) {
            var _this80;

            _this80 = _EventEmitter12.call(this) || this;
            _this80.options = $J.extend({
              maxwidth: 200,
              maxheight: 200
            }, options || {});
            _this80.view = new View(parent);
            _this80.controller = new Controller(_this80.view, _this80.options);

            _this80.controller.setParent(bHelpers.assertThisInitialized(_this80));

            return _this80;
          }

          var _proto43 = _ZoomMap.prototype;

          _proto43.prepare = function prepare(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight) {
            this.controller.prepare(imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight);
          };

          _proto43.move = function move(imgPos, scale) {
            this.controller.move(imgPos, scale);
          };

          _proto43.setImg = function setImg(src, srcset) {
            this.view.setImg(src, srcset);
          };

          _proto43.show = function show() {
            this.controller.show();
          };

          _proto43.hide = function hide(force) {
            this.controller.hide(force);
          };

          _proto43.resize = function resize(maxWidth, maxHeight, imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight) {
            this.controller.resize(maxWidth, maxHeight, imgWidth, imgHeight, zoomContainerWidth, zoomContainerHeight);
          };

          _proto43.destroy = function destroy() {
            this.controller.destroy();
            this.view.destroy();

            _EventEmitter12.prototype.destroy.call(this);
          };

          return _ZoomMap;
        }(EventEmitter);

        return _ZoomMap;
      }();
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var findZoomNode = function (el) {
        return $($(el).node.getElementsByTagName('img')[0] || $(el).node.getElementsByTagName('canvas')[0] || el);
      }; // eslint-disable-next-line no-unused-vars


      var View = /*#__PURE__*/function () {
        "use strict";

        function View(parentNode) {
          this.pn = $(parentNode);
          var className = 'sirv-zoom'; // eventsCanvasNode

          this.cnv = $J.$new('div');
          this.cnv.addClass(className);
          this.node = $J.$new('div').setCss({
            opacity: 0
          });
          this.node.addClass(className + '-wrapper');
          this.zoomWrapper = $J.$new('div').addClass('sirv-zoom-image-wrapper'); // zoomNode

          this.zoom = findZoomNode(this.pn); // lensContainer

          this.lens = $J.D.node.body;
          this.isBody = true;
          this.image = null;
          this.perspective = '';

          if ($J.browser.mobile && $J.browser.platform === 'ios') {
            // perspective much helps for ios
            this.perspective = 'perspective(1000px) ';
          }
        }

        var _proto44 = View.prototype;

        _proto44.getHash = function getHash() {
          if (this.image) {
            return this.image.$J_UUID + '' || this.image.attr('src');
          }

          return null;
        };

        _proto44.getParentSize = function getParentSize() {
          return this.pn.getSize();
        };

        _proto44.getParentPostion = function getParentPostion() {
          return this.pn.getPosition(); // Inaccurate position for mobile
        };

        _proto44.getZoomSize = function getZoomSize() {
          return this.zoom.getSize();
        };

        _proto44.getParentBoundaries = function getParentBoundaries() {
          if (this.cnv.node.parentNode) {
            return this.cnv.node.getBoundingClientRect();
          }

          return null;
        } // eslint-disable-next-line class-methods-use-this
        ;

        _proto44.addScrollEvent = function addScrollEvent(callback) {
          $J.W.addEvent('scroll', callback);
        } // eslint-disable-next-line class-methods-use-this
        ;

        _proto44.removeScrollEvent = function removeScrollEvent(callback) {
          if (callback) {
            $J.W.removeEvent('scroll', callback);
          } else {
            $J.W.removeEvent('scroll');
          }
        };

        _proto44.addClassToWrapper = function addClassToWrapper(zoomType) {
          this.node.addClass('sirv-' + zoomType + '-zoom');
        };

        _proto44.setEventToMainContainer = function setEventToMainContainer(name, callback) {
          this.cnv.addEvent(name, callback);
        };

        _proto44.removeEventFromMainContainer = function removeEventFromMainContainer() {
          for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
            args[_key5] = arguments[_key5];
          }

          this.cnv.removeEvent(args);
        };

        _proto44.setEventToWrapper = function setEventToWrapper(name, callback) {
          this.node.addEvent(name, callback);
        };

        _proto44.removeEventFromWrapper = function removeEventFromWrapper() {
          for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
            args[_key6] = arguments[_key6];
          }

          this.node.removeEvent(args);
        };

        _proto44.addMouseoutEvent = function addMouseoutEvent(callback) {
          var _this81 = this;

          this.setEventToWrapper('mouseout', function (e) {
            // let toElement = e.toElement || e.relatedTarget;
            var toElement = e.getRelated();

            if (!toElement) {
              return;
            }

            while (toElement && toElement !== _this81.node.node && toElement !== _this81.lens.node) {
              // while (toElement !== this.node && toElement !== $J.D.node.body) {
              toElement = toElement.parentNode;
            }

            if (_this81.node.node !== toElement) {
              callback(e);
            }
          });
        };

        _proto44.setLensContainer = function setLensContainer(lensContainer) {
          if (!lensContainer) {
            lensContainer = $($J.D.node.body);
          }

          this.isBody = $(lensContainer) === $($J.D.node.body);
          this.lens = $(lensContainer);
        };

        _proto44.toggleCursorClass = function toggleCursorClass(oldClass, newClass) {
          this.cnv.removeClass(oldClass).addClass(newClass);
        };

        _proto44.setImagePosition = function setImagePosition(position, scale) {
          if (this.image) {
            this.zoomWrapper.setCssProp('transform', this.perspective + 'translate3d(' + position.x + 'px, ' + position.y + 'px, 0) scale(' + scale.x + ', ' + scale.y + ')');
          }
        };

        _proto44.addStartCss = function addStartCss() {
          this.setLensStyle({
            opacity: 0,
            transform: 'scale(0)'
          });
        };

        _proto44.appendNodes = function appendNodes(smallImg, imageSize) {
          this.cnv.addEvent('contextmenu', function (e) {
            e.stopDefaults();
          });
          this.image = $(smallImg);
          this.image.setCss({
            width: imageSize.width + 'px',
            height: imageSize.height + 'px'
          });
          /*
              if tiels === false
              image sticks to mouse cursor
              just for firefox
          */

          if (!$J.browser.mobile) {
            this.image.addEvent('mousedown', function (e) {
              e.stopDefaults();
            });
          }

          this.zoomWrapper.append(this.image);
          this.node.append(this.zoomWrapper);
          this.node.appendTo(this.cnv);
          this.cnv.appendTo(this.lens, false);
        };

        _proto44.setEventNodePositionSize = function setEventNodePositionSize(pos, size) {
          var top = pos.top;
          var left = pos.left;

          if (!this.isBody) {
            var parentContainer = this.lens.getPosition();
            top -= parentContainer.top;
            left -= parentContainer.left;
          }

          this.cnv.setCss({
            top: top,
            left: left,
            width: size.width,
            height: size.height
          });
        };

        _proto44.setLensStyle = function setLensStyle(styleObj) {
          this.node.setCss(styleObj);
        };

        _proto44.setLensPosition = function setLensPosition(position) {
          this.setLensStyle({
            top: position.top,
            left: position.left
          });
        };

        _proto44.setLensSize = function setLensSize(size) {
          this.setLensStyle({
            width: size.width,
            height: size.height
          });
        };

        _proto44.setLensCss = function setLensCss(position, size, transition) {
          this.setLensPosition(position);
          this.setLensSize(size);
          this.node.setCss({
            opacity: 1,
            transform: 'scale(1)',
            // top: position.top,
            // left: position.left,
            // width: size.width,
            // height: size.height,
            transition: transition || 'none'
          });
        };

        _proto44.setImageSize = function setImageSize(position, size, scale) {
          this.zoomWrapper.setCss({
            'top': 0,
            'left': 0,
            'width': size.width + 'px',
            'height': size.height + 'px',
            'transform-origin': '50% 50%',
            'transform': this.perspective + 'translate3d(' + position.x + 'px, ' + position.y + 'px, 0) scale(' + scale.x + ', ' + scale.y + ')'
          }).getSize();
          this.image.setCss({
            width: '100%',
            height: '100%'
          }).getSize();
        };

        _proto44.clearCss = function clearCss() {
          this.node.setCss({
            transition: '',
            opacity: '',
            transform: ''
          });
          this.node.removeAttr('style');

          if (this.image) {
            this.image.setCss({
              width: '',
              height: ''
            });
          }

          this.zoomWrapper.setCss({
            top: '',
            left: '',
            width: '',
            height: '',
            transition: '',
            transform: ''
          });
        };

        _proto44.clearDOM = function clearDOM() {
          if (this.image) {
            this.image.remove();
            this.image = null;
          }

          this.zoomWrapper.remove();
          this.node.remove();
          this.cnv.remove();
        };

        _proto44.removeEvents = function removeEvents() {
          this.cnv.clearEvents(); // this.cnv.removeEvent('mouseover');

          if (this.image) {
            this.image.clearEvents();
          }

          this.node.clearEvents(); // this.node.removeEvent('mouseout');
          // this.node.removeEvent('mousemove');
          // this.node.removeEvent('btnclick');
          // this.node.removeEvent('mousescroll');
          // this.node.removeEvent('transitionend');
          // this.node.removeEvent('mousedrag');
          // this.node.removeEvent('touchdrag');
        };

        _proto44.getBoundaries = function getBoundaries() {
          return this.cnv.node.getBoundingClientRect();
        };

        _proto44.destroy = function destroy() {
          if (this.image) {
            this.image.remove();
            this.image = null;
          }

          this.zoomWrapper.remove();
          this.node.remove();
          this.cnv.remove();
        };

        return View;
      }();
      /* eslint-env es6 */

      /* global View */
      // eslint-disable-next-line no-unused-vars


      var InnerView = /*#__PURE__*/function (_View) {
        "use strict";

        bHelpers.inheritsLoose(InnerView, _View);

        function InnerView(parentNode) {
          var _this82;

          _this82 = _View.call(this, parentNode) || this;
          _this82.mouseMoveHandler = null;
          return _this82;
        }

        var _proto45 = InnerView.prototype;

        _proto45.getContainerForMap = function getContainerForMap() {
          return this.node;
        };

        _proto45.addStartCss = function addStartCss() {
          // TODO review it
          _View.prototype.addStartCss.call(this);

          this.node.addEvent('mousescroll', function (e) {
            e.stop();
          });
          this.setLensStyle({
            opacity: 0,
            transform: 'scale(1)'
          });
        };

        _proto45.removeDragstart = function removeDragstart() {
          this.node.del('event:mousedrag:dragstart'); // fix mousedrag when the lens is opening second time
        };

        _proto45.addEventsCanvasClass = function addEventsCanvasClass(className) {
          this.cnv.addClass(className);
        };

        _proto45.removeEventsCanvasClass = function removeEventsCanvasClass(className) {
          this.cnv.removeClass(className);
        };

        _proto45.getContainerSize = function getContainerSize() {
          return this.node.getSize();
        };

        _proto45.getContainerPosition = function getContainerPosition() {
          return this.node.getPosition();
        };

        _proto45.addGlobalEvent = function addGlobalEvent(callback) {
          if (!this.mouseMoveHandler) {
            this.mouseMoveHandler = callback;
            $J.D.addEvent('mousemove', callback);
          }
        };

        _proto45.removeGlobalEvent = function removeGlobalEvent() {
          if (this.mouseMoveHandler) {
            $J.D.removeEvent('mousemove', this.mouseMoveHandler);
            this.mouseMoveHandler = null;
          }
        };

        _proto45.removeEvents = function removeEvents() {
          _View.prototype.removeEvents.call(this);

          this.removeGlobalEvent();
        };

        return InnerView;
      }(View);
      /* eslint-env es6 */

      /* global View */
      // eslint-disable-next-line no-unused-vars


      var MagnifierView = /*#__PURE__*/function (_View2) {
        "use strict";

        bHelpers.inheritsLoose(MagnifierView, _View2);

        function MagnifierView() {
          return _View2.apply(this, arguments) || this;
        }

        var _proto46 = MagnifierView.prototype;

        _proto46.getParentSize = function getParentSize() {
          return this.zoom.getSize();
        };

        _proto46.getParentPostion = function getParentPostion() {
          return this.zoom.getPosition(); // Inaccurate position for mobiles
        };

        return MagnifierView;
      }(View);
      /* eslint-env es6 */

      /* global View */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars


      var OutsideView = /*#__PURE__*/function (_View3) {
        "use strict";

        bHelpers.inheritsLoose(OutsideView, _View3);

        function OutsideView() {
          return _View3.apply(this, arguments) || this;
        }

        var _proto47 = OutsideView.prototype;

        _proto47.getImageForEye = function getImageForEye() {
          return this.image.node.cloneNode();
        };

        _proto47.getNodeForEye = function getNodeForEye() {
          return this.zoom;
        };

        _proto47.setLensPosition = function setLensPosition(position) {
          this.cnv.setCss({
            top: position.top,
            left: position.left
          });
        };

        _proto47.setCanvasNodeSize = function setCanvasNodeSize(size) {
          this.cnv.setCss({
            width: size.width,
            height: size.height
          });
        };

        _proto47.addStartCss = function addStartCss(value) {
          this.setLensStyle({
            opacity: 0,
            transform: 'translate3d(' + value.start.x + '%, ' + value.start.y + '%, 0px)'
          });
        };

        _proto47.getParentSize = function getParentSize() {
          return this.zoom.getSize();
        };

        _proto47.getParentPostion = function getParentPostion() {
          return this.zoom.getPosition(); // Inaccurate position for mobiles
        };

        _proto47.setLensCss = function setLensCss(position, size, transition) {
          this.cnv.setCss({
            top: position.top,
            left: position.left
          }); // super.setLensCss({ top: 0, left: 0 }, size, transition);

          _View3.prototype.setLensCss.call(this, position, size, transition);
        };

        _proto47.addMouseMoveEvent = function addMouseMoveEvent(callback) {
          $J.W.addEvent('mousemove', callback);
        };

        _proto47.removeMouseMoveEvent = function removeMouseMoveEvent(callback) {
          $J.W.removeEvent('mousemove', callback);
        };

        _proto47.clearCss = function clearCss() {
          this.cnv.removeAttr('style');
        };

        return OutsideView;
      }(View);
      /* eslint-env es6 */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var AnimationLoop = function () {
        var STATES = {
          STOPPED: 0,
          STARTED: 1
        };

        var _Animation = /*#__PURE__*/function () {
          "use strict";

          function _Animation(callback, stopCallback) {
            this.state = STATES.STOPPED;
            this.id = null;

            this.cb = callback || function () {};

            this.stopCb = stopCallback || function () {};
          }

          var _proto48 = _Animation.prototype;

          _proto48.start = function start() {
            var _this83 = this;

            if (this.state !== STATES.STARTED) {
              this.state = STATES.STARTED;

              var step = function (lastTime) {
                _this83.cb(lastTime);

                if (_this83.state !== STATES.STOPPED) {
                  _this83.id = requestAnimationFrame(step);
                }
              };

              this.id = requestAnimationFrame(step);
            }
          };

          _proto48.stop = function stop() {
            if (this.state !== STATES.STOPPED) {
              this.state = STATES.STOPPED;
              cancelAnimationFrame(this.id);
              this.stopCb();
            }
          };

          return _Animation;
        }();

        return _Animation;
      }();
      /* eslint-env es6 */

      /* global EventEmitter */

      /* global ZoomHelper */

      /* global helper */

      /* global AnimationLoop */

      /* global getDifference */

      /* global getPercentValue */

      /* global checkRange */

      /* global CURSOR_STATES */

      /* global getPercent */

      /* global DeepZoom */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var zoomHelper = null; // TODO tmp
      // eslint-disable-next-line no-unused-vars

      var Controller = /*#__PURE__*/function (_EventEmitter13) {
        "use strict";

        bHelpers.inheritsLoose(Controller, _EventEmitter13);

        function Controller(view, o) {
          var _this84;

          _this84 = _EventEmitter13.call(this) || this;
          _this84.o = $J.extend({
            test: false,
            pan: false,
            // drag zoom
            smoothing: true,
            tiles: true,
            customZooming: true,
            clickBehavior: 'both',
            // both, up
            upscale: false,
            // upscale last level image when we have retina display
            trigger: 'hover' // hover, click, dblclick

          }, o);
          _this84.view = view;
          _this84.state = globalVariables.APPEARANCE.HIDDEN;
          _this84.x = 0;
          _this84.y = 0;
          _this84.baseScale = {
            x: 1,
            y: 1
          };
          _this84.scale = {
            x: 1,
            y: 1
          };
          _this84.dScale = {
            x: 1,
            y: 1
          }; // imageSize

          _this84.iSize = {
            width: 0,
            height: 0
          }; // imagePosition

          _this84.iPos = {
            x: 0,
            y: 0
          }; // imageDPosition

          _this84.iDPos = {
            x: 0,
            y: 0
          }; // parentPosition

          _this84.pPos = {
            top: 0,
            left: 0
          }; // parentSize

          _this84.pSize = {
            width: 0,
            height: 0
          };
          _this84.anim = null;
          _this84.animCb = null;
          _this84.animStep = 0;
          _this84.lastAnimTimer = 0;
          _this84.deepZoom = null;
          _this84.deepZoomTimer = null;
          _this84.lensSize = {
            width: 0,
            height: 0
          };
          _this84.lensHalfSize = {
            width: 0,
            height: 0
          };
          _this84.lensPosition = {
            top: 0,
            left: 0
          };
          _this84.currentLensSize = {
            width: 100,
            height: 100
          };
          _this84.dppx = 1; // just for image, not tiles

          _this84.zoomNodeSize = {
            width: 0,
            height: 0
          };
          _this84.boundaries = null;
          _this84.ANIM_STEP = 0.1;
          _this84.nonDeepZoomImageLevels = [];

          _this84.scrollHandler = function () {
            if ($J.contains([globalVariables.APPEARANCE.SHOWING, globalVariables.APPEARANCE.SHOWN], _this84.state)) {
              _this84.hide(_this84.state === globalVariables.APPEARANCE.SHOWING);
            }
          };

          return _this84;
        }

        var _proto49 = Controller.prototype;

        _proto49.init = function init() {
          this.getSizes();
          this.view.setLensCss(this.lensPosition, this.lensSize);
          this.createDeepZoom();
          this.createAnimation(this.ANIM_STEP);
          this.view.addScrollEvent(this.scrollHandler);
        } // private
        ;

        _proto49.createDeepZoom = function createDeepZoom() {
          var _this85 = this;

          this.deepZoom = new DeepZoom(this.view.node, {
            tiles: this.o.tiles,
            inner: $J.contains(['inner', 'outside'], this.o.type),
            upscale: this.o.upscale // minSize: this.pSize

          });
          this.deepZoom.setParent(this);
          this.on('getTile', function (e) {
            e.stopAll();

            _this85.emit('zoomGetImage', {
              data: e.data
            });
          });
          this.on('zoomCancelLoadingOfTiles', function (e) {
            e.stopEmptyEvent();
          });
        };

        _proto49.setLensContainer = function setLensContainer(lensContainer) {
          this.view.setLensContainer(lensContainer);
        } // private
        ;

        _proto49.getBoundaries = function getBoundaries() {
          this.boundaries = this.view.getParentBoundaries();
        } // private
        ;

        _proto49.getSizes = function getSizes() {
          this.pSize = this.view.getParentSize();
          this.pPos = this.view.getParentPostion();
          this.zoomNodeSize = this.view.getZoomSize();
          this.getBoundaries();
        };

        _proto49.isShown = function isShown() {
          return this.state === globalVariables.APPEARANCE.SHOWN;
        };

        _proto49.isShowing = function isShowing() {
          return this.state === globalVariables.APPEARANCE.SHOWING;
        } // private
        ;

        _proto49.deepZoomAction = function deepZoomAction(equals, newSize) {
          var _this86 = this;

          clearTimeout(this.deepZoomTimer);
          this.deepZoomTimer = setTimeout(function () {
            _this86.deepZoom.loadImages();

            if (newSize) {
              _this86.deepZoom.setLensSize(newSize.width, newSize.height);

              _this86.deepZoom.resize();
            }

            _this86.deepZoom.action(_this86.iDPos, _this86.dScale);

            if (!equals) {
              _this86.deepZoomAction(_this86.dScale.x === _this86.scale.x);
            }
          }, this.lastAnimTimer + 10); // must be more than fps (1000 / 60 = 16)

          if (newSize) {
            this.deepZoom.setLensSize(newSize.width, newSize.height);
            this.deepZoom.resize();
          }

          this.deepZoom.action(this.iDPos, this.dScale);
        } // private
        ;

        _proto49.stopMovingAndZooming = function stopMovingAndZooming() {
          this.scale.x = this.dScale.x;
          this.scale.y = this.dScale.y;
          this.iPos.x = this.iDPos.x;
          this.iPos.y = this.iDPos.y;
        } // private
        ;

        _proto49.createAnimation = function createAnimation(step) {
          var _this87 = this;

          var checkScale = function (sett) {
            var result = false;

            if (_this87.dScale[sett] < _this87.baseScale[sett]) {
              result = true;
              _this87.dScale[sett] = _this87.baseScale[sett];
            }

            if (_this87.dScale[sett] > 1) {
              result = true;
              _this87.dScale[sett] = 1;
            }

            return result;
          };

          this.animStep = step;
          var last = 0;
          this.anim = new AnimationLoop(function (lastTime) {
            if (!last) {
              last = lastTime;
              return;
            }

            var dx;
            var dy;
            var diffX;
            var diffY;
            var isChanged = false;
            _this87.lastAnimTimer = lastTime - last;
            last = lastTime;
            var xScaleWasClosed = false;
            var yScaleWasClosed = false;

            if (_this87.scale.x !== _this87.dScale.x) {
              isChanged = true;

              _this87.sendZoomingAction(); // this.setCursorState();


              diffX = _this87.scale.x - _this87.dScale.x; // diffY = this.scale.y - this.dScale.y;

              dx = diffX * _this87.animStep; // dy = diffY * this.animStep;

              _this87.dScale.x += dx;
              _this87.dScale.y += dx; // this.dScale.y += dy;

              xScaleWasClosed = checkScale('x');
              yScaleWasClosed = xScaleWasClosed; // yScaleWasClosed = checkScale('y');
              // if (Math.abs(diffX) < 0.0001 || Math.abs(diffY) < 0.0001) {

              if (Math.abs(diffX) < 0.0001) {
                _this87.dScale.x = _this87.scale.x; // this.dScale.y = this.scale.y;

                _this87.dScale.y = _this87.scale.x;
              }
            }

            if (_this87.iPos.x !== _this87.iDPos.x || _this87.iPos.y !== _this87.iDPos.y) {
              isChanged = true;
              diffX = _this87.iPos.x - _this87.iDPos.x;
              diffY = _this87.iPos.y - _this87.iDPos.y;
              dx = diffX * _this87.animStep;
              dy = diffY * _this87.animStep;
              _this87.iDPos.x += dx;
              _this87.iDPos.y += dy;
              _this87.iDPos.x = helper.round(_this87.iDPos.x, 4);
              _this87.iDPos.y = helper.round(_this87.iDPos.y, 4);

              if (Math.max(Math.abs(diffX), Math.abs(diffY)) < 1 || xScaleWasClosed || yScaleWasClosed) {
                _this87.iDPos.x = _this87.iPos.x;
                _this87.iDPos.y = _this87.iPos.y;
              }
            }

            if (isChanged) {
              _this87.render(_this87.iDPos, _this87.dScale);
            } else if (_this87.animCb) {
              _this87.animCb();

              _this87.animStep = step;
              _this87.animCb = null;
            }
          }, function () {
            last = 0;
          });
        };

        _proto49.render = function render(position, scale) {
          this.deepZoomAction();
          this.view.setImagePosition(position || this.iDPos, scale || this.dScale);
        } // private
        ;

        _proto49.correctX = function correctX(value) {
          return value - this.pPos.left;
        } // private
        ;

        _proto49.correctY = function correctY(value) {
          return value - this.pPos.top;
        } // private
        ;

        _proto49.setXY = function setXY(x, y) {
          this.x = this.correctX(x);
          this.y = this.correctY(y);
        };

        _proto49.getZoomData = function getZoomData(scale) {
          var result = 0;

          if (!scale) {
            scale = this.scale.x;
          }

          if (this.isShown() || this.isShowing()) {
            result = helper.round((scale - this.baseScale.x) / (1 - this.baseScale.x), 2);
          }

          return result;
        };

        _proto49.getNextMinZoom = function getNextMinZoom() {
          var result = this.deepZoom.getScale('zoomout');

          if (result < this.baseScale.x) {
            result = this.baseScale.x;
          }

          return this.getZoomData(result);
        };

        _proto49.getNextMaxZoom = function getNextMaxZoom() {
          var result = this.deepZoom.getScale('zoomin');

          if (result > 1) {
            result = 1;
          }

          return this.getZoomData(result);
        } // private
        ;

        _proto49.zoom = function zoom(direction, x, y) {
          var last = this.scale.x;
          var is = this.iSize;
          var cw = is.width * this.scale.x;
          var ch = is.height * this.scale.y;
          var dw = getDifference(is.width, cw);
          var dh = getDifference(is.height, ch);
          x = x || this.pPos.left + this.lensHalfSize.width;
          y = y || this.pPos.top + this.lensHalfSize.height;
          this.basePercentOfScale = {
            x: getPercent(Math.abs(this.iPos.x) + this.correctX(x) - dw, cw),
            y: getPercent(Math.abs(this.iPos.y) + this.correctY(y) - dh, ch)
          };
          var scale = this.deepZoom.getScale(direction);
          this.scale.x = scale;
          this.scale.y = scale;
          this.setXY(x, y);
          this.afterZoom(last);
        };

        _proto49.afterZoom = function afterZoom(lastScale) {
          if (lastScale !== this.scale.x) {
            this.sendZoomingAction();
            this.setCursorState();

            if (this.o.smoothing) {
              this.animStep = 0.25;
            } else {
              this.dScale.x = this.scale.x;
              this.dScale.y = this.scale.y;
              this.iDPos.x = this.iPos.x;
              this.iDPos.y = this.iPos.y;
              this.render(this.iPos, this.scale);
            }
          }
        } // public
        ;

        _proto49.zoomUp = function zoomUp(x, y) {
          if ((this.isShown() || this.isShowing()) && this.scale.x !== 1) {
            this.zoom('zoomin', x, y);
            return true;
          }

          return false;
        } // public
        ;

        _proto49.zoomDown = function zoomDown(x, y) {
          if ((this.isShown() || this.isShowing()) && this.scale.x !== this.baseScale.x) {
            this.zoom('zoomout', x, y);
            return true;
          }

          return false;
        } // private
        ;

        _proto49.sendZoomingAction = function sendZoomingAction() {
          var _this88 = this;

          clearTimeout(this.zoomingTimer);
          this.zoomingTimer = setTimeout($(function (from) {
            _this88.emit('zooming', {
              data: {
                zoom: _this88.getZoomData(),
                // from 0 to 1
                from: from,
                to: _this88.scale.x
              }
            });
          }).bind(this, this.dScale.x), 24);
        } // private
        ;

        _proto49.setCursorState = function setCursorState(state) {
          if (!$J.defined(state)) {
            var scale = this.getZoomData();

            if (scale === 0) {
              state = 'zoomIn';
            } else if (scale === 1) {
              state = 'zoomOut';
            } else if (scale > 0 && scale < 1) {
              if (this.o.clickBehavior === 'up') {
                state = 'zoomIn';
              } else {
                state = 'zoomOut';
              }
            }
          }

          if (this.currentCursorState !== state) {
            this.view.toggleCursorClass(CURSOR_STATES[this.currentCursorState], CURSOR_STATES[state]);
            this.currentCursorState = state;
          }
        };

        _proto49.setImage = function setImage(data) {
          // when will work last block "else" if deepZoom always true!?
          var node = data.node;

          if (this.isShown() || this.isShowing()) {
            var _data = $J.extend({}, data.callbackData);

            _data.node = node;
            this.deepZoom.setImage(_data);
          }
        } // private
        ;

        _proto49.setSizeOfLens = function setSizeOfLens(width, height) {
          this.lensSize = {
            width: width,
            height: height
          };
          this.lensHalfSize = {
            width: this.lensSize.width / 2,
            height: this.lensSize.height / 2
          };
        } // private
        ;

        _proto49.calcSizeOfLens = function calcSizeOfLens() {
          var ps = this.pSize;
          var cls = this.currentLensSize;
          this.setSizeOfLens(getPercentValue(ps.width, cls.width), getPercentValue(ps.height, cls.height));
        } // private
        ;

        _proto49.getBaseScale = function getBaseScale() {
          this.baseScale = {
            x: this.zoomNodeSize.width / this.iSize.width,
            y: this.zoomNodeSize.height / this.iSize.height
          };
        } // eslint-disable-next-line class-methods-use-this
        ;

        _proto49.calcPositionOfLens = function calcPositionOfLens() {} // eslint-disable-next-line class-methods-use-this
        ;

        _proto49.getImagePosition = function getImagePosition() {} // private
        ;

        _proto49.showDeepZoom = function showDeepZoom(bigImageOriginWidth, bigImageOriginHeight) {
          if (this.deepZoom) {
            /* start-removable-tile-helper-block */
            if (this.o.test && !zoomHelper) {
              zoomHelper = new ZoomHelper();
              zoomHelper.setParent(this);
            }
            /* end-removable-tile-helper-block */


            var hash = this.view.getHash();

            if (hash) {
              this.deepZoom.setHash(hash);
            }

            this.deepZoom.setLensSize(this.lensSize.width, this.lensSize.height).setMinSize(this.zoomNodeSize.width, this.zoomNodeSize.height).setMaxSize(this.iSize.width, this.iSize.height, bigImageOriginWidth, bigImageOriginHeight).show();
          }
        } // private
        ;

        _proto49.endOfShowing = function endOfShowing(isWithoutSettingEvents) {
          var result = false;

          if (this.state === globalVariables.APPEARANCE.SHOWING) {
            result = true;
            this.state = globalVariables.APPEARANCE.SHOWN;

            if (!isWithoutSettingEvents) {
              this.setEvents();
            }

            this.setCursorState();

            if (!this.o.smoothing) {
              this.deepZoomAction();
            }
          }

          return result;
        };

        _proto49.sendZoomShownEvent = function sendZoomShownEvent() {
          this.emit('zoomShown', {
            data: {
              clientPosition: {
                x: this.x,
                y: this.y
              },
              pagePosition: {
                x: this.pPos.left,
                y: this.pPos.top
              }
            }
          });
        };

        _proto49.showCenter = function showCenter(smallImg, largeImg, toLevel) {
          this.getSizes();
          var x = this.pPos.left + this.pSize.width / 2;
          var y = this.pPos.top + this.pSize.height / 2;
          return this.show(smallImg, largeImg, x, y, false, toLevel);
        }
        /*
            public
            toLevel = max || undefined(default), first, zero
        */
        ;

        _proto49.show = function show() {
          if (this.state !== globalVariables.APPEARANCE.HIDDEN) {
            return false;
          }

          this.state = globalVariables.APPEARANCE.SHOWING;
          return true;
        } // private
        ;

        _proto49.endOfHiding = function endOfHiding() {
          this.stopMovingAndZooming();
          clearTimeout(this.hideTimer);
          this.anim.stop();
          this.setCursorState('zoomIn');
          this.view.clearCss();
          this.baseScale = {
            x: 1,
            y: 1
          };
          this.scale = {
            x: 1,
            y: 1
          };
          this.dScale = {
            x: 1,
            y: 1
          };
          this.setUpEvent = false;
          this.basePercentOfScale = {
            x: 0,
            y: 0
          };
          clearTimeout(this.deepZoomTimer);
          this.deepZoom.hide();
          this.view.clearDOM();
          this.state = globalVariables.APPEARANCE.HIDDEN;
          /* start-removable-tile-helper-block */

          if (zoomHelper) {
            zoomHelper.destroy();
            zoomHelper = null;
          }
          /* end-removable-tile-helper-block */


          this.emit('zoomHidden', {
            data: {
              clientPosition: {
                x: this.x,
                y: this.y
              },
              pagePosition: {
                x: this.pPos.left,
                y: this.pPos.top
              }
            }
          });
        } // private
        ;

        _proto49.hide = function hide(force) {
          if (!$J.contains([globalVariables.APPEARANCE.SHOWN, globalVariables.APPEARANCE.SHOWING], this.state)) {
            return false;
          }

          this.state = globalVariables.APPEARANCE.HIDING;
          this.view.removeEvents();

          if (force) {
            clearTimeout(this.deepZoomTimer);
            this.deepZoom.hide();
            this.endOfHiding();
          } else {
            this.stopMovingAndZooming();
          }

          return true;
        } // private
        ;

        _proto49.addClickEvent = function addClickEvent() {
          var _this89 = this;

          var eventName = 'btnclick tap';

          if (this.o.trigger === 'dblclick') {
            eventName = 'dblbtnclick dbltap';
          }

          this.view.setEventToWrapper(eventName, function (e) {
            e.stop();

            _this89.setXY(e.x, e.y);

            if (_this89.o.clickBehavior === 'up') {
              if (!_this89.zoomUp(e.x, e.y)) {
                _this89.hide();
              }
            } else if (_this89.o.smoothing && _this89.scale.x !== _this89.baseScale.x) {
              _this89.hide();
            } else {
              _this89.hide(true);
            }
          });
        };

        _proto49.customMove = function customMove(x, y) {
          if (!$J.contains([globalVariables.APPEARANCE.HIDDEN, globalVariables.APPEARANCE.HIDING], this.state)) {
            this.move(x, y);
          }
        } // private
        ;

        _proto49.move = function move(x, y) {
          this.setXY(x, y);
          this.afterMove();
        } // private
        ;

        _proto49.afterMove = function afterMove() {
          if (!this.o.smoothing) {
            this.render(this.iPos, this.scale);
          }
        } // eslint-disable-next-line class-methods-use-this
        ;

        _proto49.setEvents = function setEvents() {};

        _proto49.setLensStyleOnResize = function setLensStyleOnResize() {
          this.view.setLensStyle({
            top: this.lensPosition.top,
            left: this.lensPosition.left,
            width: this.lensSize.width,
            height: this.lensSize.height
          });
        };

        _proto49.onResize = function onResize() {
          if (this.state !== globalVariables.APPEARANCE.HIDDEN) {
            if (this.state === globalVariables.APPEARANCE.HIDING) {
              this.hide(true);
            } else {
              if (this.state === globalVariables.APPEARANCE.SHOWING) {
                if (this.o.smoothing) {
                  this.state = globalVariables.APPEARANCE.SHOWN;
                  this.setEvents();
                  this.view.removeEventFromWrapper('transitionend');
                  this.view.setLensStyle({
                    'transition': ''
                  });
                  this.stopMovingAndZooming();
                  this.view.setImagePosition(this.iPos, this.scale);
                }
              }

              this.getSizes();

              if (this.zoomNodeSize.width > this.iSize.width || this.zoomNodeSize.height > this.iSize.height) {
                this.hide(true);
                return;
              }

              this.getBaseScale();
              this.scale.x = checkRange(this.scale.x, this.baseScale.x, 1);
              this.scale.y = checkRange(this.scale.y, this.baseScale.y, 1);
              this.calcSizeOfLens();
              this.calcPositionOfLens();
              this.setLensStyleOnResize();
              this.deepZoom.setLensSize(this.pSize.width, this.pSize.height).setMinSize(this.zoomNodeSize.width, this.zoomNodeSize.height) // .setMaxSize(this.iSize.width, this.iSize.height)
              .resize(); // this.calcPositionOfImage(false, true);

              this.view.setEventNodePositionSize(this.pPos, this.pSize);

              if (!this.o.smoothing) {
                this.sendZoomingAction();
                this.setCursorState();
                this.deepZoomAction();
                this.view.setImagePosition(this.iPos, this.scale);
              }
            }
          }
        };

        _proto49.destroy = function destroy() {
          this.hide(true);
          clearTimeout(this.zoomingTimer);
          this.view.removeScrollEvent(this.scrollHandler);
          this.setCursorState('canZoom');
          clearTimeout(this.deepZoomTimer);
          this.deepZoom.destroy();
          this.deepZoom = null;
          this.off('getTile');
          this.off('zoomCancelLoadingOfTiles');
          /* start-removable-tile-helper-block */

          if (zoomHelper) {
            zoomHelper.destroy();
            zoomHelper = null;
          }
          /* end-removable-tile-helper-block */


          this.zoomingTimer = null;

          _EventEmitter13.prototype.destroy.call(this);
        };

        return Controller;
      }(EventEmitter);
      /* eslint-env es6 */

      /* global TOUCHEND */

      /* global TOUCH */

      /* global checkRange */

      /* global ZoomMap */

      /* global Controller */

      /* global getPercentValue */

      /* global getDifference */

      /* global checkImagePosition */

      /* global CURSOR_STATES */

      /* global getPercent */

      /* global MOVE */

      /* eslint-disable indent */

      /* eslint-disable no-lonely-if */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars


      var InnerController = function () {
        // const MAX_SCALE_SIZE = 0.9135416666666667;
        // const MIN_SCALE_SIZE = 0.03854166666666667;
        // const MAX_STEP = 0.07;
        // const MAX_STEP = 0.2;
        // const MIN_STEP = 0.2;
        // const MIN_STEP = 0.5;
        // const getStepForAppearance = (scaleSize) => {
        //     let nextStep;
        //     nextStep = Math.abs(MAX_SCALE_SIZE - MIN_SCALE_SIZE) / Math.abs(MAX_STEP - MIN_STEP);
        //     nextStep = MAX_STEP + (MAX_SCALE_SIZE - scaleSize) / nextStep;
        //     return nextStep;
        // };
        var outOfSquare = function (checkedPoint, nodePos, nodeSize, scrollPosition) {
          var result = false;
          var x = nodePos.left - scrollPosition.x;
          var y = nodePos.top - scrollPosition.y;

          if (checkedPoint.x <= x || checkedPoint.y <= y || checkedPoint.x >= x + nodeSize.width || checkedPoint.y >= y + nodeSize.height) {
            result = true;
          }

          return result;
        };

        var IController = /*#__PURE__*/function (_Controller) {
          "use strict";

          bHelpers.inheritsLoose(IController, _Controller);

          function IController(view, o) {
            var _this90;

            _this90 = _Controller.call(this, view, $J.extend({
              map: false,
              mapSize: 50 // in percentage // 100% is 50% from each image side

            }, o)) || this;
            _this90.basePercentOfScale = {
              x: 0,
              y: 0
            };
            _this90.clonedImage = null;
            _this90.hideTimer = null;
            _this90.showTimer = null;
            _this90.map = null;
            _this90.zoomingTimer = null;
            _this90.currentCursorState = 0;
            _this90.innerImagePosition = {
              x: 0,
              y: 0
            };
            _this90.setUpEvent = false;

            if ($J.browser.mobile) {
              _this90.o.pan = true;

              if (_this90.o.trigger === 'hover') {
                _this90.o.trigger = 'click';
              }
            }

            _this90.view.setLensCss(_this90.lensPosition, _this90.lensSize);

            _this90.ANIM_STEP = 0.3;
            return _this90;
          }

          var _proto50 = IController.prototype;

          _proto50.init = function init() {
            _Controller.prototype.init.call(this);

            this.createZoomMap();
          } // private
          ;

          _proto50.createZoomMap = function createZoomMap() {
            var _this91 = this;

            if (!this.o.map) {
              return;
            }

            var mWidth = parseInt(getPercentValue(this.pSize.width / 2, this.o.mapSize), 10);
            var mHeight = parseInt(getPercentValue(this.pSize.height / 2, this.o.mapSize), 10);
            this.map = new ZoomMap(this.view.getContainerForMap(), {
              maxwidth: mWidth,
              maxheight: mHeight
            });
            this.map.setParent(this);
            this.on('zoomGetImage', function (e) {
              e.stopEmptyEvent();
              e.data.map = true;
              e.data.exactSize = true;
            });
            this.on('zoomMapNewPosition', function (e) {
              e.stopAll(); // this.move(
              //     this.pPos.left + getPercentValue(this.lensSize.width, e.data.x),
              //     this.pPos.top + getPercentValue(this.lensSize.height, e.data.y)
              // );

              _this91.setXY(_this91.pPos.left + getPercentValue(_this91.lensSize.width, e.data.x), _this91.pPos.top + getPercentValue(_this91.lensSize.height, e.data.y));

              _this91.calcPositionOfImageInCenter(_this91.scale);

              if (!_this91.o.smoothing) {
                _this91.deepZoomAction();

                _this91.view.setImagePosition(_this91.iPos, _this91.scale);

                if (_this91.map) {
                  _this91.map.move(_this91.iPos, _this91.scale);
                }
              }
            });
          } // private
          ;

          _proto50.move = function move(x, y) {
            this.setXY(x, y);
            this.calcPositionOfImage(this.scale);
            this.afterMove();
          } // private
          ;

          _proto50.render = function render(position, scale) {
            _Controller.prototype.render.call(this, position, scale);

            if (this.map) {
              this.map.move(position || this.iDPos, scale || this.dScale);
            }
          } // private
          ;

          _proto50.calcPositionOfImageForPinch = function calcPositionOfImageForPinch(scale) {
            if (!scale) {
              scale = this.dScale;
            }

            var w = this.iSize.width * scale.x;
            var h = this.iSize.height * scale.y;
            var dw = getDifference(this.iSize.width, w);
            var dh = getDifference(this.iSize.height, h);
            var x;
            var y;

            if (w > this.lensSize.width) {
              x = this.x - (getPercentValue(w, this.basePercentOfScale.x) + dw);
              x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            } else {
              x = this.lensSize.width / 2 - (w / 2 + dw);
            }

            if (h > this.lensSize.height) {
              y = this.y - (getPercentValue(h, this.basePercentOfScale.y) + dh);
              y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);
            } else {
              y = this.lensSize.height / 2 - (h / 2 + dh);
            }

            this.iPos = {
              x: x,
              y: y
            };
          };

          _proto50.setScale = function setScale(scale, x, y) {
            if (this.state === globalVariables.APPEARANCE.SHOWN) {
              if ($J.defined(x)) {
                this.setXY(x, y);
              }

              this.scale.x = scale;
              this.scale.y = scale;
              this.scale.x = checkRange(this.scale.x, this.baseScale.x, 1);
              this.scale.y = checkRange(this.scale.y, this.baseScale.y, 1);
              this.calcPositionOfImageForPinch(this.scale);
              this.sendZoomingAction();
              this.setCursorState();

              if (!this.o.smoothing) {
                this.dScale.x = this.scale.x;
                this.dScale.y = this.scale.y;
                this.imageDPosition.x = this.imagePosition.x;
                this.imageDPosition.y = this.imagePosition.y;
                this.deepZoomAction();
                this.view.setImagePosition(this.imagePosition, this.scale);

                if (this.map) {
                  this.map.move(this.imagePosition, this.scale);
                }
              }
            }
          } // private
          ;

          _proto50.afterZoom = function afterZoom(lastScale) {
            this.calcPositionOfImageForPinch(this.scale);

            _Controller.prototype.afterZoom.call(this, lastScale);
          } // private
          ;

          _proto50.calcPositionOfImage = function calcPositionOfImage(scale, first, _x, _y) {
            var sw = _x || this.x;
            var sh = _y || this.y;

            if (!scale) {
              scale = this.dScale;
            }

            var w = this.iSize.width * scale.x;
            var h = this.iSize.height * scale.y;
            var dw = getDifference(this.iSize.width, w);
            var dh = getDifference(this.iSize.height, h);
            var x;
            var y; // x = sw - getPercentValue(w, getPercent(sw, this.pSize.width)) - dw;
            // y = sh - getPercentValue(h, getPercent(sh, this.pSize.height)) - dh;
            // x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            // y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);

            if (w > this.lensSize.width) {
              x = sw - getPercentValue(w, getPercent(sw, this.pSize.width)) - dw;
              x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            } else {
              x = this.lensSize.width / 2 - (w / 2 + dw);
            }

            if (h > this.lensSize.height) {
              y = sh - getPercentValue(h, getPercent(sh, this.pSize.height)) - dh;
              y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);
            } else {
              y = this.lensSize.height / 2 - (h / 2 + dh);
            }

            this.iPos = {
              x: x,
              y: y
            };
          };

          _proto50.calcPositionOfImageInCenter = function calcPositionOfImageInCenter(scale) {
            if (!scale) {
              scale = this.dScale;
            }

            var w = this.iSize.width * scale.x;
            var h = this.iSize.height * scale.y;
            var dw = getDifference(this.iSize.width, w);
            var dh = getDifference(this.iSize.height, h); // let x = this.x / (this.zoomNodeSize.width / w);
            // let y = this.y / (this.zoomNodeSize.height / h);

            var x = this.x / (this.lensSize.width / w);
            var y = this.y / (this.lensSize.height / h);
            x = this.lensSize.width / 2 - x - dw;
            y = this.lensSize.height / 2 - y - dh;
            x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);
            this.iPos = {
              x: x,
              y: y
            };
          };

          _proto50.setBasePercent = function setBasePercent(point) {
            if ($J.contains([globalVariables.APPEARANCE.SHOWN, globalVariables.APPEARANCE.SHOWING], this.state)) {
              var is = this.iSize;
              var cw = is.width * this.scale.x;
              var ch = is.height * this.scale.y;
              var dw = getDifference(is.width, cw);
              var dh = getDifference(is.height, ch);
              this.basePercentOfScale = {
                x: getPercent(Math.abs(this.iPos.x) + this.correctX(point.x) - dw, cw),
                y: getPercent(Math.abs(this.iPos.y) + this.correctY(point.y) - dh, ch)
              };
            }
          };

          _proto50.setImage = function setImage(data) {
            //when will work last block "else" if deepZoom always true!?
            if (this.isShown() || this.isShowing()) {
              if (data.callbackData.map) {
                if (this.map) {
                  this.map.setImg(data.src, data.srcset);
                }
              } else {
                _Controller.prototype.setImage.call(this, data);
              }
            }
          } // private
          ;

          _proto50.endOfShowing = function endOfShowing(isWithoutSettingEvents) {
            if (_Controller.prototype.endOfShowing.call(this, isWithoutSettingEvents)) {
              if (this.map) {
                this.map.show();
              }
            }
          };

          _proto50.getImagePosition = function getImagePosition() {
            this.innerImagePosition = {
              x: getDifference(this.lensSize.width, this.zoomNodeSize.width),
              y: getDifference(this.lensSize.height, this.zoomNodeSize.height)
            };
          }
          /*
              public
              toLevel = max || undefined(default), first, zero
          */
          ;

          _proto50.show = function show(smallImg, bigImageOptions, x, y, actionEndHide, toLevel) {
            var _this92 = this;

            if (!_Controller.prototype.show.call(this)) {
              return false;
            }

            this.setUpEvent = actionEndHide;
            this.iSize = {
              width: bigImageOptions.width,
              height: bigImageOptions.height
            };
            this.view.addStartCss();
            this.view.appendNodes(smallImg, this.iSize);
            this.getSizes();
            this.setXY(x, y);
            this.calcSizeOfLens();
            this.getImagePosition();
            this.getBaseScale();
            this.showDeepZoom(bigImageOptions.originWidth, bigImageOptions.originHeight);
            this.showTimer = setTimeout(function () {
              // this timeout helps us to show non tile image without blink (cloned image manages to render)
              _this92.showTimer = null;

              _this92.emit('zoomBeforeShow', {
                data: {}
              });

              if (toLevel && toLevel !== 'max') {
                var scale;

                if (toLevel === 'zero') {
                  _this92.scale.x = _this92.baseScale.x;
                  _this92.scale.y = _this92.baseScale.y;
                } else {
                  scale = _this92.deepZoom.getScale('zoomin');
                  _this92.scale.x = scale;
                  _this92.scale.y = scale;
                }
              }

              _this92.calcPositionOfImage(_this92.scale, true);

              _this92.view.setEventNodePositionSize(_this92.pPos, _this92.pSize);

              _this92.dScale.x = _this92.baseScale.x;
              _this92.dScale.y = _this92.baseScale.y;
              _this92.iDPos = {
                x: getDifference(_this92.iSize.width, _this92.iSize.width * _this92.dScale.x) * -1 + _this92.innerImagePosition.x,
                y: getDifference(_this92.iSize.height, _this92.iSize.height * _this92.dScale.y) * -1 + _this92.innerImagePosition.y
              };

              _this92.view.setLensCss(_this92.lensPosition, _this92.lensSize);

              _this92.view.setImageSize(_this92.iDPos, _this92.iSize, _this92.dScale);

              _this92.boundaries = _this92.view.getBoundaries();

              if (_this92.map) {
                _this92.map.prepare(_this92.iSize.width, _this92.iSize.height, _this92.pSize.width, _this92.pSize.height);
              }

              if (_this92.o.smoothing && toLevel !== 'zero') {
                _this92.setEvents(); // this.animStep = getStepForAppearance(this.scale.x - this.baseScale.x);


                _this92.animStep = 0.3;

                _this92.animCb = function () {
                  _this92.deepZoomAction();

                  _this92.endOfShowing(true);
                };
              } else {
                _this92.endOfShowing();
              }

              if (_this92.o.smoothing) {
                _this92.anim.start();
              } // deleted it from this.endOfShowing() function because it sometimes doesn't work


              _this92.sendZoomShownEvent();
            }, 0);
            return true;
          };

          _proto50.hide = function hide(force) {
            var _this93 = this;

            var result = _Controller.prototype.hide.call(this, force);

            if (result) {
              clearTimeout(this.showTimer);

              if (force) {// empty
              } else {
                if (this.scale.x !== this.baseScale.x || this.scale.y !== this.baseScale.y) {
                  // this.animStep = getStepForAppearance(this.scale.x - this.baseScale.x);
                  this.animStep = 0.4;
                  this.scale.x = this.baseScale.x;
                  this.scale.y = this.baseScale.y;
                  this.iPos = {
                    x: getDifference(this.iSize.width, this.iSize.width * this.scale.x) * -1 + this.innerImagePosition.x,
                    y: getDifference(this.iSize.height, this.iSize.height * this.scale.y) * -1 + this.innerImagePosition.y
                  };

                  this.animCb = function () {
                    _this93.endOfHiding();
                  };
                } else {
                  this.endOfHiding();
                }
              }
            }

            return result;
          } // private
          ;

          _proto50.addMouseScrollEvent = function addMouseScrollEvent() {
            var _this94 = this;

            this.view.setEventToWrapper('mousescroll', function (e) {
              e.stop();

              if (_this94.o.pan) {
                var is = _this94.iSize;
                var cw = is.width * _this94.scale.x;
                var ch = is.height * _this94.scale.y;
                var dw = getDifference(is.width, cw);
                var dh = getDifference(is.height, ch);
                _this94.basePercentOfScale = {
                  x: getPercent(Math.abs(_this94.iPos.x) + _this94.correctX(e.x) - dw, cw),
                  y: getPercent(Math.abs(_this94.iPos.y) + _this94.correctY(e.y) - dh, ch)
                };
              }

              var delta;
              var last = _this94.scale.x;

              if (e.isMouse) {
                var percent = 37;
                var v = e.delta / getPercentValue(e.deltaFactor, percent);
                _this94.scale.x += v;
                _this94.scale.y += v;
              } else {
                delta = e.delta;

                if (Math.abs(delta) > 15) {
                  delta = 15;

                  if (e.delta < 0) {
                    delta *= -1;
                  }
                }

                delta /= 350;
                _this94.scale.x += delta;
                _this94.scale.y += delta;
              }

              _this94.scale.x = checkRange(_this94.scale.x, _this94.baseScale.x, 1);
              _this94.scale.y = checkRange(_this94.scale.y, _this94.baseScale.y, 1);

              if (_this94.o.pan) {
                _this94.setXY(e.x, e.y);

                _this94.calcPositionOfImageForPinch(_this94.scale);
              } else {
                _this94.calcPositionOfImage(_this94.scale);
              }

              if (last !== _this94.scale.x) {
                _this94.sendZoomingAction();

                _this94.setCursorState();

                if (!_this94.o.smoothing) {
                  _this94.dScale.x = _this94.scale.x;
                  _this94.dScale.y = _this94.scale.y;
                  _this94.iDPos.x = _this94.iPos.x;
                  _this94.iDPos.y = _this94.iPos.y;

                  _this94.deepZoomAction();

                  _this94.view.setImagePosition(_this94.iPos, _this94.scale);

                  if (_this94.map) {
                    _this94.map.move(_this94.iPos, _this94.scale);
                  }
                }
              }

              _this94.hideByTimer();
            });
          };

          _proto50.hideByTimer = function hideByTimer() {
            var _this95 = this;

            clearTimeout(this.hideTimer);

            if (this.scale.x <= this.baseScale.x + 0.00000001 && this.o.type !== 'outside') {
              this.hideTimer = setTimeout(function () {
                _this95.hide(true);
              }, 1000);
            }
          } // private
          ;

          _proto50.addInnerTouchDrag = function addInnerTouchDrag() {
            var _this96 = this;

            var move = false;
            var lastX;
            var lastY;
            var currentWidth;
            var currentHeight;
            var dw;
            var dh;
            this.view.setEventToWrapper(TOUCH, function (e) {
              e.stop();

              if (e.state === 'dragstart') {
                move = true;

                _this96.view.addEventsCanvasClass(CURSOR_STATES.drag);

                _this96.stopMovingAndZooming(); // this.scale.x = this.dScale.x;
                // this.scale.y = this.dScale.y;


                _this96.setXY(e.x, e.y);

                currentWidth = _this96.iSize.width * _this96.scale.x;
                currentHeight = _this96.iSize.height * _this96.scale.y;
                dw = getDifference(_this96.iSize.width, currentWidth);
                dh = getDifference(_this96.iSize.height, currentHeight);
                lastX = e.x;
                lastY = e.y;
              } else if (e.state === 'dragend') {
                move = false;

                _this96.view.removeEventsCanvasClass(CURSOR_STATES.drag);
              } else if (move) {
                _this96.setXY(e.x, e.y);

                if (currentWidth > _this96.lensSize.width) {
                  _this96.iPos.x += e.x - lastX;
                  _this96.iPos.x = checkImagePosition(_this96.iPos.x, 0 - dw, dw + currentWidth, _this96.lensSize.width);
                } else {
                  _this96.iPos.x = _this96.lensSize.width / 2 - (currentWidth / 2 + dw);
                }

                if (currentHeight > _this96.lensSize.height) {
                  _this96.iPos.y += e.y - lastY;
                  _this96.iPos.y = checkImagePosition(_this96.iPos.y, 0 - dh, dh + currentHeight, _this96.lensSize.height);
                } else {
                  _this96.iPos.y = _this96.lensSize.height / 2 - (currentHeight / 2 + dh);
                }

                if (_this96.o.smoothing && _this96.o.pan) {
                  _this96.animStep = 0.3;
                } else {
                  _this96.iDPos.x = _this96.iPos.x;
                  _this96.iDPos.y = _this96.iPos.y;

                  _this96.deepZoomAction();

                  _this96.view.setImagePosition(_this96.iPos, _this96.scale);

                  if (_this96.map) {
                    _this96.map.move(_this96.iPos, _this96.scale);
                  }
                }

                lastX = e.x;
                lastY = e.y;
              }
            });
          } // private
          ;

          _proto50.addInnerPinch = function addInnerPinch() {
            var _this97 = this;

            var timer;
            var startScale;
            var saveValue = 1 - this.baseScale.x;
            var scale;
            var maxCompensation;
            var minCompensation;
            var max;
            var min;

            if (!this.o.customZooming) {
              return;
            }

            this.view.setEventToWrapper('pinch', function (e) {
              e.stop();

              if (e.state === 'pinchstart') {
                clearTimeout(timer);

                _this97.stopMovingAndZooming();

                _this97.view.node.removeEvent(TOUCH);

                _this97.scale.x = _this97.dScale.x;
                _this97.scale.y = _this97.dScale.y;
                startScale = _this97.scale.x;
                maxCompensation = 1;
                minCompensation = 1;
                max = 1;
                min = _this97.baseScale.x;

                _this97.setBasePercent(e.centerPoint);
              } else if (e.state === 'pinchresize') {
                _this97.setBasePercent(e.centerPoint);
              } else if (e.state === 'pinchmove') {
                _this97.setXY(e.centerPoint.x, e.centerPoint.y);

                scale = e.scale;
                scale *= startScale;

                if (max < scale) {
                  max = scale;
                  min = _this97.baseScale.x;
                  minCompensation = 1;
                  maxCompensation = saveValue / (max - _this97.baseScale.x);
                }

                if (min > scale) {
                  min = scale;
                  max = 1;
                  maxCompensation = 1;
                  minCompensation = _this97.baseScale.x / min;
                }

                scale = (_this97.baseScale.x + (scale - _this97.baseScale.x) * maxCompensation) * minCompensation;
                _this97.scale.x = scale;
                _this97.scale.y = scale;
                _this97.scale.x = checkRange(_this97.scale.x, _this97.baseScale.x, 1);
                _this97.scale.y = checkRange(_this97.scale.y, _this97.baseScale.y, 1);

                _this97.calcPositionOfImageForPinch(_this97.scale);

                _this97.sendZoomingAction();

                _this97.setCursorState();

                if (!_this97.o.smoothing) {
                  _this97.dScale.x = _this97.scale.x;
                  _this97.dScale.y = _this97.scale.y;
                  _this97.iDPos.x = _this97.iPos.x;
                  _this97.iDPos.y = _this97.iPos.y;

                  _this97.deepZoomAction();

                  _this97.view.setImagePosition(_this97.iPos, _this97.scale);

                  if (_this97.map) {
                    _this97.map.move(_this97.iPos, _this97.scale);
                  }
                }
              } else if (e.state === 'pinchend') {
                clearTimeout(timer);
                timer = setTimeout(function () {
                  _this97.addInnerTouchDrag();
                }, 42);

                if (_this97.scale.x <= _this97.baseScale.x + 0.00000001 && _this97.o.type !== 'outside' && _this97.state !== globalVariables.APPEARANCE.HIDING) {
                  clearTimeout(timer);

                  _this97.hide(true);
                }
              }
            });
          };

          _proto50.hideZoomByMouseOut = function hideZoomByMouseOut() {
            var _this98 = this;

            var cb = function (e) {
              if (outOfSquare(e.getClientXY(), _this98.view.getContainerPosition(), _this98.view.getContainerSize(), $J.D.getScroll())) {
                _this98.view.removeGlobalEvent();

                _this98.hide();
              }
            };

            this.view.addGlobalEvent(cb);
          } // private
          ;

          _proto50.setEvents = function setEvents() {
            var _this99 = this;

            if (this.setUpEvent && $J.browser.mobile) {
              this.view.setEventToWrapper(TOUCHEND, function (e) {
                e.stop();

                _this99.hide(true);
              });
            }

            if (this.o.customZooming) {
              this.addMouseScrollEvent();
            }

            this.addInnerTouchDrag();
            this.view.removeDragstart();

            if (!this.setUpEvent) {
              this.addInnerPinch();
            }

            if (this.o.trigger !== 'hover') {
              this.addClickEvent();
            } else {
              this.hideZoomByMouseOut();
            }

            if (!this.o.pan && !$J.browser.mobile) {
              this.view.setEventToMainContainer(MOVE, function (e) {
                if (e.pointerType && e.pointerType === 'touch') {
                  return;
                }

                e.stop();
                var pageXY = e.getPageXY();

                _this99.move(pageXY.x, pageXY.y);
              });
            }
          } // private
          ;

          _proto50.keepOldPosition = function keepOldPosition(oldLensSize) {
            var x = this.iPos.x;
            var y = this.iPos.y;
            var w = this.iSize.width * this.scale.x;
            var h = this.iSize.height * this.scale.y;
            var dw = getDifference(this.iSize.width, w);
            var dh = getDifference(this.iSize.height, h);
            x -= (oldLensSize.width - this.lensSize.width) / 2;
            y -= (oldLensSize.height - this.lensSize.height) / 2;

            if (w > this.lensSize.width) {
              x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            } else {
              x = this.lensSize.width / 2 - (w / 2 + dw);
            }

            if (h > this.lensSize.height) {
              y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);
            } else {
              y = this.lensSize.height / 2 - (h / 2 + dh);
            }

            this.iPos = {
              x: x,
              y: y
            };
          };

          _proto50.onResize = function onResize() {
            var oldLensSize = this.lensSize;

            _Controller.prototype.onResize.call(this);

            if (this.state !== globalVariables.APPEARANCE.HIDDEN) {
              if (this.state !== globalVariables.APPEARANCE.HIDING) {
                this.keepOldPosition(oldLensSize);
                this.getImagePosition();

                if (this.map) {
                  var mWidth = parseInt(getPercentValue(this.pSize.width / 2, this.o.mapSize), 10);
                  var mHeight = parseInt(getPercentValue(this.pSize.height / 2, this.o.mapSize), 10);
                  this.map.resize(mWidth, mHeight, this.iSize.width, this.iSize.height, this.pSize.width, this.pSize.height);

                  if (!this.o.smoothing) {
                    this.map.move(this.iPos, this.scale);
                  }
                }
              }
            }
          };

          _proto50.destroy = function destroy() {
            clearTimeout(this.showTimer);

            if (this.map) {
              this.map.destroy();
              this.map = null;
              this.off('zoomGetImage');
              this.off('zoomMapNewPosition');
            }

            _Controller.prototype.destroy.call(this);
          };

          return IController;
        }(Controller);

        return IController;
      }();
      /* eslint-env es6 */

      /* global getDifference */

      /* global TOUCHEND */

      /* global TOUCH */

      /* global getPercent */

      /* global Controller */

      /* global getPercentValue */

      /* global MOVE */

      /* global checkRange */

      /* eslint-disable indent */

      /* eslint-disable no-lonely-if */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line


      var MagnifierController = function () {
        var MIN_SIZE_OF_LENS = 10;
        var MAX_SIZE_OF_LENS = 90;
        var DEFAULT_MAGNIFIER_SIZE = 70; // percent

        var DEFAULT_MOBILE_MAGNIFIER_ZOOM_MARGIN = 65;

        var checkMinMax = function (size) {
          var factor;

          if (size.width >= size.height) {
            factor = size.width / size.height;
          } else {
            factor = size.height / size.width;
          }

          var min = MIN_SIZE_OF_LENS;
          var max = MAX_SIZE_OF_LENS;

          if (factor > max / min) {
            return {
              width: 50,
              height: 50
            };
          }

          if (size.width < min) {
            size.height = min * (size.height / size.width);
            size.width = min;
          }

          if (size.height < min) {
            size.width = min * (size.width / size.height);
            size.height = min;
          }

          if (size.width > max) {
            size.height = max * (size.height / size.width);
            size.width = max;
          }

          if (size.height > max) {
            size.width = max * (size.width / size.height);
            size.height = max;
          }

          return size;
        }; // eslint-disable-next-line no-unused-vars


        var MController = /*#__PURE__*/function (_Controller2) {
          "use strict";

          bHelpers.inheritsLoose(MController, _Controller2);

          function MController(view, o) {
            var _this100;

            if ($J.browser.mobile && o.margin === 9) {
              delete o.margin;
            }

            _this100 = _Controller2.call(this, view, $J.extend({
              width: 70,
              // percent
              height: 70,
              // percent
              margin: DEFAULT_MOBILE_MAGNIFIER_ZOOM_MARGIN
            }, o)) || this;
            _this100.setUpEvent = false;
            _this100.isSquare = true;
            _this100.ANIM_STEP = 0.4;
            return _this100;
          }

          var _proto51 = MController.prototype;

          _proto51.init = function init() {
            _Controller2.prototype.init.call(this);

            this.setLensSize();
          } // private
          ;

          _proto51.setLensSize = function setLensSize() {
            var s = {
              width: this.o.width,
              height: this.o.height
            };

            if (s.width === s.height) {
              this.isSquare = true;
            }

            if ($J.contains([s.width, s.height], 'auto')) {
              this.isSquare = true;

              if (s.width === 'auto') {
                if (s.height !== 'auto') {
                  s.height = this.getPercentSize(s.height, 'height');
                  s.width = s.height;
                } else {
                  s.height = DEFAULT_MAGNIFIER_SIZE;
                  s.width = s.height;
                }
              } else if (s.width !== 'auto') {
                s.width = this.getPercentSize(s.width, 'width');
                s.height = s.width;
              } else {
                s.height = DEFAULT_MAGNIFIER_SIZE;
                s.width = s.height;
              }
            } else {
              s.width = this.getPercentSize(s.width, 'width');
              s.height = this.getPercentSize(s.height, 'height');
            }

            this.currentLensSize = checkMinMax({
              width: s.width,
              height: s.height
            });
            this.ANIM_STEP = 0.6;
          } // private
          ;

          _proto51.calcSizeOfLens = function calcSizeOfLens() {
            if (this.isSquare) {
              var ps = this.pSize;
              var cls = this.currentLensSize;
              var value = getPercentValue(Math.min(ps.width, ps.height), cls.width);
              this.setSizeOfLens(value, value);
            } else {
              _Controller2.prototype.calcSizeOfLens.call(this);
            }
          } // private
          ;

          _proto51.calcPositionOfLens = function calcPositionOfLens() {
            var ps = this.pSize;
            var margin = this.o.margin; //eslint-disable-next-line no-unused-vars
            // let lensPositionState = 'top'; // top left right bottom;

            if (margin < 0) {
              margin = 0;
            }

            if (this.x < 0) {
              this.x = 0;
            }

            if (this.y < 0) {
              this.y = 0;
            }

            if (this.x > ps.width) {
              this.x = ps.width;
            }

            if (this.y > ps.height) {
              this.y = ps.height;
            }

            var top;
            var left;
            top = this.y - this.lensHalfSize.height;
            left = this.x - this.lensHalfSize.width; // if (!$J.browser.mobile) {
            //     margin = 0;
            // }

            var scroll;
            var ws;
            var pp = this.pPos;

            if ($J.browser.mobile) {
              top -= margin;
              scroll = $($J.W).getScroll();
              ws = $($J.W).getSize();

              if (pp.top + top < scroll.y) {
                if (pp.left + this.x - this.lensSize.width - margin > scroll.x) {
                  // lensPositionState = 'left';
                  top = this.y - this.lensHalfSize.height;
                  left = this.x - this.lensSize.width - margin;
                } else if (pp.left + this.x + this.lensSize.width + margin < scroll.x + ws.width) {
                  // lensPositionState = 'right';
                  top = this.y - this.lensHalfSize.height;
                  left = this.x + margin;
                } else if (scroll.y + ws.height > pp.top + this.y + margin + this.lensSize.height) {
                  // lensPositionState = 'bottom';
                  top = this.y + margin;
                }
              }
            } // if ($J.contains(['top', 'bottom'], lensPositionState) && !$J.browser.mobile) {
            //     if (pp.left + left < scroll.x) {
            //         left = scroll.x - pp.left;
            //     }
            //     if (pp.left + left + this.lensSize.width > scroll.x + ws.width) {
            //         left = scroll.x - pp.left + ws.width - this.lensSize.width;
            //     }
            // }


            this.lensPosition = {
              top: top,
              left: left
            };
          };

          _proto51.calcPositionOfImage = function calcPositionOfImage(scale, first, _x, _y) {
            var sw = _x || this.x;
            var sh = _y || this.y;
            var x = this.lensHalfSize.width - getPercentValue(this.iSize.width, getPercent(sw, this.pSize.width));
            var y = this.lensHalfSize.height - getPercentValue(this.iSize.height, getPercent(sh, this.pSize.height));
            this.iPos = {
              x: x,
              y: y
            };
          } // private
          ;

          _proto51.getPercentSize = function getPercentSize(value, side) {
            if (/%$/.test(value)) {
              value = parseInt(value, 10);
            } else {
              value = parseInt(value, 10);
              value /= this.pSize[side] / 100;
            }

            return value;
          } // private
          ;

          _proto51.setEvents = function setEvents() {
            var _this101 = this;

            if (this.setUpEvent && !this.o.pan) {
              this.view.setEventToMainContainer(TOUCHEND, function (e) {
                e.stop();

                _this101.hide(true);
              });
            }

            if (this.o.customZooming) {
              this.addMouseScroollEvent();
            }

            this.addMouseOverEvent();

            if (this.o.trigger === 'hover') {
              this.addMouseOutEvent();
            }

            if (this.o.pan) {
              this.addDragEvent();
            }

            if ($J.browser.mobile) {
              this.addTapEvent();
            }

            if (this.o.trigger !== 'hover') {
              this.addClickEvent();
            }

            if (!this.o.pan && !$J.browser.mobile) {
              this.view.setEventToMainContainer(MOVE, function (e) {
                if (e.pointerType && e.pointerType === 'touch') {
                  return;
                }

                e.stop();
                var pageXY = e.getPageXY();

                _this101.move(pageXY.x, pageXY.y);

                if (_this101.x <= 0 || _this101.y <= 0 || _this101.x >= _this101.pSize.width || _this101.y >= _this101.pSize.height) {
                  _this101.hide();
                }
              });
            }
          };

          _proto51.afterMove = function afterMove() {
            this.calcPositionOfLens();
            this.calcPositionOfImage(this.scale);
            this.view.setLensPosition(this.lensPosition);

            _Controller2.prototype.afterMove.call(this);
          } // private
          ;

          _proto51.changeLensSize = function changeLensSize(size) {
            var min = MIN_SIZE_OF_LENS;
            var max = MAX_SIZE_OF_LENS;
            size.width = checkRange(size.width, min, max);
            size.height = checkRange(size.height, min, max);

            if (size.width !== this.currentLensSize.width) {
              this.currentLensSize.width = size.width;
              this.currentLensSize.height = size.height;
              this.calcSizeOfLens();
              this.calcPositionOfLens();
              this.calcPositionOfImage();
              this.iDPos.x = this.iPos.x;
              this.iDPos.y = this.iPos.y;
              this.deepZoomAction(false, this.lensSize);
              this.view.setImagePosition(this.iPos, this.scale);
              this.view.setLensPosition(this.lensPosition);
              this.view.setLensSize(this.lensSize);
            }
          } // private
          ;

          _proto51.addMouseScroollEvent = function addMouseScroollEvent() {
            var _this102 = this;

            this.view.setEventToWrapper('mousescroll', function (e) {
              e.stop();
              var i;
              var delta = e.delta;
              var s = {
                width: 0,
                height: 0
              };

              if (_this102.isSquare) {
                for (i in s) {
                  if ({}.hasOwnProperty.call(s, i)) {
                    s[i] = _this102.currentLensSize[i] + delta;
                  }
                }
              } else {
                i = _this102.currentLensSize.height / _this102.currentLensSize.width;
                s.width = _this102.currentLensSize.width + delta;
                s.height = _this102.currentLensSize.height + delta * i;
              }

              _this102.changeLensSize(s);
            });
          } // private
          ;

          _proto51.addMouseOverEvent = function addMouseOverEvent() {
            var _this103 = this;

            this.view.setEventToMainContainer('mouseover', function (e) {
              e.stop();
              var pageXY = e.getPageXY();

              _this103.setXY(pageXY.x, pageXY.y);

              _this103.calcPositionOfLens();

              _this103.calcPositionOfImage();

              _this103.view.setLensPosition({
                top: _this103.lensPosition.top,
                left: _this103.lensPosition.left
              });

              _this103.view.setImagePosition(_this103.iPos, _this103.scale);
            });
          } // private
          ;

          _proto51.addMouseOutEvent = function addMouseOutEvent() {
            var _this104 = this;

            this.view.setEventToWrapper('mouseout', function (e) {
              // let toElement = e.toElement || e.relatedTarget;
              var toElement = e.getRelated(); // if we change between workspace we must to hide the lens
              // if (!toElement) { return; }

              while (toElement && toElement !== _this104.node && toElement !== _this104.lensContainer && toElement !== _this104.eventsCanvasNode) {
                toElement = toElement.parentNode;
              }

              if (_this104.node !== toElement && _this104.eventsCanvasNode !== toElement) {
                var p = e.getClientXY();

                if (p.x < _this104.boundaries.left || p.x > _this104.boundaries.right || p.y < _this104.boundaries.top || p.y > _this104.boundaries.bottom) {
                  e.stop();

                  if (_this104.o.smoothing) {
                    _this104.hide();
                  } else {
                    _this104.hide(true);
                  }
                }
              }
            });
          } // private
          ;

          _proto51.addDragEvent = function addDragEvent() {
            var _this105 = this;

            var move = false;
            this.view.setEventToMainContainer(TOUCH, function (e) {
              e.stop();

              if (e.state === 'dragstart') {
                move = true;
              } else if (e.state === 'dragend') {
                move = false;
              } else if (move) {
                _this105.move(e.x, e.y);
              }
            });
          } // private
          ;

          _proto51.addTapEvent = function addTapEvent() {
            var _this106 = this;

            this.view.setEventToMainContainer(this.o.trigger === 'dblclick' ? 'dbltap' : 'tap', function (e) {
              e.stop();

              if (_this106.o.smoothing) {
                _this106.hide();
              } else {
                _this106.hide(true);
              }
            });
          };

          _proto51.hide = function hide(force) {
            var _this107 = this;

            var result = _Controller2.prototype.hide.call(this, force);

            if (result) {
              if (force) {// empty
              } else {
                this.view.setEventToWrapper('transitionend', function (e) {
                  e.stop();

                  _this107.view.removeEventFromWrapper('transitionend');

                  _this107.endOfHiding();
                });
                this.view.setLensStyle({
                  transition: 'opacity .2s linear, transform .2s linear',
                  opacity: 0,
                  transform: 'scale(0)'
                });
              }
            }

            return result;
          }
          /*
              public
              toLevel = max || undefined(default), first, zero
          */
          ;

          _proto51.show = function show(smallImg, bigImageOptions, x, y, actionEndHide, toLevel) {
            var _this108 = this;

            if (!_Controller2.prototype.show.call(this)) {
              return false;
            }

            this.emit('zoomBeforeShow', {
              data: {}
            });
            this.setUpEvent = actionEndHide;
            this.iSize = {
              width: bigImageOptions.width,
              height: bigImageOptions.height
            };
            this.view.addStartCss();
            this.view.appendNodes(smallImg, this.iSize);
            this.getSizes();
            this.setXY(x, y);
            this.calcSizeOfLens();
            this.calcPositionOfLens(); // this.getImagePosition();

            this.getBaseScale();
            this.showDeepZoom(bigImageOptions.originWidth, bigImageOptions.originHeight); // this.calcPositionOfImage(false, true);

            this.calcPositionOfImage(this.scale, true);
            this.view.setEventNodePositionSize(this.pPos, this.pSize);
            this.dScale.x = this.baseScale.x;
            this.dScale.y = this.baseScale.y;
            this.iDPos = {
              x: getDifference(this.iSize.width, this.iSize.width * this.dScale.x) * -1 - this.lensPosition.left,
              y: getDifference(this.iSize.height, this.iSize.height * this.dScale.y) * -1 - this.lensPosition.top
            };
            this.view.setLensCss(this.lensPosition, this.lensSize, 'opacity .15s linear, transform .15s linear');
            this.view.setImageSize(this.iDPos, this.iSize, this.dScale);
            this.boundaries = this.view.getBoundaries();

            if (this.o.smoothing) {
              this.view.setEventToWrapper('transitionend', function (e) {
                e.stop();

                _this108.view.removeEventFromWrapper('transitionend');

                _this108.view.setLensStyle({
                  transition: ''
                });

                _this108.sendZoomShownEvent();
              });
              this.endOfShowing();
              this.anim.start();
            } else {
              this.endOfShowing();
              this.sendZoomShownEvent();
            } // deleted it from this.endOfShowing() function because it sometimes doesn't work
            // this.sendZoomShownEvent();


            return true;
          };

          return MController;
        }(Controller);

        return MController;
      }();
      /* eslint-env es6 */

      /* global checkRange */

      /* global TOUCH */

      /* global getDifference */

      /* global Eye */

      /* global getPercentValue */

      /* global helper */

      /* global Controller */

      /* global checkImagePosition */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars


      var OutsideController = function () {
        var DEFAULT_OUTSIDE_ZOOM_MARGIN = 9; // px

        var OController = /*#__PURE__*/function (_Controller3) {
          "use strict";

          bHelpers.inheritsLoose(OController, _Controller3);

          function OController(view, o) {
            var _this109;

            _this109 = _Controller3.call(this, view, $J.extend({
              margin: DEFAULT_OUTSIDE_ZOOM_MARGIN,
              outsidePosition: 'right',
              // top, left, right, bottom
              width: 100,
              // percent
              height: 100 // percent

            }, o)) || this;
            _this109.showingParams = null;
            _this109.eye = new Eye(_this109.view.getNodeForEye(), _this109.o.trigger === 'hover');
            _this109.ANIM_STEP = 0.18;
            _this109.mouseOutHandler = _this109.mouseOut.bind(bHelpers.assertThisInitialized(_this109));
            return _this109;
          }

          var _proto52 = OController.prototype;

          _proto52.getBoundaries = function getBoundaries() {
            this.boundaries = this.eye.getBoundaries();
          };

          _proto52.init = function init() {
            _Controller3.prototype.init.call(this);

            this.setLensSize();
          } // private
          ;

          _proto52.setEyesParams = function setEyesParams() {
            var sw = this.currentLensSize.width / (this.iSize.width * this.scale.x);
            var sh = this.currentLensSize.height / (this.iSize.height * this.scale.y);
            this.eye.setSize({
              width: sw * this.zoomNodeSize.width,
              height: sh * this.zoomNodeSize.height
            });
            this.eye.setPosition(this.x, this.y);
          };

          _proto52.calcPositionOfLens = function calcPositionOfLens() {
            var margin = this.o.margin;
            var ps = this.pSize;
            var pp = this.pPos;

            if (margin < 0) {
              margin = 0;
            }

            var t = pp.top;
            var l = pp.left;

            switch (this.o.outsidePosition) {
              case 'top':
                t += (this.lensSize.height + margin) * -1;
                break;

              case 'left':
                l += (this.lensSize.width + margin) * -1;
                break;

              case 'right':
                l += ps.width + margin;
                break;

              case 'bottom':
                t += ps.height + margin;
                break;
              //no default
            }

            this.lensPosition = {
              top: t,
              left: l
            };
          };

          _proto52.calcPositionOfImage = function calcPositionOfImage(scale) {
            if (!scale) {
              scale = this.dScale;
            }

            var w = this.iSize.width * scale.x;
            var h = this.iSize.height * scale.y;
            var dw = getDifference(this.iSize.width, w);
            var dh = getDifference(this.iSize.height, h);
            var x = this.x / (this.zoomNodeSize.width / w);
            var y = this.y / (this.zoomNodeSize.height / h);
            x = this.lensSize.width / 2 - x - dw;
            y = this.lensSize.height / 2 - y - dh;
            x = checkImagePosition(x, 0 - dw, dw + w, this.lensSize.width);
            y = checkImagePosition(y, 0 - dh, dh + h, this.lensSize.height);
            this.iPos = {
              x: x,
              y: y
            };
          };

          _proto52.afterMove = function afterMove() {
            this.calcPositionOfLens();
            this.calcPositionOfImage(this.scale);
            this.setEyesParams();
            this.view.setLensPosition(this.lensPosition);

            _Controller3.prototype.afterMove.call(this);
          };

          _proto52.hide = function hide(force) {
            var result = _Controller3.prototype.hide.call(this, force);

            if (result) {
              if (!$J.browser.mobile) {
                this.view.removeMouseMoveEvent(this.mouseOutHandler);
              }

              this.eye.clearEvents();
              this.eye.hide();

              if (force) {// empty
              } else {
                this.view.removeEvents();
                this.endOfHiding();
              }
            }

            return result;
          } // private
          ;

          _proto52.getShowingPropertiesToOutsideMode = function getShowingPropertiesToOutsideMode() {
            var result = {
              start: {
                x: 0,
                y: 0
              },
              end: {
                x: 0,
                y: 0
              }
            };

            switch (this.o.outsidePosition) {
              case 'top':
                result.start.y = 10;
                result.end.y = 0;
                break;

              case 'left':
                result.start.x = 10;
                result.end.x = 0;
                break;

              case 'right':
                result.start.x = -10;
                result.end.x = 0;
                break;

              case 'bottom':
                result.start.y = -10;
                result.end.y = 0;
                break;
              // no default
            }

            return result;
          } // private
          ;

          _proto52.endOfShowing = function endOfShowing() {
            _Controller3.prototype.endOfShowing.call(this);

            this.getBoundaries();
          }
          /*
              public
              toLevel = max || undefined(default), first, zero
          */
          ;

          _proto52.show = function show(smallImg, bigImageOptions, x, y, actionEndHide, toLevel) {
            if (!_Controller3.prototype.show.call(this)) {
              return false;
            }

            this.emit('zoomBeforeShow', {
              data: {}
            });
            this.iSize = {
              width: bigImageOptions.width,
              height: bigImageOptions.height
            };
            this.showingParams = this.getShowingPropertiesToOutsideMode();
            this.view.addStartCss(this.showingParams);
            this.view.appendNodes(smallImg, this.iSize);
            this.getSizes();
            this.setXY(x, y);
            this.calcSizeOfLens();
            this.calcPositionOfLens(); // this.getImagePosition();

            this.getBaseScale();
            this.showDeepZoom(bigImageOptions.originWidth, bigImageOptions.originHeight); // this.calcPositionOfImage(false, true);

            this.calcPositionOfImage(this.scale, true);
            this.view.setEventNodePositionSize(this.pPos, this.pSize);
            this.dScale.x = this.baseScale.x;
            this.dScale.y = this.baseScale.y;
            this.iDPos = {
              x: getDifference(this.iSize.width, this.iSize.width * this.dScale.x) * -1,
              y: getDifference(this.iSize.height, this.iSize.height * this.dScale.y) * -1
            };
            this.view.setLensCss(this.lensPosition, this.lensSize, this.o.smoothing ? 'opacity .4s linear, transform .15s ease-in' : 'none');
            this.view.setImageSize(this.iDPos, this.iSize, this.dScale);

            if (this.o.smoothing || toLevel === 'zero') {
              this.endOfShowing();
            }

            this.eye.show(this.view.getImageForEye());
            this.getBoundaries();
            this.setEyesParams();
            this.animStep = 0.3;

            if (this.o.smoothing) {
              this.anim.start();
            } else {
              this.endOfShowing();
            } // deleted it from this.endOfShowing() function because it sometimes doesn't work


            this.sendZoomShownEvent();
            return true;
          };

          _proto52.setLensSize = function setLensSize() {
            var s = {
              width: this.o.width,
              height: this.o.height
            };

            if (s.width === 'auto') {
              s.width = this.pSize.width;
            } else if (/%$/.test(this.o.width)) {
              s.width = this.pSize.width / 100 * parseInt(this.o.width, 10);
            } else {
              s.width = parseInt(s.width, 10);
            }

            if (s.height === 'auto') {
              s.height = this.pSize.height;
            } else if (/%$/.test(this.o.height)) {
              s.height = this.pSize.height / 100 * parseInt(this.o.height, 10);
            } else {
              s.height = parseInt(s.height, 10);
            }

            this.currentLensSize = {
              width: s.width,
              height: s.height
            };
          };

          _proto52.calcSizeOfLens = function calcSizeOfLens() {
            var cls = this.currentLensSize;
            this.lensSize = {
              width: cls.width,
              height: cls.height
            };
            this.lensHalfSize = {
              width: this.lensSize.width / 2,
              height: this.lensSize.height / 2
            };
          } // private
          ;

          _proto52.setEvents = function setEvents() {
            var _this110 = this;

            if ($J.browser.mobile && this.o.pan) {
              this.addOutsideTouchDrag();
            } // TODO maybe remove it


            if (!$J.browser.mobile && $J.browser.touchScreen && helper.isIe()) {
              if (!this.o.pan) {
                this.eye.setEventToMainContainer('pointerup', function (e) {
                  _this110.hide();
                });
              }
            }

            this.eye.setEventToMainContainer('mousemove', function (e) {
              e.stop();
              var pageXY = e.getPageXY();

              _this110.move(pageXY.x, pageXY.y);
            });

            if (this.o.trigger === 'hover') {
              if (!$J.browser.mobile) {
                this.view.addMouseMoveEvent(this.mouseOutHandler);
              }

              this.eye.setEventToMainContainer('mouseout', this.mouseOutHandler);
            } else {
              var eventName = 'btnclick tap';

              if (this.o.trigger === 'dblclick') {
                eventName = 'dblbtnclick dbltap';
              }

              this.eye.setEventToMainContainer(eventName, function (e) {
                _this110.hide();
              });
            }

            if (this.o.customZooming) {
              this.setMouseScrollEvent();
            }
          };

          _proto52.mouseOut = function mouseOut(e) {
            var p = e.getClientXY();

            if (p.x < this.boundaries.left || p.x > this.boundaries.right || p.y < this.boundaries.top || p.y > this.boundaries.bottom) {
              this.hide(!this.getZoomData());
            }
          } // private
          // it works if trigger !== 'hover'
          ;

          _proto52.addOutsideTouchDrag = function addOutsideTouchDrag() {
            var _this111 = this;

            var isStart = false;
            this.eye.setEventToMainContainer(TOUCH, function (e) {
              e.stop();

              if (e.state === 'dragstart') {
                isStart = true;
              } else if (e.state === 'dragend') {
                isStart = false;
              } else if (isStart) {
                _this111.move(e.x, e.y);
              }
            });
          } // private
          ;

          _proto52.setMouseScrollEvent = function setMouseScrollEvent() {
            var _this112 = this;

            this.eye.setEventToMainContainer('mousescroll', function (e) {
              var last = _this112.scale.x;
              var delta;
              e.stop();

              if (e.isMouse) {
                var percent = 37;
                var v = e.delta / getPercentValue(e.deltaFactor, percent);
                _this112.scale.x += v;
                _this112.scale.y += v;
              } else {
                delta = e.delta;

                if (Math.abs(delta) > 15) {
                  delta = 15;

                  if (e.delta < 0) {
                    delta *= -1;
                  }
                }

                delta /= 350;
                _this112.scale.x += delta;
                _this112.scale.y += delta;
              }

              _this112.scale.x = checkRange(_this112.scale.x, _this112.baseScale.x, 1);
              _this112.scale.y = checkRange(_this112.scale.y, _this112.baseScale.y, 1);

              _this112.calcPositionOfImage(_this112.scale);

              if (last !== _this112.scale.x) {
                _this112.sendZoomingAction();

                _this112.setCursorState();

                if (!_this112.o.smoothing) {
                  _this112.dScale.x = _this112.scale.x;
                  _this112.dScale.y = _this112.scale.y;
                  _this112.iDPos.x = _this112.iPos.x;
                  _this112.iDPos.y = _this112.iPos.y;

                  _this112.deepZoomAction();

                  _this112.setImagePosition(_this112.iPos, _this112.scale);
                }

                _this112.setEyesParams();
              }
            });
          };

          _proto52.setLensStyleOnResize = function setLensStyleOnResize() {
            this.view.setLensPosition(this.lensPosition);
            this.view.setCanvasNodeSize(this.lensSize);
          };

          _proto52.onResize = function onResize() {
            _Controller3.prototype.onResize.call(this);

            if (this.state !== globalVariables.APPEARANCE.HIDDEN && this.state !== globalVariables.APPEARANCE.HIDING) {
              this.eye.resize();
            }
          };

          _proto52.destroy = function destroy() {
            this.eye.destroy();
            this.view.removeMouseMoveEvent(this.mouseOutHandler);

            _Controller3.prototype.destroy.call(this);
          };

          return OController;
        }(Controller);

        return OController;
      }();
      /* eslint-env es6 */

      /* global InnerView */

      /* global EventEmitter */

      /* global InnerController */

      /* global MagnifierController */

      /* global MagnifierView */

      /* global OutsideController */

      /* global OutsideView */

      /* eslint-disable indent */

      /* eslint no-unused-vars: ["error", { "args": "none" }] */

      /* eslint guard-for-in: "off"*/

      /* eslint no-restricted-syntax: ["error",  "WithStatement", "BinaryExpression[operator='in']"] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */
      // eslint-disable-next-line no-unused-vars


      var ImageZoom = /*#__PURE__*/function (_EventEmitter14) {
        "use strict";

        bHelpers.inheritsLoose(ImageZoom, _EventEmitter14);

        function ImageZoom(parentNode, o) {
          var _this113;

          _this113 = _EventEmitter14.call(this) || this;
          _this113.zoomType = o.type;

          if (o.type === 'inner') {
            _this113.view = new InnerView(parentNode);

            _this113.view.addClassToWrapper('inner');

            _this113.controller = new InnerController(_this113.view, o);
          } else if ($J.contains(['circle', 'square'], o.type)) {
            _this113.view = new MagnifierView(parentNode);

            _this113.view.addClassToWrapper(o.type);

            _this113.controller = new MagnifierController(_this113.view, o);
          } else {
            // outside
            _this113.view = new OutsideView(parentNode);

            _this113.view.addClassToWrapper('outside');

            _this113.controller = new OutsideController(_this113.view, o);
          }

          _this113.controller.setParent(bHelpers.assertThisInitialized(_this113));

          _this113.controller.init();

          return _this113;
        }

        var _proto53 = ImageZoom.prototype;

        _proto53.setLensContainer = function setLensContainer(lensContainer) {
          this.controller.setLensContainer(lensContainer);
        };

        _proto53.isShown = function isShown() {
          return this.controller.isShown();
        };

        _proto53.getZoomData = function getZoomData(scale) {
          return this.controller.getZoomData(scale);
        };

        _proto53.getNextMinZoom = function getNextMinZoom() {
          return this.controller.getNextMinZoom();
        };

        _proto53.getNextMaxZoom = function getNextMaxZoom() {
          return this.controller.getNextMaxZoom();
        };

        _proto53.zoomUp = function zoomUp(x, y) {
          return this.controller.zoomUp(x, y);
        };

        _proto53.zoomDown = function zoomDown(x, y) {
          return this.controller.zoomDown(x, y);
        };

        _proto53.showCenter = function showCenter(smallImg, largeImg, toLevel) {
          return this.controller.showCenter(smallImg, largeImg, toLevel);
        };

        _proto53.isShowing = function isShowing() {
          return this.controller.isShowing();
        };

        _proto53.setImage = function setImage(data) {
          this.controller.setImage(data);
        };

        _proto53.show = function show(smallImg, bigImageOptions, x, y, actionEndHide, toLevel) {
          return this.controller.show(smallImg, bigImageOptions, x, y, actionEndHide, toLevel);
        };

        _proto53.hide = function hide(force) {
          return this.controller.hide(force);
        };

        _proto53.customMove = function customMove(x, y) {
          this.controller.customMove(x, y);
        };

        _proto53.getBaseScale = function getBaseScale() {
          return this.controller.baseScale;
        };

        _proto53.setBasePercent = function setBasePercent(point) {
          if (this.zoomType === 'inner') {
            this.controller.setBasePercent(point);
          }
        };

        _proto53.setScale = function setScale(scale, x, y) {
          if (this.zoomType === 'inner') {
            this.controller.setScale(scale, x, y);
          }
        };

        _proto53.onResize = function onResize() {
          this.controller.onResize();
        };

        _proto53.destroy = function destroy() {
          this.view.destroy();
          this.controller.destroy();
        };

        return ImageZoom;
      }(EventEmitter);

      return ImageZoom;
    });
    Sirv.define('Hotspots', ['bHelpers', 'magicJS', 'globalFunctions', 'EventEmitter', 'Hotspot', 'helper', 'Promise!'], function (bHelpers, magicJS, globalFunctions, EventEmitter, Hotspot, helper, Promise) {
      var moduleName = 'Hotspots';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global Hotspot */

      /* global EventEmitter */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Hotspots" }] */

      var Hotspots = /*#__PURE__*/function (_EventEmitter15) {
        "use strict";

        bHelpers.inheritsLoose(Hotspots, _EventEmitter15);

        function Hotspots() {
          var _this114;

          _this114 = _EventEmitter15.call(this) || this;
          _this114.container = $J.$new('div').addClass('sirv-hotspot-container');
          _this114.hotspots = [];
          _this114.activeHotspots = [];
          _this114.hoveredHotspots = [];
          _this114.originImageSize = {
            width: 0,
            height: 0
          };
          _this114.instanceComponentNode = null;
          _this114.api = {
            add: _this114.addHotspot.bind(bHelpers.assertThisInitialized(_this114)),
            remove: _this114.removeHotspot.bind(bHelpers.assertThisInitialized(_this114)),
            removeAll: _this114.removeAllHotspots.bind(bHelpers.assertThisInitialized(_this114)),
            list: _this114.getPointerNodeHotspots.bind(bHelpers.assertThisInitialized(_this114)),
            setVisibility: _this114.setStateById.bind(bHelpers.assertThisInitialized(_this114)),
            enable: _this114.enable.bind(bHelpers.assertThisInitialized(_this114)),
            disable: _this114.disable.bind(bHelpers.assertThisInitialized(_this114))
          };

          _this114.setEvents();

          return _this114;
        }

        var _proto54 = Hotspots.prototype;

        _proto54.setOriginImageSize = function setOriginImageSize(width, height) {
          this.originImageSize = {
            width: width,
            height: height
          };
        };

        _proto54.appendTo = function appendTo(container) {
          this.container.appendTo(container);
        };

        _proto54.setInstanceComponentNode = function setInstanceComponentNode(instance) {
          this.instanceComponentNode = instance;
        };

        _proto54.setContainerSize = function setContainerSize(instNodeBoundingClientRect) {
          if (!this.hotspots.length || !instNodeBoundingClientRect) {
            return;
          }

          var componentSize = this.getRightBoundengClientRect();
          this.container.setCss({
            top: instNodeBoundingClientRect.top - componentSize.top,
            left: instNodeBoundingClientRect.left - componentSize.left,
            width: instNodeBoundingClientRect.width * 100 / componentSize.width + '%',
            height: instNodeBoundingClientRect.height * 100 / componentSize.height + '%'
          });
          var size = this.container.getSize();
          var dx = size.width / this.originImageSize.width;
          var dy = size.height / this.originImageSize.height;
          this.hotspots.forEach(function (hs) {
            return hs.setAspectRatio(dx, dy);
          });
        };

        _proto54.getActiveHotspot = function getActiveHotspot(id) {
          return this.activeHotspots.filter(function (hs) {
            return hs.id === id;
          })[0] || null;
        };

        _proto54.getHoveredHotspots = function getHoveredHotspots(id) {
          return this.hoveredHotspots.filter(function (hs) {
            return hs.id === id;
          })[0] || null;
        };

        _proto54.setEvents = function setEvents() {
          var _this115 = this;

          this.on('hotspotActivate', function (e) {
            var activeHotspot = _this115.getActiveHotspot(e.data.hotspot.id);

            if (!activeHotspot) {
              e.stopEmptyEvent();

              _this115.activeHotspots.forEach(function (hs) {
                if (!hs.isBoxAlwaysVisible()) {
                  hs.hideBox(true);
                }
              });

              _this115.activeHotspots.push(e.data.hotspot);

              _this115.activeHotspots[_this115.activeHotspots.length - 1].overridePointerEvent();

              e.data.id = e.data.hotspot.id;
              delete e.data.hotspot;
            }
          });
          this.on('hotspotDeactivate', function (e) {
            e.stopEmptyEvent();

            var activeHotspot = _this115.getActiveHotspot(e.data.hotspot.id);

            if (activeHotspot) {
              activeHotspot.removeOverridePointerEvent();
              _this115.activeHotspots = _this115.activeHotspots.filter(function (hs) {
                return hs.id !== activeHotspot.id;
              });
            }

            e.data.id = e.data.hotspot.id;
            delete e.data.hotspot;
          });
          this.on('hotspotHovered', function (e) {
            var hoveredHotspot = _this115.getHoveredHotspots(e.data.hotspot.id);

            if (!hoveredHotspot) {
              e.stopAll();

              _this115.hoveredHotspots.push(e.data.hotspot);
            }
          });
          this.on('hotspotLeft', function (e) {
            e.stopAll();

            var hoveredHotspot = _this115.getHoveredHotspots(e.data.hotspot.id);

            if (hoveredHotspot) {
              _this115.hoveredHotspots = _this115.hoveredHotspots.filter(function (hs) {
                return hs.id !== hoveredHotspot.id;
              });
            }
          });

          this.clickFn = function (e) {
            _this115.activeHotspots.forEach(function (hs) {
              if (!hs.isBoxAlwaysVisible()) {
                hs.hideBox(true);
              }
            });

            _this115.hoveredHotspots.forEach(function (hs) {
              if (!hs.isTooltipAlwaysVisible()) {
                hs.hideTooltip(true);
              }
            });
          };

          $($J.D).addEvent('click', this.clickFn);
        };

        _proto54.isHotspotActivated = function isHotspotActivated() {
          return this.activeHotspots.length > 0;
        };

        _proto54.createHotspots = function createHotspots(hotspotsData) {
          var _this116 = this;

          if (hotspotsData && hotspotsData.length) {
            hotspotsData.forEach(function (data) {
              _this116.createHotspot(data, _this116.hotspots.length);
            });
          }
        };

        _proto54.createHotspot = function createHotspot(hotspotData, index) {
          var hotspot = new Hotspot(this.container, hotspotData, index);
          hotspot.setParent(this);
          this.hotspots.push(hotspot);
        };

        _proto54.addHotspot = function addHotspot(hotspotsData) {
          if (!Array.isArray(hotspotsData)) {
            hotspotsData = [hotspotsData];
          }

          this.createHotspots(hotspotsData, this.hotspots.length);
        };

        _proto54.getRightBoundengClientRect = function getRightBoundengClientRect(hotspotsContainer) {
          if (!this.hotspots.length) {
            return this.instanceComponentNode ? this.instanceComponentNode.node.getBoundingClientRect() : hotspotsContainer.node.getBoundingClientRect();
          }

          return this.container.node.parentNode.getBoundingClientRect();
        };

        _proto54.changeBoxContainerParent = function changeBoxContainerParent(inside) {
          var c = inside ? this.container : null;
          this.hotspots.forEach(function (hotspot) {
            hotspot.changeBoxContainer(c);
          });
        };

        _proto54.hideActiveHotspotBox = function hideActiveHotspotBox(flag) {
          var result = this.activeHotspots.length || this.hoveredHotspots.length;
          this.activeHotspots.forEach(function (hs) {
            hs.hideBox(flag);
          });
          this.hoveredHotspots.forEach(function (hs) {
            hs.hideTooltip();
          });
          return result;
        };

        _proto54.show = function show(index) {
          var hs = this.hotspots[index];

          if (hs) {
            hs.show();
          }
        };

        _proto54.showAll = function showAll() {
          this.hotspots.forEach(function (hotspot) {
            hotspot.show();
          });
        };

        _proto54.hide = function hide(index) {
          var hs = this.hotspots[index];

          if (hs) {
            hs.hide();
          }
        };

        _proto54.hideAll = function hideAll() {
          this.hotspots.forEach(function (hotspot) {
            hotspot.hide();
          });
        };

        _proto54.enable = function enable(index) {
          var hs = this.hotspots[index];

          if (hs) {
            hs.enable();
            hs.show();
          }
        };

        _proto54.disable = function disable(index) {
          if (this.hotspots[index]) {
            this.hotspots[index].disable();
          }
        };

        _proto54.enableAll = function enableAll() {
          this.hotspots.forEach(function (hotspot) {
            hotspot.enable();
            hotspot.show();
          });
        };

        _proto54.disableAll = function disableAll() {
          this.hotspots.forEach(function (hotspot) {
            hotspot.disable();
          });
        };

        _proto54.showNeededElements = function showNeededElements() {
          this.hotspots.forEach(function (hs) {
            if (hs.isEnabled() && hs.isHotspotShown()) {
              if (hs.isBoxAlwaysVisible()) {
                if (hs.isBoxActivated()) {
                  hs.setBoxPosition();
                }

                hs.showBox();
              }

              if (hs.isTooltipAlwaysVisible()) {
                if (hs.isTooltipHovered()) {
                  hs.setTooltipPosition();
                }

                hs.showTooltip();
              }
            }
          });
        };

        _proto54.getHotspots = function getHotspots() {
          return this.hotspots;
        };

        _proto54.getPointerNodeHotspots = function getPointerNodeHotspots() {
          var pointers = [];
          this.hotspots.forEach(function (hotspot) {
            pointers.push(hotspot.getHotspotPointer());
          });
          return pointers;
        };

        _proto54.removeHotspot = function removeHotspot(index) {
          var hs = this.hotspots[index];

          if (hs) {
            hs.disable();
            hs.destroy();
            this.removeByIndex(index);

            if (!this.hotspots.length) {
              this.container.remove();
            }
          }
        };

        _proto54.removeAllHotspots = function removeAllHotspots() {
          for (var i = this.hotspots.length - 1; i >= 0; i--) {
            this.removeHotspot(i);
          }
        };

        _proto54.removeByIndex = function removeByIndex(index) {
          this.hotspots.splice(index, 1);

          if (this.hotspots.length > 0 && index === 0 || index > 0 && index <= this.hotspots.length - 1) {
            this.rewriteHotspotIndex(index);
          }
        };

        _proto54.rewriteHotspotIndex = function rewriteHotspotIndex(startIndex) {
          for (var index = startIndex, l = this.hotspots.length; index < l; index++) {
            this.hotspots[index].setId(index);
            this.hotspots[index].rewriteAttrPointer();
          }
        };

        _proto54.setStateById = function setStateById(index, settings) {
          if (this.hotspots[index]) {
            this.hotspots[index].setState(settings);
          }
        };

        _proto54.destroy = function destroy() {
          $($J.D).removeEvent('click', this.clickFn);
          this.hotspots.forEach(function (hotspot) {
            hotspot.destroy();
          });
          this.container = null;
          this.activeHotspots = [];
          this.hoveredHotspots = [];
          this.instanceComponentNode = null;
          this.off('hotspotActivate');
          this.off('hotspotDeactivate');
          this.off('hotspotHovered');
          this.off('hotspotLeft');
          this.hotspots = null;

          _EventEmitter15.prototype.destroy.call(this);
        };

        return Hotspots;
      }(EventEmitter);

      return Hotspots;
    });
    Sirv.define('SpinHotspots', ['bHelpers', 'magicJS', 'globalFunctions', 'EventEmitter', 'Hotspots', 'helper', 'Promise!'], function (bHelpers, magicJS, globalFunctions, EventEmitter, Hotspots, helper, Promise) {
      var moduleName = 'SpinHotspots';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global Hotspots, helper*/

      /* eslint-disable guard-for-in */

      /* eslint-disable no-restricted-syntax */

      /* eslint-disable no-loop-func */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "SpinHotspots" }] */

      var SpinHotspots = /*#__PURE__*/function (_Hotspots) {
        "use strict";

        bHelpers.inheritsLoose(SpinHotspots, _Hotspots);

        function SpinHotspots() {
          var _this117;

          _this117 = _Hotspots.call(this) || this;
          _this117.options = {
            rows: 1,
            columns: 36,
            rowsRevers: false,
            columnsRevers: false,
            originImageSize: {}
          };
          _this117.row = null;
          _this117.col = null;
          _this117.hotspotsSettings = [];
          return _this117;
        }

        var _proto55 = SpinHotspots.prototype;

        _proto55.setOptions = function setOptions(options) {
          this.options = $J.extend(this.options, options || {});
        };

        _proto55.getFrameIndex = function getFrameIndex() {
          var result;

          if (this.options.rowsRevers && this.options.columnsRevers) {
            result = (this.options.rows - this.row - 1) * this.options.columns + (this.options.columns - this.col);
          } else if (this.options.rowsRevers) {
            result = (this.options.rows - this.row - 1) * this.options.columns + this.col + 1;
          } else if (this.options.columnsRevers) {
            result = this.row * this.options.columns + (this.options.columns - this.col);
          } else {
            result = this.row * this.options.columns + this.col + 1;
          }

          return result;
        };

        _proto55.createHotspotsSettings = function createHotspotsSettings(dataSettings) {
          var _this118 = this;

          var firstFrame = true;

          var _loop = function (index, l) {
            var map = new Map();
            var settings = {};
            helper.objEach(dataSettings[index].frames, function (frame) {
              settings = dataSettings[index].frames[frame];
              settings.pointerPositionPercentage = {
                top: helper.isPercentage('' + dataSettings[index].frames[frame].pointer.y),
                left: helper.isPercentage('' + dataSettings[index].frames[frame].pointer.x)
              };
              helper.objEach(dataSettings[index], function (item) {
                if (item !== 'frames') {
                  if (!(item === 'data' && !firstFrame)) {
                    settings[item] = dataSettings[index][item];
                    firstFrame = false;
                  }
                }
              });
              map.set(parseInt(frame, 10), settings);
            });

            _this118.hotspotsSettings.push(map);

            firstFrame = true;
          };

          for (var index = 0, l = dataSettings.length; index < l; index++) {
            _loop(index, l);
          }
        };

        _proto55.createHotspots = function createHotspots(hotspotsData) {
          if (!Array.isArray(hotspotsData)) {
            hotspotsData = [hotspotsData];
          }

          this.createHotspotsSettings(hotspotsData);
          var hotspotSettings = this.getStartHotspotSettings();

          _Hotspots.prototype.createHotspots.call(this, hotspotSettings);
        };

        _proto55.addHotspot = function addHotspot(hotspotData) {
          if (!Array.isArray(hotspotData)) {
            hotspotData = [hotspotData];
          }

          this.createHotspotsSettings(hotspotData);
          var hotspotSettings = this.getStartHotspotSettings();

          _Hotspots.prototype.createHotspots.call(this, hotspotSettings.slice(hotspotSettings.length - hotspotData.length));

          this.updateAndShow();
        };

        _proto55.getStartHotspotSettings = function getStartHotspotSettings() {
          var tempHotspotData = [];
          this.hotspotsSettings.forEach(function (map) {
            var startSettings = null;

            if ($J.browser.uaName === 'ie') {
              map.forEach(function (value) {
                if (!startSettings) {
                  startSettings = value;
                }
              });
            } else if (map.entries().next().value) {
              startSettings = map.entries().next().value[1];
            }

            if (startSettings) {
              tempHotspotData.push(startSettings);
            }
          });
          return tempHotspotData;
        };

        _proto55.setFramePosition = function setFramePosition(row, col) {
          this.row = row;
          this.col = col;
        };

        _proto55.updateAndShow = function updateAndShow() {
          var _this119 = this;

          var frameIndex = this.getFrameIndex();
          this.hotspotsSettings.forEach(function (hotspotSettings, index) {
            var sett = hotspotSettings.get(frameIndex);
            var hs = _this119.hotspots[index];

            if (sett && hs.isEnabled()) {
              hs.setHotspotSettings(sett);

              if (hs.isHotspotShown()) {
                hs.setPointerPosition();

                _this119.showNeededElements();

                if (hs.isBoxAlwaysVisible()) {
                  hs.setBaseBoxSize(hs.box.getSize());
                  hs.setBoxPosition();
                }

                if (hs.isTooltipAlwaysVisible()) {
                  hs.setTooltipPosition();
                }
              } else {
                _this119.show(index);
              }
            } else {
              _this119.hide(index);
            }
          });
        };

        _proto55.hideNeededElements = function hideNeededElements(flag) {
          this.activeHotspots.forEach(function (hs) {
            if (!hs.isBoxAlwaysVisible()) {
              hs.hideBox(flag);
            }
          });
          this.hoveredHotspots.forEach(function (hs) {
            if (hs.isTooltipAlwaysVisible()) {
              hs.hideTooltip(flag);
            }
          });
        };

        _proto55.changeHotspotsPosition = function changeHotspotsPosition(row, col) {
          if (this.row !== row || this.col !== col) {
            this.setFramePosition(row, col);
            this.updateAndShow();
          }
        };

        _proto55.showAll = function showAll() {
          var _this120 = this;

          var position = this.getFrameIndex();
          this.hotspotsSettings.forEach(function (map, index) {
            if (map.get(position)) {
              _this120.show(index);
            }
          });
        };

        _proto55.enable = function enable(index) {
          if (this.hotspotsSettings[index]) {
            var hs = this.hotspots[index];
            hs.enable();

            if (this.hotspotsSettings[index].get(this.getFrameIndex())) {
              hs.show();
            }
          }
        };

        _proto55.setStateById = function setStateById(index, settings) {
          if (this.hotspots[index]) {
            this.hotspots[index].setState(settings, !this.hotspotsSettings[index].get(this.getFrameIndex()));
          }
        };

        _proto55.removeHotspot = function removeHotspot(index) {
          if (this.hotspots[index]) {
            this.hotspotsSettings.splice(index, 1);

            _Hotspots.prototype.removeHotspot.call(this, index);
          }
        };

        _proto55.destroy = function destroy() {
          _Hotspots.prototype.destroy.call(this);

          this.options = null;
          this.row = null;
          this.col = null;
          this.hotspotsSettings = null;
        };

        return SpinHotspots;
      }(Hotspots);

      return SpinHotspots;
    });
    Sirv.define('SliderBuilder', ['bHelpers', 'magicJS', 'EventEmitter', 'helper', 'globalVariables', 'globalFunctions', 'Promise!'], function (bHelpers, magicJS, EventEmitter, helper, globalVariables, globalFunctions, Promise) {
      var moduleName = 'SliderBuilder';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global $J, helper, Promise */

      /* eslint-disable no-extra-semi */

      /* eslint-disable no-unused-vars */

      /* eslint class-methods-use-this: ["error", {"exceptMethods": ["loadData"]}] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var SLIDER_BUILDER_CONF_VER = 1;

      var getInfoUrl = function (url, callbackName) {
        return url + ($J.stringHas(url, '?') ? '&' : '?') + 'nometa&info=' + callbackName;
      };

      var SliderBuilder = /*#__PURE__*/function () {
        "use strict";

        function SliderBuilder(sirvOption, node) {
          this.mainNode = $(node);
          this.sirvOptions = helper.deepExtend({}, sirvOption || {});
          this.nodes = [];
          this.configURL = null;
          this.dataJSON = null;
          this.configHash = null;
          this.attrbMainNode = null;
          this.cfCallbackName = null;
          this.urlParams = null;
          this.componentsList = [];
          this.referrerPolicy = this.mainNode.attr('data-referrerpolicy') || this.mainNode.attr('referrerpolicy') || 'no-referrer-when-downgrade';
        }

        var _proto56 = SliderBuilder.prototype;

        _proto56.getOptions = function getOptions() {
          var _this121 = this;

          return new Promise(function (resolve, reject) {
            if (_this121.checkNode()) {
              _this121.buildCallBackName();

              helper.getRemoteData(getInfoUrl(_this121.configURL, _this121.cfCallbackName), _this121.cfCallbackName, _this121.referrerPolicy).then(function (result) {
                if (result && result.assets) {
                  _this121.dataJSON = result;

                  _this121.buildOptions();

                  resolve({
                    'dataOptions': _this121.sirvOptions
                  });
                } else {
                  var contentType = globalVariables.SLIDE.TYPES.IMAGE;

                  if (result.layers) {
                    contentType = globalVariables.SLIDE.TYPES.SPIN;
                  }

                  resolve({
                    'content': contentType,
                    'dataOptions': _this121.sirvOptions
                  });
                }
              }).catch(function (error) {
                error = _this121.configURL;
                reject({
                  'error': _this121.configURL,
                  'dataOptions': _this121.sirvOptions
                });
              });
            } else {
              resolve({
                'dataOptions': _this121.sirvOptions
              });
            }
          });
        };

        _proto56.buildViewer = function buildViewer() {
          var _this122 = this;

          return new Promise(function (resolve, reject) {
            if (_this122.dataJSON) {
              var parsedURL = /(^https?:\/\/[^/]*)([^#?]*)\/.*$/.exec(_this122.configURL);
              var pathname = _this122.dataJSON.dirname || parsedURL[2];

              _this122.prepareListComponents(_this122.dataJSON.assets, parsedURL[1], pathname);

              _this122.generateComponents();

              _this122.addAllComponents();
            }

            resolve({
              'mainNode': _this122.mainNode
            });
          });
        };

        _proto56.prepareListComponents = function prepareListComponents(listComponents, origin, folderPath) {
          var _this123 = this;

          listComponents.forEach(function (component) {
            var path;
            var is3rd = /^(https?:)?\/\/[^/]/.test(component.name);

            if (is3rd) {
              path = component.name;
            } else if (/^\//.test(component.name)) {
              path = origin + component.name;
            } else {
              path = origin + folderPath + '/' + component.name;
            }

            _this123.componentsList.push({
              'path': is3rd ? path : globalFunctions.normalizeURL(path),
              'type': globalVariables.SLIDE.NAMES.indexOf(component.type),
              'is3rd': is3rd
            });
          });
        };

        _proto56.checkNode = function checkNode() {
          var result = false;
          var template = /([^#?]+)\/?([^#?]+\.view)(\?([^#]*))?(#(.*))?$/;

          if (this.mainNode) {
            this.attrbMainNode = this.mainNode.attr('data-src');

            if (this.attrbMainNode && template.test(this.attrbMainNode)) {
              result = true;
            }
          }

          return result;
        };

        _proto56.buildOptions = function buildOptions() {
          this.sirvOptions.common = helper.deepExtend(this.sirvOptions.common, this.dataJSON.settings || {});
          this.sirvOptions.mobile = helper.deepExtend(this.sirvOptions.mobile, this.dataJSON.settings || {});
        };

        _proto56.buildCallBackName = function buildCallBackName() {
          this.configURL = globalFunctions.normalizeURL(this.attrbMainNode.replace(globalVariables.REG_URL_QUERY_STRING, '$1'));
          this.urlParams = this.attrbMainNode.replace(globalVariables.REG_URL_QUERY_STRING, '$2');

          if (this.urlParams) {
            this.configURL += '?' + this.urlParams;
          }

          this.configHash = $J.getHashCode(this.configURL.replace(/^http(s)?:\/\//, ''));
          this.cfCallbackName = 'view-' + SLIDER_BUILDER_CONF_VER + '_' + this.configHash;
        };

        _proto56.generateComponents = function generateComponents() {
          var _this124 = this;

          this.componentsList.forEach(function (item) {
            var node = $J.$new('div');

            if (item.type === globalVariables.SLIDE.TYPES.IMAGE) {
              if (item.is3rd) {
                node = $J.$new('img');
                node.attr('data-type', 'static');
              } else {
                node.attr('data-type', 'zoom');
              }
            }

            var path = item.path;

            if (_this124.urlParams) {
              path += '?' + _this124.urlParams;
            }

            node.attr('data-src', path);

            _this124.nodes.push(node);
          });
        };

        _proto56.addAllComponents = function addAllComponents() {
          var _this125 = this;

          this.mainNode.node.innerHTML = '';
          this.nodes.forEach(function (item) {
            _this125.mainNode.node.appendChild(item.node);
          });
        };

        _proto56.destroy = function destroy() {
          this.mainNode = null;
          this.sirvOptions = null;
          this.nodes = [];
          this.configURL = null;
          this.dataJSON = null;
          this.configHash = null;
          this.cfCallbackName = null;
          this.componentsList = [];
        };

        return SliderBuilder;
      }();

      return SliderBuilder;
    });
    Sirv.define('getDPPX', ['bHelpers', 'magicJS', 'helper', 'ResponsiveImage'], function (bHelpers, magicJS, helper, ResponsiveImage) {
      var moduleName = 'getDPPX';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global ResponsiveImage, helper */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "getDPPX" }] */

      var getDPPX = function (currentWidth, currentHeight, originWidth, originHeight, round, upscale) {
        var result = 1;
        var tmp;

        if ($J.DPPX > 1) {
          if (currentHeight > currentWidth) {
            tmp = currentHeight;

            if (round) {
              tmp = ResponsiveImage.roundImageSize({
                height: currentHeight
              }).height;
            }

            result = helper.getDPPX(tmp, originHeight, upscale);
          } else {
            tmp = currentWidth;

            if (round) {
              tmp = ResponsiveImage.roundImageSize({
                width: currentWidth
              }).width;
            }

            result = helper.getDPPX(tmp, originWidth, upscale);
          }
        }

        return result;
      };

      return getDPPX;
    });
    Sirv.define('LazyImage', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Promise!', 'ResponsiveImage', 'BaseInstance', 'getDPPX'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, Promise, ResponsiveImage, BaseInstance, getDPPX) {
      var moduleName = 'LazyImage';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable no-extra-semi */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var defaultOptions = {
        resize: {
          type: 'boolean',
          defaults: true
        },
        // A distance from the viewport within which images should be loaded.
        threshold: {
          type: 'number',
          minimum: 0,
          defaults: 0
        },
        fit: {
          type: 'string',
          'enum': ['contain', 'cover', 'crop', 'none'],
          defaults: 'contain'
        },
        // Quality applied to images (1x - 1.49x).
        quality: {
          type: 'number',
          minimum: 0,
          maximum: 100,
          defaults: 80
        },
        // Quality applied to hi-res images (1.5x - 2x).
        hdQuality: {
          type: 'number',
          minimum: 0,
          maximum: 100,
          defaults: 60
        },
        autostart: {
          oneOf: [
          /*
              created - init and load
              visible - init and load in view
              off - not init
          */
          {
            type: 'string',
            'enum': ['created', 'visible', 'off']
          }, {
            type: 'boolean',
            'enum': [false]
          }],
          defaults: 'visible'
        },
        onReady: {
          type: 'function',
          defaults: function () {}
        }
      };
      /*
          image without slider
      
          If image is as background
          background-size: auto;
          background-size: contain;
          background-size: cover;
          background-size: 100px;
          background-size: 50%;
          background-size: 100px, 150px;
      */

      /* eslint-env es6 */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var Appearance = /*#__PURE__*/function () {
        "use strict";

        function Appearance(node) {
          this.node = $(node);
          this.state = 0; // 0 - nothing, 1 - before loading image, 2 - after loading high quality image

          this.states = $(['sirv-image-loading', 'sirv-image-loaded']);
        }

        var _proto57 = Appearance.prototype;

        _proto57.setState = function setState(numberOfState) {
          if (this.state !== numberOfState) {
            if (this.state - 1 >= 0) {
              this.node.removeClass(this.states[this.state - 1]);
            }

            this.state = numberOfState;
            this.node.addClass(this.states[numberOfState - 1]);
          }
        };

        _proto57.destroy = function destroy() {
          var _this126 = this;

          this.state = 0;
          this.states.forEach(function (className) {
            _this126.node.removeClass(className);
          });
          this.node = null;
        };

        return Appearance;
      }();
      /* eslint-env es6 */

      /* global BaseInstance */

      /* global ResponsiveImage */

      /* global helper */

      /* global globalFunctions */

      /* global globalVariables */

      /* global Appearance */

      /* global getDPPX */

      /* global defaultOptions */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint class-methods-use-this: ["error", { "exceptMethods": ["_imageOnerrorHandler", "_setHDQuality"] }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "LazyImage" }] */
      // const calcCropPositionForBGImage = (position, nodeSize, originImageSize) => {
      //     let result = helper.round((originImageSize - nodeSize) / 100 * position);
      //     if (result < 0) { result = 0; }
      //     return result;
      // };


      var P = globalVariables.smv;

      var inView = function (node) {
        var rect = node.getBoundingClientRect();
        return !(rect.top === 0 && rect.right === 0 && rect.bottom === 0 && rect.left === 0 && rect.width === 0 && rect.height === 0); // hidden
      };

      var LazyImage = /*#__PURE__*/function (_BaseInstance2) {
        "use strict";

        bHelpers.inheritsLoose(LazyImage, _BaseInstance2);

        function LazyImage(node, options, force) {
          var _this127;

          options.options = {
            common: {
              common: options.options.common,
              mobile: {}
            },
            local: {
              common: '',
              mobile: ''
            }
          };
          _this127 = _BaseInstance2.call(this, node, options, defaultOptions) || this;
          _this127.node = _this127.instanceNode;
          _this127.type = globalVariables.SLIDE.TYPES.IMAGE;
          _this127.isLazy = _this127.option('autostart') === 'visible';
          _this127.image = null;
          _this127.isInfoLoaded = false;
          _this127.infoSize = {
            width: 0,
            height: 0
          };
          _this127.isNotSirv = false;
          _this127.isInView = false;
          _this127.isStaticImage = false;
          _this127.dppx = 1;
          _this127.getImageInfoPromise = null;
          _this127.loadStaticImagePromise = null;
          _this127.upscale = false;
          _this127.size = {
            width: 0,
            height: 0
          };
          _this127.maxSize = {};
          _this127.lastImageSize = {
            width: 0,
            height: 0
          };
          _this127.srcWasSetted = false;
          _this127.originAlt = null;
          _this127.infoAlt = null;
          _this127.originTitle = null;
          _this127.src = null;
          _this127.srcset = null;
          _this127.startedSrc = null;
          _this127.dataSrc = null;
          _this127.imageUrl = null;
          _this127.dontLoad = true;
          _this127.appearanceState = null;
          _this127.dataBgSrc = null;
          _this127.inViewModule = null;
          _this127.rootMargin = 0;
          _this127.fitSize = null;
          _this127.backgroundNodeSize = null;
          _this127.isMaxWidthSet = false;
          _this127.cropPosition = {
            x: null,
            y: null
          };
          _this127.cssBackgroundSize = null;
          _this127.isPlaceholder = false;
          _this127.isRun = false;
          _this127.inited = false;
          _this127.resizeDebounce = helper.debounce(function () {
            _this127._setRootMargin();

            _this127.onResize();
          }, 50);

          _this127.resizeHandler = function (e) {
            _this127.resizeDebounce();
          };

          var as = _this127.instanceOptions.get('autostart');

          if (as && as !== 'off' || force) {
            _this127.preInit();
          }

          return _this127;
        }

        var _proto58 = LazyImage.prototype;

        _proto58.preInit = function preInit() {
          var _this128 = this;

          this.isRun = true;
          this.inViewModule = new helper.InViewModule(function (entries) {
            entries.forEach(function (entry) {
              // https://github.com/verlok/vanilla-lazyload/issues/293#issuecomment-469100338
              // Sometimes 'intersectionRatio' can be 0 but 'isIntersecting' is true
              var iv = entry.isIntersecting || entry.intersectionRatio > 0;

              if (_this128.isInView !== iv) {
                if (!_this128.inited) {
                  _this128.isInView = iv;

                  if (iv) {
                    _this128.init();
                  } else if (inView(_this128.instanceNode.node)) {
                    _this128.init();
                  }
                } else {
                  _this128.inViewCallback(iv);
                }
              }
            });
          }, {
            rootMargin: this.rootMargin + 'px 0px'
          });
          this.inViewModule.observe(this.instanceNode);

          if (inView(this.instanceNode.node)) {
            this.init();
          }
        };

        _proto58.init = function init() {
          this.inited = true;

          try {
            this.maxWidth = this.instanceNode.node.style.maxWidth;
          } catch (ex) {
            /* empty */
          }

          this._getBaseData();

          if (this.imageUrl && ($J.browser.ready || $J.D.node.readyState !== 'loading')) {
            this.startFullInit();
          }

          this.createSirvImage();
        };

        _proto58.stop = function stop() {
          this.destroy();
          return true;
        };

        _proto58.getOptionsForStartFullInit = function getOptionsForStartFullInit(options) {
          if (options) {
            options = {
              common: {
                common: options.common.lazyImage,
                mobile: options.mobile.lazyImage
              },
              local: {
                common: '',
                mobile: ''
              }
            };
          }

          _BaseInstance2.prototype.getOptionsForStartFullInit.call(this, options);
        };

        _proto58.checkReadiness = function checkReadiness(eventname, component) {
          if (eventname === 'onLoad') {
            return this._isReady;
          }

          return false;
        };

        _proto58._setRootMargin = function _setRootMargin() {
          var value = parseInt(this.option('threshold'), 10);

          if ($J.typeOf(this.option('threshold')) === 'string') {
            value = ($J.W.node.innerHeight || $J.D.node.documentElement.clientHeight) / 100 * value; // eslint-disable-line operator-assignment
          }

          this.rootMargin = value;
        };

        _proto58._getQueryParams = function _getQueryParams() {
          if (this.imageUrl) {
            this.queryParams = helper.paramsFromQueryString(this.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$2'));

            if (this.queryParams) {
              var q = parseInt(this.queryParams.quality, 10);

              if (isNaN(q)) {
                delete this.queryParams.quality;
              } else {
                this.queryParams.quality = q;
              }
            }

            this.queryParamsQuality = this.queryParams.quality || null;
          }
        };

        _proto58._getBaseData = function _getBaseData() {
          this.originAlt = this.instanceNode.attr('alt');
          this.originTitle = this.instanceNode.attr('title');
          this.src = this.instanceNode.attr('src');
          this.srcset = this.instanceNode.attr('srcset');
          this.startedSrc = this.src;
          this.dataSrc = this.instanceNode.attr('data-src');
          this.isStaticImage = this.src && !this.dataSrc;
          this.imageUrl = this.dataSrc || this.src;

          if (helper.isSVG(this.imageUrl) || this.instanceNode.attr('data-type') === 'static') {
            this.isNotSirv = true;
          }

          this.dataBgSrc = this.instanceNode.attr('data-bg-src');
          this.isStaticImage = this.isStaticImage && !this.dataBgSrc;
          this.imageUrl = this.dataBgSrc || this.imageUrl;

          if (this.instanceNode.getTagName() === 'img') {
            this.instanceNode.attr('referrerpolicy', this.referrerPolicy);

            if (this.dataBgSrc) {
              if (!this.dataSrc) {
                this.dataSrc = this.dataBgSrc;
              }

              this.dataBgSrc = null;
            }
          }

          if (this.dataBgSrc) {
            this.dontLoad = false;
          }

          if (this.imageUrl) {
            // Image URL
            this.src = globalFunctions.normalizeURL(this.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$1'));
          } // Image default params


          this._getQueryParams();

          if (this.startedSrc && this.dataSrc && this.startedSrc !== this.dataSrc) {
            this.isPlaceholder = this.instanceNode.attr('src');
          }
        };

        _proto58.createSirvImage = function createSirvImage() {
          var _this129 = this;

          if (!this.imageUrl || this.isNotSirv) {
            return;
          }

          this.on('imageOnload', function (e) {
            e.stopAll();

            _this129.replaceSrc();

            if (!_this129._isReady) {
              if (_this129.isStaticImage) {
                _this129.done();
              } else {
                var showImage = function () {
                  if (_this129.appearanceState) {
                    _this129.appearanceState.setState(2);

                    _this129.done();
                  }
                };

                if (e.data.node) {
                  showImage();
                } else {
                  helper.loadImage(_this129.instanceNode).finally(function () {
                    showImage();
                  });
                }
              }
            }
          });
          this.on('imageOnerror', function (e) {
            e.stopAll();
            console.log('image error');
          });
          this.image = new ResponsiveImage(this.imageUrl, {
            imageSettings: this.queryParams,
            round: true,
            dontLoad: this.dontLoad,
            convertSmallerSideToZero: this.option('fit') !== 'crop',
            referrerPolicy: this.referrerPolicy
          });
          this.image.setParent(this);
          this.getInfoSize().catch(function (err) {
            if (err._isplaceholder) {
              _this129.infoSize = err;
              _this129.isNotSirv = true;
            }
          }).finally(function () {
            if ($J.D.node.readyState !== 'loading') {
              if (_this129.isStartedFullInit) {
                _this129.run();
              }
            }
          });
        };

        _proto58.getInfoSize = function getInfoSize() {
          var _this130 = this;

          if (!this.getImageInfoPromise) {
            this.getImageInfoPromise = new Promise(function (resolve, reject) {
              if (_this130.image) {
                _this130.image.getImageInfo().then(function (info) {
                  _this130.isInfoLoaded = true;
                  _this130.infoAlt = _this130.image.getDescription();
                  _this130.infoSize = _this130.image.getOriginSize();
                  _this130.cropPosition = _this130.image.getCropPosition();
                  resolve(info);
                }).catch(function (err) {
                  _this130.isInfoLoaded = true;

                  if (!err.status || err.status !== 404) {
                    _this130.isNotSirv = true;
                  }

                  reject(err);
                });
              } else {
                reject();
              }
            });
          }

          return this.getImageInfoPromise;
        };

        _proto58.getId = function getId(idPrefix, df) {
          this.id = this.instanceNode.attr('id');

          if (!this.id && !this.isStaticImage) {
            _BaseInstance2.prototype.getId.call(this, idPrefix, df);
          }
        };

        _proto58.startFullInit = function startFullInit(options, force) {
          if (this.isStartedFullInit || !this.inited) {
            return;
          }

          this.getOptionsForStartFullInit(options);
          var as = this.option('autostart');

          if (!this.inited && !(as && as !== 'off' || force)) {
            return;
          }

          _BaseInstance2.prototype.startFullInit.call(this, options);

          if (options) {
            this.isLazy = this.option('autostart') === 'visible';
          }

          this.getId('responsive-image-', ' ');

          if (this.dataBgSrc) {
            this.cssBackgroundSize = helper.imageLib.getBackgroundSize(this.instanceNode);

            if (this.cssBackgroundSize) {
              this.option('fit', 'none');
            }

            this.instanceNode.addClass(P + '-bg-image');

            if (this.option('fit') !== 'none') {
              if (this.option('fit') === 'contain') {
                this.instanceNode.addClass(P + '-bg-contain');
              } else {
                this.instanceNode.addClass(P + '-bg-cover');
              }
            }
          }

          this._setRootMargin();

          if (this.isStaticImage) {
            this.isLazy = false;
          } else {
            this.appearanceState = new Appearance(this.instanceNode);

            if (!this.isPlaceholder) {
              this.appearanceState.setState(1);
            }
          }

          if (!this.isLazy) {
            this.isInView = true;
            this.inViewModule.disconnect();
            this.inViewModule = null;
          }

          if (this.isInfoLoaded || this.isNotSirv) {
            if ($J.D.node.readyState !== 'loading') {
              this.run();
            }
          }

          $J.W.addEvent('resize', this.resizeHandler);
        };

        _proto58.fixHeight = function fixHeight(height) {
          if (height !== 0) {
            var blockSize = parseInt(this.instanceNode.getCss('block-size'), 10);

            if (height === blockSize || height <= 16) {
              height = 0;
            }
          }

          return height;
        };

        _proto58.run = function run() {
          var _this131 = this;

          var result = _BaseInstance2.prototype.run.call(this);

          if (result) {
            // Remove ALT to properly calculate image size.
            // Safari and Edge/IE return image size with a height if ALT text is present.
            this.instanceNode.removeAttr('alt'); // Remove TITLE to properly calculate image size.
            // The latest version(s) of Chrome returns image size with a height if TITLE is set.

            this.instanceNode.removeAttr('title'); // This force browsers to re-layout image and recalculate its dimensions.

            this.instanceNode.setCss({
              display: 'inline-flex'
            }).getSize();
            this.instanceNode.setCss({
              display: ''
            }).getSize();
            var size = null;
            helper.imageLib.getSize(this.instanceNode).then(function (dataSize) {
              size = dataSize;
            }).finally(function () {
              if (_this131.destroyed) {
                return;
              }

              size = helper.fixSize(_this131.instanceNode, size); // if (this.dataBgSrc) {
              //     this.fitSize = helper.imageLib.getBackgroundSize(this.instanceNode);
              // }

              if (size.width === 0 && size.height === 0) {
                _this131.instanceNode.setCss({
                  width: '100%'
                });

                size.width = _this131.instanceNode.getSize().width;
              }

              if (size.width === 0 && size.height === 0) {
                size.width = $J.W.node.innerWidth;
              }

              if (_this131.option('fit') === 'contain') {
                _this131.fitSize = {
                  width: 'contain',
                  height: 'contain'
                };
              } else {
                _this131.fitSize = {
                  width: 'cover',
                  height: 'cover'
                };
              }

              if (_this131.option('fit') === 'none') {
                if (_this131.cssBackgroundSize) {
                  _this131.size = helper.imageLib.calcProportionalBackgroundSize(_this131.cssBackgroundSize, _this131.infoSize);
                } else {
                  _this131.size = _this131.infoSize;
                }
              } else {
                _this131.size = helper.imageLib.calcProportionSize(size, _this131.infoSize, _this131.fitSize);
              }

              if (!_this131.dataBgSrc) {
                // Set the max-width to prevent image stretching beyond its original maximum width
                var objectFit = _this131.instanceNode.getCss('objectFit');

                if (!_this131.maxWidth && _this131.infoSize.width > 0 && (!objectFit || objectFit === 'fill') && !_this131.instanceNode.attr('width')) {
                  _this131.isMaxWidthSet = true;

                  _this131.instanceNode.setCss({
                    maxWidth: _this131.infoSize.width
                  });
                }
              }

              if (_this131.originAlt || _this131.infoAlt) {
                // Restore ALT text
                _this131.instanceNode.attr('alt', _this131.originAlt || _this131.infoAlt);
              }

              if (_this131.originTitle) {
                // Restore TITLE text
                _this131.instanceNode.attr('title', _this131.originTitle);
              }

              if (_this131.isStaticImage) {
                _this131.loadStaticImage().finally(function () {
                  if (_this131.isInfoLoaded) {
                    _this131.done();
                  }
                });
              } else if (!_this131.isLazy || _this131.isInView) {
                _this131.getImage();
              }
            });
          }

          return result;
        };

        _proto58._setSrc = function _setSrc(src, srcset) {
          if (this.dataBgSrc) {
            this.instanceNode.setCss({
              backgroundImage: 'url("' + (srcset || src) + '")'
            });
          } else {
            this.instanceNode.attr('src', src);

            if (srcset) {
              if (!this.isNotSirv && this.dppx > 1) {
                this.instanceNode.attr('srcset', srcset + ' ' + this.dppx + 'x');
              }
            } else {
              this.instanceNode.removeAttr('srcset');
            }
          }
        };

        _proto58._setHDQuality = function _setHDQuality(opt) {
          if (opt.dppx > 1 && opt.dppx < 1.5) {
            var quality = this.instanceOptions.isset('quality') ? this.option('quality') : null;

            if (this.queryParamsQuality === null && quality !== null) {
              opt.srcset.quality = quality;
            } else if (opt.srcset) {
              delete opt.srcset.quality;
            }
          }

          return opt;
        };

        _proto58.replaceSrc = function replaceSrc() {
          var img;

          if (this.isNotSirv) {
            if (this.srcWasSetted) {
              return;
            }

            this.srcWasSetted = true;
            img = {
              src: this.imageUrl
            };
          } else {
            var opt = this._getImageCreateSettings();

            if (opt.dppx > 1 && opt.dppx < 1.5) {
              delete opt.srcset.quality;
            }

            opt = this._setHDQuality(opt);
            img = this.image.getImage(opt);
            this.lastImageSize.width = img.width || img.serverWidth;
            this.lastImageSize.height = img.height || img.serverHeight;
          }

          this._setSrc(img.src, img.srcset);
        };

        _proto58.loadStaticImage = function loadStaticImage() {
          var _this132 = this;

          if (!this.loadStaticImagePromise) {
            this.loadStaticImagePromise = new Promise(function (resolve, reject) {
              if (_this132.isStaticImage) {
                if (_this132.instanceNode.node.complete) {
                  resolve();
                } else {
                  _this132.instanceNode.addEvent('load', function (e) {
                    resolve();
                  });

                  _this132.instanceNode.addEvent('error', function (e) {
                    reject();
                  });
                }
              } else {
                resolve();
              }
            });
          }

          return this.loadStaticImagePromise;
        };

        _proto58._getImageCreateSettings = function _getImageCreateSettings() {
          var setts = {
            src: {},
            srcset: {}
          };
          var quality = this.instanceOptions.isset('quality') ? this.option('quality') : null;

          if (quality !== null && this.queryParamsQuality === null) {
            setts.src.quality = quality;
          }

          var hdQuality = this.option('hdQuality');

          if (this.queryParamsQuality === null || this.instanceOptions.isset('hdQuality') && hdQuality < this.queryParamsQuality) {
            setts.srcset = {
              quality: hdQuality
            };
          }

          setts.width = this.size.width;

          if (this.size.height) {
            setts.height = this.size.height;
          }

          setts = helper.imageLib.checkMaxSize(setts, this.infoSize);

          if (this.infoSize.width === setts.width || this.infoSize.height === setts.height) {
            setts.round = false;
          }

          if ($J.DPPX > 1) {
            setts.dppx = this.dppx;
          }

          if (this.option('fit') === 'crop') {
            setts.round = false;
          } // if (this.dataBgSrc && this.option('fit') === 'crop') {
          //     this.backgroundNodeSize = this.instanceNode.getSize();
          //     let crop = null;
          //     let cropX2 = null;
          //     // const roundedSize = ResponsiveImage.roundImageSize(this.size);
          //     const roundedSize = this.size;
          //     const originSize = this.image.getOriginSize();
          //     const dppx = getDPPX(roundedSize.width, roundedSize.height, originSize.width, originSize.height, (!$J.defined(setts.round) || setts.round), this.upscale);
          //     if (!this.cropPosition.type) {
          //         if (this.backgroundNodeSize.width < roundedSize.width) {
          //             if (!crop) { crop = {}; cropX2 = {}; }
          //             // crop.x = calcCropPositionForBGImage(50, this.backgroundNodeSize.width, roundedSize.width);
          //             crop.x = calcCropPositionForBGImage(this.cropPosition.x ? parseFloat(this.cropPosition.x) : 50, this.backgroundNodeSize.width, roundedSize.width);
          //             // cropX2.x = calcCropPositionForBGImage(50, this.backgroundNodeSize.width * setts.dppx, roundedSize.width * dppx);
          //             cropX2.x = calcCropPositionForBGImage(this.cropPosition.x ? parseFloat(this.cropPosition.x) : 50, this.backgroundNodeSize.width * setts.dppx, roundedSize.width * dppx);
          //             crop.width = this.backgroundNodeSize.width;
          //             cropX2.width = this.backgroundNodeSize.width * dppx;
          //         }
          //         if (this.backgroundNodeSize.height < roundedSize.height) {
          //             if (!crop) { crop = {}; cropX2 = {}; }
          //             // crop.y = calcCropPositionForBGImage(50, this.backgroundNodeSize.height, roundedSize.height);
          //             crop.y = calcCropPositionForBGImage(this.cropPosition.y ? parseFloat(this.cropPosition.y) : 50, this.backgroundNodeSize.height, roundedSize.height);
          //             // cropX2.y = calcCropPositionForBGImage(50, this.backgroundNodeSize.height * setts.dppx, roundedSize.height * dppx);
          //             cropX2.y = calcCropPositionForBGImage(this.cropPosition.y ? parseFloat(this.cropPosition.y) : 50, this.backgroundNodeSize.height * setts.dppx, roundedSize.height * dppx);
          //             crop.height = this.backgroundNodeSize.height;
          //             cropX2.height = this.backgroundNodeSize.height * dppx;
          //         }
          //         if (crop) {
          //             if (!setts.src) { setts.src = {}; }
          //             setts.src.crop = crop;
          //             if (!setts.srcset) { setts.srcset = {}; }
          //             setts.srcset.crop = cropX2;
          //         }
          //     }
          // }


          setts = this.setCrop(setts);
          return setts;
        };

        _proto58.setCrop = function setCrop(setts) {
          if (this.option('fit') === 'crop') {
            var size = $(this.instanceNode.node).getInnerSize(!!this.dataBgSrc);

            if (!setts.imageSettings) {
              setts.imageSettings = {};
            }

            if (!setts.imageSettings.crop) {
              setts.imageSettings.crop = {};
            }

            setts.imageSettings.crop = {
              x: this.cropPosition.x || 'center',
              y: this.cropPosition.y || 'center',
              width: size.width,
              height: size.height
            };
          }

          return setts;
        };

        _proto58.getImage = function getImage() {
          if (this.isStaticImage) {
            return;
          }

          if (this.isNotSirv) {
            this.getNonSirvImg();
          } else {
            this.getSirvImg();
          }
        };

        _proto58.getNonSirvImg = function getNonSirvImg() {
          var _this133 = this;

          if (this.isPlaceholder) {
            helper.loadImage(this.dataSrc).finally(function () {
              _this133.replaceSrc();

              _this133.appearanceState.setState(2);

              _this133.done();
            });
          } else {
            this.replaceSrc();
            this.appearanceState.setState(2);
            this.done();
          }
        };

        _proto58.getImageClassContainer = function getImageClassContainer() {
          return this.image;
        };

        _proto58.getSirvImg = function getSirvImg() {
          var setts = this._getImageCreateSettings();

          if (setts.width) {
            this.maxSize.width = setts.width;
          }

          if (setts.height) {
            this.maxSize.height = setts.height;
          }

          if ($J.DPPX > 1) {
            var originSize = this.image.getOriginSize();
            this.dppx = getDPPX(setts.width, setts.height, originSize.width, originSize.height, !$J.defined(setts.round) || setts.round, this.upscale);
            setts.dppx = this.dppx;
          }

          setts = this._setHDQuality(setts);

          if (this.checkImage(setts)) {
            this.replaceSrc();
          } else {
            this.image.getImage(setts);
          }
        };

        _proto58.checkSize = function checkSize(size) {
          var w = this.infoSize.width;
          var h = this.infoSize.height;

          if (size.width > w || size.height > h) {
            size.width = w;

            if (size.height) {
              size.height = h;
            }

            size.round = false;
          }

          return size;
        };

        _proto58.done = function done() {
          _BaseInstance2.prototype.done.call(this); // if (!this.dataBgSrc) {
          //     this.instanceNode.setCss({ width: '', height: '' });
          // }


          this.option('onReady')(this.id);
          this.sendEvent('ready');
        };

        _proto58.inViewCallback = function inViewCallback(value) {
          if (value && !this.isStaticImage) {
            if (!this._isReady && !this.isInView) {
              if (this.isStarted) {
                this.isInView = true;

                if (this.isNotSirv) {
                  if (!this.srcWasSetted) {
                    this.getImage();
                  }
                } else if (this.isInfoLoaded) {
                  this.getImage();
                }
              }
            }
          }

          this.isInView = value;
        };

        _proto58.sendEvent = function sendEvent(nameOfEvent, data) {
          /*
              image events: [
                  'ready',
              ]
          */
          if (!data) {
            data = {};
          }

          if (!data.image) {
            data.image = {};
          }

          if (!data.image.event) {
            data.image.event = {};
          }

          if (nameOfEvent === 'ready') {
            nameOfEvent = 'onLoad';
          }

          data.type = nameOfEvent;
          data.image.id = this.id;
          data.image.url = this.instanceUrl;
          $J.extend(data.image, this.api);
          data.node = this.instanceNode;
          data.image.node = this.instanceNode.node;
          data.image.event.timestamp = +new Date();
          data.image.event.type = 'lazyimage:' + nameOfEvent;
          this.emit('imagePublicEvent', {
            data: data
          });
        };

        _proto58.getOriginImageUrl = function getOriginImageUrl() {
          return this.src;
        };

        _proto58.onResize = function onResize() {
          if (!this.isStarted || this.isStaticImage || !this.option('resize') || this.isNotSirv) {
            return false;
          }

          var size;

          if ($J.contains(['crop', 'cover'], this.option('fit'))) {
            size = $(this.instanceNode.node.parentNode).getSize();
          } else {
            size = this.instanceNode.getSize(); // sometimes before the image appear in view the resize event can work and size of height of this image is 16px on android in chrome

            size.height = this.fixHeight(size.height);
          }

          size = helper.imageLib.calcProportionSize(size, this.infoSize, this.fitSize);
          this.size.width = size.width;

          if (this.size.height) {
            this.size.height = size.height;
          }

          if (this._isReady && !this.isNotSirv) {
            var upscale = 50;

            if (this.option('fit') === 'crop') {
              if (Math.abs(this.size.width - this.lastImageSize.width) > upscale || Math.abs(this.size.height - this.lastImageSize.height) > upscale) {
                this.getImage();
              }
            } else if (this.size.width - this.lastImageSize.width > upscale || this.size.height - this.lastImageSize.height > upscale) {
              this.getImage();
            }
          }

          return true;
        };

        _proto58.destroy = function destroy() {
          if (this.dataBgSrc) {
            this.instanceNode.removeClass(P + '-bg-image');
            this.instanceNode.setCssProp('background-image', '');
          }

          if (this.isMaxWidthSet) {
            this.isMaxWidthSet = false;
            this.instanceNode.setCss({
              maxWidth: ''
            });
          }

          if (this.appearanceState) {
            this.appearanceState.destroy();
          }

          if (this.inViewModule) {
            this.inViewModule.disconnect();
            this.inViewModule = null;
          }

          $J.W.removeEvent('resize', this.resizeHandler);
          this.resizeDebounce.cancel();
          this.resizeDebounce = null;

          if (this.image) {
            this.off('imageOnload');
            this.off('imageOnerror');
            this.image.destroy();
            this.image = null;
          }

          if (this.instanceNode.node.hasAttribute('src')) {
            try {
              this.instanceNode.removeAttr('src');

              if (this.isStaticImage) {
                this.instanceNode.attr('src', this.imageUrl);
              }
            } catch (e) {// empty
            }
          }

          if (!this.isStaticImage) {
            this.instanceNode.removeAttr('src');
          } else {
            this.instanceNode.attr('src', this.src);
          }

          if (this.srcset) {
            this.instanceNode.attr('srcset', this.srcset);
          } else {
            try {
              this.instanceNode.removeAttr('srcset');
            } catch (e) {// empty
            }
          }

          this.srcset = null;

          if (!this.originAlt && this.infoAlt) {
            this.instanceNode.removeAttr('alt');
          }

          this.instanceNode.removeEvent('load');

          if (this.isPlaceholder) {
            this.instanceNode.attr('src', this.isPlaceholder);
            this.isPlaceholder = false;
          }

          _BaseInstance2.prototype.destroy.call(this);
        };

        return LazyImage;
      }(BaseInstance);

      return LazyImage;
    });
    Sirv.define('ViewerImage', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Promise!', 'ResponsiveImage', 'HotspotInstance', 'Hotspots', 'getDPPX'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, Promise, ResponsiveImage, HotspotInstance, Hotspots, getDPPX) {
      var moduleName = 'ViewerImage';
      var $J = magicJS;
      var $ = $J.$;
      /* global $, $J */

      /* global helper */

      /* global HotspotInstance */

      /* global globalVariables */

      /* global ResponsiveImage */

      /* global Hotspots */

      /* global getDPPX */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint-env es6 */

      var BRAND_LANDING = 'https://sirv.com/about-image/?utm_source=client&utm_medium=sirvembed&utm_content=typeofembed(image)&utm_campaign=branding'; // eslint-disable-next-line no-unused-vars

      var ViewerImage = /*#__PURE__*/function (_HotspotInstance2) {
        "use strict";

        bHelpers.inheritsLoose(ViewerImage, _HotspotInstance2);

        function ViewerImage(node, options) {
          var _this134;

          _this134 = _HotspotInstance2.call(this, node, options, {}) || this;
          _this134.type = globalVariables.SLIDE.TYPES.IMAGE;

          _this134.instanceNode.attr('referrerpolicy', _this134.referrerPolicy);

          _this134.image = null;
          _this134.isInfoLoaded = false;
          _this134.getImageInfoPromise = null;
          _this134.loadStaticImagePromise = null;
          _this134.imageShowPromise = null;
          _this134.srcWasSetted = false;
          _this134.lastImageSize = {
            width: 0,
            height: 0
          };
          _this134.imageIndex = options.imageIndex;
          _this134.dppx = 1;
          _this134.upscale = false;
          _this134.size = {
            width: 0,
            height: 0
          };
          _this134.dontLoad = true;
          _this134.accountInfo = {};
          _this134.countOfTries = 1;
          _this134.isFullscreen = options.isFullscreen;
          _this134.nativeFullscreen = options.nativeFullscreen;
          _this134.infoAlt = null;
          _this134.originAlt = _this134.instanceNode.attr('alt');
          _this134.originTitle = _this134.instanceNode.attr('title');
          _this134.src = _this134.instanceNode.attr('src');
          _this134.srcset = _this134.instanceNode.attr('srcset');
          _this134.startedSrc = _this134.src;
          _this134.dataSrc = _this134.instanceNode.attr('data-src');
          _this134.isStaticImage = _this134.src && !_this134.dataSrc;
          _this134.imageUrl = _this134.dataSrc || _this134.src;
          _this134.getImageTimer = helper.debounce(function () {
            _this134.getImage();
          }, 32);
          _this134.firstSlideAhead = false; // Image URL

          _this134.src = globalFunctions.normalizeURL(_this134.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$1'));
          _this134.queryParamsQuality = null;
          _this134.queryParams = helper.paramsFromQueryString(_this134.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$2')); // Image default params

          _this134.getQueryParams();

          _this134.isNotSirv = false;

          if (helper.isSVG(_this134.imageUrl)) {
            _this134.isNotSirv = true;
          } // this.api = $J.extend(this.api, {
          //     isReady: this.isReady.bind(this), // parent class
          //     resize: this.resize.bind(this), // parent class
          //     getOptions: this.getOptions.bind(this) // parent class
          //     hotspots: {} // parent class, hotspots api
          // });


          _this134.createHotspotsClass(Hotspots);

          _this134.createSirvImage();

          return _this134;
        }

        var _proto59 = ViewerImage.prototype;

        _proto59.sendEvent = function sendEvent(typeOfEvent, data) {
          if (!data) {
            data = {};
          }

          data.imageIndex = this.imageIndex;

          _HotspotInstance2.prototype.sendEvent.call(this, typeOfEvent, data);
        };

        _proto59.getInfo = function getInfo() {
          var _this135 = this;

          if (!this.gettingInfoPromise) {
            this.gettingInfoPromise = new Promise(function (resolve, reject) {
              _this135.waitGettingInfo.wait(function () {
                _this135.image.getImageInfo().then(function (info) {
                  if (!_this135.destroyed) {
                    _this135.isInfoLoaded = true;
                    _this135.infoAlt = _this135.image.getDescription();
                    _this135.infoSize = _this135.image.getOriginSize();
                    _this135.accountInfo = _this135.image.getAccountInfo();
                    _this135.hotspotsData = info.hotspots;

                    if (_this135.hotspots) {
                      _this135.hotspots.setOriginImageSize(_this135.infoSize.width, _this135.infoSize.height);
                    }

                    resolve();
                  }
                }).catch(function (err) {
                  if (!_this135.destroyed) {
                    _this135.isInfoLoaded = true;

                    if (!err.status || err.status !== 404) {
                      _this135.isNotSirv = true;
                    }

                    reject(err);
                  }
                });
              });
            });
          }

          return this.gettingInfoPromise;
        };

        _proto59.getQueryParams = function getQueryParams() {
          if (this.imageUrl) {
            if (this.queryParams) {
              var q = parseInt(this.queryParams.quality, 10);

              if (isNaN(q)) {
                delete this.queryParams.quality;
              } else {
                this.queryParams.quality = q;
              }
            }

            this.queryParamsQuality = this.queryParams.quality || null;
          }
        };

        _proto59.getImageCreateSettings = function getImageCreateSettings() {
          var setts = {
            src: {},
            srcset: {}
          };

          if (this.quality !== null && this.queryParamsQuality === null) {
            setts.src.quality = this.quality;
          }

          var hdQuality = this.hdQuality;

          if (this.queryParamsQuality === null || this.isHDQualitySet && hdQuality < this.queryParamsQuality) {
            setts.srcset = {
              quality: hdQuality
            };
          }

          setts.width = this.size.width;

          if (this.size.height) {
            setts.height = this.size.height;
          }

          setts = helper.imageLib.checkMaxSize(setts, this.infoSize);

          if (this.infoSize.width === setts.width || this.infoSize.height === setts.height) {
            setts.round = false;
          }

          if ($J.DPPX > 1) {
            setts.dppx = this.dppx;
          }

          return setts;
        };

        _proto59.setHDQuality = function setHDQuality(opt) {
          if (opt.dppx > 1 && opt.dppx < 1.5) {
            if (this.queryParamsQuality === null && this.quality !== null) {
              opt.srcset.quality = this.quality;
            } else if (opt.srcset) {
              delete opt.srcset.quality;
            }
          }

          return opt;
        };

        _proto59.replaceSrc = function replaceSrc() {
          var img;

          if (this.isNotSirv) {
            if (this.srcWasSetted) {
              return;
            }

            this.srcWasSetted = true;
            img = {
              src: this.imageUrl
            };
          } else {
            var opt = this.getImageCreateSettings();

            if (opt.dppx > 1 && opt.dppx < 1.5) {
              delete opt.srcset.quality;
            }

            opt = this.setHDQuality(opt);
            img = this.image.getImage(opt);
            this.lastImageSize.width = img.width || img.serverWidth;
            this.lastImageSize.height = img.height || img.serverHeight;
          }

          this.instanceNode.attr('src', img.src);

          if (img.srcset) {
            if (!this.isNotSirv && this.dppx > 1) {
              this.instanceNode.attr('srcset', img.srcset + ' ' + this.dppx + 'x');
            }
          } else {
            this.instanceNode.removeAttr('srcset');
          }
        };

        _proto59.showImage = function showImage() {
          var _this136 = this;

          if (!this.imageShowPromise) {
            // eslint-disable-next-line
            this.imageShowPromise = new Promise(function (resolve, reject) {
              if (_this136.isStaticImage) {
                _this136.instanceNode.setCssProp('opacity', '');

                resolve();
              } else if (_this136.isInView && _this136.isSlideShown) {
                _this136.instanceNode.addEvent('transitionend', function (e) {
                  if (e.propertyName === 'opacity') {
                    e.stop();

                    _this136.instanceNode.removeEvent('transitionend');

                    _this136.instanceNode.setCss({
                      opacity: '',
                      transition: ''
                    });

                    resolve();
                  }
                });

                _this136.instanceNode.getSize();

                _this136.instanceNode.setCss({
                  opacity: 1,
                  transition: 'opacity 0.3s linear'
                });
              } else {
                _this136.instanceNode.setCssProp('opacity', '');

                resolve();
              }
            });
          }

          return this.imageShowPromise;
        };

        _proto59.createSirvImage = function createSirvImage() {
          var _this137 = this;

          if (!this.imageUrl || this.isNotSirv) {
            return;
          }

          this.on('imageOnload', function (e) {
            e.stopAll();

            _this137.replaceSrc();

            if (!_this137._isReady) {
              if (e.data.node) {
                _this137.showImage().finally(function () {
                  _this137.done();
                });
              } else {
                helper.loadImage(_this137.instanceNode).finally(function () {
                  _this137.showImage().finally(function () {
                    _this137.done();

                    _this137.sendContentLoadedEvent();
                  });
                });
              }
            }
          });
          this.on('imageOnerror', function (e) {
            e.stopAll();
            console.log('image error');
          });
          this.image = new ResponsiveImage(this.imageUrl, {
            imageSettings: this.queryParams,
            round: true,
            dontLoad: this.dontLoad,
            referrerPolicy: this.referrerPolicy
          });
          this.image.setParent(this);
          this.getInfo();
        };

        _proto59.getInfoSize = function getInfoSize() {
          var _this138 = this;

          if (!this.getImageInfoPromise) {
            this.getImageInfoPromise = new Promise(function (resolve, reject) {
              if (_this138.image) {
                _this138.getInfo().then(function () {
                  resolve({
                    size: _this138.infoSize,
                    imageIndex: _this138.imageIndex
                  });
                }).catch(function (err) {
                  reject({
                    error: err,
                    isPlaceholder: err._isplaceholder,
                    imageIndex: _this138.imageIndex
                  });
                });
              } else {
                reject({
                  error: 'nonsirv',
                  isPlaceholder: false,
                  imageIndex: _this138.imageIndex
                });
              }
            });
          }

          return this.getImageInfoPromise;
        };

        _proto59.startFullInit = function startFullInit(options) {
          if (this.isStartedFullInit) {
            return;
          }

          _HotspotInstance2.prototype.startFullInit.call(this, options);

          this.getId('responsive-image-'); // TODO check css

          if (!this.isStaticImage) {
            this.instanceNode.setCssProp('opacity', 0);
          }
        };

        _proto59.run = function run(isShown, preload, firstSlideAhead, loadContent) {
          var _this139 = this;

          this.firstSlideAhead = firstSlideAhead;

          var result = _HotspotInstance2.prototype.run.call(this, isShown, preload, firstSlideAhead);

          if (result) {
            if (this.destroyed) {
              result = false;
            } else {
              // Remove ALT to properly calculate image size.
              // Safari and Edge/IE return image size with a height if ALT text is present.
              this.instanceNode.removeAttr('alt'); // Remove TITLE to properly calculate image size.
              // The latest version(s) of Chrome returns image size with a height if TITLE is set.

              this.instanceNode.removeAttr('title'); // This force browsers to re-layout image and recalculate its dimensions.

              this.instanceNode.setCss({
                display: 'inline-flex'
              }).getSize();
              this.instanceNode.setCss({
                display: ''
              }).getSize();
              var size = null;
              helper.imageLib.getSize(this.instanceNode.node.parentNode).then(function (dataSize) {
                size = dataSize;
              }).finally(function () {
                if (!_this139.destroyed) {
                  // sometimes when we have very slow internet connection and the image is first slide and thumbnails have left position we get wrong height
                  if (size.width && size.height <= 20) {
                    size.height = 0;
                  } // size = helper.fixSize(this.instanceNode, size);


                  _this139.size = helper.imageLib.calcProportionSize(size, _this139.infoSize);

                  if (_this139.originAlt || _this139.infoAlt) {
                    // Restore ALT text
                    $(_this139.instanceNode).attr('alt', _this139.originAlt || _this139.infoAlt);
                  }

                  if (_this139.originTitle) {
                    // Restore TITLE text
                    $(_this139.instanceNode).attr('title', _this139.originTitle);
                  }

                  if (_this139.isStaticImage) {
                    _this139.loadStaticImage().finally(function () {
                      if (_this139.isInfoLoaded) {
                        _this139.done();
                      }
                    });
                  } else {
                    if (_this139.originAlt) {
                      // Restore ALT text
                      $(_this139.instanceNode).attr('alt', _this139.originAlt);
                    }

                    if (_this139.isInView && (_this139.isSlideShown || _this139.preload || loadContent)) {
                      _this139.getImage();
                    }
                  }

                  if (_this139.dataAlt) {
                    $(_this139.instanceNode).attr('alt', _this139.dataAlt);
                  }
                }
              });
              this.startGettingInfo();
            }
          }

          return result;
        };

        _proto59.loadContent = function loadContent() {
          this.getImage(true);
        };

        _proto59.loadStaticImage = function loadStaticImage() {
          var _this140 = this;

          if (!this.loadStaticImagePromise) {
            this.loadStaticImagePromise = new Promise(function (resolve, reject) {
              if (_this140.isStaticImage) {
                if (_this140.instanceNode.node.complete) {
                  resolve();
                } else {
                  // eslint-disable-next-line
                  _this140.instanceNode.addEvent('load', function (e) {
                    _this140.sendContentLoadedEvent();

                    resolve();
                  }); // eslint-disable-next-line


                  _this140.instanceNode.addEvent('error', function (e) {
                    reject();
                  });
                }
              } else {
                resolve();
              }
            });
          }

          return this.loadStaticImagePromise;
        };

        _proto59.getImage = function getImage(loadContent) {
          var _this141 = this;

          if (this.isStaticImage) {
            return;
          }

          if (!this.isNotSirv && !this._isReady && !this.size.width && !this.size.height) {
            // fix for if the viewer was with display none
            if (this.countOfTries < 100) {
              setTimeout(function () {
                _this141.countOfTries += 1;
                _this141.isStarted = false;

                _this141.run(_this141.isSlideShown, _this141.preload, _this141.firstSlideAhead, loadContent);
              }, 16 * this.countOfTries);
            }

            return;
          }

          this.waitToStart.start();

          if (this.isNotSirv) {
            this.replaceSrc();
          } else {
            this.getSirvImg();
          }
        };

        _proto59.getImageClassContainer = function getImageClassContainer() {
          return this.image;
        };

        _proto59.getSirvImg = function getSirvImg() {
          var setts = this.getImageCreateSettings();

          if ($J.DPPX > 1) {
            var originSize = this.image.getOriginSize();
            this.dppx = getDPPX(setts.width, setts.height, originSize.width, originSize.height, !$J.defined(setts.round) || setts.round, this.upscale);
            setts.dppx = this.dppx;
          }

          setts = this.setHDQuality(setts);

          if (this.checkImage(setts, this.dontLoad)) {
            this.replaceSrc();
          } else {
            this.image.getImage(setts);
          }
        };

        _proto59.getOriginImageUrl = function getOriginImageUrl() {
          return this.src;
        };

        _proto59.done = function done() {
          if (!this._isReady) {
            if (this.accountInfo.branded) {
              var n = this.instanceNode;

              if (n.getTagName() === 'img') {
                n = n.node.parentNode;
              }

              var nodeWithSirvClassName = globalFunctions.getNodeWithSirvClassName(this.instanceNode) || $J.D.node.head || $J.D.node.body;
              globalFunctions.rootDOM.showSirvAd(nodeWithSirvClassName, n, BRAND_LANDING, 'Image viewer by Sirv');
            }

            _HotspotInstance2.prototype.done.call(this);

            if (this.hotspots) {
              this.hotspots.setContainerSize(this.instanceNode.node.getBoundingClientRect());
            }

            if (!this.isFullscreenEnabled) {
              this.pinchCloud.removeEvent();
              this.pinchCloud = null;
            }
          }
        };

        _proto59.getSelectorImgUrl = function getSelectorImgUrl(data) {
          var _this142 = this;

          return new Promise(function (resolve, reject) {
            var defOpt = _this142.getImageCreateSettings();

            if (defOpt.src) {
              data.src = defOpt.src;
            }

            data.srcset = defOpt.srcset;

            if (_this142.isInfoLoaded) {
              _this142.waitToStart.wait(function () {
                resolve($J.extend(_this142.image.getThumbnail(data), {
                  imageIndex: _this142.imageIndex,
                  alt: _this142.dataAlt || _this142.originAlt || _this142.infoAlt,
                  'referrerpolicy': _this142.instanceNode.attr('referrerpolicy')
                }));
              });
            } else {
              _this142.getInfo().then(function () {
                _this142.waitToStart.wait(function () {
                  resolve($J.extend(_this142.image.getThumbnail(data), {
                    imageIndex: _this142.imageIndex,
                    alt: _this142.dataAlt || _this142.originAlt || _this142.infoAlt,
                    referrerpolicy: _this142.instanceNode.attr('referrerpolicy')
                  }));
                });
              }).catch(reject);
            }
          });
        };

        _proto59.getThumbnailData = function getThumbnailData(opt) {
          return this.image.getThumbnail(opt);
        };

        _proto59.createPinchEvent = function createPinchEvent() {
          var _this143 = this;

          // difference between scale
          var FS_OUT = 0.2;
          var FS_IN = 2;

          _HotspotInstance2.prototype.createPinchEvent.call(this, this.instanceNode);

          this.pinchCloud.onPinchStart = function (e) {
            if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.CLOSING], _this143.fullscreenState)) {
              return;
            }

            _this143.pinchCloud.pinch = true;
            _this143.pinchCloud.scale = e.scale;

            _this143.sendEvent('pinchStart');
          };

          this.pinchCloud.onPinchMove = function (e) {
            if (_this143.pinchCloud.pinch && !_this143.pinchCloud.block) {
              if (_this143.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                if (e.scale < FS_OUT) {
                  _this143.pinchCloud.block = true;

                  _this143.sendEvent('fullscreenOut');
                }
              } else if (e.scale >= FS_IN) {
                _this143.pinchCloud.block = true;

                _this143.sendEvent('fullscreenIn');
              }
            }
          };
        };

        _proto59.onStartActions = function onStartActions() {
          if (!this._isReady) {
            if (this.isInView && this.isStarted) {
              if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                this.onResize();
              }

              if (this.always) {
                /*
                    it can happen when fullscreen always is true and we came to this slide by thumbnail
                    we need timer to clear it in 'onBeforeFullscreenIn' handler and don't if we are in standard mode
                */
                this.getImageTimer();
              } else {
                this.getImage();
              }
            }
          }

          _HotspotInstance2.prototype.onStartActions.call(this);
        };

        _proto59.onStopActions = function onStopActions() {
          _HotspotInstance2.prototype.onStopActions.call(this);
        };

        _proto59.onInView = function onInView(value) {
          if (value && !this.isStaticImage) {
            if (!this._isReady && !this.isInView) {
              if (this.isStarted) {
                this.isInView = true;

                if (this.isInfoLoaded && (this.preload || this.isSlideShown)) {
                  this.getImage();
                }
              }
            }
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto59.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {
          this.getImageTimer.cancel();

          if (this._isReady && !this.isStaticImage) {
            this.instanceNode.setCssProp('visibility', 'hidden');
          }

          _HotspotInstance2.prototype.onBeforeFullscreenIn.call(this, data);

          if (this.hotspots) {
            this.hotspots.disableAll();
          }
        } // eslint-disable-next-line no-unused-vars, class-methods-use-this
        ;

        _proto59.onAfterFullscreenIn = function onAfterFullscreenIn(data) {
          var _this144 = this;

          // if we use it, we do not have pinchend event and touchdrag after that
          // if (this.pinchCloud) {
          //     this.pinchCloud.removeEvent();
          //     this.pinchCloud.addEvent();
          // }
          if (this.always && !this._isReady && this.isInView && this.isStarted) {
            this.onResize();
            this.getImage();
          }

          if (this.hotspots) {
            setTimeout(function () {
              // we have to wait a little bit for 'onResize' function
              if (_this144.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                // if we will exit from fullscreen before the timeout end
                _this144.hotspots.enableAll();

                if (_this144.isInView && _this144.isSlideShown) {
                  _this144.hotspots.showNeededElements();
                }
              }
            }, 100);
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto59.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {
          this.instanceNode.setCss({
            width: '',
            height: '',
            visibility: ''
          });

          _HotspotInstance2.prototype.onBeforeFullscreenOut.call(this, data);
        } // eslint-disable-next-line no-unused-vars, class-methods-use-this
        ;

        _proto59.onAfterFullscreenOut = function onAfterFullscreenOut(data) {
          // if we use it, we do not have pinchend event and touchdrag after that
          // if (this.pinchCloud) {
          //     this.pinchCloud.removeEvent();
          //     this.pinchCloud.addEvent();
          // }
          _HotspotInstance2.prototype.onAfterFullscreenOut.call(this, data);
        };

        _proto59.onResize = function onResize() {
          if (!this.isStarted || this.isStaticImage || this.isNotSirv) {
            return false;
          }

          if (this.isFullscreenActionEnded()) {
            var size = $(this.instanceNode.node.parentNode).getSize();
            size = helper.imageLib.calcProportionSize(size, this.infoSize);

            if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
              this.instanceNode.setCss({
                width: size.width + 'px',
                height: size.height + 'px'
              });
              this.instanceNode.setCssProp('visibility', '');
            }

            this.size.width = size.width;

            if (this.size.height) {
              this.size.height = size.height;
            }

            if (this._isReady) {
              var upscale = 50;

              if (this.size.width - this.lastImageSize.width > upscale || this.size.height - this.lastImageSize.height > upscale) {
                this.getImage();
              }

              if (this.hotspots) {
                this.hotspots.setContainerSize(this.instanceNode.node.getBoundingClientRect());

                if (this.isInView && this.isSlideShown) {
                  this.hotspots.showNeededElements();
                }
              }
            }

            return true;
          }

          return false;
        };

        _proto59.getType = function getType() {
          return this.type;
        };

        _proto59.destroy = function destroy() {
          if (this.image) {
            this.off('imageOnload');
            this.off('imageOnerror');
            this.image.destroy();
            this.image = null;
          }

          this.getImageTimer.cancel();
          this.getImageTimer = null;
          this.instanceNode.setCssProp('opacity', '');

          if (this.hotspot) {
            $(this.instanceNode.node.parentNode).removeEvent('tap');
          }

          if (this.instanceNode.node.hasAttribute('src')) {
            try {
              this.instanceNode.removeAttr('src');

              if (this.isStaticImage) {
                this.instanceNode.attr('src', this.imageUrl);
              }
            } catch (e) {// empty
            }
          }

          if (!this.isStaticImage) {
            this.instanceNode.removeAttr('src');
          } else {
            this.instanceNode.attr('src', this.src);
          }

          if (this.srcset) {
            this.instanceNode.attr('srcset', this.srcset);
          } else {
            try {
              this.instanceNode.removeAttr('srcset');
            } catch (e) {// empty
            }
          }

          this.srcset = null;

          if (!this.originAlt && (this.infoAlt || this.dataAlt)) {
            this.instanceNode.removeAttr('alt');
          }

          this.instanceNode.removeEvent('load');
          this.hotspotsData = null;

          _HotspotInstance2.prototype.destroy.call(this);

          return true;
        };

        return ViewerImage;
      }(HotspotInstance);

      return ViewerImage;
    });
    Sirv.define('Spin', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Promise!', 'EventEmitter', 'Zoominstance', 'ResponsiveImage', 'Hint', 'ProgressLoader', 'SpinHotspots'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, Promise, EventEmitter, Zoominstance, ResponsiveImage, Hint, ProgressLoader, SpinHotspots) {
      var moduleName = 'Spin';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* eslint-disable no-unused-vars */

      /* eslint-disable no-extra-semi */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var defaultOptions = {
        // Swap rows and columns, i.e. "2 rows x 36 columns" spin behaves like "36 rows x 2 columns".
        swapSides: {
          type: 'boolean',
          defaults: false
        },
        wheel: {
          type: 'boolean',
          defaults: true
        },
        initialize: {
          type: 'string',
          'enum': ['load', 'hover', 'click', 'tap'],
          defaults: 'load'
        },
        freeDrag: {
          type: 'boolean',
          defaults: false
        },
        tappingFirst: {
          type: 'boolean',
          defaults: false
        },
        thumbnail: {
          // thumbnail.type
          type: {
            type: 'string',
            'enum': ['image', 'gif'],
            defaults: 'image'
          },
          // thumbnail.gifParams
          gifParams: {
            type: 'string',
            defaults: ''
          }
        },
        zoom: {
          // zoom.enable
          enable: {
            type: 'boolean',
            defaults: true
          },
          // zoom.ratio
          ratio: {
            oneOf: [{
              type: 'number',
              minimum: 0
            }, {
              type: 'string',
              'enum': ['max']
            }],
            defaults: 2.5
          },
          // zoom.tiles
          tiles: {
            type: 'boolean',
            defaults: true
          },
          // zoom.pan
          pan: {
            type: 'boolean',
            defaults: true
          }
        },
        inactivity: {
          type: 'number',
          minimum: 1000,
          defaults: 3000
        },
        autospin: {
          // autospin.enable
          enable: {
            type: 'boolean',
            defaults: false
          },
          // autospin.type
          type: {
            type: 'string',
            'enum': ['row', 'sphere', 'full', 'helix'],
            defaults: 'sphere'
          },
          // autospin.resume
          resume: {
            type: 'number',
            minimum: 0,
            defaults: 3000
          },
          // autospin.duration
          duration: {
            type: 'number',
            minimum: 0,
            defaults: 3600
          }
        },
        hint: {
          message: {
            // hint.message.enable
            enable: {
              type: 'boolean',
              defaults: true
            },
            // hint.message.text
            text: {
              type: 'string',
              defaults: 'Drag to spin'
            }
          },
          onStart: {
            // hint.onStart.enable
            enable: {
              type: 'boolean',
              defaults: true
            },
            // hint.onStart.effect
            effect: {
              oneOf: [{
                type: 'string',
                'enum': ['intro', 'twitch', 'spin', 'momentum', 'sphere', 'none']
              }, {
                type: 'boolean',
                'enum': [false]
              }],
              defaults: 'intro'
            }
          },
          onVisible: {
            // hint.onVisible.enable
            enable: {
              type: 'boolean',
              defaults: true
            },
            // hint.onVisible.effect
            effect: {
              oneOf: [{
                type: 'string',
                'enum': ['intro', 'twitch', 'spin', 'momentum', 'sphere', 'none']
              }, {
                type: 'boolean',
                'enum': [false]
              }],
              defaults: 'twitch'
            }
          },
          onInactive: {
            // hint.onInactive.enable
            enable: {
              type: 'boolean',
              defaults: true
            },
            // hint.onInactive.effect
            effect: {
              oneOf: [{
                type: 'string',
                'enum': ['intro', 'twitch', 'spin', 'momentum', 'sphere', 'none']
              }, {
                type: 'boolean',
                'enum': [false]
              }],
              defaults: 'twitch'
            }
          }
        },
        row: {
          // Row/Column from which to start spin. 'auto' means to fetch these from the image filename (img.src)
          // row.start
          start: {
            type: 'number',
            minimum: 1,
            defaults: 1
          },
          // should the spin loop rows (y)
          // row.loop
          loop: {
            type: 'boolean',
            defaults: false
          },
          // whether photos are taken in the reverse order
          // row.increment
          increment: {
            type: 'number',
            minimum: 1,
            defaults: 1
          },
          // whether photos are taken in the reverse order
          // row.reverse
          reverse: {
            type: 'boolean',
            defaults: false
          },
          //row.sensitivity
          sensitivity: {
            type: 'number',
            'minimum': 1,
            'maximum': 100,
            defaults: 50
          } // speed of spin (1 - 100)

        },
        column: {
          // Row/Column from which to start spin. 'auto' means to fetch these from the image filename (img.src)
          // col.start
          start: {
            type: 'number',
            minimum: 1,
            defaults: 1
          },
          // should the spin loop columns in row (x)
          // col.loop
          loop: {
            type: 'boolean',
            defaults: true
          },
          // whether photos are taken in the reverse order
          // col.increment
          increment: {
            type: 'number',
            minimum: 1,
            defaults: 1
          },
          // whether photos are taken in the reverse order
          // col.reverse
          reverse: {
            type: 'boolean',
            defaults: false
          },
          //column.sensitivity
          sensitivity: {
            type: 'number',
            'minimum': 1,
            'maximum': 100,
            defaults: 50
          } // speed of spin (1 - 100)

        }
      };
      var mobileDefaults = {// hint: {
        //     message: {
        //         text: { type: 'string', defaults: 'Tap to spin' }
        //     }
        // }
      };
      /* eslint-env es6 */

      /* global ResponsiveImage */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "SpinResponsiveImage" }] */

      var SpinResponsiveImage = /*#__PURE__*/function (_ResponsiveImage) {
        "use strict";

        bHelpers.inheritsLoose(SpinResponsiveImage, _ResponsiveImage);

        function SpinResponsiveImage(source, o, col, row) {
          var _this145;

          _this145 = _ResponsiveImage.call(this, source, o) || this;
          _this145.col = col;
          _this145.row = row;
          return _this145;
        }

        var _proto60 = SpinResponsiveImage.prototype;

        _proto60._createImageData = function _createImageData(img, callbackData) {
          var data = _ResponsiveImage.prototype._createImageData.call(this, img, callbackData);

          data.col = this.col;
          data.row = this.row;
          return data;
        };

        _proto60.getThumbnail = function getThumbnail(imageSettings) {
          var data = _ResponsiveImage.prototype.getThumbnail.call(this, imageSettings);

          data.col = this.col;
          data.row = this.row;
          return data;
        };

        return SpinResponsiveImage;
      }(ResponsiveImage);
      /* eslint-env es6 */

      /* global helper */

      /* eslint operator-assignment: 0 */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "INTRO_QUEUE" }] */


      var INTRO_QUEUE = function () {
        var CUBICBEZIER = $([0.45, 0.19, 0.56, 0.86]);
        var DEFAULTDURATION = 600;

        var isNull = function (v) {
          return v === null;
        };

        var getBresenhamsLine = function (point1, point2) {
          var result = {
            x: [],
            y: []
          };

          var plotLineLow = function (x0, y0, x1, y1) {
            var dx = x1 - x0;
            var dy = y1 - y0;
            var yi = 1;
            var x,
                y = y0;
            var D;

            if (dy < 0) {
              yi = -1;
              dy = -dy;
            }

            D = 2 * dy - dx;

            for (x = x0; x <= x1; x++) {
              result.x.push(x);
              result.y.push(y);

              if (D > 0) {
                y = y + yi;
                D = D - 2 * dx;
              }

              D = D + 2 * dy;
            }
          };

          var plotLineHigh = function (x0, y0, x1, y1) {
            var dx = x1 - x0;
            var dy = y1 - y0;
            var xi = 1;
            var y;
            var x = x0;
            var D;

            if (dx < 0) {
              xi = -1;
              dx = -dx;
            }

            D = 2 * dx - dy;
            x = x0;

            for (y = y0; y <= y1; y++) {
              result.x.push(x);
              result.y.push(y);

              if (D > 0) {
                x = x + xi;
                D = D - 2 * dy;
              }

              D = D + 2 * dx;
            }
          };

          if (Math.abs(point2.y - point1.y) < Math.abs(point2.x - point1.x)) {
            if (point1.x > point2.x) {
              plotLineLow(point2.x, point2.y, point1.x, point1.y);
            } else {
              plotLineLow(point1.x, point1.y, point2.x, point2.y);
            }
          } else if (point1.y > point2.y) {
            plotLineHigh(point2.x, point2.y, point1.x, point1.y);
          } else {
            plotLineHigh(point1.x, point1.y, point2.x, point2.y);
          }

          return result;
        };

        var getLineSegment = function (from, to, forward, length, loop) {
          var arr = [];
          var start = false;
          var currentIndex = from;

          while (currentIndex !== to || !start && loop) {
            start = true;

            if (forward) {
              currentIndex += 1;
            } else {
              currentIndex -= 1;
            }

            currentIndex = helper.getArrayIndex(currentIndex, length);
            arr.push(currentIndex);
          }

          return arr;
        };

        var getQueue = function (source, sides) {
          var side = 'col';

          if (isNull(sides.row)) {
            side = 'row';
          }

          var result = [];
          source.forEach(function (v) {
            var s = {
              col: sides.column,
              row: sides.row
            };
            s[side] = v;
            result.push(s);
          });
          return result;
        };

        var getLoopSegment = function (startIndex, count, length, loop) {
          var getEndIndex = function (value) {
            var result;

            if (loop) {
              result = helper.getArrayIndex(value, length);
            } else {
              result = value;

              if (result < 0) {
                result = 0;
              }

              if (result > length - 1) {
                result = length - 1;
              }
            }

            return result;
          };

          var tmp = [startIndex];
          var endIndex;
          var dir = true;
          [startIndex + count, startIndex - count, startIndex].forEach(function (value) {
            endIndex = getEndIndex(value);
            tmp = tmp.concat(getLineSegment(tmp[tmp.length - 1], endIndex, dir, length, loop));
            dir = !dir;
          });
          return tmp;
        };

        var getLine = function (from, length, loop) {
          var result = [];

          if (loop) {
            result = getLineSegment(from, helper.getArrayIndex(from + length, length), true, length, loop);
          } else {
            result = getLoopSegment(from, length, length, false);
          }

          return result;
        };

        var axelerate = function (arr) {
          var max = 6;
          var l = arr.length;

          var getCount = function (value) {
            return Math.round((max - 1) * $J.FX.cubicBezierAtTime(value / l, DEFAULTDURATION, CUBICBEZIER)) + 1;
          };

          var result = [];
          arr.forEach(function (point, index) {
            var count = getCount(index);

            while (count > 0) {
              count -= 1;
              result.push(point);
            }
          });
          return result;
        };

        var getOptions = function (options) {
          var opt = helper.deepExtend({
            degree: 30,
            swapSides: false,
            axelerate: false,
            isBackward: false,
            justFirstLine: false,
            row: {
              length: 1,
              loop: false,
              current: 1,
              jumpCount: 0
            },
            column: {
              length: 36,
              loop: true,
              current: 1,
              jumpCount: 0
            },
            firstSide: 'column',
            secondSide: 'row'
          }, options || {});
          ['row', 'column'].forEach(function (value) {
            if (opt[value].current > opt[value].length - 1) {
              opt[value].current = 0;
            }
          });

          if (opt.swapSides) {
            opt.secondSide = opt.firstSide;
            opt.firstSide = 'row';
          }

          return opt;
        };

        var api = {
          lib: {
            getRightIndex: function (index, length, loop) {
              var result;

              if (loop) {
                result = helper.getArrayIndex(index, length);
              } else {
                if (index >= length) {
                  index = length - 1;
                } else if (index < 0) {
                  index = 0;
                }

                result = index;
              }

              return result;
            }
          },
          twitch: function (options) {
            var opt = getOptions(options);
            var count = {
              column: 0,
              row: 0
            };
            var tmp;
            var result = [];
            [opt.firstSide, opt.secondSide].forEach(function (side) {
              var otherSide = side === opt.firstSide ? opt.secondSide : opt.firstSide;

              if (opt[side].length > 1) {
                count[side] = Math.floor(opt[side].length / 360 * opt.degree) || 1;
              }

              if (count[side]) {
                tmp = {};
                tmp[side] = null;
                tmp[otherSide] = opt[otherSide].current;
                result = result.concat(getQueue(getLoopSegment(opt[side].current, count[side], opt[side].length, opt[side].loop), tmp));
              }
            });
            return result;
          },
          sphere: function (options) {
            var opt = getOptions(options);
            var result = [];
            (opt.justFirstLine ? [opt.firstSide] : [opt.firstSide, opt.secondSide]).forEach(function (side) {
              var otherSide = side === opt.firstSide ? opt.secondSide : opt.firstSide;
              var tmp = {};

              if (opt[side].length === 1) {
                return;
              }

              tmp[side] = null;
              tmp[otherSide] = opt[otherSide].current;
              var arr = getQueue(getLine(opt[side].current, opt[side].length, opt[side].loop), tmp);

              if (opt.isBackward) {
                arr.reverse();
              }

              result = result.concat(arr);
            });

            if (opt.axelerate) {
              result = axelerate(result);
            }

            return result;
          },
          intro: function (options) {
            var opt = getOptions(options);
            var copiedOpt = {
              swapSides: opt.swapSides,
              justFirstLine: true,
              isBackward: opt.isBackward,
              row: helper.deepExtend({}, opt.row),
              column: helper.deepExtend({}, opt.column)
            };
            var result = [];
            result = api.sphere(copiedOpt);
            result = result.concat(api.twitch(copiedOpt));
            return result;
          },
          full: function (options) {
            var arr;
            var opt = getOptions(options);
            var l = opt[opt.secondSide].length;

            if (l > 1) {
              arr = getLine(opt[opt.secondSide].current, l, opt[opt.secondSide].loop);
            } else {
              arr = [opt[opt.secondSide].current];
            }

            var firstSideOpt = helper.deepExtend({}, opt[opt.firstSide]);
            var secondSideOpt = helper.deepExtend({}, opt[opt.secondSide]);
            var result = [];
            arr.forEach(function (item) {
              var circleOption = {
                swapSides: opt.swapSides,
                justFirstLine: true
              };
              secondSideOpt.current = item;
              circleOption[opt.firstSide] = firstSideOpt;
              circleOption[opt.secondSide] = secondSideOpt;
              result = result.concat(api.sphere(circleOption));
            });

            if (opt.isBackward) {
              result.reverse();
            }

            return result;
          },
          custom: function (options) {
            var opt = getOptions(options);
            var point1 = {
              x: opt.column.current,
              y: opt.row.current
            };
            var point2 = {
              x: opt.column.current + opt.column.jumpCount,
              y: opt.row.current + opt.row.jumpCount
            };

            var convert = function (points) {
              var r = [];

              if (points.x[0] !== point1.x) {
                points.x.reverse();
              }

              if (points.y[0] !== point1.y) {
                points.y.reverse();
              }

              for (var i = 0, l = points.x.length; i < l; i++) {
                r.push({
                  col: points.x[i],
                  row: points.y[i]
                });
              }

              return r;
            };

            var result = [];
            result = getBresenhamsLine(point1, point2);
            result = convert(result);
            result = $(result).map(function (point) {
              return {
                col: api.lib.getRightIndex(point.col, opt.column.length, opt.column.loop),
                row: api.lib.getRightIndex(point.row, opt.row.length, opt.row.loop)
              };
            });
            return result;
          }
        };
        return api;
      }();
      /* eslint-env es6 */

      /* global helper */

      /* eslint-disable no-loop-func */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "LOADING_QUEUE" }] */


      var LOADING_QUEUE = function () {
        var _insideLib = {
          getStep: function (l) {
            var result = 1;

            if (l > 24) {
              result = Math.floor(l / 24);

              if (result > 3) {
                result = 3;
              }
            }

            return result;
          },
          getIndexes: function (length) {
            var result = [];
            var arr = [];
            var i;
            var tmp;
            var flag = true;

            var step = _insideLib.getStep(length);

            do {
              tmp = [];

              for (i = 0; i < length; i += step) {
                if (!arr[i]) {
                  tmp.push(i);
                  arr[i] = 1;
                }
              }

              if (step === 1) {
                flag = false;
              }

              result.push(tmp);
              step = Math.ceil(step / 2);
            } while (step >= 1 && flag);

            return result;
          },
          // print: (arr) => {
          //     let str = '';
          //     arr.forEach((_arr, index) => {
          //         let str2;
          //         if (index < 10) {
          //             str2 = index + ' - ';
          //         } else {
          //             str2 = index + '- ';
          //         }
          //         _arr.forEach(v => {
          //             str2 += v + ' ';
          //         });
          //         str2 += '\n';
          //         str += str2;
          //     });
          //     console.log(str);
          // },
          createArray: function (images) {
            var result = [];
            images.forEach(function (line) {
              var arr = [];
              line.forEach(function () {
                arr.push(0);
              });
              result.push(arr);
            });
            return result;
          },
          getRightIdexes: function (arr, startPos, length, callback) {
            arr.forEach(function (indexOfLine) {
              var index = indexOfLine + startPos;
              var rightIndex = helper.getArrayIndex(index, length);

              if (index < length || rightIndex < startPos) {
                callback(rightIndex);
              }
            });
          },
          getOptions: function (options) {
            // images[row][col]

            /*
                options {
                    images: 36,
                    startRow: 0,
                    startCol: 0
                }
            */
            var opt = helper.deepExtend({}, options);
            opt.schemaOfImages = _insideLib.createArray(opt.images);
            opt.rowLength = opt.images.length;
            opt.colLength = opt.images[opt.startRow].length;
            return opt;
          },
          all: function (images, schema, index) {
            var result = [];

            for (var i = 0, l = images.length; i < l; i++) {
              for (var j = 0, len = images[i].length; j < len; j++) {
                if (!schema[i][j]) {
                  result.push([i, j]);
                  schema[i][j] = index + 1;
                }
              }
            }

            return result;
          },
          getSideOpt: function (opt) {
            var tmp;
            var result = {
              length: opt.colLength,
              start: opt.startCol,
              otherLength: opt.rowLength,
              otherStart: opt.startRow
            };

            if (opt.swapSides) {
              tmp = result.length;
              result.length = result.otherLength;
              result.otherLength = tmp;
              tmp = result.start;
              result.start = result.otherStart;
              result.otherStart = tmp;
            }

            return result;
          }
        };
        var api = {
          _: _insideLib,
          all: function (options) {
            var result = [];

            var opt = _insideLib.getOptions(options);

            var indexesOfCols = _insideLib.getIndexes(opt.colLength);

            var tmp = [];
            var index = 1;
            opt.images.forEach(function (line, i) {
              var l = line.length;

              _insideLib.getRightIdexes(indexesOfCols[0], opt.startCol, l, function (col) {
                var row = helper.getArrayIndex(i + opt.startRow, opt.rowLength);
                tmp.push([row, col]);
                opt.schemaOfImages[row][col] = 1;
              });
            });
            result.push(tmp);
            tmp = [];
            result.push(tmp.concat(_insideLib.all(opt.images, opt.schemaOfImages, index))); // _insideLib.print(opt.schemaOfImages);

            return result;
          },
          fastLine: function (options) {
            var result = [];

            var opt = _insideLib.getOptions(options);

            var sideOpt = _insideLib.getSideOpt(opt);

            var tmp = [];
            var index = 1;

            for (var i = 0, l = sideOpt.length; i < l; i++) {
              var _i = helper.getArrayIndex(i + sideOpt.start, sideOpt.length);

              if (opt.swapSides) {
                tmp.push([_i, opt.startCol]);
                opt.schemaOfImages[_i][opt.startCol] = index;
              } else {
                tmp.push([opt.startRow, _i]);
                opt.schemaOfImages[opt.startRow][_i] = index;
              }
            }

            result.push(tmp);
            tmp = [];
            result.push(tmp.concat(_insideLib.all(opt.images, opt.schemaOfImages, index))); // _insideLib.print(opt.schemaOfImages);

            return result;
          },
          line: function (options) {
            var result = [];

            var opt = _insideLib.getOptions(options);

            var sideOpt = _insideLib.getSideOpt(opt);

            var indexes = _insideLib.getIndexes(sideOpt.length);

            var tmp = [];
            var index = 1;

            _insideLib.getRightIdexes(indexes[0], sideOpt.start, sideOpt.length, function (i) {
              if (opt.swapSides) {
                tmp.push([i, opt.startCol]);
                opt.schemaOfImages[i][opt.startCol] = 1;
              } else {
                tmp.push([opt.startRow, i]);
                opt.schemaOfImages[opt.startRow][i] = 1;
              }
            });

            result.push(tmp);
            tmp = [];

            while (index < indexes.length) {
              if (indexes[index]) {
                _insideLib.getRightIdexes(indexes[index], sideOpt.start, sideOpt.length, function (i) {
                  if (opt.swapSides) {
                    tmp.push([i, opt.startCol]);
                    opt.schemaOfImages[i][opt.startCol] = index + 1;
                  } else {
                    tmp.push([opt.startRow, i]);
                    opt.schemaOfImages[opt.startRow][i] = index + 1;
                  }
                });
              }

              index += 1;
            }

            result.push(tmp.concat(_insideLib.all(opt.images, opt.schemaOfImages, index))); // _insideLib.print(opt.schemaOfImages);

            return result;
          },
          sphere: function (options) {
            var result = [];

            var opt = _insideLib.getOptions(options);

            var sideOpt = _insideLib.getSideOpt(opt);

            var indexes = _insideLib.getIndexes(sideOpt.length);

            var otherIndexes = _insideLib.getIndexes(sideOpt.otherLength);

            var max = Math.max(indexes.length, otherIndexes.length);
            var tmp = [];
            var index = 1;

            _insideLib.getRightIdexes(indexes[0], sideOpt.start, sideOpt.length, function (i) {
              if (opt.swapSides) {
                tmp.push([i, opt.startCol]);
                opt.schemaOfImages[i][opt.startCol] = 1;
              } else {
                tmp.push([opt.startRow, i]);
                opt.schemaOfImages[opt.startRow][i] = 1;
              }
            });

            _insideLib.getRightIdexes(otherIndexes[0], sideOpt.otherStart, sideOpt.otherLength, function (i) {
              if (opt.swapSides) {
                if (!opt.schemaOfImages[opt.startRow][i]) {
                  tmp.push([opt.startRow, i]);
                  opt.schemaOfImages[opt.startRow][i] = 1;
                }
              } else if (!opt.schemaOfImages[i][opt.startCol]) {
                tmp.push([i, opt.startCol]);
                opt.schemaOfImages[i][opt.startCol] = 1;
              }
            });

            result.push(tmp);
            tmp = [];

            while (index < max) {
              if (indexes[index]) {
                _insideLib.getRightIdexes(indexes[index], sideOpt.start, sideOpt.length, function (i) {
                  if (opt.swapSides) {
                    tmp.push([i, opt.startCol]);
                    opt.schemaOfImages[i][opt.startCol] = index + 1;
                  } else {
                    tmp.push([opt.startRow, i]);
                    opt.schemaOfImages[opt.startRow][i] = index + 1;
                  }
                });
              }

              if (otherIndexes[index]) {
                _insideLib.getRightIdexes(otherIndexes[index], sideOpt.otherStart, sideOpt.otherLength, function (i) {
                  if (opt.swapSides) {
                    tmp.push([opt.startRow, i]);
                    opt.schemaOfImages[opt.startRow][i] = index + 1;
                  } else {
                    tmp.push([i, opt.startCol]);
                    opt.schemaOfImages[i][opt.startCol] = index + 1;
                  }
                });
              }

              index += 1;
            }

            result.push(tmp.concat(_insideLib.all(opt.images, opt.schemaOfImages, index))); // _insideLib.print(opt.schemaOfImages);

            return result;
          }
        };
        return api;
      }();
      /* eslint-env es6 */

      /* global EventEmitter */

      /* global helper */

      /* global SpinResponsiveImage, INTRO_QUEUE, LOADING_QUEUE */

      /* eslint no-multi-assign: 0 */

      /* eslint operator-assignment: 0 */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "ImagesMap" }] */

      /* eslint class-methods-use-this: "off" */


      var ImagesMap = function () {
        var getPointsString = function (row, col) {
          return row + '.' + col;
        };

        var checkIndex = function (index, increment) {
          return index % increment === 0;
        };

        var getRoot = function (url) {
          var result = [];
          result = $(url.split('//'));
          url = result[1];
          result = result[0];
          url = url.split('/')[0];
          result = [result, url];
          result = result.join('//');
          return result;
        };

        var getImageUrl = function (absoluteURL, baseURL, imageUrl) {
          var result;

          if (/^\//.test(imageUrl)) {
            result = absoluteURL + imageUrl;
          } else {
            result = baseURL + '/' + imageUrl;
          }

          return result;
        };

        var ImagesMap_ = /*#__PURE__*/function (_EventEmitter16) {
          "use strict";

          bHelpers.inheritsLoose(ImagesMap_, _EventEmitter16);

          function ImagesMap_(o) {
            var _this146;

            _this146 = _EventEmitter16.call(this) || this;
            _this146.o = o;
            _this146.startColumn = 0;
            _this146.startRow = 0;
            _this146.currentColumn = 0;
            _this146.currentRow = 0;
            _this146.nextColumn = 0;
            _this146.nextRow = 0;
            _this146.futureColumn = 0;
            _this146.futureRow = 0;
            _this146.imgMap = [];
            _this146.isAvailableOfLoading = true;
            _this146.images = [];
            _this146.isStartedFullInit = false;
            _this146.imageInfoPromise = null;
            _this146.loadingMap = {
              queue: []
            };
            _this146.url = helper.spinLib.getUrl(_this146.o.url);
            _this146.absoluteURL = getRoot(_this146.url);
            _this146.infoImg = null;
            _this146.imageInfoId = 'img-' + helper.generateUUID();

            _this146.setEvents();

            return _this146;
          }

          var _proto61 = ImagesMap_.prototype;

          _proto61.createImageInfo = function createImageInfo() {
            var _this147 = this;

            var getItemFromObject = function () {
              var key1 = $J.hashKeys(_this147.o.layers)[0];
              var key2 = $J.hashKeys(_this147.o.layers[key1])[0];
              return _this147.o.layers[key1][key2];
            };

            if (!this.infoImg) {
              this.infoImg = new SpinResponsiveImage(globalFunctions.normalizeURL(getImageUrl(this.absoluteURL, this.url, getItemFromObject())), {
                imageSettings: this.o.imageSettings,
                infoId: this.imageInfoId,
                round: true,
                referrerPolicy: this.o.referrerPolicy
              }, null, null);
              this.infoImg.setParent(this);
            }

            return this.infoImg;
          };

          _proto61.loadImageInfo = function loadImageInfo() {
            var _this148 = this;

            if (!this.imageInfoPromise) {
              this.imageInfoPromise = new Promise(function (resolve, reject) {
                _this148.createImageInfo(); // this.infoImg


                _this148.infoImg.getImageInfo().then(function (info) {
                  if (_this148.isStartedFullInit) {
                    _this148.createQueue();
                  }

                  resolve({
                    size: _this148.infoImg.getOriginSize()
                  });
                }).catch(function (err) {
                  reject({
                    error: err
                  });
                });
              });
            }

            return this.imageInfoPromise;
          };

          _proto61.startFullInit = function startFullInit(o) {
            var _this149 = this;

            if (this.isStartedFullInit) {
              return;
            }

            this.isStartedFullInit = true;
            this.o = $J.extend(this.o, o);
            this.o.layers = helper.spinLib.checkLayers(this.o.layers);
            this.o.layers = helper.spinLib.swapLayers(this.o.layers, this.o.swapSides);
            helper.objEach(this.o.layers, function (key, rows, rowIndex) {
              if (checkIndex(rowIndex, _this149.o.rowIncrement)) {
                var arr = [];
                helper.objEach(rows, function (_key, frame, frameIndex) {
                  if (checkIndex(frameIndex, _this149.o.columnIncrement)) {
                    arr.push(globalFunctions.normalizeURL(getImageUrl(_this149.absoluteURL, _this149.url, frame)));
                  }
                });

                _this149.imgMap.push(arr);
              }
            });
            helper.spinLib.reverse(this.o.reverseColumn, this.o.reverseRow, this.imgMap);
            this.createImages(this.imgMap);
            this.setFirstImage();

            if (this.imageInfoPromise) {
              this.infoImg.getImageInfo().then(function (info) {
                if (!_this149.loadingMap.queue.length) {
                  _this149.createQueue();
                }
              }).catch(function (err) {// empty
              });
            }
          };

          _proto61.setImageSettings = function setImageSettings(options) {
            if (!options) {
              options = {};
            }

            if (!options.imageSettings) {
              options.imageSettings = {};
            }

            if (!options.imageSettings.scale) {
              options.imageSettings.scale = {};
            }

            if (!options.callbackData) {
              options.callbackData = {};
            }

            options.imageSettings.scale.option = 'fill';

            if (!options.srcset) {
              options.srcset = {};
            }

            if (this.o.quality !== null) {
              if (!options.src) {
                options.src = {};
              }

              options.src = this.o.quality;
            }

            if (options.dppx >= 1.5) {
              options.srcset.quality = this.o.hdQuality;
            } else if (this.o.quality !== null) {
              options.srcset.quality = this.o.quality;
            }

            return options;
          };

          _proto61.getImage = function getImage(row, col) {
            var val1;
            var val2;

            if ($J.defined(row)) {
              val1 = row;
              val2 = col;
            } else {
              val1 = this.currentRow;
              val2 = this.currentColumn;
            }

            return this.images[val1][val2];
          };

          _proto61.getThumbnail = function getThumbnail(imageOptions) {
            return this.getImage(this.startRow, this.startColumn).getThumbnail(imageOptions);
          };

          _proto61.getMap = function getMap() {
            var arr = [];
            this.imgMap.forEach(function (row) {
              var arr2 = [];
              row.forEach(function (col) {
                arr2.push(false);
              });
              arr.push(arr2);
            });
            return arr;
          };

          _proto61.setEvents = function setEvents() {
            var _this150 = this;

            var firstIsLoaded = false;
            var partIsLoaded = false;
            var allIsLoaded = false;

            var allCheck = function (data) {
              if (firstIsLoaded && partIsLoaded && allIsLoaded || data.lens) {
                return;
              }

              if (!firstIsLoaded && data.col === _this150.currentColumn && data.row === _this150.currentRow) {
                firstIsLoaded = true;

                _this150.emit('mapFirstImageLoaded', {
                  data: data
                });
              }

              if (!partIsLoaded && _this150.loadingMap.checkOfFirstPartImagesLoading(data.row, data.col)) {
                partIsLoaded = true;

                _this150.emit('mapImagesReady');
              }

              if (!allIsLoaded && _this150.loadingMap.checkOtherImagesLoading(data.row, data.col)) {
                allIsLoaded = true;
              }

              if (firstIsLoaded && partIsLoaded && allIsLoaded) {
                _this150.emit('mapAllImagesLoaded');
              }
            };

            this.on('imageOnload', function (e) {
              e.stopAll();

              var _data = $J.extend({
                isCurrent: e.data.col === _this150.currentColumn && e.data.row === _this150.currentRow
              }, e.data);

              _this150.emit('mapImageLoaded', {
                data: _data
              });

              allCheck(_data);
            });
            this.on('imageOnerror', function (e) {
              e.stopAll();
              e.data.error = true;

              _this150.emit('mapImageLoaded', {
                data: e.data
              });

              allCheck(e.data);
              console.log('image error');
            });
          };

          _proto61.getHintType = function getHintType() {
            var result;
            var r = this.getCountOfRows();
            var c = this.getCountOfFrames();

            if (r > 1 && c > 1) {
              result = 'multi-row';
            } else if (r > 1) {
              result = 'col';
            } else {
              result = 'row';
            }

            return result;
          };

          _proto61.isLoaded = function isLoaded(imageOptions) {
            var img = this.getImage();
            imageOptions = this.setImageSettings(imageOptions);
            return img.isLoaded(imageOptions);
          };

          _proto61.isExist = function isExist(imageOptions) {
            var img = this.getImage();
            imageOptions = this.setImageSettings(imageOptions);
            return img.isExist(imageOptions);
          };

          _proto61.isCurrent = function isCurrent(position) {
            return position.row === this.currentRow && position.col === this.currentColumn;
          };

          _proto61.getCountOfImages = function getCountOfImages() {
            return this.getCountOfFrames() * this.getCountOfRows();
          };

          _proto61.getCountOfFrames = function getCountOfFrames() {
            var result = this.images[0].length || 0;
            return result;
          };

          _proto61.getCountOfRows = function getCountOfRows() {
            var result = this.images.length;
            return result;
          };

          _proto61.pixelPerFrame = function pixelPerFrame(width) {
            var min = width;
            var cols = this.getCountOfFrames();

            if (cols > 1) {
              if (!this.o.loopColumn) {
                min = min / 2;
              }

              min = min / cols;
            } else {
              min = min / this.getCountOfRows();
            } // eslint-disable-next-line


            min = min / Math.pow(this.o.columnSpeed / 50, 2);
            return min;
          };

          _proto61.pixelPerRow = function pixelPerRow(height) {
            var min = height;
            var rows = this.getCountOfRows();

            if (rows > 1) {
              if (!this.o.loopRow) {
                min = min / 2;
              }

              min = min / rows;
            } else {
              min = min / this.getCountOfFrames();
            } // eslint-disable-next-line


            min = min / Math.pow(this.o.rowSpeed / 50, 2);
            return min;
          };

          _proto61.createImages = function createImages(arr) {
            for (var i = 0, l = arr.length; i < l; i++) {
              var _arr = [];

              for (var j = 0, len = arr[i].length; j < len; j++) {
                var img = new SpinResponsiveImage(globalFunctions.adjustURL(arr[i][j]), {
                  imageSettings: this.o.imageSettings,
                  infoId: this.imageInfoId,
                  round: true,
                  referrerPolicy: this.o.referrerPolicy
                }, j, i);
                img.setParent(this);

                _arr.push(img);
              }

              this.images.push(_arr);
            }
          };

          _proto61.setFirstImage = function setFirstImage() {
            var sr = this.o.startRow;
            var sc = this.o.startColumn;

            if (this.o.reverseRow) {
              sr = this.images.length + 1 - sr;
            }

            if (this.o.reverseColumn) {
              sc = this.images[0].length + 1 - sc;
            }

            this.currentRow = sr - 1;
            this.currentColumn = sc - 1;

            if (this.currentRow > this.images.length - 1) {
              this.currentRow = 0;
            }

            if (this.currentColumn > this.images[0].length - 1) {
              this.currentColumn = 0;
            }

            this.startColumn = this.futureColumn = this.nextColumn = this.currentColumn;
            this.startRow = this.futureRow = this.nextRow = this.currentRow;
          };

          _proto61.loadImage = function loadImage(imageOptions, row, col) {
            var img = this.getImage(row, col);
            imageOptions = this.setImageSettings(imageOptions);
            img.getImage(imageOptions);
          };

          _proto61.loadFirstImage = function loadFirstImage(imageOptions) {
            if (!this.loadingMap.queue.length) {
              return;
            }

            var point = this.loadingMap.queue[0].shift();
            this.loadImage(imageOptions, point[0], point[1]);
          };

          _proto61.loadFirstPartOfImages = function loadFirstPartOfImages(imageOptions) {
            var _this151 = this;

            if (!this.loadingMap.queue.length) {
              return;
            }

            this.loadingMap.queue[0].forEach(function (point) {
              _this151.loadImage(imageOptions, point[0], point[1]);
            });
          };

          _proto61.loadOtherImages = function loadOtherImages(imageOptions) {
            var _this152 = this;

            if (this.isAvailableOfLoading && this.loadingMap.queue.length) {
              imageOptions = this.setImageSettings(imageOptions);
              this.loadingMap.queue[1].forEach(function (point) {
                _this152.loadImage(imageOptions, point[0], point[1]);
              });
            }
          };

          _proto61.loadImages = function loadImages(imageOptions) {
            var cc = this.currentColumn;

            if (this.isAvailableOfLoading) {
              imageOptions = this.setImageSettings(imageOptions);

              if (this.o.swapSides) {
                this.images.forEach(function (line) {
                  var img = line[cc];

                  if (!img.isExist(imageOptions)) {
                    img.getImage(imageOptions);
                  } else {
                    img.sendLoad(imageOptions);
                  }
                });
              } else {
                this.images.forEach(function (line) {
                  line.forEach(function (img) {
                    if (!img.isExist(imageOptions)) {
                      img.getImage(imageOptions);
                    } else {
                      img.sendLoad(imageOptions);
                    }
                  });
                });
              }
            }
          };

          _proto61.isImagesExist = function isImagesExist(imageOptions) {
            var j;
            imageOptions = this.setImageSettings(imageOptions);

            for (var i = 0, l = this.images.length; i < l; i++) {
              for (j = 0; j < this.images[i].length; j++) {
                if (!this.images[i][j].isExist(imageOptions)) {
                  return false;
                }
              }
            }

            return true;
          } // isImageExist(imageOptions) {
          //     return this.images[this.currentRow][this.currentColumn]
          //         .isExist(imageOptions.width, imageOptions.height, imageOptions.additionalImageSettings ? imageOptions.additionalImageSettings.tile : null);
          // }
          ;

          _proto61.createQueue = function createQueue() {
            var _this153 = this;

            var name;

            switch (this.o.loadingSchema) {
              case 'momentum':
                name = 'fastLine';
                break;

              case 'full':
                name = 'all';
                break;

              case 'row':
              case 'spin':
                name = 'line';
                break;

              case 'sphere':
              case 'intro':
              case 'twitch':
                name = 'sphere';
                break;

              default:
                name = 'all';
            }

            this.loadingMap.queue = LOADING_QUEUE[name]({
              swapSides: this.o.swapSides,
              images: this.images,
              startRow: this.currentRow,
              startCol: this.currentColumn
            });

            this.loadingMap.checkOfFirstPartImagesLoading = function () {
              var firstPartOfImages = [];

              _this153.loadingMap.queue[0].forEach(function (indexes) {
                firstPartOfImages.push(getPointsString(indexes[0], indexes[1]));
              });

              firstPartOfImages.shift(); // first image

              var count = firstPartOfImages.length;
              var areLoaded = false;

              if (!count) {
                areLoaded = true;
              }

              return function (row, col) {
                if (!areLoaded) {
                  if (firstPartOfImages.indexOf(getPointsString(row, col)) >= 0) {
                    count -= 1;

                    if (count === 0) {
                      firstPartOfImages = [];
                      areLoaded = true;
                    }
                  }
                }

                return areLoaded;
              };
            }();

            this.loadingMap.checkOtherImagesLoading = function () {
              var otherImages = [];

              _this153.loadingMap.queue[1].forEach(function (indexes) {
                otherImages.push(getPointsString(indexes[0], indexes[1]));
              });

              var count;
              var areLoaded = false;
              count = otherImages.length;

              if (!count) {
                areLoaded = true;
              }

              return function (row, col) {
                if (!areLoaded) {
                  if (otherImages.indexOf(getPointsString(row, col)) >= 0) {
                    count -= 1;

                    if (count === 0) {
                      otherImages = [];
                      areLoaded = true;
                    }
                  }
                }

                return areLoaded;
              };
            }();
          };

          _proto61.prepareFutureImage = function prepareFutureImage(direction, count) {
            if (!count) {
              count = 1;
            }

            var index;
            var length;
            var loop;

            if ($J.contains(['next', 'prev'], direction)) {
              loop = this.o.loopColumn;
              index = this.futureColumn;
              length = this.getCountOfFrames();

              if (direction === 'next') {
                index += count;
              } else {
                index -= count;
              }

              this.futureColumn = INTRO_QUEUE.lib.getRightIndex(index, length, loop);
            } else {
              loop = this.o.loopRow;
              index = this.futureRow;
              length = this.getCountOfRows();

              if (direction === 'down') {
                index += count;
              } else {
                index -= count;
              } // loop = false;


              this.futureRow = INTRO_QUEUE.lib.getRightIndex(index, length, loop);
            }
          };

          _proto61.setPreparedNextImage = function setPreparedNextImage() {
            this.futureColumn = this.currentColumn = this.nextColumn;
            this.futureRow = this.currentRow = this.nextRow;
            this.emit('frameChange', {
              data: {
                column: this.currentColumn,
                row: this.currentRow
              }
            });
          };

          _proto61.setPreparedFutureImage = function setPreparedFutureImage() {
            var img = this.getImage(this.futureRow, this.futureColumn);

            if (img && img.isReady()) {
              this.currentColumn = this.futureColumn;
              this.currentRow = this.futureRow;
              this.emit('frameChange', {
                data: {
                  column: this.currentColumn,
                  row: this.currentRow
                }
              });
            }
          };

          _proto61.resetPreparedImage = function resetPreparedImage() {
            this.futureColumn = this.nextColumn = this.currentColumn;
            this.futureRow = this.nextRow = this.currentRow;
          };

          _proto61.getCurrentImage = function getCurrentImage(imageOptions) {
            imageOptions = this.setImageSettings(imageOptions);
            var c = this.currentColumn;
            var r = this.currentRow;
            var img = this.getImage(r, c);
            img = img.getImage(imageOptions);
            return img;
          };

          _proto61.getOriginImageUrl = function getOriginImageUrl() {
            var c = this.currentColumn;
            var r = this.currentRow;
            var url = this.getImage(r, c);
            url = url.getOriginImageUrl();
            return url;
          };

          _proto61.jump = function jump(axis, value
          /* count or index */
          , direction) {
            var _this154 = this;

            var result = false;
            var row;
            var col;

            var checkImg = function (r, c) {
              var res = false;

              if (_this154.getImage(r, c).isReady()) {
                _this154.nextRow = r;
                _this154.nextColumn = col;

                _this154.setPreparedNextImage();

                res = true;
              }

              return res;
            };

            switch (axis) {
              case 'row':
                row = helper.spinLib.getNextIndex(this.currentRow, value, direction, this.getCountOfRows(), this.o.loopRow);
                col = this.currentColumn;
                result = checkImg(row, col);
                break;

              case 'col':
                col = helper.spinLib.getNextIndex(this.currentColumn, value, direction, this.getCountOfFrames(), this.o.loopColumn);
                row = this.currentRow;
                result = checkImg(row, col);
                break;
              // no default
            }

            return result;
          };

          _proto61.setNextAnimationFrame = function setNextAnimationFrame(index) {
            var point = this.imagesBuffer[index];
            var img = this.getImage(point.row, point.col);

            if (img && img.isReady()) {
              this.nextColumn = point.col;
              this.nextRow = point.row;
            }
          };

          _proto61.getNextBufferIndex = function getNextBufferIndex(fromIndex) {
            var _this155 = this;

            var count = 0;
            var l = this.imagesBuffer.length;

            var check = function (point) {
              var img = _this155.getImage(point.row, point.col);

              var result = false;

              if (img && img.isReady()) {
                result = true;
              }

              return result;
            };

            var point;

            do {
              count += 1;
              fromIndex += 1;

              if (fromIndex >= l) {
                count = 0;
              } else {
                point = this.imagesBuffer[fromIndex];
              }
            } while (count > 0 && (!point || !check(point)));

            return count;
          };

          _proto61.createAnimation = function createAnimation(typeOfBuffer, isBackward) {
            var jfl = false;
            var a = false;
            var cols = 0;
            var rows = 0;

            switch (typeOfBuffer) {
              case 'as-row':
                typeOfBuffer = 'sphere';
                jfl = true;
                break;

              case 'as-sphere':
                typeOfBuffer = 'sphere';
                break;

              case 'as-full':
                typeOfBuffer = 'full';
                break;

              case 'as-helix':
                // TODO do the effect
                typeOfBuffer = 'sphere';
                break;

              case 'intro':
                typeOfBuffer = 'intro';
                jfl = true;
                break;

              case 'twitch':
                typeOfBuffer = 'twitch';
                break;

              case 'spin':
                typeOfBuffer = 'sphere';
                jfl = true;
                break;

              case 'momentum':
                typeOfBuffer = 'sphere';
                jfl = true;
                a = true;
                break;

              case 'sphere':
                typeOfBuffer = 'sphere';
                break;

              default:
                cols = typeOfBuffer.cols;
                rows = typeOfBuffer.rows;
                typeOfBuffer = 'custom';
            }

            this.imagesBuffer = INTRO_QUEUE[typeOfBuffer]({
              justFirstLine: jfl,
              swapSides: this.o.swapSides,
              axelerate: a,
              isBackward: isBackward,
              count: typeOfBuffer,
              row: {
                length: this.getCountOfRows(),
                loop: this.o.loopRow,
                current: this.currentRow,
                jumpCount: rows
              },
              column: {
                length: this.getCountOfFrames(),
                loop: this.o.loopColumn,
                current: this.currentColumn,
                jumpCount: cols
              }
            });
            return this.imagesBuffer.length;
          };

          _proto61.clearFramesQueue = function clearFramesQueue() {
            this.imagesBuffer = [];
          };

          _proto61.cancelLoadingImage = function cancelLoadingImage(imageOptions) {
            var img = this.getImage();

            if (img) {
              imageOptions = this.setImageSettings(imageOptions);
              img.cancelLoadingImage(imageOptions);
            }
          };

          _proto61.getStartRow = function getStartRow() {
            return this.startRow;
          };

          _proto61.getStartColumn = function getStartColumn() {
            return this.startColumn;
          };

          _proto61.getCurrentRow = function getCurrentRow() {
            return this.currentRow;
          };

          _proto61.getCurrentColumn = function getCurrentColumn() {
            return this.currentColumn;
          };

          _proto61.getImagesBuffer = function getImagesBuffer() {
            return this.imagesBuffer;
          };

          _proto61.destroy = function destroy(last) {
            this.isAvailableOfLoading = false;
            this.resetPreparedImage();
            this.clearFramesQueue();
            this.images.forEach(function (row) {
              row.forEach(function (frame) {
                frame.destroy();
              });
            });
            this.off('imageOnload');
            this.off('imageOnerror');
            this.loadingMap = {
              queue: []
            };
            this.imgMap = [];
            this.images = $([]);
            this.currentColumn = 0;
            this.currentRow = 0;

            _EventEmitter16.prototype.destroy.call(this);
          };

          return ImagesMap_;
        }(EventEmitter);

        return ImagesMap_;
      }();
      /* eslint-env es6 */

      /* global defaultOptions, ImagesMap, SpinHotspots, Animation, Zoominstance, helper, ResponsiveImage, ProgressLoader, Hint, $J, globalFunctions, globalVariables */

      /* eslint-disable indent */

      /* eslint-disable no-lonely-if */

      /* eslint-disable class-methods-use-this */

      /* eslint operator-assignment: 0 */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Spin" }] */


      var SPIN_CONF_VER = 1;
      var P = globalVariables.smv;
      var CSS_CLASS_NAME = P + '-spin';
      var BRAND_LANDING = 'https://sirv.com/about-spin/?utm_source=client&utm_medium=sirvembed&utm_content=typeofembed(spin)&utm_campaign=branding'; // const calcScalePosition = (scale, size) => {
      //     return (size - size * scale) / 2;
      // };

      var ActivatedCurtain = /*#__PURE__*/function () {
        "use strict";

        function ActivatedCurtain(parentNode, activeNode) {
          this.parentNode = parentNode;
          this.activeNode = activeNode;
          this.activatedCurtain = $J.$new('div').addClass('spin-activated-curtain').setCss({
            top: 0,
            left: 0,
            width: '100%',
            height: '100%',
            position: 'absolute',
            'z-index': 999999999
          });
          this.state = 0; // 0 - deactivated, 1 - activated
        }

        var _proto62 = ActivatedCurtain.prototype;

        _proto62.show = function show() {
          if (this.state) {
            this.activatedCurtain.setCssProp('display', 'block');
            this.activeNode.addClass(P + '-activated');
          }
        };

        _proto62.hide = function hide() {
          if (this.state) {
            this.activatedCurtain.setCssProp('display', 'none');
            this.activeNode.removeClass(P + '-activated');
          }
        };

        _proto62.activateCurtain = function activateCurtain() {
          if (!this.state) {
            this.state = 1;
            this.activeNode.addClass(P + '-sleeping');
            this.parentNode.append(this.activatedCurtain);
          }
        };

        _proto62.deactivateCurtain = function deactivateCurtain() {
          if (this.state) {
            this.state = 0;
            this.activeNode.removeClass(P + '-sleeping');
            this.activatedCurtain.remove();
          }
        };

        _proto62.addTapEvents = function addTapEvents(callback) {
          var _this156 = this;

          this.activatedCurtain.addEvent('tap', function (e) {
            if (_this156.state) {
              e.action = 'activate';
              callback(e);
            }
          });
          this.activeNode.addEvent('tap', function (e) {
            if (_this156.state) {
              e.action = 'deactivate';
              callback(e);
            }
          });
        };

        _proto62.addPinchEvent = function addPinchEvent(handler) {
          this.activeNode.addEvent('pinch', handler);
        };

        _proto62.removePinchEvent = function removePinchEvent(handler) {
          this.activeNode.removeEvent('pinch', handler);
        };

        _proto62.destroy = function destroy() {
          this.state = 1;
          this.hide();
          this.deactivateCurtain();
          this.removePinchEvent();
          this.activeNode.removeEvent('tap');
          this.activatedCurtain.remove();
          this.activatedCurtain.removeEvent('tap');
          this.activatedCurtain = null;
        };

        return ActivatedCurtain;
      }();

      var checkProps = function (obj) {
        if (!obj.common) {
          obj.common = {};
        }

        if (!obj.common.common) {
          obj.common.common = {};
        }

        if (!obj.common.mobile) {
          obj.common.mobile = {};
        }

        if (!obj.local) {
          obj.local = {};
        }

        if (!obj.local.common) {
          obj.local.common = '';
        }

        if (!obj.local.mobile) {
          obj.local.mobile = '';
        }

        return obj;
      };

      var fnStopTouchMove = function (e) {
        e.stopDefaults();
      };

      var Spin = /*#__PURE__*/function (_Zoominstance) {
        "use strict";

        bHelpers.inheritsLoose(Spin, _Zoominstance);

        function Spin(node, options) {
          var _this157;

          _this157 = _Zoominstance.call(this, node, options, defaultOptions) || this;
          _this157.type = globalVariables.SLIDE.TYPES.SPIN; // this.instanceOptions = this.makeOptions();

          _this157.canvas = null;
          _this157.canvasContainer = $J.$new('div').addClass('spin-canvas-container');
          _this157.coreNode = $J.$new('div').addClass('sirv-spin');

          _this157.instanceNode.append(_this157.coreNode); // this.additionalCanvases = [];


          _this157.ctx = null;
          _this157.isSmoothing = false;
          _this157.smooseTimeout = null;
          _this157.minSizeOfFrame = 0;
          _this157.minSizeOfRow = 0;
          _this157.size = {
            width: 0,
            height: 0
          };
          _this157.isDragMove = false;
          _this157.longTapTimer = false;
          _this157.imagesMap = null;
          _this157.isInited = false;
          _this157.loader = null;
          _this157.hint = null;
          _this157.openedImg = null;
          _this157.scale = 1;
          _this157.cssId = -1;
          _this157.boxBoundaries = null;
          _this157.hotspots = null;
          _this157.animationFX = null;
          _this157.loadedImages = [];
          _this157.currentSize = {
            width: 0,
            height: 0
          };
          _this157.currentImageSize = {
            width: 0,
            height: 0
          };
          _this157.standardSize = {
            width: 0,
            height: 0
          };
          _this157.lastImg = null;
          _this157.startLoadingTime = null;
          _this157.isOver = false;
          _this157.isSpinActivated = !$J.browser.mobile;
          _this157.canvasPromise = null;
          _this157.firstImageLoaded = false;
          _this157.firstPartOfImagesLoaded = false;
          _this157.isInfoLoaded = false;
          _this157.customActionWas = false;
          _this157.isAutoplayPaused = false; // the variable is inside option which is hidden

          _this157.reflectDirection = false;
          _this157.configURL = _this157.instanceNode.attr('data-src') || _this157.instanceNode.attr('data-config') || '';
          _this157.imageBaseURL = globalFunctions.normalizeURL(_this157.configURL.replace(/([^#?]+)\/.*$/, '$1/'));
          _this157.absoluteURL = _this157.imageBaseURL.replace(/(^https?:\/\/[^/]*).*/, '$1/');
          _this157.configHash = $J.getHashCode(_this157.configURL.replace(/^http(s)?:\/\//, ''));
          _this157.configPath = '/' + _this157.configURL.replace(_this157.absoluteURL, '');
          _this157.imageInfoCallbackName = 'sirv_spin_image_info_';
          _this157.sessionId = $J.getHashCode(_this157.configURL.replace(/^http(s)?:\/\//, '') + $J.D.node.location.href.replace(/^http(s)?:\/\//, '') + $J.now());
          _this157.layers = {};
          _this157.imageSettings = {};
          _this157.hotspotsData = [];
          _this157.fullscreenStartTime = 0;
          _this157.meta = {};
          _this157.isFullscreen = options.isFullscreen;
          _this157.nativeFullscreen = options.nativeFullscreen;
          _this157.infoSettings = {};
          _this157.autospinResumeTimer = null;
          _this157.isHidden = false;
          _this157.sessionStartTime = 0;
          _this157.animationCloud = null;
          _this157.touchDragCloud = null;
          _this157.slideDragEventStart = false;
          _this157.dppx = null;
          _this157.startTimeForZommEvent = null;
          _this157.resizeAnimationTimer = helper.debounce(function () {
            _this157.animate('inactive');
          }, 1000);
          _this157.keyPressHandlerForShiftButton = null;
          _this157.firstUserInteraction = false;
          _this157.userColumn = 0;
          _this157.userRow = 0;
          _this157.placeholder = _this157.instanceNode.node.querySelector('img');

          if (_this157.placeholder) {
            _this157.placeholder = $(_this157.placeholder);
          }

          _this157.replaceTextParamURLFromMetadata();

          _this157.trackUnload = function () {
            _this157.sendStats('Page Unload', $J.now() - _this157.sessionStartTime, {
              message: 'Stopped'
            }, true);
          }; // Handle window resize to prevent page dragging on mobile devices when spin fills the entire page.


          _this157.disableScrollOnMobile = function () {
            var docFullSize = $J.D.getFullSize();

            var placeholderSize = _this157.instanceNode.getSize();

            if (Math.abs(placeholderSize.height - docFullSize.height) <= 50) {
              _this157.instanceNode.addEvent('touchmove', fnStopTouchMove);
            } else {
              _this157.instanceNode.removeEvent('touchmove', fnStopTouchMove);
            }
          };

          _this157.resizeWindowTimer = null;

          _this157.windowResizeCallback = function () {
            clearTimeout(_this157.resizeWindowTimer);
            _this157.resizeWindowTimer = setTimeout(function () {
              _this157.disableScrollOnMobile();
            }, 10);
          };

          _this157.api = $J.extend(_this157.api, {
            isInitialized: _this157.isInitialized.bind(bHelpers.assertThisInitialized(_this157)),
            // new
            play: _this157.play.bind(bHelpers.assertThisInitialized(_this157)),
            pause: _this157.pause.bind(bHelpers.assertThisInitialized(_this157)),
            rotate: _this157.rotateXY.bind(bHelpers.assertThisInitialized(_this157)),
            rotateX: _this157.rotateX.bind(bHelpers.assertThisInitialized(_this157)),
            rotateY: _this157.rotateY.bind(bHelpers.assertThisInitialized(_this157)),
            jump: _this157.jump.bind(bHelpers.assertThisInitialized(_this157)),
            jumpRows: _this157.jumpRows.bind(bHelpers.assertThisInitialized(_this157)),
            // new
            jumpCols: _this157.jumpCols.bind(bHelpers.assertThisInitialized(_this157)),
            // new
            // resize: this.resize.bind(this), // parent class
            // zoomIn: this.zoomIn.bind(this), // parent class
            // zoomOut: this.zoomOut.bind(this), // parent class
            // isZoomed: this.isZoomed.bind(this), // new, parent class
            // isReady: this.isReady.bind(this), // parent class
            // getOptions: this.getOptions.bind(this), // parent class
            // hotspots: {}, // parent class, hotspots api
            currentFrame: _this157.currentFrame.bind(bHelpers.assertThisInitialized(_this157))
          });

          _this157.createHotspotsClass(SpinHotspots);

          _this157.getInfo().then(function () {
            if ($J.browser.mobile && _this157.option('tappingFirst')) {
              _this157.activatedCurtain = new ActivatedCurtain(_this157.instanceNode, _this157.coreNode);
            } else {
              _this157.isSpinActivated = true;
            }

            _this157.createMap(_this157.quality, _this157.hdQuality, _this157.isHDQualitySet);
          }).catch(function (e) {});

          return _this157;
        } // API


        var _proto63 = Spin.prototype;

        _proto63.isInitialized = function isInitialized() {
          return this.isInited;
        } // API
        ;

        _proto63.rotateXY = function rotateXY(x, y) {
          if (this._isReady && !this.isZoomed()) {
            return this.rotate(x, y);
          }

          return false;
        } // API
        ;

        _proto63.rotateX = function rotateX(frames) {
          if (this._isReady && !this.isZoomed()) {
            return this.rotate(frames, null);
          }

          return false;
        } // API
        ;

        _proto63.rotateY = function rotateY(frames) {
          if (this._isReady && !this.isZoomed()) {
            return this.rotate(null, frames);
          }

          return false;
        }
        /**
         * Jump up/down by certain number of rows
         * @param  {int} rows Number of rows to jump
         * @return
         */
        // API
        ;

        _proto63.jump = function jump(rows) {
          return this.jumpRows(rows);
        } // API
        ;

        _proto63.jumpRows = function jumpRows(frame) {
          if (this._isReady && !this.isZoomed()) {
            return this.jumpTo(frame, 'row');
          }

          return false;
        } // API
        ;

        _proto63.jumpCols = function jumpCols(frame) {
          if (this._isReady && !this.isZoomed()) {
            return this.jumpTo(frame, 'col');
          }

          return false;
        }
        /**
         * Retrieve current visible frame
         * @return
         */
        // API
        ;

        _proto63.currentFrame = function currentFrame() {
          if (this._isReady) {
            return this.getCurrentFrame();
          }

          return null;
        } // API
        ;

        _proto63.isActive = function isActive() {
          return this.isSpinActivated;
        };

        _proto63.makeGlobalOptions = function makeGlobalOptions(optionsInstance) {
          var o = this.options.options;
          optionsInstance.fromJSON(o.common.common);
          helper.objEach(this.infoSettings, function (key, value) {
            if (!$J.contains(['images', 'hotspots'], key)) {
              optionsInstance.set(key, value);
            }
          });
          optionsInstance.fromString(o.local.common);
          optionsInstance.fromString(this.instanceNode.attr('data-options') || '');
          return optionsInstance;
        };

        _proto63.makeOptions = function makeOptions() {
          this.options.options = checkProps(this.options.options);
          return _Zoominstance.prototype.makeOptions.call(this);
        };

        _proto63.sendStats = function sendStats(name, time, additionalData, useBeacon) {
          var data = {
            account: this.config.account,
            useBeacon: !!useBeacon,
            event: name,
            eventTime: time,
            sessionId: this.sessionId,
            origin: this.configPath
          };

          if (additionalData) {
            data.data = additionalData;
          }

          this.emit('stats', {
            data: data
          });
        };

        _proto63.getInfo = function getInfo() {
          var _this158 = this;

          if (!this.gettingInfoPromise) {
            this.gettingInfoPromise = new Promise(function (resolve, reject) {
              _this158.waitGettingInfo.wait(function () {
                var cfCallbackName = 'sirv_spin_info_v' + SPIN_CONF_VER + '_' + _this158.configHash;
                var url = _this158.configURL + ($J.stringHas(_this158.configURL, '?') ? '&' : '?') + 'info=' + cfCallbackName;
                helper.getRemoteData(url, cfCallbackName, _this158.referrerPolicy).then(function (config) {
                  if (!_this158.destroyed) {
                    if (config.layers) {
                      _this158.config = config;
                      _this158.layers = _this158.config.layers;
                      _this158.meta = _this158.config._file.meta || null;
                      _this158.infoSettings = _this158.config.settings;
                      _this158.hotspotsData = _this158.config.settings.hotspots || [];
                      _this158.imageSettings = _this158.config.settings.images.main;
                      _this158.accountInfo = {
                        account: _this158.config.account,
                        branded: _this158.config.branded
                      };
                      _this158.sessionStartTime = $J.now();

                      _this158.sendStats('sessionStart', _this158.sessionStartTime);

                      $J.W.addEvent('beforeunload', _this158.trackUnload);
                      resolve();
                    } else if (config.contentType && /image/.test(config.contentType) || config._isplaceholder) {
                      reject({
                        error: 'changeSpinToImage',
                        isPlaceholder: config._isplaceholder,
                        account: config.account
                      });
                    } else {
                      reject({
                        error: {
                          status: 404
                        }
                      });
                    }
                  }
                }).catch(function (err) {
                  if (!_this158.destroyed) {
                    reject({
                      error: err
                    });
                  }
                });
              });
            });
          }

          return this.gettingInfoPromise;
        };

        _proto63.replaceTextParamURLFromMetadata = function replaceTextParamURLFromMetadata() {
          var _this159 = this;

          if (this.imageSettings.text && this.imageSettings.text.text) {
            this.imageSettings.text.text = this.imageSettings.text.text.replace(/\$\{spin\.(title|description)\}/g, function (m, p1) {
              var t = _this159.meta[p1] || '';

              if (typeof t === 'string') {
                return t;
              }

              return p1;
            });

            if (this.imageSettings.text.text === '') {
              delete this.imageSettings.text;
            }
          }
        };

        _proto63.getDPPX = function getDPPX(size) {
          var side = size.height > size.width ? 'height' : 'width';
          var tmp = {};
          tmp[side] = size[side];
          this.dppx = helper.getDPPX(ResponsiveImage.roundImageSize(tmp)[side], this.infoSize[side], this.upscale);
        };

        _proto63.showHint = function showHint() {
          var result = false;

          if (this.hint) {
            if ((!this.always || $J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.fullscreenState)) && (!this.option('autospin.enable') || !this.firstUserInteraction) // do not show hint again after first user interaction if the autospin.enable is true
            ) {
                result = true;
                this.hint.show();
              }
          }

          return result;
        };

        _proto63.onStartActions = function onStartActions() {
          if (this._isReady) {
            this.animate('slideIn');
          } else {
            if (this.isStarted) {
              if (this.isInited && !this.initNameEvent) {
                this.loadFirstPartOfImages();
              } else {
                // if (this.isInView || this.preload) {
                if (this.isInView) {
                  this.loadFirstImage();
                }
              }
            }
          }
        };

        _proto63.onStopActions = function onStopActions() {
          this.zoomOut();
          this.stopSmoothing();
          this.stopAnimation();
          this.deactivateSpin();
          this.setUserFrame();
          this.customActionWas = false;

          if (this.hint) {
            this.hint.hide();
          }

          _Zoominstance.prototype.onStopActions.call(this);
        };

        _proto63.onInView = function onInView(value) {
          if (value) {
            if (!this.isInView) {
              if (this._isReady) {
                this.isInView = true;
                this.animate('inView');
              } else {
                if (this.preload || this.isSlideShown) {
                  this.isInView = true;

                  if (this.isInited) {
                    if (this.isSlideShown && !this.initNameEvent) {
                      this.loadFirstPartOfImages();
                    }
                  } else {
                    this.loadFirstImage();
                  }
                }
              }
            }
          } else {
            if (this.isInView && this._isReady) {
              if (this.option('autospin.enable')) {
                this.animationCloud.pause();
              } else {
                this.stopAnimation();
                this.setUserFrame();
              }

              this.deactivateSpin();
            }
          }
        };

        _proto63.startFullInit = function startFullInit(options) {
          var _this160 = this;

          if (this.isStartedFullInit) {
            return;
          } // if (options) {
          //     this.instanceOptions = options.options;
          //     options.options = this.makeOptions();
          // }


          _Zoominstance.prototype.startFullInit.call(this, options);

          this.getInfo().then(function () {
            _this160.normalizeOptions();

            _this160.getId('spin-');

            var option = _this160.option;

            _this160.imagesMap.startFullInit({
              swapSides: option('swapSides'),
              startColumn: option('column.start'),
              startRow: option('row.start'),
              reverseColumn: option('column.reverse'),
              reverseRow: option('row.reverse'),
              loopColumn: option('column.loop'),
              loopRow: option('row.loop'),
              rowSpeed: option('row.sensitivity'),
              columnSpeed: option('column.sensitivity'),
              columnIncrement: option('column.increment'),
              rowIncrement: option('row.increment')
            });

            _this160.loadedImages = _this160.imagesMap.getMap();
            _this160.loader = new ProgressLoader(_this160.coreNode, {
              max: _this160.imagesMap.getCountOfImages(),
              'class': 'spin-loader'
            });

            _this160.loader.setParent(_this160);

            _this160.coreNode.addEvent('btnclick tap', function (e) {
              e.stop();
            });

            _this160.on('isSingleSlide', function (e) {
              e.stop();

              if (_this160.activatedCurtain) {
                if (e.data.isSingle) {
                  _this160.activatedCurtain.deactivateCurtain();
                } else {
                  _this160.activatedCurtain.activateCurtain();
                }
              }
            });

            if (_this160.hotspots) {
              _this160.hotspots.setOptions({
                columnsRevers: _this160.option('column.reverse'),
                rowsRevers: _this160.option('row.reverse'),
                rows: _this160.imagesMap.getCountOfRows(),
                columns: _this160.imagesMap.getCountOfFrames()
              });
            }

            _this160.initAnimation();
          }).catch(function () {});

          if ($J.browser.touchScreen) {
            this.on('dragEvent', function (e) {
              if (e.data.type === 'dragstart') {
                _this160.slideDragEventStart = true;

                if (_this160.touchDragCloud) {
                  _this160.touchDragCloud.removeEvent();
                }
              } else if (e.data.type === 'dragend') {
                _this160.slideDragEventStart = false;

                if (_this160.touchDragCloud) {
                  _this160.touchDragCloud.addEvent();
                }
              }
            });
          }
        };

        _proto63.getThumbnailData = function getThumbnailData(opt) {
          return this.imagesMap.getThumbnail(opt);
        };

        _proto63.setUserFrame = function setUserFrame() {
          this.jumpTo(this.userRow, 'row');
          this.jumpTo(this.userColumn, 'col');
        };

        _proto63.getSocialButtonData = function getSocialButtonData(data, isSpin) {
          var url = null;

          if (isSpin) {
            url = this.instanceNode.attr('data-src');
          } else {
            url = _Zoominstance.prototype.getSocialButtonData.call(this, data);
          }

          return url;
        };

        _proto63.turnOnOff = function turnOnOff() {
          var _this161 = this;

          if (!$J.browser.mobile || !this.activatedCurtain) {
            return;
          }

          this.activatedCurtain.addTapEvents(function (e) {
            if (e.action === 'activate') {
              if (!_this161.isSpinActivated) {
                e.stop();

                _this161.activateSpin();
              }

              if (_this161.hotspots) {
                _this161.hotspots.hideActiveHotspotBox(true);
              }
            } else {
              if (_this161.isSpinActivated) {
                e.stop();

                _this161.stopSmoothing();

                _this161.stopAnimation();

                if (_this161.hotspots && _this161.hotspots.isHotspotActivated()) {
                  _this161.hotspots.hideActiveHotspotBox(true);
                } else {
                  _this161.deactivateSpin();
                }
              }
            }
          });
        };

        _proto63.activateSpin = function activateSpin() {
          if (!this.isSpinActivated) {
            this.isSpinActivated = true;

            if ($J.browser.mobile) {
              this.stopAnimation();
              this.customActionWas = true;

              if (this.hint) {
                this.hint.hide();
              }

              if (this.activatedCurtain) {
                this.activatedCurtain.hide();
              }
            }
          }
        };

        _proto63.deactivateSpin = function deactivateSpin() {
          if (this.isSpinActivated) {
            this.isSpinActivated = false;

            if ($J.browser.mobile) {
              if (!this.customActionWas) {
                this.showHint();
              }

              if (this.activatedCurtain) {
                this.activatedCurtain.show();
              } // this.customActionWas = false;
              // this.animate('inactive');

            }
          }
        } // setActiveAction() {
        //     if ($J.browser.mobile) { return; }
        //     this.canvasContainer.addEvent('mouseover', e => {
        //         if (this.isSlideShown) {
        //             this.isOver = true;
        //             if (this._isReady) {
        //                 this.activateSpin();
        //             }
        //         }
        //     });
        //     this.canvasContainer.addEvent('mouseout', e => {
        //         if (this.isSlideShown) {
        //             this.isOver = false;
        //             this.deactivateSpin();
        //         }
        //     });
        // }
        ;

        _proto63.createPinchEvent = function createPinchEvent() {
          var _this162 = this;

          // difference between scale
          var OPEN_ZOOM = 1.1;
          var FS_OUT = 0.2;
          var FS_IN = 2;
          var saveValue;
          var scale;
          var baseMin;
          var compensation;
          var maxCompensation;
          var minCompensation;
          var max;
          var min;
          var basePercent;

          var setDefaultsValues = function () {
            maxCompensation = 1;
            minCompensation = 1;
            baseMin = _this162.zoom.getBaseScale().x;
            max = 1;
            min = baseMin;
            saveValue = 1 - baseMin;
          };

          _Zoominstance.prototype.createPinchEvent.call(this, this.coreNode);

          this.pinchCloud.onPinchStart = function (e) {
            if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.CLOSING], _this162.fullscreenState)) {
              return;
            }

            _this162.pinchCloud.pinch = true;
            clearTimeout(_this162.longTapTimer);

            _this162.stopSmoothing();

            _this162.stopAnimation();

            if (_this162.touchDragCloud) {
              _this162.touchDragCloud.removeEvent();
            }

            if (_this162.hotspots) {
              _this162.hotspots.hideActiveHotspotBox(true);
            }

            _this162.customActionWas = true;
            basePercent = false;
            _this162.pinchCloud.scale = e.scale;
            compensation = 1;

            if (_this162.openedImg) {
              compensation = _this162.zoom.scale.x;

              if (baseMin === $J.U) {
                setDefaultsValues();
              }

              compensation /= baseMin;
            }

            _this162.sendEvent('pinchStart');
          };

          this.pinchCloud.onPinchResize = function (e) {
            if (_this162.pinchCloud.pinch && !_this162.pinchCloud.block) {
              if (_this162.zoom && _this162.fullscreenState === globalVariables.FULLSCREEN.OPENED && _this162.openedImg) {
                _this162.pinchCloud.scale = e.scale;

                _this162.zoom.setBasePercent(e.centerPoint);
              }
            }
          };

          this.pinchCloud.onPinchMove = function (e) {
            if (_this162.pinchCloud.pinch && !_this162.pinchCloud.block) {
              if (_this162.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this162.isFullscreenEnabled) {
                if (!_this162.openedImg) {
                  if (e.scale > OPEN_ZOOM) {
                    _this162.firstUserInteraction = true;

                    _this162.openLens(e.centerPoint.x, e.centerPoint.y, false, 'zero');

                    setDefaultsValues();
                    compensation = 1;
                  } else if (e.scale < FS_OUT) {
                    _this162.pinchCloud.block = true;

                    _this162.sendEvent('fullscreenOut');
                  }
                } else if (_this162.zoom) {
                  if (!basePercent) {
                    basePercent = true;

                    _this162.zoom.setBasePercent(e.centerPoint);
                  } else {
                    scale = e.scale;
                    scale *= baseMin;

                    if (max < scale) {
                      max = scale;
                      min = baseMin;
                      minCompensation = 1;
                      maxCompensation = saveValue / (max - baseMin);
                    }

                    if (min > scale) {
                      min = scale;
                      max = 1;
                      maxCompensation = 1;
                      minCompensation = baseMin / min;
                    }

                    scale *= compensation;
                    scale = (baseMin + (scale - baseMin) * maxCompensation) * minCompensation;

                    _this162.zoom.setScale(scale, e.centerPoint.x, e.centerPoint.y);
                  }

                  _this162.pinchCloud.scale = e.scale;
                }
              } else if (e.scale >= FS_IN) {
                _this162.pinchCloud.block = true;

                _this162.sendEvent('fullscreenIn');
              }
            }
          };

          this.pinchCloud.onPinchEnd = function (e) {
            if (_this162.pinchCloud.pinch) {
              _this162.pinchCloud.pinch = false;

              if (_this162.openedImg) {
                _this162.activateSpin();
              }

              setTimeout(function () {
                if (_this162.touchDragCloud) {
                  _this162.touchDragCloud.addEvent();
                }
              }, 16);

              _this162.sendEvent('pinchEnd');
            }

            if (_this162.openedImg) {
              _this162.pinchCloud.removeEvent();
            }

            _this162.pinchCloud.block = false;
            _this162.pinchCloud.scale = 0;
          };
        };

        _proto63.onStopContext = function onStopContext() {
          this.stopSmoothing();
          this.stopAnimation();

          if (this.hint) {
            this.hint.hide();
          }
        };

        _proto63.onSecondSelectorClick = function onSecondSelectorClick() {
          this.zoomOut();
        };

        _proto63.setGlobalEvents = function setGlobalEvents() {
          var _this163 = this;

          this.on('zoomUp', function (e) {
            var pos = e.data;
            e.stop();

            if (_this163._isReady && _this163.zoom) {
              if (!_this163.isDragMove && _this163.isFullscreenActionEnded()) {
                _this163.firstUserInteraction = true;

                _this163.openLens(pos.x, pos.y);
              }
            }
          });
          this.on('zoomDown', function (e) {
            e.stop();

            if (_this163._isReady && _this163.zoom && _this163.isZoomed()) {
              _this163.zoom.hide();
            }
          });
        };

        _proto63.normalizeOptions = function normalizeOptions() {
          var _this164 = this;

          if (!this.option('autospin.enable')) {
            this.option('autospin.duration', 0);
          }

          if (this.option('swapSides')) {
            ['start', 'loop', 'increment', 'reverse', 'sensitivity'].forEach(function (param) {
              var tmp = _this164.option('row.' + param);

              _this164.option('row.' + param, _this164.option('column.' + param));

              _this164.option('column.' + param, tmp);
            });
          }

          ['onStart', 'onVisible', 'onInactive'].forEach(function (v) {
            var o = 'hint.' + v + '.effect';

            if (_this164.option(o) === 'none') {
              _this164.option(o, false);
            }
          });

          if ($J.browser.mobile) {
            if (this.option('initialize') !== 'load') {
              this.option('initialize', 'tap');
            }
          }

          this.setDefaultZoomOptions();

          if (this.option('zoom.enable') && this.option('zoom.ratio') !== 'max' && this.option('zoom.ratio') < globalVariables.MIN_RATIO) {
            this.option('zoom.enable', false);
          }
        };

        _proto63.setDefaultZoomOptions = function setDefaultZoomOptions() {
          _Zoominstance.prototype.setDefaultZoomOptions.call(this);

          this.defaultZoomOptions = $J.extend(this.defaultZoomOptions, {
            tiles: this.option('zoom.tiles'),
            pan: this.option('zoom.pan'),
            trigger: $J.browser.mobile ? 'dblclick' : 'click',
            type: 'inner',
            height: 'auto'
          });
        };

        _proto63.loadFirstPartOfImages = function loadFirstPartOfImages() {
          if (!this.firstPartOfImagesLoaded) {
            this.firstPartOfImagesLoaded = true;
            this.startLoadingTime = $J.now();
            this.imagesMap.loadFirstPartOfImages({
              width: this.currentImageSize.width,
              height: this.currentImageSize.height,
              dppx: this.dppx
            });

            if (this.loader) {
              this.loader.show();
            }
          }
        };

        _proto63.isThumbnailGif = function isThumbnailGif() {
          return this.option('thumbnail.type') === 'gif';
        };

        _proto63.init = function init() {
          var _this165 = this;

          if (!this.infoSize || this.isInited) {
            return;
          }

          this.isInited = true; // this.setActiveAction();

          this.initNameEvent = null;

          this.initFnEvent = function (e) {
            e.stop();

            _this165.coreNode.removeEvent(e.type, _this165.initFnEvent);

            if (_this165.activatedCurtain) {
              _this165.activatedCurtain.activatedCurtain.removeEvent(_this165.initNameEvent, _this165.initFnEvent);
            }

            _this165.loadFirstPartOfImages();
          };

          switch (this.option('initialize')) {
            case 'hover':
              this.initNameEvent = 'mouseover';
              break;

            case 'click':
              this.initNameEvent = 'btnclick';
              break;

            case 'tap':
              this.initNameEvent = 'tap';
              break;

            default:
          }

          if (this.initNameEvent) {
            this.coreNode.addEvent(this.initNameEvent, this.initFnEvent);

            if (this.activatedCurtain) {
              this.activatedCurtain.activatedCurtain.addEvent(this.initNameEvent, this.initFnEvent);
            }

            this.loadFirstImage();
          } else {
            if (this.isInView && this.isSlideShown) {
              this.loadFirstPartOfImages();
            }
          }

          this.sendEvent('init');
        };

        _proto63.run = function run(isShown, preload, firstSlideAhead) {
          var result = _Zoominstance.prototype.run.call(this, isShown, preload, firstSlideAhead);

          if (result) {
            $J.W.addEvent('resize', this.windowResizeCallback);
            this.initCanvas();
            this.startGettingInfo();
          }

          return result;
        };

        _proto63.initCanvas = function initCanvas() {
          this.canvas = $J.$new('canvas');

          if (this.canvas.node.getContext) {
            this.ctx = this.canvas.node.getContext('2d'); // for (let i = 0; i < 2; i++) {
            //     const canvas = $J.$new('canvas');
            //     this.additionalCanvases.push({
            //         node: canvas,
            //         ctx: canvas.node.getContext('2d')
            //     });
            // }
          }

          var alt = this.getRightAlt();

          if (alt) {
            this.canvas.attr('role', 'img');
            this.canvas.attr('aria-label', alt);
            this.canvas.attr('alt', alt);
          }

          var w = this.infoSize.width;
          var h = this.infoSize.height;
          var size = this.coreNode.getSize();

          if (w < size.width) {
            w = size.width;
          }

          if (h < size.height) {
            h = size.height;
          } // broke html if image less then viewer
          // I do not know why I added it
          // this.coreNode.setCss({
          //     'max-width': w + 'px',
          //     'max-height': h + 'px'
          // });


          if (size.height === 0) {
            this.cssId = $J.addCSS('#' + this.id + ' .' + CSS_CLASS_NAME + ':before', {
              'padding-top': this.infoSize.height / this.infoSize.width * 100 + '%'
            }, this.id + '-css');
            size.height = size.width * (this.infoSize.height / this.infoSize.width);
          }

          this.currentSize = helper.spinLib.calcProportionSize(size, this.infoSize);
          this.getDPPX(this.currentSize);
          this.standardSize.width = this.currentSize.width;
          this.standardSize.height = this.currentSize.height;
          this.setImageSize();
          this.canvas.setCss({
            top: '0',
            left: '0',
            zIndex: 10,
            position: 'absolute'
          });
          this.setCanvasSize();
          this.canvasContainer.append(this.canvas);
          this.coreNode.append(this.canvasContainer);

          if (this.isInView && (this.preload || this.isSlideShown)) {
            this.loadFirstImage();
          }
        };

        _proto63.loadContent = function loadContent() {
          this.loadFirstImage();
        };

        _proto63.loadFirstImage = function loadFirstImage() {
          if (!this.firstImageLoaded && this.isInfoLoaded) {
            // fix for if the viewer was with display none
            if (!this.currentImageSize.width || !this.currentImageSize.height) {
              this.currentSize = helper.spinLib.calcProportionSize(this.coreNode.getSize(), this.infoSize);
              this.getDPPX(this.currentSize);

              if (this.currentSize.width && this.currentSize.height) {
                this.setImageSize();

                if (this.isStarted && this.currentImageSize.width && this.currentImageSize.height) {
                  this.setCanvasSize();
                  this.draw();
                }
              }
            }

            if (!this.currentImageSize.width || !this.currentImageSize.height) {
              return;
            }

            this.waitToStart.start();
            this.firstImageLoaded = true;
            this.imagesMap.loadFirstImage({
              width: this.currentImageSize.width,
              height: this.currentImageSize.height,
              dppx: this.dppx
            });
          }
        };

        _proto63.getRightAlt = function getRightAlt() {
          var description = null;

          if (!this.dataAlt && this.meta && this.meta.description) {
            description = this.meta.description;
          } else {
            description = this.dataAlt;
          }

          return description;
        };

        _proto63.createMap = function createMap(quality, hdQuality, isHDQualitySet) {
          var _this166 = this;

          var option = this.option;
          var loadingSchema = null;

          if (option('autospin.enable')) {
            loadingSchema = option('autospin.type');
          } else if (option('hint.onStart.enable') && option('hint.onStart.effect')) {
            loadingSchema = option('hint.onStart.effect');
          }

          this.imagesMap = new ImagesMap({
            url: this.configURL,
            imageSettings: this.imageSettings,
            layers: this.layers,
            swapSides: option('swapSides'),
            startColumn: option('column.start'),
            startRow: option('row.start'),
            reverseColumn: option('column.reverse'),
            reverseRow: option('row.reverse'),
            loopColumn: option('column.loop'),
            loopRow: option('row.loop'),
            rowSpeed: option('row.sensitivity'),
            columnSpeed: option('column.sensitivity'),
            columnIncrement: option('column.increment'),
            rowIncrement: option('row.increment'),
            loadingSchema: loadingSchema,
            quality: quality,
            hdQuality: hdQuality,
            isHDQualitySet: isHDQualitySet,
            referrerPolicy: this.referrerPolicy
          });
          this.imagesMap.setParent(this);
          this.userColumn = this.imagesMap.getStartColumn();
          this.userRow = this.imagesMap.getStartRow();
          this.on('mapFirstImageLoaded', function (e) {
            e.stopAll();

            if (_this166.placeholder) {
              _this166.placeholder.setCssProp('display', 'none');
            }

            if (!_this166.isInited) {
              if (_this166.firstImageLoaded) {
                _this166.draw();

                _this166.canvas.setCssProp('transition', 'none');

                _this166.canvas.getSize();

                _this166.canvas.setCssProp('transition', '');
              }

              if (_this166.loader) {
                _this166.loader.progress();
              }

              _this166.setCanvas().finally(function () {
                _this166.init();
              });
            }

            if (_this166.hotspots) {
              var img = _this166.imagesMap.getCurrentImage({
                width: _this166.currentSize.width,
                height: _this166.currentSize.height
              });

              _this166.hotspots.setFramePosition(img.row, img.col);

              _this166.hotspots.updateAndShow();

              if (_this166.isInView && _this166.isSlideShown) {
                _this166.hotspots.showNeededElements();
              }
            }
          });
          this.on('mapImagesReady', function (e) {
            e.stopAll();

            _this166.imagesMap.loadOtherImages({
              width: _this166.currentImageSize.width,
              height: _this166.currentImageSize.height,
              dppx: _this166.dppx
            });

            _this166.calcMinSizeForDrag();

            var now = $J.now();

            _this166.sendStats('framesPreloaded', now - _this166.sessionStartTime, {
              duration: now - _this166.startLoadingTime
            });

            _this166.done();

            _this166.sendContentLoadedEvent();
          });
          this.on('mapImageLoaded', function (e) {
            e.stopAll();

            if (_this166.loader) {
              if (!_this166.loadedImages[e.data.row][e.data.col]) {
                _this166.loadedImages[e.data.row][e.data.col] = true;

                _this166.loader.progress();
              }
            }

            if (!e.data.error) {
              if (e.data.isCurrent) {
                if (e.data.callbackData.lens) {
                  // if (this.option('zoom.magnify.enable') && this.zoom) { // the option was removed
                  if (_this166.zoom) {
                    if ((_this166.zoom.isShown() || _this166.zoom.isShowing()) && _this166.openedImg) {
                      if (_this166.openedImg.col === e.data.col && _this166.openedImg.row === e.data.row) {
                        _this166.zoom.setImage(e.data);
                      }
                    }
                  }
                } else {
                  if (_this166.lastImg && (_this166.lastImg.width !== e.data.width || _this166.lastImg.height !== e.data.height) && _this166.firstImageLoaded) {
                    _this166.draw();
                  }
                }
              }
            }
          });
          this.on('mapAllImagesLoaded', function (e) {
            e.stopAll();
            var now = $J.now();

            _this166.sendStats('framesLoaded', now - _this166.sessionStartTime, {
              duration: now - _this166.startLoadingTime
            });

            if (_this166.loader && _this166.loader.getProgressState() !== 2) {
              _this166.loader.hide();
            }
          });
          this.on('frameChange', function (e) {
            e.stop();

            if (_this166._isReady) {
              _this166.sendEvent('frameChange', {
                row: e.data.row,
                column: e.data.column
              });
            }
          });
          this.imagesMap.loadImageInfo().then(function (originSize) {
            _this166.isInfoLoaded = true;
            var size = $J.extend({}, originSize.size);
            _this166.infoSize = size;

            if (_this166.hotspots) {
              _this166.hotspots.setOriginImageSize(_this166.infoSize.width, _this166.infoSize.height);
            }
          }).catch(function (err) {
            _this166.isInfoLoaded = true;
          });
        };

        _proto63.getSelectorImgUrl = function getSelectorImgUrl(data) {
          var _this167 = this;

          return new Promise(function (resolve, reject) {
            _this167.getInfo().then(function () {
              _this167.imagesMap.loadImageInfo().then(function (originSize) {
                _this167.waitToStart.wait(function () {
                  var defOpt = _this167.imagesMap.setImageSettings({
                    dppx: _this167.dppx
                  });

                  if (defOpt.src) {
                    data.src = defOpt.src;
                  }

                  data.srcset = defOpt.srcset;

                  if (_this167.option('thumbnail.type') === 'gif') {
                    data.originUrl = _this167.configURL.split('?')[0];
                    data.imageSettings = {
                      image: 24
                    };

                    if (_this167.option('thumbnail.gifParams')) {
                      data.imageSettings = helper.paramsFromQueryString(_this167.option('thumbnail.gifParams'));
                    }
                  }

                  resolve($J.extend(_this167.imagesMap.getThumbnail(data), {
                    alt: _this167.getRightAlt()
                  }));
                });
              }).catch(reject);
            }).catch(reject);
          });
        };

        _proto63.getInfoSize = function getInfoSize() {
          var _this168 = this;

          return new Promise(function (resolve, reject) {
            _this168.getInfo().then(function () {
              _this168.imagesMap.loadImageInfo().then(resolve).catch(reject);
            }).catch(reject);
          });
        };

        _proto63.onHotspotActivate = function onHotspotActivate(data) {
          this.customActionWas = true;
          this.stopAnimation();

          _Zoominstance.prototype.onHotspotActivate.call(this, data);
        };

        _proto63.onHotspotDeactivate = function onHotspotDeactivate(data) {
          _Zoominstance.prototype.onHotspotDeactivate.call(this, data);

          this.animateWithDelay();
        };

        _proto63.createHint = function createHint() {
          if (!this.option('hint.message.enable')) {
            return;
          }

          var hintMessage = '<div class="spin-hint-animation"></div>';
          var horizontal = 'spin-hint-horizontal-animation';
          var vertical = 'spin-hint-vertical-animation';
          var hintClass;
          hintMessage += '<span>';
          hintMessage += this.option('hint.message.text');
          hintMessage += '</span>';

          switch (this.imagesMap.getHintType()) {
            case 'multi-row':
              hintClass = horizontal + ' ' + vertical;
              break;

            case 'row':
              hintClass = horizontal;
              break;

            case 'col':
              hintClass = vertical;
              break;
            // no default
          }

          var hintOptions = {
            html: hintMessage,
            additionalClass: hintClass
          };

          if ($J.browser.mobile || this.option('autospin.enable')) {
            hintOptions.autohide = 0;
          }

          this.hint = new Hint(this.coreNode, hintOptions);

          if (this.isSlideShown && this.isInView && this.option('autospin.type') === 'infinite') {
            this.showHint();
          }
        };

        _proto63.getImageClassContainer = function getImageClassContainer() {
          return this.imagesMap;
        };

        _proto63.createZoom = function createZoom() {
          var _this169 = this;

          var result = null;

          if (!this.destroyed && this.option('zoom.enable')) {
            result = _Zoominstance.prototype.createZoom.call(this, this.coreNode, {});

            if (this.zoomContainer) {
              this.zoom.setLensContainer(this.zoomContainer);
            }

            this.coreNode.addEvent('btnclick dbltap', function (e) {
              if (_this169.isFullscreenActionEnded()) {
                _this169.firstUserInteraction = true;

                _this169.openLens(e.x, e.y);
              }
            });

            if ($J.browser.mobile) {// this.setLongTapEvents();
            }
          }

          return result;
        };

        _proto63.onZoomGetImage = function onZoomGetImage(e) {
          _Zoominstance.prototype.onZoomGetImage.call(this, e);

          if (this.checkImage(e.data, e.data.dontLoad)) {
            this.zoom.setImage(this.imagesMap.getCurrentImage(e.data));
          } else {
            this.imagesMap.loadImage(e.data);
          }
        };

        _proto63.onZoomCancelLoadingOfTiles = function onZoomCancelLoadingOfTiles(e) {
          _Zoominstance.prototype.onZoomGetImage.call(this, e);

          e.data.round = false;
          this.imagesMap.cancelLoadingImage(e.data);
        };

        _proto63.onZoomBeforeShow = function onZoomBeforeShow(e) {
          this.canvas.addClass(this.zoomClassName);

          if (this.hotspots) {
            this.hotspots.hideAll();
          }
        };

        _proto63.onZoomShown = function onZoomShown(e) {
          if (this.isSlideShown) {
            this.startTimeForZommEvent = $J.now();

            if (this.openedImg) {
              this.sendStats('zoomIn', $J.now() - this.sessionStartTime, {
                frame: {
                  row: this.openedImg.row,
                  column: this.openedImg.col
                },
                clientX: e.data.clientPosition.x,
                clientY: e.data.clientPosition.y,
                pageX: e.data.pagePosition.x,
                pageY: e.data.pagePosition.y
              });
            }

            this.sendEvent('zoomIn');
          } else {
            this.zoom.hide(true);
          }
        };

        _proto63.onZoomHidden = function onZoomHidden(e) {
          if (this.openedImg) {
            this.canvas.removeClass(this.zoomClassName);
            var now = $J.now();
            this.sendStats('zoomOut', now - this.sessionStartTime, {
              duration: now - this.startTimeForZommEvent,
              frame: {
                row: this.openedImg.row,
                column: this.openedImg.col
              },
              clientX: e.data.clientPosition.x,
              clientY: e.data.clientPosition.y,
              pageX: e.data.pagePosition.x,
              pageY: e.data.pagePosition.y
            });

            if (this.hotspots) {
              this.hotspots.showAll();

              if (this.isInView && this.isSlideShown) {
                this.hotspots.showNeededElements();
              }
            }
          }

          this.sendEvent('zoomOut');

          if (this.isSlideShown) {
            this.animateWithDelay();
          }

          this.startTimeForZommEvent = null;
          this.openedImg = null;

          if (this.pinchCloud) {
            this.pinchCloud.addEvent();
          }
        };

        _proto63.setLongTapEvents = function setLongTapEvents() {
          var _this170 = this;

          var pe = $J.W.node.navigator.pointerEnabled;
          var move = false;
          var touchDown = false;
          this.coreNode.addEvent('touchstart ' + (pe ? 'pointerdown' : 'MSPointerDown'), function (e) {
            if (!_this170.isDragMove && !_this170.pinchCloud.pinch && _this170.isFullscreenActionEnded()) {
              clearTimeout(_this170.longTapTimer);
              _this170.longTapTimer = setTimeout(function () {
                e.stop();
                move = true;
                _this170.customActionWas = true;
                var p = e.getPageXY();

                if (_this170.touchDragCloud) {
                  _this170.touchDragCloud.removeEvent();
                }

                _this170.firstUserInteraction = true;

                _this170.openLens(p.x, p.y, true);
              }, 500);
              touchDown = true;
            }
          });
          this.coreNode.addEvent('touchmove ' + (pe ? 'pointermove' : 'MSPointerMove'), function (e) {
            if (move && _this170.isFullscreenActionEnded()) {
              e.stop();
              var p = e.getPageXY();

              _this170.zoom.customMove(p.x, p.y);
            }
          }, 1);
          this.coreNode.addEvent('touchend ' + (pe ? 'pointerup' : 'MSPointerUp'), function (e) {
            if (touchDown) {
              e.stop();
              touchDown = false;
              clearTimeout(_this170.longTapTimer);
            }

            if (move && _this170.isFullscreenActionEnded()) {
              e.stop();
              move = false; // clearTimeout(this.longTapTimer);

              _this170.zoom.hide(true);

              if (_this170.touchDragCloud) {
                _this170.touchDragCloud.addEvent();
              }
            }
          });
        };

        _proto63.getZoomSize = function getZoomSize() {
          var r = this.option('zoom.ratio');
          var originWidth = this.infoSize.width;
          var originHeight = this.infoSize.height;
          var size = {
            width: originWidth,
            height: originHeight
          };

          if (r !== 'max') {
            size.width = this.currentImageSize.width * r;
            size.height = this.currentImageSize.height * r;
            size = ResponsiveImage.roundImageSize(size);
          }

          size.width = Math.min(originWidth, size.width);
          size.height = Math.min(originHeight, size.height);
          return {
            width: size.width,
            height: size.height,
            originWidth: originWidth,
            originHeight: originHeight
          };
        };

        _proto63.openLens = function openLens(x, y, longTap, toLevel) {
          var result = false;

          if (this.isZoomSizeExist()) {
            var zoomSize = this.getZoomSize();
            result = true;
            this.stopSmoothing();
            this.stopAnimation();

            if (this.hint) {
              this.hint.hide();
            }

            if (this.hotspots) {
              this.hotspots.hideActiveHotspotBox(true);
            }

            var round = false;
            var lensImgWidth;
            var lensImgHeight;

            if (this.isFullscreenActionEnded() && this.imagesMap.isLoaded({
              width: this.currentImageSize.width,
              height: this.currentImageSize.height
            })) {
              lensImgWidth = this.currentImageSize.width;
              lensImgHeight = this.currentImageSize.height;
              round = true;
            } else {
              lensImgWidth = this.lastImg.serverWidth;
              lensImgHeight = this.lastImg.serverHeight;
            }

            var img = this.imagesMap.getCurrentImage({
              width: lensImgWidth,
              height: lensImgHeight,
              round: round
            });
            this.openedImg = img;

            if (x === undefined) {
              result = this.zoom.showCenter(img.node, zoomSize);
            } else {
              result = this.zoom.show(img.node, zoomSize, x, y, longTap, toLevel);
            }
          }

          return result;
        };

        _proto63.done = function done() {
          var rows = this.imagesMap.getCountOfRows();
          var cols = this.imagesMap.getCountOfFrames();

          if (this.loader) {
            this.loader.setMaxOpacity(0.5);
          }

          this.setBrowserEvents();
          this.createHint();
          this.createZoom();
          this.setZoomEvents();

          if (rows > 1 && cols > 1) {
            this.coreNode.setCssProp('touch-action', 'none');
          } else {
            if (rows > 1) {
              this.coreNode.setCssProp('touch-action', 'pan-x');
            } else {
              this.coreNode.setCssProp('touch-action', 'pan-y');
            }
          }

          this.boxBoundaries = this.coreNode.getRect();
          this.animate('start');

          if (this.accountInfo.branded) {
            var nodeWithSirvClassName = globalFunctions.getNodeWithSirvClassName(this.instanceNode) || $J.D.node.head || $J.D.node.body;
            globalFunctions.rootDOM.showSirvAd(nodeWithSirvClassName, this.instanceNode, BRAND_LANDING, '360-degree viewer by Sirv');
          }

          this.sendStats('viewerReady', $J.now() - this.sessionStartTime, {
            rows: this.imagesMap.getCountOfRows(),
            columns: this.imagesMap.getCountOfFrames(),
            viewerSize: {
              width: this.currentSize.width,
              height: this.currentSize.height
            }
          });

          if (this.isZoomSizeExist()) {
            this.coreNode.addClass(globalVariables.CSS_CURSOR_ZOOM_IN);
          }

          this.setGlobalEvents();
          this.turnOnOff();

          _Zoominstance.prototype.done.call(this);

          if (this.hotspots) {
            if (!this.hotspots.getHotspots().length) {
              this.hotspots.setInstanceComponentNode(this.canvasContainer);
            }

            this.hotspots.setContainerSize(this.canvasContainer.node.getBoundingClientRect());
          }
        };

        _proto63.setBrowserEvents = function setBrowserEvents() {
          this.setDrag(this.coreNode);
          this.setMouseWheel(this.coreNode);
        };

        _proto63.setCanvas = function setCanvas() {
          var _this171 = this;

          if (!this.canvasPromise) {
            var _resolve;

            var canvasOpacityHandler;
            var _timer = null;
            this.canvasPromise = helper.makeQueryblePromise(new Promise(function (resolve1, reject) {
              _resolve = resolve1;

              if (_this171.firstImageLoaded) {
                _this171.draw();
              }

              if (!_this171.isInView || !_this171.isSlideShown) {
                _this171.canvas.addClass(P + '-shown');

                resolve1();
              } else {
                _timer = setTimeout(function () {
                  // some times transitionend does not work
                  if (_this171.canvas) {
                    // we can remove slide from slider by API much faster then this animation
                    _this171.canvas.removeEvent('transitionend', canvasOpacityHandler);
                  }

                  resolve1();
                }, 1100);

                canvasOpacityHandler = function (e) {
                  if (e.propertyName === 'opacity') {
                    e.stop();
                    clearTimeout(_timer);

                    _this171.canvas.removeEvent(e.type, canvasOpacityHandler);

                    resolve1();
                  }
                };

                _this171.canvas.addEvent('transitionend', canvasOpacityHandler);

                _this171.canvas.getSize();

                _this171.canvas.addClass(P + '-shown');
              }
            }));

            this.canvasPromise.resolve = function () {
              _this171.canvas.removeEvent('transitionend', canvasOpacityHandler);

              _resolve();
            };
          }

          return this.canvasPromise;
        };

        _proto63.clearCanvas = function clearCanvas() {
          if (this.ctx) {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          }
        };

        _proto63.draw = function draw(neededSize) {
          if (this.ctx) {
            var size = neededSize || this.currentImageSize;
            var imageData = {
              width: size.width,
              height: size.height,
              maxSize: true,
              dppx: this.dppx
            };
            var img = this.imagesMap.getCurrentImage(imageData);
            this.lastImg = img;

            if (!img) {
              return;
            }

            this.ctx.imageSmoothingQuality = 'high';

            if (this.hotspots) {
              this.hotspots.changeHotspotsPosition(img.row, img.col);
            }

            this.clearCanvas();
            this.canvas.node.width = img.node.node.width;
            this.canvas.node.height = img.node.node.height;
            this.ctx.drawImage(img.node.node, 0, 0, this.canvas.node.width, this.canvas.node.height);
          }
        }
        /*
        draw(neededSize) {
            const size = neededSize || this.currentImageSize;
             const imageData = {
                width: size.width,
                height: size.height,
                maxSize: true,
                dppx: this.dppx
            };
             const img = this.imagesMap.getCurrentImage(imageData);
            const ac = this.additionalCanvases;
            let steps = 0;
            let posX;
            let posY;
            let i;
             if (!img || !size.width || !size.height) { return; }
             this.lastImg = img;
             // s.width = Math.min(s.width * 2, img.width * $J.DPPX);
            // s.height = Math.min(s.height * 2, img.height * $J.DPPX);
             const s = {
                width: img.width * this.dppx,
                height: img.height * this.dppx
            };
             // steps = Math.ceil(Math.log(Math.max(img.width / s.width, img.height / s.height)) / Math.LN2);
            steps = Math.ceil(Math.log(Math.max(s.width / img.width, s.height / img.height)) / Math.LN2);
             ac[0].node.node.width = s.width;
            ac[0].node.node.height = s.height;
            ac[1].node.node.width = s.width;
            ac[1].node.node.height = s.height;
             ac[0].ctx.drawImage(img.node.node, 0, 0, s.width, s.height);
             for (i = steps - 1; i > 0; i--) {
                // Scale down in tmp canvas
                ac[1].node.node.width *= 0.5;
                ac[1].node.node.height *= 0.5;
                ac[1].ctx.drawImage(ac[0].node.node, 0, 0, ac[0].node.node.width, ac[0].node.node.height,
                                            0, 0, ac[1].node.node.width, ac[1].node.node.height);
                 // Copy back
                ac[0].node.node.width *= 0.5;
                ac[0].node.node.height *= 0.5;
                ac[0].ctx.drawImage(ac[1].node.node, 0, 0, ac[1].node.node.width, ac[1].node.node.height,
                                            0, 0, ac[0].node.node.width, ac[0].node.node.height);
            }
             // this.ctx.setTransform(1, 0, 0, 1, 0, 0);
             this.canvas.node.width = s.width;
            this.canvas.node.height = s.height;
             // this.canvas.setCss({
            //     width: (s.width / 2) + 'px',
            //     height: (s.height / 2) + 'px'
            // });
             if (this.hotspots) {
                this.hotspots.changeHotspotsPosition(img.row, img.col);
            }
             this.clearCanvas();
             if (this.ctx) {
                posX = calcScalePosition(this.scale, s.width);
                posY = calcScalePosition(this.scale, s.height);
                 this.ctx.drawImage(ac[0].node.node, 0, 0, ac[0].node.node.width, ac[0].node.node.height, posX, posY, s.width * this.scale, s.height * this.scale);
            }
        }
        */
        ;

        _proto63.setCanvasSize = function setCanvasSize() {
          var s = this.currentSize;
          this.canvas.setCss({
            width: s.width,
            height: s.height
          });
          this.canvasContainer.setCss({
            width: s.width,
            height: s.height
          });
          this.canvas.width = s.width;
          this.canvas.height = s.height;
        };

        _proto63.calcMinSizeForDrag = function calcMinSizeForDrag() {
          var s = this.currentSize;
          this.minSizeOfFrame = this.imagesMap.pixelPerFrame(s.width);
          this.minSizeOfRow = this.imagesMap.pixelPerRow(s.height);
        };

        _proto63.smoothing = function smoothing(distance, time, direction) {
          var _this172 = this;

          // direction - next, prev, down, up
          if (!time) {
            return;
          }

          var speed = distance / time;

          var move = function () {
            speed *= 0.97;
            _this172.smooseTimeout = setTimeout(function () {
              _this172.imagesMap.prepareFutureImage(direction);

              _this172.imagesMap.setPreparedFutureImage();

              _this172.draw();

              if (speed > 0.3) {
                move();
              }
            }, _this172.minSizeOfFrame / speed);
          };

          if (!this.isSmoothing) {
            this.isSmoothing = true;
            move();
          }
        };

        _proto63.stopSmoothing = function stopSmoothing() {
          if (this.isSmoothing) {
            this.isSmoothing = false;
            clearTimeout(this.smooseTimeout);
            this.smooseTimeout = null;
            this.imagesMap.resetPreparedImage();
          }
        };

        _proto63.animateWithDelay = function animateWithDelay(action) {
          var _this173 = this;

          var animateAction = 'inactive';

          if (action) {
            animateAction = action;
          }

          if (this.option('autospin.enable')) {
            clearTimeout(this.autospinResumeTimer);
            this.autospinResumeTimer = setTimeout(function () {
              _this173.animate(animateAction);
            }, this.option('autospin.resume'));
          } else {
            this.animate(animateAction);
          }
        };

        _proto63.setDrag = function setDrag(node) {
          var _this174 = this;

          var rows = this.imagesMap.getCountOfRows();
          var cols = this.imagesMap.getCountOfFrames();
          var multi = rows > 1 && cols > 1;
          var sphereValues = {
            x: {
              minSize: this.minSizeOfFrame,
              count: cols
            },
            y: {
              minSize: this.minSizeOfRow,
              count: rows
            }
          };
          var onAnyDrag = this.option('freeDrag');
          var lastPoint = {
            x: 0,
            y: 0
          };
          var lastPartOfDistance = {
            x: 0,
            y: 0
          };
          var canMoveAxis = null;

          if (!multi) {
            canMoveAxis = cols > 1 ? 'x' : 'y';
          }

          var lastTime = null;
          var axis;
          var fns = {};
          var otherAxis;
          var queue = {
            x: {
              next: 0,
              prev: 0
            },
            y: {
              up: 0,
              down: 0
            }
          };
          var startTime;
          var rotate = false;
          var rotateDebounce = helper.debounce(function () {
            rotate = false;
          }, 50);
          var G = 9.8;
          var COEFFICIENT_OF_FRICTION = 0.00065;
          var FRICTION_FORCE = {
            x: COEFFICIENT_OF_FRICTION * cols * G,
            y: COEFFICIENT_OF_FRICTION * rows * G
          };
          var DIRECTIONS = {
            x: ['prev', 'next'],
            y: ['down', 'up']
          };

          if (!multi && onAnyDrag) {
            if (cols > 1) {
              DIRECTIONS.y = DIRECTIONS.x;
            } else {
              DIRECTIONS.x = DIRECTIONS.y;
            }
          }

          var onDrag = function (e) {
            clearTimeout(_this174.longTapTimer);
            fns[e.state](e);
          };

          var addPoint = function (_axis, _speed, _distance, _direction) {
            queue[_axis][_direction] += _distance;
          };

          var getPoints = function (_axis) {
            var a = queue[_axis];
            var result;
            var dir = _axis === 'x' ? ['next', 'prev'] : ['up', 'down'];

            if (a[dir[0]] > a[dir[1]]) {
              result = {
                distance: a[dir[0]],
                direction: dir[0]
              };
            } else {
              result = {
                distance: a[dir[1]],
                direction: dir[1]
              };
            }

            return result;
          };

          var getCountOfItems = function (frictionForce, weight, distance, time, sizeOfItem) {
            var result; // eslint-disable-next-line no-restricted-properties

            result = weight * Math.pow(distance / time, 2) / (2 * frictionForce);
            result = Math.floor(result / sizeOfItem);
            return result;
          };

          var getTime = function (frictionForce, weight, distance, time) {
            return weight * (distance / time) / frictionForce;
          };

          var getDirection = function (value, _axis) {
            return DIRECTIONS[_axis][value >= 0 ? 0 : 1];
          };

          fns.dragstart = function (e) {
            _this174.firstUserInteraction = true;
            _this174.isDragMove = true;

            _this174.stopSmoothing();

            _this174.stopAnimation();

            if (_this174.hint) {
              _this174.hint.hide();
            }

            if (_this174.hotspots) {
              _this174.hotspots.hideNeededElements(true);
            }

            _this174.userColumn = _this174.imagesMap.getStartColumn();
            _this174.userRow = _this174.imagesMap.getStartRow();

            if (_this174.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
              e.stop();
            }

            lastPoint.x = e.x;
            lastPoint.y = e.y;
            lastTime = e.timeStamp;
            startTime = $J.now();

            var t = $J.now() - _this174.sessionStartTime;

            _this174.sendStats('dragStart', t, {
              clientX: e.x - _this174.boxBoundaries.left,
              clientY: e.y - _this174.boxBoundaries.top,
              pageX: e.x,
              pageY: e.y
            });

            _this174.sendEvent('spinStart');

            _this174.sendEvent('rotate');

            _this174.sendStats('rotate', t, {});

            _this174.pinchCloud.removeEvent();
          };

          fns.dragend = function (e) {
            var time;
            var values;
            var countOfItems;
            var timeOfAnimation;
            var timeOfAnimation2;
            var animationValues = [];

            if (_this174.isDragMove) {
              e.stop();
              _this174.isDragMove = false;
              rotateDebounce.cancel();

              if (rotate && canMoveAxis === axis || rotate && (multi || onAnyDrag)) {
                time = +new Date() - startTime;
                values = getPoints(axis);
                countOfItems = getCountOfItems(FRICTION_FORCE[axis], cols, values.distance, time, sphereValues[axis].minSize);
                timeOfAnimation = getTime(FRICTION_FORCE[axis], cols, values.distance, time);
                animationValues.push({
                  items: countOfItems,
                  direction: values.direction
                });

                if (multi) {
                  values = getPoints(otherAxis);
                  countOfItems = getCountOfItems(FRICTION_FORCE[otherAxis], cols, values.distance, time, sphereValues[otherAxis].minSize);
                  timeOfAnimation2 = getTime(FRICTION_FORCE[otherAxis], cols, values.distance, time);

                  if (timeOfAnimation2 > timeOfAnimation) {
                    timeOfAnimation = timeOfAnimation2;
                  }

                  animationValues.push({
                    items: countOfItems,
                    direction: values.direction
                  });
                }

                _this174.animateTo(timeOfAnimation, animationValues);

                _this174.pinchCloud.addEvent();
              } else {
                if (_this174.hotspots && _this174.isInView && _this174.isSlideShown) {
                  _this174.hotspots.showNeededElements();
                }

                _this174.animateWithDelay();
              }

              _this174.sendEvent('spinEnd');

              var now = $J.now();

              _this174.sendStats('dragEnd', now - _this174.sessionStartTime, {
                duration: now - startTime,
                clientX: e.x - _this174.boxBoundaries.left,
                clientY: e.y - _this174.boxBoundaries.top,
                pageX: e.x,
                pageY: e.y
              });

              lastPoint = {
                x: 0,
                y: 0
              };
              lastTime = null;
              lastPartOfDistance = {
                x: 0,
                y: 0
              };
              queue = {
                x: {
                  next: 0,
                  prev: 0
                },
                y: {
                  up: 0,
                  down: 0
                }
              };
              rotate = false;
            }
          };

          var setFrame = function (currentAxis, direction) {
            var result = false;

            if (lastPartOfDistance[currentAxis] > sphereValues[currentAxis].minSize) {
              result = true;
              var count = Math.floor(lastPartOfDistance[currentAxis] / sphereValues[currentAxis].minSize);
              lastPartOfDistance[currentAxis] = lastPartOfDistance[currentAxis] % sphereValues[currentAxis].minSize;

              _this174.imagesMap.prepareFutureImage(direction, count);

              _this174.imagesMap.setPreparedFutureImage();
            }

            return result;
          };

          fns.dragmove = function (e) {
            var directions = {};
            var currentDistance = {
              x: 0,
              y: 0
            };
            var absCurrentDistance = {
              x: 0,
              y: 0
            };
            var currentSpeed;

            if (_this174.isDragMove) {
              rotate = true;
              _this174.customActionWas = true;
              currentDistance.x = e.x - lastPoint.x; // +prev, -next

              currentDistance.y = e.y - lastPoint.y; // +down, -up

              absCurrentDistance.x = Math.abs(currentDistance.x);
              absCurrentDistance.y = Math.abs(currentDistance.y);
              currentSpeed = e.timeStamp - lastTime;
              lastTime = e.timeStamp;
              axis = absCurrentDistance.x >= absCurrentDistance.y ? 'x' : 'y';
              otherAxis = axis === 'x' ? 'y' : 'x';

              if (_this174.fullscreenState === globalVariables.FULLSCREEN.OPENED || multi || onAnyDrag || axis === 'x' && cols > 1 || axis === 'y' && rows > 1) {
                e.stop();
              }

              directions[axis] = getDirection(currentDistance[axis], axis);
              directions[otherAxis] = getDirection(currentDistance[otherAxis], otherAxis);
              addPoint(axis, currentSpeed, absCurrentDistance[axis], directions[axis]);
              addPoint(otherAxis, currentSpeed, absCurrentDistance[otherAxis], directions[otherAxis]);

              if (multi || onAnyDrag) {
                lastPartOfDistance.x += absCurrentDistance.x;
                lastPartOfDistance.y += absCurrentDistance.y;
              } else if (canMoveAxis) {
                if (canMoveAxis === axis && canMoveAxis === 'x') {
                  lastPartOfDistance.x += absCurrentDistance.x;
                } else if (canMoveAxis === axis && canMoveAxis === 'y') {
                  lastPartOfDistance.y += absCurrentDistance.y;
                }
              }

              if (setFrame(axis, directions[axis]) && onAnyDrag) {
                lastPartOfDistance[otherAxis] = 0;
              }

              if (multi) {
                setFrame(otherAxis, directions[otherAxis]);
              }

              _this174.userColumn = _this174.imagesMap.getCurrentColumn();
              _this174.userRow = _this174.imagesMap.getCurrentRow();
              lastPoint.x = e.x;
              lastPoint.y = e.y;

              _this174.draw();

              rotateDebounce();
            }
          };

          var cloud = {
            eventAdded: false
          };

          cloud.addEvent = function () {
            if (!cloud.eventAdded) {
              cloud.eventAdded = true;
              node.addEvent('mousedrag touchdrag', onDrag);
            }
          };

          cloud.removeEvent = function () {
            if (cloud.eventAdded) {
              cloud.eventAdded = false;
              node.removeEvent('mousedrag touchdrag', onDrag);
            }
          };

          this.touchDragCloud = cloud;

          if (!this.slideDragEventStart) {
            this.touchDragCloud.addEvent();
          }
        };

        _proto63.animateTo = function animateTo(time, values) {
          var _this175 = this;

          var last = [];
          var dirs = [];
          var startObj = {};
          clearTimeout(this.autospinResumeTimer);

          if (this.animationFX) {
            this.animationFX.stop();
          }

          for (var i = 0, l = values.length; i < l; i++) {
            dirs.push(values[i].direction);
            last.push(0);
            startObj[values[i].direction] = [0, values[i].items];
          }

          this.animationFX = new $J.FX($J.$new('div'), {
            duration: Math.abs(time),
            transition: $J.FX.getTransition().inCubic,
            onBeforeRender: $(function (ds, value) {
              var _i;

              var frame;

              for (_i = 0; _i < ds.length; _i++) {
                frame = Math.round(value[ds[_i]]);

                if (last[_i] !== frame) {
                  _this175.imagesMap.prepareFutureImage(ds[_i], frame - last[_i]);

                  _this175.imagesMap.setPreparedFutureImage();

                  _this175.userColumn = _this175.imagesMap.getCurrentColumn();
                  _this175.userRow = _this175.imagesMap.getCurrentRow();
                  last[_i] = frame;
                }
              }

              _this175.draw();
            }).bind(this, dirs),
            onComplete: function () {
              _this175.stopAnimation();

              _this175.animateWithDelay();

              if (_this175.hotspots && _this175.isInView && _this175.isSlideShown) {
                _this175.hotspots.showNeededElements();
              }
            }
          }).start(startObj);
        };

        _proto63.setMouseWheel = function setMouseWheel(node) {
          var _this176 = this;

          var delta;
          var direction;
          var correction = 8 / 54;
          var count = 0;
          var spinOnWheel = false; // let stack = [];

          var wheelStep = 3;
          var wheelDebounce = helper.debounce(function (isMouse) {
            spinOnWheel = false; // stack = [];

            _this176.sendEvent('spinEnd');

            if (isMouse) {
              count = 0;
            } else {
              _this176.animateWithDelay();
            }
          }, 200);
          var rows = this.imagesMap.getCountOfRows();
          var cols = this.imagesMap.getCountOfFrames();
          var multi = rows > 1 && cols > 1;
          var onAnyDrag = this.option('freeDrag');

          if (this.option('wheel')) {
            var _shiftButtonIsPressed = false;

            this.keyPressHandlerForShiftButton = function (e) {
              if (e.oe.keyCode === 16) {
                // shift
                _shiftButtonIsPressed = e.type === 'keydown';
              }
            };

            $J.W.addEvent('keydown keyup', this.keyPressHandlerForShiftButton);
            node.addEvent('mousescroll', function (e) {
              _this176.firstUserInteraction = true;
              var shiftButtonIsPressed = e.isMouse ? _shiftButtonIsPressed : false;
              var isX = Math.abs(e.deltaY) < Math.abs(e.deltaX); // TODO chrome on windows 10 has just Y axis
              // if (!isX && rows === 1) { return; }

              if (!isX && !multi && !onAnyDrag) {
                return;
              }

              _this176.customActionWas = true;
              e.stop();

              if (_this176.animationFX) {
                _this176.animationFX.stop();

                _this176.animationFX = null;
              }

              _this176.stopSmoothing();

              _this176.stopAnimation();

              if (_this176.hotspots) {
                _this176.hotspots.hideActiveHotspotBox();
              }

              if (!spinOnWheel) {
                spinOnWheel = true;

                _this176.sendEvent('spinStart');

                _this176.sendEvent('rotate');

                _this176.sendStats('rotate', $J.now() - _this176.sessionStartTime, {});
              }

              if (isX) {
                delta = e.deltaX;
                direction = delta >= 0 ? 'next' : 'prev';
              } else {
                delta = e.deltaY;

                if (rows > 1 && !shiftButtonIsPressed) {
                  direction = delta >= 0 ? 'down' : 'up';
                } else {
                  direction = delta >= 0 ? 'next' : 'prev';
                }
              }

              if (e.isMouse) {
                delta = delta / Math.abs(delta) * wheelStep;
                count += Math.abs(delta);

                _this176.animateTo(200, [{
                  direction: direction,
                  items: count
                }]);
              } else {
                delta = delta * correction;
                count += delta;

                if (Math.abs(count) > 1) {
                  delta = parseInt(count, 10);
                  count -= delta;

                  _this176.imagesMap.prepareFutureImage(direction, Math.abs(delta));

                  _this176.imagesMap.setPreparedFutureImage();

                  _this176.draw();
                }
              }

              wheelDebounce(e.isMouse);
            });
          }
        };

        _proto63.animate = function animate(action, autoplayDuration, autoplayType, fromAPI) {
          var _this177 = this;

          var isAutospin = action === 'autoplay' || this.option('autospin.enable');

          if (!this.isInView || !this.isSlideShown || this.animationCloud.isMoving() || this.isDragMove || this.customActionWas && !isAutospin && !fromAPI) {
            return;
          }

          if (this.animationCloud.isPaused()) {
            this.animationCloud.resume();
            return;
          }

          clearTimeout(this.animationCloud.hintTimer);
          clearTimeout(this.autospinResumeTimer);
          var delay = false;
          var effect = null;

          if (isAutospin) {
            if (this.isAutoplayPaused) {
              return;
            }

            effect = 'as-' + (autoplayType || this.option('autospin.type'));

            if (action !== 'start') {
              delay = true;
            }
          } else {
            var nameOfEvent;

            switch (action) {
              case 'start':
                nameOfEvent = 'onStart';
                break;

              case 'inView':
              case 'slideIn':
                nameOfEvent = 'onVisible';
                break;

              case 'inactive':
                delay = true;
                nameOfEvent = 'onInactive';
                break;

              default:
                effect = action;
            }

            if (nameOfEvent && this.option('hint.' + nameOfEvent + '.enable')) {
              var tmp = this.option('hint.' + nameOfEvent + '.effect');

              if (tmp) {
                effect = tmp;
              }
            } // showTextHint = false;

          }

          this.animationCloud.start({
            speed: autoplayDuration || this.option('autospin.duration'),
            type: effect,
            infinite: isAutospin,
            delay: delay,
            isBackward: this.reflectDirection,
            userInteraction: fromAPI
          }, function () {
            var r = _this177.showHint();

            if (_this177.hotspots && _this177.isInView && _this177.isSlideShown) {
              _this177.hotspots.showNeededElements();
            }

            if (_this177.option('hint.onInactive.enable')) {
              if (r) {
                _this177.animationCloud.hintTimer = setTimeout(function () {
                  _this177.animationCloud.hintTimer = null;

                  _this177.animate('inactive');
                }, _this177.hint.getMovingTime());
              } else {
                _this177.animate('inactive');
              }
            }
          });
        };

        _proto63.initAnimation = function initAnimation() {
          var _this178 = this;

          var isMoving = false;
          var isPaused = false;
          var isStopped = false;
          var timer = null;
          var delayTimer = null;
          var step;
          var currentIndex = 0;
          var callback = null;
          var framesLength = this.imagesMap.getCountOfFrames();
          var options;

          if (this.option('swapSides')) {
            framesLength = this.imagesMap.getCountOfRows();
          }

          var clear = function () {
            isMoving = false;
            currentIndex = 0;
          };

          var end = function () {
            clear();

            if (callback) {
              callback();
            }
          };

          var move = function () {
            var count = _this178.imagesMap.getNextBufferIndex(currentIndex);

            if (count || options.infinite) {
              if (!count && options.infinite) {
                count = 1;

                if (options.infinite) {
                  currentIndex = -1;
                } else {
                  currentIndex = 0;
                }
              }

              currentIndex = currentIndex + count;

              _this178.imagesMap.setNextAnimationFrame(currentIndex);

              timer = setTimeout(function () {
                _this178.imagesMap.setPreparedNextImage();

                _this178.draw();

                move();
              }, count * step);
            } else {
              end();
            }
          };

          var getSpeed = function (currentSpeed, typeOfAnimation) {
            var r = currentSpeed;

            if (!r) {
              switch (typeOfAnimation) {
                case 'intro':
                  r = 3600;
                  break;

                case 'twitch':
                  r = 2200;
                  break;

                case 'spin':
                  r = 3600;
                  break;

                case 'momentum':
                  r = 10;
                  break;

                default:
                  r = 3600;
              }
            }

            return r;
          };

          var animationCloud = {
            hintTimer: null,
            isMoving: function () {
              return isMoving;
            },
            isPaused: function () {
              return isPaused;
            },
            start: function (_options, cb) {
              if (isMoving) {
                return;
              }

              isMoving = true;
              isStopped = false;

              var _move = function () {
                delayTimer = null;

                if (options.type) {
                  if (!_this178.imagesMap) {
                    return;
                  }

                  _this178.imagesMap.createAnimation(options.type, options.isBackward);

                  if (options.userInteraction && _this178.imagesMap.getImagesBuffer() && _this178.imagesMap.getImagesBuffer().length) {
                    var last = _this178.imagesMap.getImagesBuffer()[_this178.imagesMap.getImagesBuffer().length - 1];

                    _this178.userColumn = last.col;
                    _this178.userRow = last.row;
                  }

                  step = options.speed / framesLength;

                  if (options.infinite) {
                    _this178.showHint();
                  }

                  move();
                } else {
                  end();
                }
              };

              callback = cb;
              options = $J.extend({
                speed: 3600,
                type: 'row',
                delay: false,
                infinite: false,
                isBackward: false,
                userInteraction: false
              }, _options);
              options.speed = getSpeed(options.speed, options.type);

              if (options.delay && !options.infinite) {
                delayTimer = setTimeout(_move, _this178.option('inactivity'));
              } else {
                _move();
              }
            },
            resume: function () {
              if (isPaused) {
                isMoving = true;
                isPaused = false;
                move();
              }
            },
            pause: function () {
              if (!isPaused && !isStopped) {
                isMoving = false;
                isPaused = true;
                clearTimeout(animationCloud.hintTimer);
                clearTimeout(delayTimer);
                clearTimeout(timer);
              }
            },
            stop: function () {
              animationCloud.pause();
              isStopped = true;
              isPaused = false;
              currentIndex = 0;
              callback = null;

              _this178.imagesMap.clearFramesQueue();

              _this178.imagesMap.resetPreparedImage();
            }
          };
          this.animationCloud = animationCloud;
        };

        _proto63.stopAnimation = function stopAnimation() {
          if (this.animationFX) {
            this.animationFX.stop();
            this.animationFX = null;
          }

          clearTimeout(this.autospinResumeTimer);

          if (this.animationCloud) {
            this.animationCloud.stop();
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto63.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {
          this.stopSmoothing();
          this.stopAnimation();

          if (this.zoom) {
            this.zoom.hide(true);
          }

          this.deactivateSpin();
          this.boxBoundaries = this.coreNode.getRect();

          _Zoominstance.prototype.onBeforeFullscreenIn.call(this, data);

          if (this.hotspots) {
            this.hotspots.hideAll();
          }

          if (this.isInited && this.isInView && this.isSlideShown) {
            this.isHidden = true;
            this.canvas.setCss({
              opacity: 0,
              visibility: 'hidden'
            });
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto63.onAfterFullscreenIn = function onAfterFullscreenIn(data) {
          var _this179 = this;

          if (!this.infoSize) {
            return;
          } // const insideIFrame = $J.W.node.parent !== $J.W.node.window;
          // const pseudo = data.pseudo;
          // if we use it, we do not have pinchend event and touchdrag after that
          // if (this.pinchCloud) {
          //     this.pinchCloud.removeEvent();
          //     this.pinchCloud.addEvent();
          // }


          if (this.canvasPromise && this.canvasPromise.isPending()) {
            this.canvasPromise.resolve();
          }

          var screenSize = this.coreNode.getSize();
          this.currentSize = helper.spinLib.calcProportionSize(screenSize, this.infoSize, true, this.standardSize);
          this.getDPPX(this.currentSize);
          this.setImageSize();
          this.setCanvasSize();

          if (this._isReady) {
            if (!this.imagesMap.isImagesExist({
              width: this.currentImageSize.width,
              height: this.currentImageSize.height
            })) {
              this.imagesMap.loadImages({
                width: this.currentImageSize.width,
                height: this.currentImageSize.height,
                dppx: this.dppx
              });
            }
          }

          if (this.firstImageLoaded) {
            this.draw();
          }

          if (this.isHidden) {
            this.isHidden = false;
            setTimeout(function () {
              _this179.canvas.setCss({
                opacity: '',
                visibility: ''
              });
            }, 0);
          }

          if (this.hotspots) {
            if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
              this.hotspots.showAll();

              if (this.isInView && this.isSlideShown) {
                this.hotspots.showNeededElements();
              }
            }
          }

          if (this._isReady) {
            this.animate('inactive');

            if (!$J.browser.mobile) {
              this.showHint();
            }

            this.fullscreenStartTime = +new Date();
            this.sendStats('fullscreenOpen', $J.now() - this.sessionStartTime);
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto63.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {
          this.stopSmoothing();
          this.stopAnimation();

          if (this.zoom) {
            this.zoom.hide(true);
          }

          this.deactivateSpin();

          if (this.hint && this.always) {
            this.hint.hide();
          }

          _Zoominstance.prototype.onBeforeFullscreenOut.call(this, data);

          if (this.isInited && this.isInView && this.isSlideShown) {
            this.isHidden = true;
            this.canvas.setCss({
              opacity: 0,
              visibility: 'hidden'
            });
          }
        } // eslint-disable-next-line no-unused-vars
        ;

        _proto63.onAfterFullscreenOut = function onAfterFullscreenOut(data) {
          var _this180 = this;

          if (!this.infoSize) {
            return;
          } // const pseudo = data.pseudo;
          // if we use it, we do not have pinchend event and touchdrag after that
          // if (this.pinchCloud) {
          //     this.pinchCloud.removeEvent();
          //     this.pinchCloud.addEvent();
          // }


          if (this.canvasPromise && this.canvasPromise.isPending()) {
            this.canvasPromise.resolve();
          }

          this.currentSize = helper.spinLib.calcProportionSize(this.coreNode.getSize(), this.infoSize);
          this.getDPPX(this.currentSize);
          this.standardSize.width = this.currentSize.width;
          this.standardSize.height = this.currentSize.height;
          this.currentImageSize.width = this.currentSize.width;
          this.currentImageSize.height = this.currentSize.height;
          this.setCanvasSize();

          if (this._isReady) {
            if (!this.imagesMap.isImagesExist({
              width: this.currentSize.width,
              height: this.currentSize.height
            })) {
              this.imagesMap.loadImages({
                width: this.currentSize.width,
                height: this.currentSize.height,
                dppx: this.dppx
              });
            }
          }

          if (this.firstImageLoaded) {
            this.draw();
          }

          if (this.isHidden) {
            this.isHidden = false;
            setTimeout(function () {
              if (!_this180.destroyed) {
                _this180.canvas.setCss({
                  opacity: '',
                  visibility: ''
                });
              }
            }, 0);
          }

          _Zoominstance.prototype.onAfterFullscreenOut.call(this, data);

          if (this._isReady) {
            this.animate('inactive');

            if (!$J.browser.mobile) {
              this.showHint();
            }

            var now = $J.now();
            this.sendStats('fullscreenClose', now - this.sessionStartTime, {
              duration: now - this.fullscreenStartTime
            });
          }
        };

        _proto63.play = function play(duration, effect) {
          var result = false;

          if (this._isReady && !this.isZoomed()) {
            this.isAutoplayPaused = false;
            this.stopSmoothing();
            this.stopAnimation();

            if (!this.instanceOptions.checkValue('autospin.duration', duration)) {
              duration = null;
            }

            if (!this.instanceOptions.checkValue('autospin.type', effect)) {
              effect = null;
            }

            this.animate('autoplay', duration, effect);
            result = true;
          }

          return result;
        };

        _proto63.pause = function pause() {
          var result = false;

          if (this._isReady && !this.isZoomed()) {
            this.isAutoplayPaused = true;
            this.stopSmoothing();
            this.stopAnimation();
            this.animateWithDelay();
            result = true;
          }

          return result;
        };

        _proto63.rotate = function rotate(countOfCols, countOfRows) {
          var result = false;

          var normalizeValue = function (value) {
            if (!value) {
              value = 0;
            } else if ($J.typeOf(value) === 'string') {
              value = parseInt(value, 10);

              if (isNaN(value)) {
                value = 0;
              }
            }

            return value;
          };

          if (this._isReady) {
            countOfCols = normalizeValue(countOfCols);
            countOfRows = normalizeValue(countOfRows);

            if (countOfCols !== 0 || countOfRows !== 0) {
              this.stopAnimation();
              this.stopSmoothing();

              if (!this.isDragMove) {
                this.sendEvent('rotate');
                this.sendStats('rotate', $J.now() - this.sessionStartTime, {});
                this.animate({
                  cols: countOfCols,
                  rows: countOfRows
                }, $J.U, $J.U, true);
                result = true;
              }
            }
          }

          return result;
        };

        _proto63.jumpTo = function jumpTo(value, axis) {
          var result = false;
          var direction = null;

          if (this._isReady) {
            if ($J.typeOf(value) === 'string') {
              value = value.trim();
              direction = /^-/.test(value) ? 'prev' : 'next';
            }

            value = parseInt(value, 10);

            if (!isNaN(value)) {
              result = this.imagesMap.jump(axis, value, direction);

              if (result && this.firstImageLoaded) {
                this.sendEvent('rotate');
                this.sendStats('rotate', $J.now() - this.sessionStartTime, {});
                this.draw();
              }
            }
          }

          return result;
        };

        _proto63.zoomIn = function zoomIn() {
          if (this._isReady && this.zoom) {
            if (!this.isDragMove && this.isFullscreenActionEnded()) {
              return this.openLens();
            }
          }

          return false;
        };

        _proto63.zoomOut = function zoomOut() {
          if (this._isReady && this.zoom) {
            return this.zoom.hide();
          }

          return false;
        };

        _proto63.getCurrentFrame = function getCurrentFrame() {
          if (this._isReady) {
            var img = this.imagesMap.getCurrentImage({
              width: this.currentSize.width,
              height: this.currentSize.height
            });
            return {
              row: img.row + 1,
              column: img.col + 1
            };
          }

          return false;
        };

        _proto63.getOriginImageUrl = function getOriginImageUrl() {
          if (this._isReady) {
            return this.imagesMap.getOriginImageUrl();
          }

          return null;
        };

        _proto63.setCallback = function setCallback(name, fn) {
          if (this._isReady) {
            this.option(name, fn);
            return true;
          }

          return false;
        };

        _proto63.setImageSize = function setImageSize() {
          this.currentImageSize.width = this.currentSize.width;
          this.currentImageSize.height = this.currentSize.height;
        };

        _proto63.isZoomSizeExist = function isZoomSizeExist() {
          var result = false; // const minZoom = 1.2;

          var minZoomFactor = 100; // like in deep zoom level calculation

          if (this.option('zoom.enable')) {
            var cs = this.currentImageSize;
            var zoomSize = this.getZoomSize();

            if (zoomSize.originWidth - cs.width >= minZoomFactor) {
              result = true;
            }
          }

          return result;
        };

        _proto63.getOrientation = function getOrientation() {
          return this.imagesMap.getHintType();
        };

        _proto63.getType = function getType() {
          return this.type;
        };

        _proto63.onResize = function onResize() {
          if (this.fullscreenState === globalVariables.FULLSCREEN.OPENING || !this.isStarted) {
            return false;
          }

          var isFullscreen = this.fullscreenState === globalVariables.FULLSCREEN.OPENED;
          this.stopSmoothing();

          if (this.option('autospin.enable')) {
            this.animationCloud.pause();
          } else {
            this.stopAnimation();
          }

          this.boxBoundaries = this.coreNode.getRect();
          this.currentSize = helper.spinLib.calcProportionSize($(this.coreNode.node.parentNode).getSize(), this.infoSize, isFullscreen, this.standardSize);
          this.getDPPX(this.currentSize);
          this.standardSize.width = this.currentSize.width;
          this.standardSize.height = this.currentSize.height;
          this.setImageSize();
          this.setCanvasSize();
          this.calcMinSizeForDrag();

          if (this.isZoomSizeExist()) {
            this.coreNode.addClass(globalVariables.CSS_CURSOR_ZOOM_IN);
          } else {
            this.coreNode.removeClass(globalVariables.CSS_CURSOR_ZOOM_IN);
          }

          if (this.zoom) {
            this.zoom.onResize();
          }

          if (!this.imagesMap.isImagesExist({
            width: this.currentSize.width,
            height: this.currentSize.height
          })) {
            this.imagesMap.loadImages({
              width: this.currentSize.width,
              height: this.currentSize.height,
              dppx: this.dppx
            });
          }

          if (this.firstImageLoaded) {
            this.draw();
          }

          if (this._isReady && this.hotspots) {
            this.hotspots.setContainerSize(this.canvasContainer.node.getBoundingClientRect());
            this.hotspots.updateAndShow();
          }

          this.resizeAnimationTimer();
          return true;
        } // @Override, HotspotInstance class
        ;

        _proto63.getContainerForBoundengClientRect = function getContainerForBoundengClientRect() {
          return this.canvasContainer;
        };

        _proto63.destroy = function destroy() {
          this.instanceNode.removeEvent('touchmove', fnStopTouchMove);
          $J.W.removeEvent('resize', this.windowResizeCallback);
          clearTimeout(this.resizeWindowTimer);

          if (this.isInited) {
            this.sendStats('sessionEnd', $J.now() - this.sessionStartTime, {
              message: 'Stopped'
            });
          }

          this.coreNode.removeEvent('btnclick tap');
          this.coreNode.del('instance');
          this.resizeAnimationTimer.cancel();
          this.resizeAnimationTimer = null;

          if (this.touchDragCloud) {
            this.touchDragCloud.removeEvent();
            this.touchDragCloud = null;
          }

          if (this.placeholder) {
            this.placeholder.setCssProp('display', '');
          }

          if (this.keyPressHandlerForShiftButton) {
            $J.W.removeEvent('keydown keyup', this.keyPressHandlerForShiftButton);
            this.keyPressHandlerForShiftButton = null;
          }

          if (this.cssId > -1) {
            $J.removeCSS(this.id + '-css', this.cssId);
            $J.$(this.id + '-css').remove();
          }

          this.cssId = -1;

          if (this.initNameEvent) {
            this.coreNode.removeEvent(this.initNameEvent, this.initFnEvent);
          }

          if (this.activatedCurtain) {
            this.activatedCurtain.destroy();
          }

          this.stopSmoothing();
          this.stopAnimation();

          if (this.hint) {
            this.hint.destroy();
            this.hint = null;
          }

          this.coreNode.removeEvent('mousedrag touchdrag pinch');

          if (this.loader) {
            this.loader.destroy();
            this.loader = null;
          }

          if (this.imagesMap) {
            this.imagesMap.destroy();
            this.imagesMap = null;
            this.off('mapFirstImageLoaded');
            this.off('mapImagesReady');
            this.off('mapImageLoaded');
            this.off('mapAllImagesLoaded');
          } // this.additionalCanvases = [];


          this.clearCanvas();

          if (this.canvas) {
            this.canvas.removeEvent('transform');
            this.canvas.removeClass(this.zoomClassName);
            this.canvas.remove();
          }

          this.canvasContainer.removeEvent('transform');
          this.canvasContainer.removeEvent('mouseover');
          this.canvasContainer.removeEvent('mouseout');
          this.canvasContainer.remove();
          this.canvasContainer = null;
          this.ctx = null;
          this.canvas = null;
          this.loadedImages = [];
          this.off('isSingleSlide');
          this.off('zoomUp');
          this.off('zoomDown');
          this.off('frameChange');
          this.coreNode.remove();
          this.infoSize = null;
          this.startLoadingTime = null;
          this.isInited = false;
          this.openedImg = null;
          this.coreNode = null;
          this.firstUserInteraction = false;

          if (this.animationCloud) {
            clearTimeout(this.animationCloud.hintTimer);
            this.animationCloud = null;
          }

          this.lastImg = null;
          this.hotspotsData = null;

          _Zoominstance.prototype.destroy.call(this);

          return true;
        };

        return Spin;
      }(Zoominstance);

      return Spin;
    });
    Sirv.define('Zoom', ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Promise!', 'EventEmitter', 'Zoominstance', 'Hint', 'ResponsiveImage', 'RoundLoader', 'Hotspots'], function (bHelpers, magicJS, globalVariables, globalFunctions, helper, Promise, EventEmitter, Zoominstance, Hint, ResponsiveImage, RoundLoader, Hotspots) {
      var moduleName = 'Zoom';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-env es6 */

      /* global helper */

      /* eslint-disable no-extra-semi */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var defaults = {
        mode: {
          type: 'string',
          'enum': ['top', 'left', 'right', 'bottom', 'inner', 'magnifier', 'deep'],
          defaults: 'inner'
        },
        margin: {
          type: 'number',
          defaults: 9
        },
        width: {
          oneOf: [{
            type: 'number'
          }, {
            type: 'string',
            'enum': ['auto']
          }],
          defaults: 'auto'
        },
        height: {
          oneOf: [{
            type: 'number'
          }, {
            type: 'string',
            'enum': ['auto']
          }],
          defaults: 'auto'
        },
        pan: {
          type: 'boolean',
          defaults: false
        },
        ratio: {
          oneOf: [{
            type: 'number',
            minimum: 0
          }, {
            type: 'string',
            'enum': ['max']
          }],
          defaults: 2.5
        },
        wheel: {
          type: 'boolean',
          defaults: true
        },
        // Zoom in/out on mouse wheel
        tiles: {
          type: 'boolean',
          defaults: true
        },
        trigger: {
          oneOf: [{
            type: 'string',
            'enum': ['hover', 'click', 'dblclick']
          }, {
            type: 'boolean',
            'enum': [false]
          }],
          defaults: 'click'
        },
        hint: {
          // hint.enable
          enable: {
            type: 'boolean',
            defaults: true
          },
          text: {
            // hint.text.hover
            hover: {
              type: 'string',
              defaults: 'Hover to zoom'
            },
            // hint.text.click
            click: {
              type: 'string',
              defaults: 'Click to zoom'
            },
            // hint.text.dblclick
            dblclick: {
              type: 'string',
              defaults: 'Double click to zoom'
            }
          }
        },
        // Navigation map
        map: {
          // map.enable
          enable: {
            type: 'boolean',
            defaults: false
          },
          // map.size
          size: {
            type: 'number',
            'minimum': 0,
            'maximum': 50,
            defaults: 25
          } // in percentage

        }
      };

      if ($J.browser.touchScreen) {
        defaults = helper.deepExtend(defaults, {
          hint: {
            text: {
              // hint.text.hover
              hover: {
                defaults: 'Tap and hold to zoom'
              }
            }
          }
        });
      }

      var defaultsForMobileZoomOptions = {
        hint: {
          text: {
            // hint.text.hover
            hover: {
              type: 'string',
              defaults: 'Tap and hold to zoom'
            },
            // hint.text.click
            click: {
              type: 'string',
              defaults: 'Tap to zoom'
            },
            // hint.text.dblclick
            dblclick: {
              type: 'string',
              defaults: 'Double tap to zoom'
            }
          }
        }
      };
      var defaultsForOutsideMode = {
        trigger: {
          oneOf: [{
            type: 'string',
            'enum': ['hover', 'click', 'dblclick']
          }, {
            type: 'boolean',
            'enum': [false]
          }],
          defaults: 'hover'
        }
      };
      var defaultsForMobileInnerMode = {
        trigger: {
          oneOf: [{
            type: 'string',
            'enum': ['hover', 'click', 'dblclick']
          }, {
            type: 'boolean',
            'enum': [false]
          }],
          defaults: 'dblclick'
        }
      };
      var defaultsForDeepZoom = {
        ratio: {
          oneOf: [{
            type: 'number',
            minimum: 0
          }, {
            type: 'string',
            'enum': ['max']
          }],
          defaults: 'max'
        }
      };
      /* eslint-env es6 */

      /* global EventEmitter */

      /* global helper */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint dot-notation: ["error", { "allowKeywords": false }]*/
      // eslint-disable-next-line no-unused-vars

      var ButtonClass = /*#__PURE__*/function (_EventEmitter17) {
        "use strict";

        bHelpers.inheritsLoose(ButtonClass, _EventEmitter17);

        function ButtonClass(parent, options, events) {
          var _this181;

          _this181 = _EventEmitter17.call(this) || this;
          _this181.parentNode = $(parent);
          _this181.options = $J.extend({
            'class': null,
            disabledClass: 'disable'
          }, options);
          _this181.events = events || {};
          _this181.isDisabled = false;
          _this181.isDisabledClassAdded = false;
          _this181.instanceNode = $J.$new('button');

          if (_this181.options['class']) {
            _this181.instanceNode.addClass(_this181.options['class']);
          }

          helper.objEach(_this181.events, function (key, value) {
            _this181.instanceNode.addEvent(key, value);
          });
          return _this181;
        }

        var _proto64 = ButtonClass.prototype;

        _proto64.append = function append() {
          this.parentNode.append(this.instanceNode);
        };

        _proto64.changeState = function changeState(disable) {
          if (disable) {
            this.disable(true);

            if (!this.isDisabledClassAdded) {
              this.isDisabledClassAdded = true;
              this.instanceNode.addClass(this.options.disabledClass);
            }
          } else {
            if (this.isDisabledClassAdded) {
              this.isDisabledClassAdded = false;
              this.instanceNode.removeClass(this.options.disabledClass);
            }

            this.disable();
          }
        };

        _proto64.disable = function disable(_disable) {
          if (_disable) {
            if (!this.isDisabled) {
              this.isDisabled = true;
              this.instanceNode.attr('disabled', 'disabled');
            }
          } else if (this.isDisabled) {
            this.isDisabled = false;
            this.instanceNode.removeAttr('disabled');
          }
        };

        _proto64.destroy = function destroy() {
          var _this182 = this;

          helper.objEach(this.events, function (key, value) {
            _this182.instanceNode.removeEvent(key, value);
          });
          this.events = {};
          this.changeState();
          this.instanceNode.remove();
          this.instanceNode = null;

          _EventEmitter17.prototype.destroy.call(this);
        };

        return ButtonClass;
      }(EventEmitter); // eslint-disable-next-line no-unused-vars


      var ZoomControls = /*#__PURE__*/function (_EventEmitter18) {
        "use strict";

        bHelpers.inheritsLoose(ZoomControls, _EventEmitter18);

        function ZoomControls(parent) {
          var _this183;

          _this183 = _EventEmitter18.call(this) || this;
          _this183.parentNode = $(parent);
          _this183.instanceNode = $J.$new('div').addClass('zoom-controls');
          _this183.zoomInButton = new ButtonClass(_this183.instanceNode, {
            'class': 'zoom-in'
          }, {
            'btnclick tap': function (e) {
              e.stop();

              _this183.emit('zoomControlsAction', {
                data: {
                  type: 'zoomin'
                }
              });
            }
          });

          _this183.zoomInButton.setParent(bHelpers.assertThisInitialized(_this183));

          _this183.zoomOutButton = new ButtonClass(_this183.instanceNode, {
            'class': 'zoom-out'
          }, {
            'btnclick tap': function (e) {
              e.stop();

              _this183.emit('zoomControlsAction', {
                data: {
                  type: 'zoomout'
                }
              });
            }
          });

          _this183.zoomOutButton.setParent(bHelpers.assertThisInitialized(_this183));

          _this183.zoomCloseButton = new ButtonClass(_this183.instanceNode, {
            'class': 'zoom-close'
          }, {
            'btnclick tap': function (e) {
              e.stop();

              _this183.emit('zoomControlsAction', {
                data: {
                  type: 'zoomclose'
                }
              });
            }
          });

          _this183.zoomCloseButton.setParent(bHelpers.assertThisInitialized(_this183));

          _this183.zoomInButton.append();

          _this183.zoomOutButton.append();

          _this183.zoomCloseButton.append();

          return _this183;
        }

        var _proto65 = ZoomControls.prototype;

        _proto65.show = function show() {
          this.parentNode.append(this.instanceNode);
        };

        _proto65.hide = function hide() {
          this.instanceNode.remove();
        };

        _proto65.invisibleDisable = function invisibleDisable(disable) {
          this.zoomInButton.disable(disable);
          this.zoomOutButton.disable(disable);
          this.zoomCloseButton.disable(disable);
        };

        _proto65.disable = function disable(typeOfButton
        /* in, out */
        ) {
          if (typeOfButton) {
            if (typeOfButton === 'in') {
              this.zoomInButton.changeState(true);
              this.zoomOutButton.changeState();
              this.zoomCloseButton.changeState();
            } else {
              this.zoomOutButton.changeState(true);
              this.zoomCloseButton.changeState(true);
              this.zoomInButton.changeState();
            }
          } else {
            this.zoomInButton.changeState();
            this.zoomOutButton.changeState();
            this.zoomCloseButton.changeState();
          }
        };

        _proto65.destroy = function destroy() {
          this.zoomInButton.destroy();
          this.zoomOutButton.destroy();
          this.zoomCloseButton.destroy();
          this.hide();

          _EventEmitter18.prototype.destroy.call(this);
        };

        return ZoomControls;
      }(EventEmitter);
      /* eslint-env es6 */

      /* global ZoomControls */

      /* global helper */

      /* global Zoominstance */

      /* global Hint */

      /* global Hotspots */

      /* global ResponsiveImage */

      /* global RoundLoader */

      /* global globalFunctions */

      /* global globalVariables */

      /* global defaults */

      /* global defaultsForDeepZoom */

      /* global defaultsForMobileZoomOptions */

      /* global defaultsForOutsideMode */

      /* global defaultsForMobileInnerMode */

      /* eslint-disable indent */

      /*eslint consistent-return: 0*/

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint class-methods-use-this: ["off", { "imageSettings": ["error"] }] */
      // eslint-disable-next-line no-unused-vars


      var Zoom = function () {
        var P = globalVariables.smv;
        var BRAND_LANDING = 'https://sirv.com/about-zoom/?utm_source=client&utm_medium=sirvembed&utm_content=typeofembed(zoom)&utm_campaign=branding';

        var stopEvent = function (e) {
          e.stop();
        };

        var difference = function (value1, value2) {
          return Math.abs(value1 - value2);
        };

        var getContainerForZoom = function (container) {
          var result = null;

          while (container.node !== $J.D.node.body && !result) {
            container = $(container.node.parentNode);

            if (container.hasClass(P + '-slides-box')) {
              result = container;
            }
          }

          return result;
        };

        var getNodeSize = function (node, count) {
          return new Promise(function (resolve, reject) {
            var size = $(node).getSize();

            if (!count) {
              count = 100;
            }

            count -= 1;

            if (size.width || size.height) {
              resolve(size);
            } else if (count > 0) {
              setTimeout(function () {
                getNodeSize(node, count).then(resolve).catch(reject);
              }, 16);
            } else {
              reject(null);
            }
          });
        };

        var Zoom_ = /*#__PURE__*/function (_Zoominstance2) {
          "use strict";

          bHelpers.inheritsLoose(Zoom_, _Zoominstance2);

          function Zoom_(node, options) {
            var _this184;

            _this184 = _Zoominstance2.call(this, node, options, defaults) || this;
            _this184.type = globalVariables.SLIDE.TYPES.ZOOM;
            _this184.insideOptions = {
              type: 'outside',
              // inner, circle, square, outside
              position: 'right',
              // top, left, right, bottom
              hideZoomForClickTrigger: true,
              zooming: true,
              map: false,
              mapSize: 50,
              controls: false,
              trigger: 'click',
              outsideModeWasChanged: false
            };
            _this184.imageUrl = _this184.instanceNode.attr('data-src'); // Image URL

            _this184.src = globalFunctions.normalizeURL(_this184.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$1')); // Image default params

            _this184.queryParams = helper.paramsFromQueryString(_this184.imageUrl.replace(globalVariables.REG_URL_QUERY_STRING, '$2'));

            if (_this184.queryParams) {
              var q = parseInt(_this184.queryParams.quality, 10);

              if (isNaN(q)) {
                delete _this184.queryParams.quality;
              } else {
                _this184.queryParams.quality = q;
              }
            }

            _this184.isFullscreen = options.isFullscreen;
            _this184.nativeFullscreen = options.nativeFullscreen;
            _this184.queryParamsQuality = _this184.queryParams.quality || null;
            _this184.imageNode = null;
            _this184.loader = null;
            _this184.image = null;
            _this184.controls = null;
            _this184.differenceBetweenSizes = 100;
            _this184.currentSize = {
              width: 0,
              height: 0
            };
            _this184.currentImageSize = {
              width: 0,
              height: 0
            };
            _this184.isInfoLoaded = false;
            _this184.zoomIsOpened = false;
            _this184.imageShowPromise = null;
            _this184.hint = null;
            _this184.longTapTimer = null;
            _this184.setImageCss = false;
            _this184.lastTriggerAction = null;
            _this184.isNotMouse = false;
            _this184.accountInfo = {};
            _this184.postInitState = 0;
            _this184.clonedImage = null;
            _this184.isHidden = false;
            _this184.destroyed = false;
            _this184.waitingCallbacks = []; // just for outsize zoom

            _this184.lastImageSize = {
              width: 0,
              height: 0
            };
            _this184.hotspotsTurnedOn = true;
            _this184.scrollDebounce = helper.debounce(function () {
              _this184.replaceZoom();
            }, 16);
            _this184.zoomDebounce = helper.debounce(function () {
              if (_this184.controls) {
                _this184.controls.invisibleDisable();

                _this184.changeControlsState(_this184.zoom.getZoomData());
              }
            }, 42);
            _this184.onScrollHandler = _this184.onScroll.bind(bHelpers.assertThisInitialized(_this184));

            _this184.instanceNode.addEvent('selectstart', function (e) {
              e.stop();
            }); // this.api = $J.extend(this.api, {
            // resize: this.resize.bind(this), // parent class
            // zoomIn: this.zoomIn.bind(this), // parent class
            // zoomOut: this.zoomOut.bind(this), // parent class
            // isZoomed: this.isZoomed.bind(this), // parent class
            // isReady: this.isReady.bind(this), // parent class
            // getOptions: this.getOptions.bind(this), // parent class
            // hotspots: {} // parent class, hotspots api
            // });


            _this184.createHotspotsClass();

            _this184.createSirvImage();

            return _this184;
          }

          var _proto66 = Zoom_.prototype;

          _proto66.makeOptions = function makeOptions() {
            var options = new $J.Options(this.defaultSchema);
            options = this.makeGlobalOptions(options);

            if ($J.contains(['top', 'left', 'right', 'bottom', 'inner', 'magnifier'], options.get('mode'))) {
              options.parseSchema(defaultsForOutsideMode, true);
            }

            if ($J.browser.touchScreen && $J.browser.mobile) {
              options.parseSchema(defaultsForMobileZoomOptions, true);
              options = this.makeMobileOptions(options);

              if ($J.contains(['inner', 'deep'], options.get('mode'))) {
                options.parseSchema(defaultsForMobileInnerMode, true);
              }
            }

            if (options.get('mode') === 'deep') {
              options.parseSchema(defaultsForDeepZoom, true);
            }

            return options;
          };

          _proto66.getInfo = function getInfo() {
            var _this185 = this;

            if (!this.gettingInfoPromise) {
              this.gettingInfoPromise = new Promise(function (resolve, reject) {
                _this185.waitGettingInfo.wait(function () {
                  _this185.image.getImageInfo().then(function (info) {
                    if (!_this185.destroyed) {
                      _this185.isInfoLoaded = true;
                      _this185.accountInfo = _this185.image.getAccountInfo();

                      if (!_this185.dataAlt) {
                        _this185.dataAlt = _this185.image.getDescription();
                      }

                      _this185.hotspotsData = info.hotspots;
                      _this185.infoSize = _this185.image.getOriginSize();

                      if (_this185.hotspots) {
                        _this185.hotspots.setOriginImageSize(_this185.infoSize.width, _this185.infoSize.height);
                      }

                      resolve();
                    }
                  }).catch(function (err) {
                    if (!_this185.destroyed) {
                      reject(err);
                    }
                  });
                });
              });
            }

            return this.gettingInfoPromise;
          };

          _proto66.showHint = function showHint() {
            if (this.hint) {
              if (!this.always || $J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.fullscreenState)) {
                this.hint.show();
              }
            }
          };

          _proto66.onStartActions = function onStartActions() {
            if (this._isReady) {
              if (this.isInView && this.isZoomSizeExist()) {
                this.showHint();
              }
            } else if (this.isStarted) {
              if (this.isInView && this.isSlideShown && !this.preload) {
                this.postInit();
              }
            }

            _Zoominstance2.prototype.onStartActions.call(this);
          };

          _proto66.onStopActions = function onStopActions() {
            this.zoomOut(true);

            if (this.hint) {
              this.hint.hide();
            }

            _Zoominstance2.prototype.onStopActions.call(this);
          };

          _proto66.onInView = function onInView(value) {
            if (value) {
              if (this._isReady) {
                if (this.isSlideShown && this.isZoomSizeExist()) {
                  this.showHint();
                }
              } else if (this.isStarted) {
                if (!this.isInView && (this.preload || this.isSlideShown)) {
                  this.isInView = true;
                  this.postInit();
                }
              }
            }
          };

          _proto66.startFullInit = function startFullInit(options) {
            if (this.isStartedFullInit) {
              return;
            }

            _Zoominstance2.prototype.startFullInit.call(this, options); // if (options && options.lensContainer) {
            //     this.zoomContainer = options.lensContainer;
            // }


            this.normalizeOptions();
            this.getId('zoom-');
            this.instanceNode.addClass(P + '-zoom-view');
            this.instanceNode.addEvent('mousedown', stopEvent);
            this.createLoader();
          };

          _proto66.imageSettings = function imageSettings(options) {
            if (!options) {
              options = {};
            }

            if (!options.imageSettings) {
              options.imageSettings = {};
            }

            if (!options.imageSettings.scale) {
              options.imageSettings.scale = {};
            }

            if (!options.callbackData) {
              options.callbackData = {};
            }

            options.imageSettings.scale.option = 'fill';

            if (this.quality !== null && this.queryParamsQuality === null) {
              if (!options.src) {
                options.src = {};
              }

              options.src.quality = this.quality;
            }

            var hdQuality = this.hdQuality;

            if (this.queryParamsQuality === null || this.isHDQualitySet && hdQuality < this.queryParamsQuality) {
              options.srcset = {
                quality: hdQuality
              };
            }

            return options;
          };

          _proto66.setHDQuality = function setHDQuality(data) {
            if (data.dppx > 1 && data.dppx < 1.5) {
              if (this.queryParamsQuality === null && this.quality !== null) {
                data.srcset.quality = this.quality;
              } else if (data.srcset) {
                delete data.srcset.quality;
              }
            }

            return data;
          };

          _proto66.isOutsideZoom = function isOutsideZoom() {
            return $J.contains(['top', 'left', 'right', 'bottom'], this.option('mode'));
          };

          _proto66.createHint = function createHint(message) {
            if (this.option('hint.enable')) {
              this.hint = new Hint(this.instanceNode, {
                html: '<span>' + message + '<span>'
              });
              this.hint.append();
            }
          };

          _proto66.clearZoom = function clearZoom() {
            if (this.zoom) {
              this.off('zooming');
              this.off('zoomUp');
              this.off('zoomDown');

              if (this.imageNode) {
                this.imageNode.removeClass(this.zoomClassName);
              }
            }

            _Zoominstance2.prototype.clearZoom.call(this);
          };

          _proto66.replaceZoom = function replaceZoom() {
            var trigger = false;
            var currentTrigger = this.option('trigger');
            var zoomOptions = {
              clickBehavior: 'both'
            };

            if (!this._isReady) {
              return;
            }

            if (currentTrigger === 'hover' && this.option('mode') !== 'magnifier') {
              if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.fullscreenState)) {
                trigger = 'click';
                zoomOptions.trigger = trigger;
              } else {
                trigger = currentTrigger;
              }
            }

            var createNewZoom = false;

            if (trigger && this.insideOptions.trigger !== trigger) {
              createNewZoom = true;
            }

            var canIUse;

            if (this.insideOptions.type === 'outside') {
              canIUse = this.canIUseOutsideZoom();

              if (canIUse && this.insideOptions.outsideModeWasChanged || !canIUse && !this.insideOptions.outsideModeWasChanged) {
                this.insideOptions.outsideModeWasChanged = !this.insideOptions.outsideModeWasChanged;
                createNewZoom = true;
              } // if the image checnge size the window of outside zoom must chenge too


              var imageSize = this.imageNode.getSize();

              if (!createNewZoom && canIUse && this.lastImageSize.width !== imageSize.width) {
                this.lastImageSize = imageSize;
                createNewZoom = true;
              }
            }

            if (createNewZoom) {
              this.clearZoom();

              if (this.insideOptions.type === 'outside') {
                if (canIUse) {
                  zoomOptions.type = 'outside';
                } else {
                  zoomOptions.type = 'inner';

                  if ($J.browser.mobile) {
                    zoomOptions.pan = true;

                    if (currentTrigger === 'hover') {
                      trigger = 'dblclick';
                      zoomOptions.trigger = trigger;
                    }
                  }
                }
              }

              if (trigger) {
                this.insideOptions.trigger = trigger;
              }

              this.setTriggerAction(trigger);
              this.createZoom(zoomOptions);
              this.setZoomEvents();
            }
          };

          _proto66.canIUseOutsideZoom = function canIUseOutsideZoom() {
            var result = false;

            if (this.insideOptions.type === 'outside') {
              if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.fullscreenState)) {
                return result;
              }

              var margin = this.option('margin');
              var zoomSize = this.imageNode.getSize();
              var scroll = $J.W.getScroll();
              var pos = this.imageNode.getPosition();

              var _w = this.option('width');

              var h = this.option('height');
              var size = {
                width: zoomSize.width,
                height: zoomSize.height
              };

              if (_w !== 'auto') {
                if (/%$/.test(_w)) {
                  zoomSize.width = zoomSize.width / 100 * parseInt(_w, 10);
                } else {
                  zoomSize.width = parseInt(_w, 10);
                }
              }

              if (h !== 'auto') {
                if (/%$/.test(h)) {
                  zoomSize.height = zoomSize.height / 100 * parseInt(h, 10);
                } else {
                  zoomSize.height = parseInt(h, 10);
                }
              }

              var tmp;

              switch (this.insideOptions.position) {
                case 'top':
                  tmp = pos.top - scroll.y - margin;

                  if (tmp > zoomSize.height) {
                    result = true;
                  }

                  break;

                case 'left':
                  tmp = pos.left - scroll.x - margin;

                  if (tmp >= zoomSize.width) {
                    result = true;
                  }

                  break;

                case 'right':
                  tmp = pos.left - scroll.x;
                  tmp += size.width + margin;

                  if ($J.W.node.innerWidth - tmp >= zoomSize.width) {
                    result = true;
                  }

                  break;

                case 'bottom':
                  tmp = pos.top - scroll.y;
                  tmp += size.height + margin;

                  if ($J.W.node.innerHeight - tmp >= zoomSize.height) {
                    result = true;
                  }

                  break;
                // no default
              }
            }

            return result;
          };

          _proto66.createHotspotsClass = function createHotspotsClass() {
            if (this.option('mode') === 'magnifier') {
              return;
            }

            if (!$J.browser.mobile && this.option('trigger') === 'hover') {
              this.hotspotsTurnedOn = false;
            }

            _Zoominstance2.prototype.createHotspotsClass.call(this, Hotspots);
          };

          _proto66.run = function run(isShown, preload, firstSlideAhead) {
            var _this186 = this;

            var result = _Zoominstance2.prototype.run.call(this, isShown, preload, firstSlideAhead);

            if (result) {
              this.getInfo().finally(function () {
                _this186.calcContainerSize();

                if (_this186.isInView && (_this186.preload || _this186.isSlideShown)) {
                  _this186.postInit();
                }
              });
              this.startGettingInfo();
            }

            return result;
          };

          _proto66.done = function done() {
            if (!this._isReady && !this.destroyed) {
              _Zoominstance2.prototype.done.call(this);

              if (this.hotspots) {
                if (!this.hotspots.getHotspots().length) {
                  this.hotspots.setInstanceComponentNode(this.imageNode);
                }

                this.hotspots.setContainerSize(this.imageNode.node.getBoundingClientRect());
              }

              this.createZoom();
              this.replaceZoom();
              this.createControls();
              var zoomable = this.isZoomSizeExist();

              if (this.controls) {
                this.controls.disable('out');

                if (zoomable) {
                  this.controls.show();
                }
              }

              if (this.imageNode && zoomable) {
                this.imageNode.addClass(globalVariables.CSS_CURSOR_ZOOM_IN);
              }

              this.setZoomEvents();

              if (this.isSlideShown && this.isInView && zoomable) {
                this.showHint();
              }

              if (this.accountInfo.branded) {
                var nodeWithSirvClassName = globalFunctions.getNodeWithSirvClassName(this.instanceNode) || $J.D.node.head || $J.D.node.body;
                globalFunctions.rootDOM.showSirvAd(nodeWithSirvClassName, this.instanceNode, BRAND_LANDING, 'Deep zoom image viewer by Sirv');
              }
            }
          };

          _proto66.normalizeOptions = function normalizeOptions() {
            if (this.option('mode') !== 'deep') {
              this.option('map.enable', false);
            }

            if (this.option('mode') === 'deep' || $J.browser.mobile) {
              this.option('pan', true);
            }

            if (this.option('mode') === 'magnifier' && !$J.browser.mobile) {
              this.option('pan', false);
            }

            if (!this.isOutsideZoom()) {
              if (this.option('width') === 'auto' && this.option('height') === 'auto') {
                this.option('width', '70%');
              }
            }

            switch (this.option('trigger')) {
              case 'hover':
                if (this.option('mode') === 'deep') {
                  this.option('trigger', 'click');
                }

                break;

              case 'click':
              case 'dblclick':
                break;

              default:
                this.option('trigger', false);
            }

            switch (this.option('mode')) {
              case 'top':
              case 'left':
              case 'right':
              case 'bottom':
                this.insideOptions.type = 'outside';
                this.insideOptions.position = this.option('mode');
                break;

              case 'magnifier':
                this.insideOptions.type = 'circle';
                break;

              case 'inner':
                this.insideOptions.type = 'inner';
                break;

              case 'deep':
                this.insideOptions.type = 'deep';
                this.insideOptions.controls = true;
                break;
              // no default
            }

            if (this.insideOptions.type === 'deep' && this.option('map.enable')) {
              this.insideOptions.map = this.option('map.size') !== 0;

              if (this.insideOptions.map) {
                this.insideOptions.mapSize = 100 / 50 * this.option('map.size');
              }
            }

            this.insideOptions.trigger = this.option('trigger');

            if ($J.browser.mobile) {
              this.insideOptions.hideZoomForClickTrigger = false;
            }

            if (this.option('ratio') !== 'max' && this.option('ratio') < globalVariables.MIN_RATIO) {
              this.option('ratio', 0);
            }

            this.setDefaultZoomOptions();
          };

          _proto66.setDefaultZoomOptions = function setDefaultZoomOptions() {
            var isDeep = this.insideOptions.type === 'deep';

            _Zoominstance2.prototype.setDefaultZoomOptions.call(this);

            this.defaultZoomOptions = $J.extend(this.defaultZoomOptions, {
              trigger: this.option('trigger'),
              tiles: this.option('tiles'),
              width: this.option('width'),
              height: this.option('height'),
              map: this.insideOptions.map,
              clickBehavior: isDeep ? 'up' : 'both',
              outsidePosition: this.insideOptions.position,
              margin: this.option('margin'),
              type: isDeep ? 'inner' : this.insideOptions.type,
              pan: this.option('pan'),
              customZooming: this.option('wheel'),
              mapSize: this.insideOptions.mapSize
            });
          };

          _proto66.onZoomGetImage = function onZoomGetImage(e) {
            _Zoominstance2.prototype.onZoomGetImage.call(this, e);

            e.data = this.imageSettings(e.data);
            e.data = this.setHDQuality(e.data);
            var img = this.image.getImage(e.data);

            if (this.checkImage(e.data, e.data.dontLoad)) {
              this.zoom.setImage(img);
            }
          };

          _proto66.onZoomCancelLoadingOfTiles = function onZoomCancelLoadingOfTiles(e) {
            _Zoominstance2.prototype.onZoomCancelLoadingOfTiles.call(this, e);

            e.data = this.imageSettings(e.data);
            this.image.cancelLoadingImage(e.data);
          } // eslint-disable-next-line
          ;

          _proto66.onZoomBeforeShow = function onZoomBeforeShow(e) {
            if (this.option('mode') !== 'magnifier') {
              if (this.insideOptions.type === 'outside' && !this.insideOptions.outsideModeWasChanged) {
                this.imageNode.addClass('sirv-filter-bw');
              } else {
                this.imageNode.addClass(this.zoomClassName);
              }

              if (this.hotspots) {
                this.hotspots.disableAll();
              }
            }
          } // eslint-disable-next-line
          ;

          _proto66.onZoomShown = function onZoomShown(e) {
            if (this.isSlideShown) {
              this.sendEvent('zoomIn', {
                trigger: this.option('trigger'),
                isOutsideZoom: this.isOutsideZoom()
              });
            }
          } // eslint-disable-next-line
          ;

          _proto66.onZoomHidden = function onZoomHidden(e) {
            this.imageNode.removeClass(this.zoomClassName);
            this.imageNode.removeClass('sirv-filter-bw');
            this.sendEvent('zoomOut');
            this.isNotMouse = false;
            this.zoomIsOpened = false;

            if (this.pinchCloud) {
              this.pinchCloud.addEvent();
            }

            if (this.hotspots) {
              if (this.hotspotsTurnedOn && $J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.OPENING], this.fullscreenState) || this.insideOptions.trigger !== 'hover' && $J.contains([globalVariables.FULLSCREEN.OPENED, globalVariables.FULLSCREEN.CLOSING], this.fullscreenState)) {
                this.hotspots.enableAll();

                if (this.isInView && this.isSlideShown) {
                  this.hotspots.showNeededElements();
                }
              }
            }
          };

          _proto66.setZoomEvents = function setZoomEvents() {
            var _this187 = this;

            _Zoominstance2.prototype.setZoomEvents.call(this);

            this.on('zooming', function (e) {
              var zoom = e.data.zoom;
              e.stopAll();

              if (_this187.controls) {
                _this187.controls.invisibleDisable(true);

                _this187.changeControlsState(zoom);

                _this187.zoomDebounce();
              }
            });
            this.on('zoomUp', function (e) {
              e.stop();

              _this187.makeZoom('zoomin', e.data.x, e.data.y);
            });
            this.on('zoomDown', function (e) {
              e.stop();

              _this187.makeZoom('zoomout', e.data.x, e.data.y);
            });
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto66.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {
            if (this.zoomIsOpened) {
              this.zoom.hide(true);

              if (this.controls) {
                this.controls.disable('out');
              }
            }

            if (this._isReady && this.isSlideShown && this.isInView && !!this.imageNode) {
              this.isHidden = true;
              this.imageNode.setCss({
                opacity: 0,
                visibility: 'hidden'
              });
            }

            _Zoominstance2.prototype.onBeforeFullscreenIn.call(this, data);

            if (this.hotspots) {
              this.hotspots.disableAll();
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto66.onAfterFullscreenIn = function onAfterFullscreenIn(data) {
            var _this188 = this;

            this.calcContainerSize();
            this.replaceZoom();

            if (this.isHidden) {
              this.isHidden = false;
              setTimeout(function () {
                _this188.setImageWidthHeight();

                _this188.imageNode.setCss({
                  opacity: '',
                  visibility: ''
                });
              }, 0);
            } // if we use it, we do not have pinchend event and touchdrag after that
            // if (this.pinchCloud) {
            //     this.pinchCloud.removeEvent();
            //     this.pinchCloud.addEvent();
            // }


            if (this.hotspots) {
              setTimeout(function () {
                // we have to wait a little bit for 'onResize' function
                if (_this188.hotspotsTurnedOn && _this188.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                  // if we will exit from fullscreen before the timeout end
                  _this188.hotspots.enableAll();

                  if (_this188.isInView && _this188.isSlideShown) {
                    _this188.hotspots.showNeededElements();
                  }
                }
              }, 100);
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto66.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {
            if (this.zoomIsOpened) {
              this.zoom.hide(true);

              if (this.controls) {
                this.controls.disable('out');
              }
            }

            _Zoominstance2.prototype.onBeforeFullscreenOut.call(this, data);

            if (this.hotspots) {
              if (!this.hotspotsTurnedOn) {
                this.hotspots.disableAll();
              }
            } // if (this.option('mode') === 'magnifier') {
            //     this.zoom.setLensContainer($J.D.node.body);
            // }


            this.replaceZoom();

            if (this._isReady && this.isSlideShown && this.isInView && !!this.imageNode) {
              this.isHidden = true;
              this.imageNode.setCss({
                opacity: 0,
                visibility: 'hidden'
              });
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto66.onAfterFullscreenOut = function onAfterFullscreenOut(data) {
            var _this189 = this;

            if (this.isHidden) {
              this.isHidden = false;
              setTimeout(function () {
                if (!_this189.destroyed) {
                  _this189.setImageWidthHeight();

                  _this189.imageNode.setCss({
                    opacity: '',
                    visibility: ''
                  });
                }
              }, 0);
            }

            _Zoominstance2.prototype.onAfterFullscreenOut.call(this, data); // if we use it, we do not have pinchend event and touchdrag after that
            // if (this.pinchCloud) {
            //     this.pinchCloud.removeEvent();
            //     this.pinchCloud.addEvent();
            // }

          };

          _proto66.onSecondSelectorClick = function onSecondSelectorClick() {
            this.zoomOut(true);
          };

          _proto66.onMouseAction = function onMouseAction(type) {
            if (type === 'mouseout') {
              if (!$J.contains(['deep', 'magnifier'], this.option('mode')) && (this.insideOptions.type === 'outside' && this.insideOptions.outsideModeWasChanged || this.insideOptions.type === 'inner') && (this.insideOptions.trigger === 'hover' || this.insideOptions.hideZoomForClickTrigger) && !this.isNotMouse) {
                this.zoomOut(true);
              }
            }
          };

          _proto66.makeZoom = function makeZoom(direction, x, y) {
            var result = false;

            if (this._isReady && this.zoom) {
              switch (direction) {
                case 'zoomin':
                  if (this.zoomIsOpened) {
                    if (this.zoom.getNextMinZoom() === 1) {
                      this.controls.disable('in');
                    }

                    result = this.zoom.zoomUp(x, y);
                  } else {
                    result = this.openZoom(x, y, this.insideOptions.type === 'deep' ? 'first' : false);
                  }

                  break;

                case 'zoomout':
                  if (this.zoomIsOpened) {
                    if (this.zoom.getZoomData() === 0 || this.zoom.getNextMinZoom() === 0) {
                      result = this.zoom.hide();

                      if (this.controls) {
                        this.controls.disable('out');
                      }
                    } else {
                      result = this.zoom.zoomDown(x, y);
                    }
                  }

                  break;

                default:
                  // why is it need
                  if (this.zoomIsOpened) {
                    result = this.zoom.hide();

                    if (this.controls) {
                      this.controls.disable('out');
                    }
                  }

              }
            }

            return result;
          };

          _proto66.calcContainerSize = function calcContainerSize() {
            var size = this.instanceNode.getSize();

            if (!size.height || !size.width) {
              var originSize = this.image.getOriginSize();

              if (!size.height) {
                this.currentSize.width = size.width;
                this.currentSize.height = originSize.height / originSize.width * size.width;
              } else {
                this.currentSize.height = size.height;
                this.currentSize.width = originSize.width / originSize.height * size.height;
              }
            } else {
              this.currentSize = size;
            }
          };

          _proto66.getImageSize = function getImageSize() {
            var width;
            var height;
            var cs = this.currentSize;
            var is = this.image.getOriginSize();

            if (cs.width >= cs.height) {
              height = Math.min(cs.height, is.height);
              width = is.width / is.height * height;

              if (width > cs.width) {
                width = Math.min(cs.width, is.width);
                height = is.height / is.width * width;
              }
            } else {
              width = Math.min(cs.width, is.width);
              height = is.height / is.width * width;

              if (height > cs.height) {
                height = Math.min(cs.height, is.height);
                width = is.width / is.height * height;
              }
            }

            return $J.extend({
              realWidth: width,
              realHeight: height
            }, this.image.getClearSizeWithoutProcessingSettings({
              width: width,
              height: height
            }));
          };

          _proto66.setTriggerAction = function setTriggerAction(tr) {
            var _this190 = this;

            var trigger = this.option('trigger');
            this.isNotMouse = false;

            if (this.option('ratio') !== 'max' && this.option('ratio') < globalVariables.MIN_RATIO) {
              return;
            }

            if (trigger) {
              var showHint = false;

              if (this.lastTriggerAction) {
                this.lastTriggerAction();
                this.lastTriggerAction = null;

                if (this.hint) {
                  this.hint.destroy();
                  this.hint = null;
                  showHint = true;
                }
              }

              if (tr) {
                trigger = tr;
              }

              var imageEvent;
              var hintMessage;

              switch (trigger) {
                case 'click':
                  imageEvent = 'btnclick tap';
                  hintMessage = this.option('hint.text.click');
                  break;

                case 'dblclick':
                  imageEvent = 'dblbtnclick dbltap';
                  hintMessage = this.option('hint.text.dblclick');
                  break;

                case 'hover':
                  imageEvent = 'mouseover';
                  hintMessage = this.option('hint.text.hover');

                  if ($J.browser.mobile) {
                    if (this.outsideModeWasChanged) {
                      hintMessage = this.option('hint.text.dblclick');
                      imageEvent = 'dbltap';
                      trigger = imageEvent;
                    }
                  }

                  break;
                // no default
              }

              this.createHint(hintMessage);

              if (showHint && this.isSlideShown && this.isInView && this.isZoomSizeExist()) {
                this.showHint();
              }

              var cbs = [];

              if (trigger === 'hover') {
                if ($J.browser.touchScreen) {
                  cbs.push(this.setLongTapEvents());
                }

                if (!$J.browser.mobile) {
                  cbs.push(this.setHoverEvents());
                }
              } else {
                var eventHandler = function (e) {
                  if (_this190.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this190.always) {
                    e.stop();

                    if (_this190.isFullscreenActionEnded()) {
                      var pageXY = e.getPageXY();

                      _this190.openZoom(pageXY.x, pageXY.y, false);
                    }
                  }
                };

                if ($J.browser.touchScreen) {
                  var pointerCallback = function (e) {
                    _this190.isNotMouse = e.isTouchEvent();
                  };

                  this.imageNode.addEvent('pointerup', pointerCallback);
                  cbs.push($(function (cb) {
                    _this190.isNotMouse = false;

                    _this190.imageNode.removeEvent('pointerup', cb);
                  }).bind(this, pointerCallback));
                }

                this.imageNode.addEvent(imageEvent, eventHandler);
                cbs.push($(function (eventName, cb) {
                  _this190.imageNode.removeEvent(eventName, cb);
                }).bind(this, imageEvent, eventHandler));
              }

              this.lastTriggerAction = $(function (_cbs) {
                $(_cbs).forEach(function (cb) {
                  cb();
                });
              }).bind(this, cbs);
            }
          };

          _proto66.setImageSrc = function setImageSrc(src, srcset, dppx) {
            if (this.imageNode) {
              this.imageNode.attr('src', src);

              if (srcset) {
                this.imageNode.attr('srcset', srcset + ' ' + dppx + 'x');
              } else {
                this.imageNode.removeAttr('srcset');
              }

              this.clonedImage = $(this.imageNode.node.cloneNode(true));
              this.clonedImage.node.className = '';
            }
          };

          _proto66.setImageWidthHeight = function setImageWidthHeight() {
            if (!this.destroyed) {
              if (this.currentImageSize.realWidth / this.currentImageSize.realHeight >= this.currentSize.width / this.currentSize.height) {
                this.imageNode.setCss({
                  width: '100%',
                  height: ''
                });
              } else {
                this.imageNode.setCss({
                  width: '',
                  height: '100%'
                });
              }
            }
          };

          _proto66.createImage = function createImage(node, src, srcset, dppx) {
            var _this191 = this;

            if (!this.imageNode) {
              if (node) {
                this.imageNode = $(node);
              } else {
                this.imageNode = $J.$new('img');
              }

              this.imageNode.attr('referrerpolicy', this.referrerPolicy);
              var originSize = this.image.getOriginSize();
              this.imageNode.setCss({
                maxWidth: originSize.width,
                maxHeight: originSize.height
              });
              this.setImageWidthHeight();
              this.setTriggerAction();

              if (this.option('wheel') && this.option('mode') === 'deep') {
                this.imageNode.addEvent('mousescroll', function (e) {
                  if (!_this191.zoomIsOpened && e.delta > 0) {
                    e.stop();

                    _this191.openZoom(e.x, e.y, 'first');
                  }
                });
              }

              $J.W.addEvent('scroll', this.onScrollHandler);

              if (this.dataAlt) {
                this.imageNode.attr('alt', this.dataAlt);
              }

              this.setImageSrc(src, srcset, dppx);
            }
          };

          _proto66.setLongTapEvents = function setLongTapEvents() {
            var _this192 = this;

            var move = false;
            var touchDown = false;

            var _start = function (e) {
              clearTimeout(_this192.longTapTimer);

              if (_this192.zoomIsOpened || e.isTouchEvent() && !e.isPrimaryTouch()) {
                return;
              }

              if (_this192.isFullscreenActionEnded()) {
                _this192.longTapTimer = setTimeout(function () {
                  if (e.isTouchEvent() && !e.isPrimaryTouch()) {
                    return;
                  }

                  e.stop();
                  move = true;
                  var p = e.getPageXY();

                  _this192.openZoom(p.x, p.y, false, true);
                }, 201);
                touchDown = true;
              }
            };

            var _move = function (e) {
              if (e.isTouchEvent() && !e.isPrimaryTouch(e)) {
                return;
              }

              if (move) {
                e.stop();
                var p = e.getPageXY();

                _this192.zoom.customMove(p.x, p.y);
              } else {
                clearTimeout(_this192.longTapTimer);
              }
            };

            var _end = function (e) {
              if (e.isTouchEvent() && !e.isPrimaryTouch(e)) {
                return;
              }

              if (touchDown) {
                // e.stop();
                touchDown = false;
                clearTimeout(_this192.longTapTimer);
              }

              if (move) {
                e.stop();
                move = false;

                _this192.zoom.hide(true);
              }
            };

            if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED || !this.always) {
              this.instanceNode.addEvent('touchstart pointerdown', _start);
              this.instanceNode.addEvent('touchmove pointermove', _move);
              this.instanceNode.addEvent('touchend pointerup', _end);
            }

            return function () {
              _this192.instanceNode.removeEvent('touchstart pointerdown', _start);

              _this192.instanceNode.removeEvent('touchmove pointermove', _move);

              _this192.instanceNode.removeEvent('touchend pointerup', _end);
            };
          };

          _proto66.setHoverEvents = function setHoverEvents() {
            var _this193 = this;

            var isOver = false;
            var x;
            var y;
            var timer;

            var check = function () {
              return $J.browser.touchScreen && !$J.browser.mobile;
            };

            var _move = function (e) {
              var pageXY = e.getPageXY();
              x = pageXY.x;
              y = pageXY.y;

              if (check() && e.isTouchEvent()) {
                return;
              }

              if (!isOver && _this193.isSlideShown && (_this193.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this193.always)) {
                isOver = true;
                timer = setTimeout(function () {
                  // the scroll is not needed for inner zoom
                  _this193.openZoom(x, y, false);
                }, 84);
              }
            };

            var _out = function (e) {
              var relatedTarget = $(e.getRelated());

              if (check() && e.isTouchEvent()) {
                return;
              }

              if (isOver && (_this193.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this193.always)) {
                isOver = false;

                if (_this193.isFullscreenActionEnded()) {
                  while (relatedTarget && relatedTarget !== _this193.imageNode.node && relatedTarget !== $J.D.node.body) {
                    relatedTarget = $(relatedTarget.parentNode);
                  }

                  if (relatedTarget !== _this193.imageNode.node) {
                    x = null;
                    y = null;
                    clearTimeout(timer);
                  }
                }
              }
            };

            var removeConnection = function () {};

            var moveEvent = 'mousemove';
            var outEvent = 'mouseout';

            if (check() && helper.isIe()) {
              removeConnection = this.on('zoomHidden', function (e) {
                e.stop();
                isOver = false;
              });
              moveEvent = 'pointermove';
              outEvent = 'pointerup';
            }

            this.imageNode.addEvent(moveEvent, _move);
            this.imageNode.addEvent(outEvent, _out);
            return function () {
              removeConnection();

              _this193.imageNode.removeEvent(moveEvent, _move);

              _this193.imageNode.removeEvent(outEvent, _out);
            };
          };

          _proto66.getZoomImageSize = function getZoomImageSize() {
            var originSize = this.image.getOriginSize();
            var originWidth = originSize.width;
            var originHeight = originSize.height;
            var r = this.option('ratio');
            var size = {
              width: originWidth,
              height: originHeight
            };

            if (r !== 'max') {
              // because proportions can change
              size.width = this.currentImageSize.realWidth * r;
              size.height = this.currentImageSize.realHeight * r;
              size = ResponsiveImage.roundImageSize(size);
            }

            size.width = Math.min(originWidth, size.width);
            size.height = Math.min(originHeight, size.height);
            return {
              width: size.width,
              height: size.height,
              originWidth: originWidth,
              originHeight: originHeight
            };
          };

          _proto66.openZoom = function openZoom(x, y, toFirstLevel, longTap) {
            if (this.insideOptions.type === 'deep' && toFirstLevel !== 'zero') {
              toFirstLevel = 'first';
            }

            var result = false;

            if (!this.zoom || !this.isZoomSizeExist()) {
              return result;
            } // this.zoomIsOpened = img;


            this.zoomIsOpened = true;

            if (this.hint) {
              this.hint.hide();
            }

            if (this.hotspots) {
              this.hotspots.hideActiveHotspotBox(true);
            }

            var imageClone = this.clonedImage;
            var zoomSize = this.getZoomImageSize();

            if (undefined === x) {
              result = this.zoom.showCenter(imageClone, zoomSize, toFirstLevel);
            } else {
              result = this.zoom.show(imageClone, zoomSize, x, y, longTap, toFirstLevel);
            }

            return result;
          };

          _proto66.createPinchEvent = function createPinchEvent() {
            var _this194 = this;

            // difference between scale
            var OPEN_ZOOM = 1.1;
            var FS_OUT = 0.2;
            var FS_IN = 2;
            var scale;
            var baseMin;
            var saveValue;
            var compensation;
            var maxCompensation;
            var minCompensation;
            var max;
            var min;
            var basePercent;

            var setDefaultsValues = function () {
              maxCompensation = 1;
              minCompensation = 1;
              baseMin = _this194.zoom.getBaseScale().x;
              max = 1;
              min = baseMin;
              saveValue = 1 - baseMin;
            };

            _Zoominstance2.prototype.createPinchEvent.call(this, this.instanceNode);

            this.pinchCloud.onPinchStart = function (e) {
              if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.CLOSING], _this194.fullscreenState) || _this194.insideOptions.type === 'outside' && !_this194.insideOptions.outsideModeWasChanged) {
                return;
              }

              _this194.pinchCloud.pinch = true;
              clearTimeout(_this194.longTapTimer);
              basePercent = false;
              _this194.pinchCloud.scale = e.scale;
              compensation = 1;

              if (_this194.hotspots) {
                _this194.hotspots.hideActiveHotspotBox(true);
              }

              if (_this194.zoomIsOpened) {
                compensation = _this194.zoom.scale.x;

                if (baseMin === $J.U) {
                  setDefaultsValues();
                }

                compensation /= baseMin;
              }

              _this194.sendEvent('pinchStart');
            };

            this.pinchCloud.onPinchResize = function (e) {
              if (_this194.pinchCloud.pinch && !_this194.pinchCloud.block) {
                if (_this194.zoom && _this194.fullscreenState === globalVariables.FULLSCREEN.OPENED && _this194.zoomIsOpened) {
                  _this194.pinchCloud.scale = e.scale;

                  _this194.zoom.setBasePercent(e.centerPoint);
                }
              }
            };

            this.pinchCloud.onPinchMove = function (e) {
              if (_this194.pinchCloud.pinch && !_this194.pinchCloud.block) {
                if (_this194.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this194.isFullscreenEnabled) {
                  if (!_this194.zoomIsOpened) {
                    if (e.scale > OPEN_ZOOM) {
                      if (_this194.option('mode') !== 'magnifier' && _this194.option('wheel')) {
                        _this194.openZoom(e.centerPoint.x, e.centerPoint.y, 'zero');

                        setDefaultsValues();
                        compensation = 1;
                      }
                    } else if (e.scale < FS_OUT && _this194.isFullscreenEnabled) {
                      _this194.pinchCloud.block = true;

                      _this194.sendEvent('fullscreenOut');
                    }
                  } else if (_this194.zoom) {
                    if (!basePercent) {
                      basePercent = true;

                      _this194.zoom.setBasePercent(e.centerPoint);
                    } else {
                      scale = e.scale;
                      scale *= baseMin;

                      if (max < scale) {
                        max = scale;
                        min = baseMin;
                        minCompensation = 1;
                        maxCompensation = saveValue / (max - baseMin);
                      }

                      if (min > scale) {
                        min = scale;
                        max = 1;
                        maxCompensation = 1;
                        minCompensation = baseMin / min;
                      }

                      scale *= compensation;
                      scale = (baseMin + (scale - baseMin) * maxCompensation) * minCompensation;

                      _this194.zoom.setScale(scale, e.centerPoint.x, e.centerPoint.y);
                    }

                    _this194.pinchCloud.scale = e.scale;
                  }
                } else if (e.scale >= FS_IN) {
                  _this194.pinchCloud.block = true;

                  _this194.sendEvent('fullscreenIn');
                }
              }
            }; // eslint-disable-next-line


            this.pinchCloud.onPinchEnd = function (e) {
              // TODO hide zoom if zoom works with this event
              if (_this194.pinchCloud.pinch) {
                _this194.pinchCloud.pinch = false;

                _this194.sendEvent('pinchEnd');
              }

              if (_this194.zoomIsOpened) {
                _this194.pinchCloud.removeEvent();
              }

              _this194.pinchCloud.block = false;
            };
          };

          _proto66.loadContent = function loadContent() {
            this.postInit();
          };

          _proto66.postInit = function postInit() {
            var _this195 = this;

            if (this.postInitState) {
              return;
            }

            this.postInitState = 1;
            this.waitToStart.start();
            getNodeSize(this.instanceNode.node).then(function (size) {
              _this195.currentSize = size; // eslint-disable-next-line
            }).catch(function (error) {
              if (!_this195.destroyed) {
                _this195.calcContainerSize();
              }
            }).finally(function () {
              if (!_this195.destroyed) {
                _this195.postInitState = 2;

                _this195.getImage();
              }
            });
          };

          _proto66.getImageClassContainer = function getImageClassContainer() {
            return this.image;
          } // checkImage(setts, dontLoad) {
          //     let result;
          //     if (dontLoad) {
          //         result = this.image.isExist(setts); // because we do not load images with imageclass
          //     } else {
          //         result = this.image.isLoaded(setts);
          //     }
          //     return result;
          // }
          ;

          _proto66.getImage = function getImage() {
            var _this196 = this;

            var newImageSize = this.getImageSize();
            /*
                we must do round for those values
                 for example without round
                old size is 374
                new size is 470
                470 - 374 = 96
                difference between those sizes is less than 100 and we won't reload for image
                but image was loaded with size 400
                 with round
                374 + round = 400
                470 + round = 500
                 500 - 400 = 100 we must to reload image
            */

            var diff = difference(ResponsiveImage.roundImageSize({
              width: this.currentImageSize.width
            }).width, ResponsiveImage.roundImageSize({
              width: newImageSize.width
            }).width);
            var originSize;
            var dppx;
            var dontLoad = true;
            this.setImageCss = false;

            if (!this._isReady || diff >= this.differenceBetweenSizes || this.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
              // fix for if the viewer was with display none
              if (!this._isReady && !newImageSize.width && !newImageSize.height) {
                setTimeout(function () {
                  _this196.calcContainerSize();

                  _this196.getImage();
                }, 16);
                return;
              }

              if (diff >= this.differenceBetweenSizes || this.fullscreenState === globalVariables.FULLSCREEN.OPENED || !this.currentImageSize.width) {
                this.currentImageSize = newImageSize;
              }

              var opt = this.imageSettings({
                width: this.currentImageSize.realWidth,
                height: this.currentImageSize.realHeight,
                round: true,
                dontLoad: dontLoad
              });

              if ($J.DPPX > 1) {
                originSize = this.image.getOriginSize();

                if (opt.height > opt.width) {
                  dppx = helper.getDPPX(opt.round ? ResponsiveImage.roundImageSize({
                    height: opt.height
                  }).height : opt.height, originSize.height, this.upscale);
                } else {
                  dppx = helper.getDPPX(opt.round ? ResponsiveImage.roundImageSize({
                    width: opt.width
                  }).width : opt.width, originSize.width, this.upscale);
                }

                opt.dppx = dppx;
              }

              opt = this.setHDQuality(opt);

              if (!this.checkImage(opt, dontLoad) || !this._isReady) {
                this.image.getImage(opt);
              } else {
                var img = this.image.getImage(opt);
                this.setImageSrc(img.src, img.srcset, dppx);
              }
            } else if (diff < this.differenceBetweenSizes) {
              this.setImageCss = true;
            }
          };

          _proto66.imageRequest = function imageRequest() {
            this.image.getImage(this.imageSettings({
              width: this.currentImageSize.width,
              height: this.currentImageSize.height
            }));
          };

          _proto66.showImage = function showImage() {
            var _this197 = this;

            if (!this.imageShowPromise) {
              this.imageShowPromise = new Promise(function (resolve, reject) {
                var result = null;
                var _error = null;

                if (_this197.isInView && _this197.isSlideShown) {
                  _this197.imageNode.setCss({
                    opacity: 0,
                    transition: 'opacity .3s linear'
                  });

                  _this197.instanceNode.append(_this197.imageNode);

                  helper.loadImage(_this197.imageNode.node).then(function (imageData) {
                    result = imageData;
                  }).catch(function (error) {
                    _error = error;
                  }).finally(function () {
                    if (!_this197.destroyed) {
                      _this197.imageNode.addEvent('transitionend', function (e) {
                        e.stop();

                        _this197.imageNode.removeEvent('transitionend');

                        _this197.imageNode.setCss({
                          opacity: '',
                          transition: ''
                        });

                        if (result) {
                          _this197.sendContentLoadedEvent();

                          resolve(result);
                        } else {
                          reject(_error);
                        }
                      });

                      _this197.imageNode.getSize();

                      _this197.imageNode.setCssProp('opacity', 1);
                    }
                  });
                } else {
                  _this197.instanceNode.append(_this197.imageNode);

                  helper.loadImage(_this197.imageNode.node).then(function (imageData) {
                    result = imageData;
                  }).catch(function (error) {
                    _error = error;
                  }).finally(function () {
                    if (result) {
                      _this197.sendContentLoadedEvent();

                      resolve(result);
                    } else {
                      reject(_error);
                    }
                  });
                }
              });
            }

            return this.imageShowPromise;
          };

          _proto66.createLoader = function createLoader() {
            this.loader = new RoundLoader(this.instanceNode, {
              'class': 'zoom-loader'
            });
          };

          _proto66.createSirvImage = function createSirvImage() {
            var _this198 = this;

            if (!this.imageUrl) {
              return;
            }

            this.on('imageOnload', function (e) {
              e.stopAll();

              if (e.data.callbackData.lens) {
                if ((_this198.zoom.isShown() || _this198.zoom.isShowing()) && _this198.zoomIsOpened) {
                  _this198.zoom.setImage(e.data);
                }
              } else if (_this198._isReady) {
                if (_this198.imageShowPromise) {
                  _this198.setImageSrc(e.data.src, e.data.srcset, e.data.dppx);
                }
              } else {
                _this198.createImage(e.data.node, e.data.src, e.data.srcset, e.data.dppx);

                _this198.showImage().finally(function () {
                  if (_this198.loader) {
                    _this198.loader.hide();
                  }

                  _this198.done();

                  _this198.sendContentLoadedEvent();
                });
              }
            });
            this.on('imageOnerror', function (e) {
              e.stopAll();

              if (_this198.loader) {
                _this198.loader.hide();
              }

              console.log('image error');
            });
            this.image = new ResponsiveImage(this.imageUrl, {
              imageSettings: this.queryParams,
              referrerPolicy: this.referrerPolicy
            });
            this.image.setParent(this);
            this.getInfo();
          };

          _proto66.getInfoSize = function getInfoSize() {
            var _this199 = this;

            return new Promise(function (resolve, reject) {
              _this199.getInfo().then(function () {
                resolve({
                  size: _this199.infoSize
                });
              }).catch(function (err) {
                reject({
                  error: err,
                  isPlaceholder: err._isplaceholder
                });
              });
            });
          };

          _proto66.getSelectorImgUrl = function getSelectorImgUrl(data) {
            var _this200 = this;

            return new Promise(function (resolve, reject) {
              var defOpt = _this200.imageSettings();

              if (defOpt.src) {
                data.src = defOpt.src;
              }

              data.srcset = defOpt.srcset;

              if (_this200.isInfoLoaded) {
                _this200.waitToStart.wait(function () {
                  resolve($J.extend(_this200.image.getThumbnail(data), {
                    alt: _this200.dataAlt
                  }));
                });
              } else {
                _this200.getInfo().then(function () {
                  _this200.waitToStart.wait(function () {
                    resolve($J.extend(_this200.image.getThumbnail(data), {
                      alt: _this200.dataAlt
                    }));
                  });
                }).catch(reject);
              }
            });
          };

          _proto66.getThumbnailData = function getThumbnailData(opt) {
            return this.image.getThumbnail(opt);
          };

          _proto66.createControls = function createControls() {
            var _this201 = this;

            if (this.insideOptions.controls) {
              this.controls = new ZoomControls(this.instanceNode);
              this.controls.setParent(this);
              this.on('zoomControlsAction', function (e) {
                e.stopAll();

                if (_this201.zoom) {
                  _this201.makeZoom(e.data.type);
                }
              });
            }
          };

          _proto66.changeControlsState = function changeControlsState(zoom
          /* from 0 to 1 */
          ) {
            if (this.controls) {
              if (zoom === 1 || zoom === 0) {
                if (zoom === 1) {
                  this.controls.disable('in');
                } else {
                  this.controls.disable('out');
                }
              } else {
                this.controls.disable();
              }
            }
          };

          _proto66.createZoom = function createZoom(options) {
            var result = null;

            if (!this.destroyed) {
              var lensContainer = this.zoomContainer;
              result = _Zoominstance2.prototype.createZoom.call(this, this.instanceNode, options);

              if (this.option('mode') === 'magnifier') {
                lensContainer = getContainerForZoom(this.instanceNode);
              } else if (!$J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.fullscreenState)) {
                if (result.type === 'outside') {
                  lensContainer = getContainerForZoom(this.instanceNode); // because container of viewer can be overflow hidden

                  lensContainer = $J.D.node.body;
                }
              }

              if (lensContainer) {
                this.zoom.setLensContainer(lensContainer);
              }
            }

            return result;
          };

          _proto66.zoomIn = function zoomIn() {
            var result = false;

            if (this._isReady && this.zoom) {
              if (this.option('fullscreenOnly') && this.fullscreenState === globalVariables.FULLSCREEN.CLOSED) {
                this.sendEvent('fullscreenIn');
              } else {
                result = this.makeZoom('zoomin');
              }
            }

            return result;
          };

          _proto66.zoomOut = function zoomOut(force) {
            var result = false;

            if (this._isReady && this.zoom) {
              if (force) {
                if (this.zoomIsOpened) {
                  result = this.zoom.hide(!this.zoom.getZoomData());
                }
              } else {
                result = this.makeZoom('zoomout');
              }
            }

            return result;
          };

          _proto66.getOriginImageUrl = function getOriginImageUrl() {
            if (this._isReady) {
              return this.image.getOriginImageUrl();
            }

            return null;
          };

          _proto66.isZoomSizeExist = function isZoomSizeExist() {
            var result = false;

            if (this._isReady) {
              var minZoomFactor = 100; // like in deep zoom level calculation

              var cs = this.currentImageSize;
              var zoomSize = this.getZoomImageSize();

              if (zoomSize.originWidth - cs.realWidth >= minZoomFactor && (this.option('ratio') === 'max' || this.option('ratio') >= globalVariables.MIN_RATIO)) {
                result = true;
              }
            }

            return result;
          };

          _proto66.onResize = function onResize() {
            var result = false;

            if (this.destroyed) {
              return;
            }

            if (this.isStarted && this.postInitState === 2) {
              this.calcContainerSize();
              this.getImage();

              if (this.hotspots) {
                if (this.hotspotsTurnedOn && $J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.OPENING], this.fullscreenState) || this.insideOptions.trigger !== 'hover' && $J.contains([globalVariables.FULLSCREEN.OPENED, globalVariables.FULLSCREEN.CLOSING], this.fullscreenState)) {
                  this.hotspots.setContainerSize(this.imageNode.node.getBoundingClientRect());

                  if (this.isInView && this.isSlideShown) {
                    this.hotspots.showNeededElements();
                  }
                }
              }

              if (this.imageNode) {
                this.setImageWidthHeight();

                if (this.isZoomSizeExist()) {
                  this.imageNode.addClass(globalVariables.CSS_CURSOR_ZOOM_IN);
                } else {
                  if (this.hint) {
                    this.hint.hide();
                  }

                  this.imageNode.removeClass(globalVariables.CSS_CURSOR_ZOOM_IN);
                }
              }

              result = true;
            }

            if (this.controls) {
              if (this.isZoomSizeExist()) {
                this.controls.show();
              } else {
                this.controls.hide();
              }
            }

            this.replaceZoom();

            if (this.zoom) {
              this.zoom.onResize();
            }

            return result;
          };

          _proto66.onScroll = function onScroll(e) {
            if (this.zoomIsOpened) {
              e.stop();
            }

            clearTimeout(this.longTapTimer);
            this.scrollDebounce();
          };

          _proto66.getType = function getType() {
            return this.type;
          };

          _proto66.destroy = function destroy() {
            this.destroyed = true;

            if (this.loader) {
              this.loader.destroy();
              this.loader = null;
            }

            $($J.W).removeEvent('scroll', this.onScrollHandler);
            this.onScrollHandler = null;

            if (this.lastTriggerAction) {
              this.lastTriggerAction();
              this.lastTriggerAction = null;
            }

            if (this.hint) {
              this.hint.destroy();
              this.hint = null;
            }

            if (this.image) {
              this.off('imageOnload');
              this.off('imageOnerror');
              this.image.destroy();
              this.image = null;
            }

            if (this.controls) {
              this.controls.destroy();
              this.controls = null;
              this.off('zoomControlsAction');
            }

            if (this.hotspots) {
              this.hotspotsTurnedOn = false;
              this.instanceNode.removeEvent('tap');
            }

            if (this.zoom) {
              this.off('zooming');
              this.off('zoomUp');
              this.off('zoomDown');
            }

            this.instanceNode.clearEvents();
            this.instanceNode.removeClass(P + '-zoom-view');

            if (this.imageNode) {
              this.imageNode.remove();
              this.imageNode = null;
            }

            if (this.clonedImage) {
              this.clonedImage = null;
            }

            this.zoomDebounce.cancel();
            this.zoomDebounce = null;
            this.scrollDebounce.cancel();
            this.scrollDebounce = null;
            clearTimeout(this.longTapTimer);
            this.longTapTimer = null;
            this.hotspotsData = null;

            _Zoominstance2.prototype.destroy.call(this);

            return true;
          };

          return Zoom_;
        }(Zoominstance);

        return Zoom_;
      }();

      return Zoom;
    });
    Sirv.define('defaultsVideoOptions',
    /* eslint-env es6 */
    {
      autoplay: {
        type: 'boolean',
        defaults: false
      },
      // sirvvideo, video, youtube, vimeo
      loop: {
        type: 'boolean',
        defaults: false
      },
      // sirvvideo, video, youtube, vimeo
      volume: {
        type: 'number',
        minimum: 0,
        maximum: 100,
        defaults: 100
      },
      // sirvvideo, video, youtube
      // youtube does not have preload option
      // https://developers.google.com/youtube/iframe_api_reference
      // vimeo does not have preload option
      // https://developer.vimeo.com/player/sdk/embed
      preload: {
        type: 'boolean',
        defaults: true
      },
      // sirvvideo, video
      thumbnail: {
        oneOf: [{
          type: 'url'
        }, {
          type: 'boolean',
          'enum': [false]
        }, {
          type: 'number',
          minimum: 0
        }],
        defaults: false
      },
      // 1 = little motion
      // 2 = moderate motion
      // 3 = more motion
      // 4 = high motion
      motionFactor: {
        type: 'number',
        minimum: 1,
        maximum: 4,
        defaults: 3
      },
      dynamicAdaptiveStreaming: {
        type: 'boolean',
        defaults: true
      },
      // just for videojs
      quality: {
        // quality.min
        min: {
          type: 'number',
          'enum': [360, 480, 720, 1080],
          defaults: 360
        },
        // quality.max
        max: {
          type: 'number',
          'enum': [360, 480, 720, 1080],
          defaults: 1080
        }
      },
      controls: {
        enable: {
          type: 'boolean',
          defaults: true
        },
        // sirvvideo, video, youtube
        // Volume control
        volume: {
          type: 'boolean',
          defaults: true
        },
        // sirvvideo
        // Playback rate control
        speed: {
          type: 'boolean',
          defaults: false
        },
        // sirvvideo
        // Quality (resolutions) control
        quality: {
          type: 'boolean',
          defaults: false
        },
        // sirvvideo
        // controls.fullscreen. hidden option
        fullscreen: {
          type: 'boolean',
          defaults: true
        } // sirvvideo

      }
    });
    Sirv.define('Video', ['require', 'module', 'bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'helper', 'Promise!', 'EventEmitter', 'Instance', 'defaultsVideoOptions'], function (sirvRequire, sirvModule, bHelpers, magicJS, globalVariables, globalFunctions, helper, Promise, EventEmitter, Instance, defaultsVideoOptions) {
      var moduleName = 'Video';
      var $J = magicJS;
      var $ = $J.$; // see 'src/modules/defaultsVideoOptions/8.core.js' file

      /* global $, $J */

      /* global helper */

      /* global videojs */

      /* global Instance */

      /* global sirvRequire */

      /* global sirvModule */

      /* global globalVariables */

      /* global defaultsVideoOptions */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint-env es6 */

      /*
          videojs-brand
      */
      // eslint-disable-next-line no-unused-vars

      var Video = function () {
        var P = globalVariables.smv; // Video playback rates (speed)

        var PLAYBACK_RATES = [0.5, 1, 1.5, 2];
        var DISABLE_CLASS = P + '-disabled-action';
        var HOST = 'https://video.sirv.com';
        var INFO = 'sirv_video_info_';
        var QUALITY_CONTROL = P + '-q-last';
        var SPEED_CONTROL = P + '-s-last';
        var NEW_IMAGE_FACTOR = 50 * $J.DPPX;
        var ACTIONS = {
          NONE: 0,
          PLAY: 1,
          PLAY_SREEN_IN: 2,
          PLAY_BY_USER: 3,
          PLAY_BY_SWITCHING: 4,
          PAUSE: 5,
          PAUSE_BY_SWITCHING: 6
        };
        var cssID = 'sirv-stylesheet-vjs';

        var loadCSS = function (rootNode) {
          // return globalFunctions.rootDOM.addStyle(rootNode, sirvModule.config().libcss, cssID, '#' + globalFunctions.rootDOM.mainCSSID);
          return globalFunctions.rootDOM.addStyle(rootNode, sirvModule.config().libcss, cssID); // videojs css must be added before sirv.css
        };

        var loadVideoJS = function () {
          return new Promise(function (resolve) {
            sirvRequire([sirvModule.config().libjs], resolve);
          });
        };

        var loadQualitySelectorCSS = function (rootNode) {
          return globalFunctions.rootDOM.addStyle(rootNode, sirvModule.config().qualitySelectorcss, 'sirv-stylesheet-vjs-quality-selector', '#' + globalFunctions.rootDOM.mainCSSID);
        };

        var loadQualitySelector = function () {
          return new Promise(function (resolve) {
            sirvRequire([sirvModule.config().qualitySelectorjs], resolve);
          });
        };

        var getVideoType = function (src) {
          src = src || '';
          src = src.split('?')[0];
          src = src.split('.');
          src = src[src.length - 1];
          src = src.toLowerCase();

          switch (src) {
            case '3gp':
              src = 'video/3gpp'; // src = 'video/3gpp; codecs="mp4v.20.8, samr"';

              break;

            case 'flv':
              src = 'video/flv'; // src = 'video/flv; codecs="flv"';

              break;

            case 'mp4':
              src = 'video/mp4'; // src = 'video/mp4; codecs="avc1.42E01E, mp4a.40.2"';

              break;

            case 'ogv':
              src = 'video/ogg'; // src = 'video/ogg; codecs="theora, vorbis"';

              break;

            case 'webm':
              src = 'video/webm'; // src = 'video/webm; codecs="vp8, vorbis"';

              break;

            default:
              src = '';
          }

          return src;
        };

        var calcBandwidth = function (hls, fps, motionFactor) {
          // return hls.width * hls.height * 24 / 8;
          // https://www.miracletutorials.com/bitrate-hls-video/
          // width * height * fps * motion_factor * 0.07
          // 1 = little motion
          // 2 = moderate motion
          // 3 = more motion
          // 4 = high motion
          return parseInt(hls.width * hls.height * fps * motionFactor * 0.07, 10);
        };

        var VideoInstance = /*#__PURE__*/function (_Instance2) {
          "use strict";

          bHelpers.inheritsLoose(VideoInstance, _Instance2);

          function VideoInstance(node, options) {
            var _this202;

            _this202 = _Instance2.call(this, node, options, defaultsVideoOptions) || this;
            _this202.type = globalVariables.SLIDE.TYPES.VIDEO;
            _this202.url = _this202.instanceNode.attr('data-src');
            _this202.info = null;
            _this202.HLS = [];
            _this202.currentSize = {
              width: 0,
              height: 0
            };
            _this202.videoNode = null;
            _this202.areSourcesAdded = false;
            _this202.indexOfCurrentHls = 0;
            _this202.player = null;
            _this202.thumbnail = _this202.option('thumbnail');
            _this202.currentTime = 0;
            _this202.isVideoPaused = false;
            _this202.fps = 30;
            _this202.pluginResizeDebounce = null;
            _this202.playPromise = null;
            _this202.posterSize = null;
            _this202.lastAction = ACTIONS.NONE;
            _this202.isPlayed = false;
            _this202.isEnded = false; // because sometimes when we call this.player.start() and the video is not loaded yet the videojs throw error when we call this.player.pause()

            _this202.playingState = globalVariables.VIDEO.NONE;
            _this202.nativeFullscreen = options.nativeFullscreen;
            var baseUrl = globalFunctions.normalizeURL(_this202.url.replace(globalVariables.REG_URL_QUERY_STRING, '$1'));

            var params = _this202.url.replace(globalVariables.REG_URL_QUERY_STRING, '$2');

            _this202.url = baseUrl;

            if (params) {
              _this202.url += '?' + params;
            }

            _this202.disableAction();

            _this202.isLoadeddata = false;
            _this202.controlsFullscreen = _this202.option('controls.fullscreen'); // this.api = $J.extend(this.api, {
            //     isReady: this.isReady.bind(this), // parent class
            //     resize: this.resize.bind(this), // parent class
            //     getOptions: this.getOptions.bind(this) // parent class
            // });

            _this202.getInfo(); // for shadow dom we must add it after the element will be in dom to detect where the viewer is started
            // this.addSources();


            return _this202;
          }

          var _proto67 = VideoInstance.prototype;

          _proto67.normalizeOptions = function normalizeOptions() {
            var min = this.option('quality.min');
            var max = this.option('quality.max');

            if (min > max) {
              this.option('quality.max', min);
            }
          } // eslint-disable-next-line class-methods-use-this
          ;

          _proto67.getOriginImageUrl = function getOriginImageUrl() {
            return null;
          };

          _proto67.getSelectorImgUrl = function getSelectorImgUrl(data) {
            var _this203 = this;

            return new Promise(function (resolve, reject) {
              var size = data.width || data.height;
              var thumbnailPosterSelector = _this203.url.split('?')[0] + '?thumbnail=' + size;

              if ($J.DPPX > 1) {
                thumbnailPosterSelector = _this203.url.split('?')[0] + '?thumbnail=' + size * $J.DPPX + '&quality=60';
              }

              if (_this203.thumbnail) {
                if (!isNaN(parseFloat(_this203.thumbnail))) {
                  thumbnailPosterSelector = _this203.getThumbnailPoster(thumbnailPosterSelector);
                } else {
                  thumbnailPosterSelector = _this203.thumbnail;
                }
              }

              var obj = {
                src: thumbnailPosterSelector,
                callbackData: data.callbackData
              };

              if ($J.DPPX > 1) {
                obj.srcset = thumbnailPosterSelector;
              }

              _this203.getInfo().then(function () {
                // this.waitToStart.wait(() => {
                resolve(obj); // });
              }).catch(reject);
            });
          };

          _proto67.disableAction = function disableAction() {
            if (this.always && $J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.CLOSING], this.fullscreenState)) {
              this.instanceNode.addClass(DISABLE_CLASS);
            }
          };

          _proto67.enableAction = function enableAction() {
            if (this.always) {
              this.instanceNode.removeClass(DISABLE_CLASS);
            }
          };

          _proto67.getInfo = function getInfo() {
            var _this204 = this;

            if (!this.gettingInfoPromise) {
              this.gettingInfoPromise = new Promise(function (resolve, reject) {
                _this204.waitGettingInfo.wait(function () {
                  var url = _this204.url;
                  var hash = $J.getHashCode(_this204.url.split('?')[0].replace(/^http(s)?:\/\//, ''));

                  if (/\?/.test(url)) {
                    url += '&';
                  } else {
                    url += '?';
                  } // url += ('nometa&info=' + INFO + hash + '_main');
                  // we need meta because we need fps


                  url += 'info=' + INFO + hash + '_main';
                  helper.getRemoteData(url, 'video_info_' + helper.generateUUID(), _this204.referrerPolicy).then(function (data) {
                    if (!_this204.destroyed) {
                      _this204.info = data;

                      if (_this204.info.QuickTime && _this204.info.QuickTime.VideoFrameRate) {
                        _this204.fps = _this204.info.QuickTime.VideoFrameRate;
                      }

                      _this204.HLS = _this204.info.original.HLS || [];

                      if (_this204.HLS.length > 1) {
                        _this204.HLS.sort(function (a, b) {
                          var result = 0;

                          if (a.width < b.width) {
                            result = -1;
                          } else if (a.width > b.width) {
                            result = 1;
                          } else if (a.height < b.height) {
                            result = -1;
                          } else if (a.height > b.height) {
                            result = 1;
                          }

                          return result;
                        });
                      }

                      _this204.infoSize = {
                        width: _this204.info.original.width,
                        height: _this204.info.original.height
                      };
                      resolve(_this204.infoSize);
                    }
                  }).catch(function (err) {
                    if (!_this204.destroyed) {
                      reject(err);
                    }
                  });
                });
              });
            }

            return this.gettingInfoPromise;
          };

          _proto67.getInfoSize = function getInfoSize() {
            var _this205 = this;

            return new Promise(function (resolve, reject) {
              _this205.getInfo().then(function () {
                resolve({
                  size: _this205.infoSize
                });
              }).catch(function (err) {
                reject({
                  error: err
                });
              });
            });
          };

          _proto67.addSources = function addSources() {
            var _this206 = this;

            var nodeWithSirvClassName = globalFunctions.getNodeWithSirvClassName(this.instanceNode) || $J.D.node.head || $J.D.node.body;
            Promise.all([loadCSS($J.D.node.head || $J.D.node.body), loadCSS(nodeWithSirvClassName), loadVideoJS(), loadQualitySelectorCSS(nodeWithSirvClassName), loadQualitySelector()]).finally(function () {
              _this206.areSourcesAdded = true;

              if (_this206.isStarted) {
                if (_this206.isInView && (_this206.preload || _this206.isSlideShown)) {
                  _this206.createVideoNode();
                }
              }
            });
          };

          _proto67.onStartActions = function onStartActions(who) {
            if (this._isReady) {
              if (this.player) {
                if (this.isInView) {
                  if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED && this.always && this.option('controls.enable')) {
                    this.player.controlBar.show();
                    this.player.bigPlayButton.show();
                  }

                  if (this.option('autoplay') && this.player.paused() && (this.fullscreenState === globalVariables.FULLSCREEN.OPENED || !this.always)) {
                    this.player.muted(true);

                    if (this.isPlayed) {
                      this.lastAction = ACTIONS.PLAY_BY_SWITCHING;
                    } else if (who === globalVariables.SLIDE_SHOWN_BY.USER) {
                      this.lastAction = ACTIONS.PLAY;
                    }

                    this.play();
                  }
                }
              }
            } else if (this.isStarted) {
              if (this.isInView && this.isSlideShown && !this.preload && this.areSourcesAdded) {
                this.createVideoNode();
              }
            }
          };

          _proto67.onStopActions = function onStopActions() {
            if (this.player) {
              if (!this.player.paused() && this.playingState === globalVariables.VIDEO.PLAYING) {
                this.lastAction = ACTIONS.PAUSE_BY_SWITCHING;
                this.pause();
              }
            }
          };

          _proto67.onInView = function onInView(value) {
            if (value) {
              if (this._isReady) {
                if (this.player) {
                  if (this.isSlideShown && value) {
                    if (this.option('autoplay') || this.playingState !== globalVariables.VIDEO.NONE && !this.isVideoPaused) {
                      this.lastAction = ACTIONS.PLAY_SREEN_IN;
                      this.play();
                    }
                  }
                }
              } else if (this.isStarted) {
                if (!this.isInView && (this.preload || this.isSlideShown) && this.areSourcesAdded) {
                  this.isInView = true;
                  this.createVideoNode();
                }
              }
            } else if (this.player) {
              this.isVideoPaused = this.playingState === globalVariables.VIDEO.PAUSE;

              if (!this.player.paused() && this.playingState === globalVariables.VIDEO.PLAYING) {
                this.lastAction = ACTIONS.PAUSE;
                this.pause();
              }
            }
          };

          _proto67.startFullInit = function startFullInit(options) {
            if (this.isStartedFullInit) {
              return;
            }

            _Instance2.prototype.startFullInit.call(this, options);

            this.normalizeOptions();
            this.thumbnail = this.option('thumbnail');
            this.getId('video-');
            this.instanceNode.addClass('sirv-video');
            this.instanceNode.addEvent('mousedown', function (e) {
              e.stop();
            });
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto67.onBeforeFullscreenIn = function onBeforeFullscreenIn(data) {
            this.controlsFullscreen = false;

            if (this.player) {
              this.isVideoPaused = this.playingState === globalVariables.VIDEO.PAUSE; // if (!this.player.paused() && this.playingState === globalVariables.VIDEO.PLAYING) {
              //     this.currentTime = this.player.currentTime();
              //     this.pause();
              // }

              this.toggleFullscreenButton();
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto67.onAfterFullscreenIn = function onAfterFullscreenIn(data) {
            this.enableAction();

            if (this.isSlideShown && this.isInView && this.player) {
              if (this.player.paused()) {
                if (this.always) {
                  if (this.option('controls.enable')) {
                    this.player.controlBar.show();
                    this.player.bigPlayButton.show();
                  }
                } // if (this.option('autoplay') || this.playingState !== globalVariables.VIDEO.NONE && !this.isVideoPaused) {
                // if ((this.option('autoplay') || this.playingState !== globalVariables.VIDEO.NONE) && !this.isVideoPaused) {


                if (this.option('autoplay') && !this.isVideoPaused) {
                  this.player.currentTime(this.currentTime);
                  this.playingState = globalVariables.VIDEO.PLAY; // from v 7.2.3; The method 'play_' fix bug with chenching container

                  this.player.play_();
                }
              }
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto67.onBeforeFullscreenOut = function onBeforeFullscreenOut(data) {
            this.disableAction();

            if (this.option('controls.fullscreen')) {
              this.controlsFullscreen = true;
            }

            if (this.player) {
              this.isVideoPaused = this.playingState === globalVariables.VIDEO.PAUSE; // if (!this.player.paused() && this.playingState === globalVariables.VIDEO.PLAYING) {
              //     this.currentTime = this.player.currentTime();
              //     this.pause();
              // }

              this.toggleFullscreenButton();
            }
          } // eslint-disable-next-line no-unused-vars
          ;

          _proto67.onAfterFullscreenOut = function onAfterFullscreenOut(data) {
            if (this.isSlideShown && this.isInView) {
              if (this.player) {
                if (this.always && this.option('controls.enable')) {
                  this.player.controlBar.hide();
                  this.player.bigPlayButton.hide();
                } // if (this.option('autoplay') || this.playingState !== globalVariables.VIDEO.NONE && !this.isVideoPaused) {
                // if ((this.option('autoplay') || this.playingState !== globalVariables.VIDEO.NONE) && !this.isVideoPaused) {


                if (this.option('autoplay') && !this.isVideoPaused) {
                  // this.player.currentTime(this.currentTime);
                  this.lastAction = ACTIONS.PLAY;
                  this.play();
                }
              }
            }
          };

          _proto67.onSecondSelectorClick = function onSecondSelectorClick() {
            if (this.player) {
              if (this.isSlideShown && this.isInView) {
                if (this.fullscreenState === globalVariables.FULLSCREEN.OPENED || !this.always) {
                  if (this.player.paused()) {
                    this.lastAction = ACTIONS.PLAY;
                    this.play();
                  } else if (this.playingState === globalVariables.VIDEO.PLAYING && this.isLoadeddata) {
                    this.pause();
                  }
                }
              }
            }
          };

          _proto67.createVideoNode = function createVideoNode() {
            if (!this.videoNode) {
              this.videoNode = $J.$new('video', {
                'class': P + '-sirv-video',
                preload: 'none'
              });
              this.videoNode.addClass('video-js');
              this.instanceNode.append(this.videoNode);
              this.waitToStart.start();
              this.done();
            }
          };

          _proto67.play = function play() {
            if (this.player && !this.playPromise) {
              this.playingState = globalVariables.VIDEO.PLAY;
              this.playPromise = this.player.play();
            }
          };

          _proto67.pause = function pause() {
            var _this207 = this;

            if (this.player) {
              // videojs play promise does not have 'finally' method for ie11
              // we have launch videojs player without promise because we have bug with standard play method when we are changing videojs player's time
              (this.playPromise || new Promise(function (resolve) {
                return resolve(null);
              })).then(function () {
                _this207.player.pause();

                _this207.playPromise = null;
              }).catch(function () {
                _this207.player.pause();

                _this207.playPromise = null;
              });
            }
          };

          _proto67.loadContent = function loadContent() {
            this.createVideoNode();
          };

          _proto67.run = function run(isShown, preload, firstSlideAhead) {
            var result = _Instance2.prototype.run.call(this, isShown, preload, firstSlideAhead);

            if (result) {
              this.calcContainerSize();

              if (this.isInView && (this.preload || this.isSlideShown) && this.areSourcesAdded) {
                this.createVideoNode();
              }

              this.startGettingInfo();
            }

            return result;
          };

          _proto67.createMasterManifest = function createMasterManifest() {
            var _this208 = this;

            var result = ['#EXTM3U'];
            var mf = this.option('motionFactor');
            var das = this.option('dynamicAdaptiveStreaming');
            this.HLS.forEach(function (HLS) {
              var str = '#EXT-X-STREAM-INF:PROGRAM-ID=1,';

              if (das) {
                str += 'BANDWIDTH=' + calcBandwidth(HLS, _this208.fps, mf) + ',';
              }

              str += 'RESOLUTION=' + HLS.width + 'x' + HLS.height;
              result.push(str);
              result.push(HOST + HLS.index);
            });
            return result.join('\n');
          };

          _proto67.toggleFullscreenButton = function toggleFullscreenButton() {
            var ft = this.player.controlBar.getChild('FullscreenToggle');
            var ua = this.player.options_.userActions;

            if (this.controlsFullscreen) {
              ua.doubleClick = true;
              ft.show();
            } else {
              ua.doubleClick = false;
              ft.hide();
            }
          };

          _proto67.isHLS = function isHLS() {
            return this.HLS.length > 0 && $J.browser.uaName !== 'ie';
          };

          _proto67.getThumbnailSize = function getThumbnailSize() {
            var maxSize = this.isHLS() ? this.HLS[this.HLS.length - 1].height : this.info.height || this.info.original.height || 140;
            var size = maxSize;

            if (this.currentSize.height < size) {
              size = this.currentSize.height;
            }

            size *= $J.DPPX;

            if (size > maxSize) {
              size = maxSize;
            }

            return size;
          };

          _proto67.getPosterUrl = function getPosterUrl() {
            return this.getThumbnailPoster(this.url.split('?')[0] + '?thumbnail=' + this.posterSize);
          };

          _proto67.done = function done() {
            var _this209 = this;

            if (!this._isReady) {
              this.posterSize = this.getThumbnailSize();
              var posterImage = this.getPosterUrl(); // Position volume control verically, if it's enabled.

              var volumeControl = {
                inline: false
              };

              if (this.option('controls.volume') === false) {
                volumeControl = false;
              }

              var html5Options = {
                nativeTextTracks: false,
                nativeAudioTracks: false,
                nativeVideoTracks: false
              };
              var isHSL = this.isHLS();
              var vhsOptions = {
                overrideNative: isHSL && $J.browser.uaName !== 'safari'
              };
              html5Options.smoothQualityChange = true;
              html5Options.vhs = vhsOptions;
              var videoOptions = {
                controls: this.option('controls.enable'),
                fluid: false,
                muted: this.option('volume') === 0 || this.option('autoplay'),
                loop: this.option('loop'),
                autoplay: this.option('autoplay') && this.isSlideShown,
                preload: this.option('autoplay') || this.option('preload') ? 'auto' : 'none',
                textTrackSettings: false,
                controlBar: {
                  fullscreenToggle: true,
                  // we will toggle it by itself
                  volumePanel: volumeControl,
                  muteToggle: false,
                  children: ['playToggle', 'currentTimeDisplay', 'timeDivider', 'durationDisplay', 'progressControl', 'liveDisplay', 'remainingTimeDisplay', 'volumePanel', 'customControlSpacer', 'playbackRateMenuButton', 'chaptersButton', 'descriptionsButton', 'subsCapsButton', 'audioTrackButton', 'fullscreenToggle']
                },
                poster: posterImage,
                playsinline: true,
                html5: html5Options,
                userActions: {
                  doubleClick: true
                },
                qualityLevels: {} // errorDisplay: false // it does not work

              };

              if (this.option('controls.quality')) {
                this.instanceNode.addClass(QUALITY_CONTROL);
              } else if (this.option('controls.speed')) {
                this.instanceNode.addClass(SPEED_CONTROL);
              }

              if (this.option('controls.speed')) {
                videoOptions.playbackRates = PLAYBACK_RATES;
              }

              if (isHSL) {
                this.player = $J.W.node.videojs(this.videoNode.node, videoOptions);

                if ($J.browser.uaName !== 'safari') {
                  this.player.src({
                    src: 'data:application/x-mpegURL;base64,' + window.btoa(this.createMasterManifest()),
                    type: 'application/x-mpegURL'
                  });
                }

                this.player.hlsQualitySelectorAutoMode({
                  visibility: this.option('controls.quality'),
                  hls: this.HLS,
                  host: HOST,
                  max: this.option('quality.max'),
                  min: this.option('quality.min')
                });
                this.pluginResizeDebounce = helper.debounce(function () {
                  _this209.player.hlsQualitySelectorAutoMode.recalc();
                }, 600);
              } else {
                videoOptions.src = this.url;
                var vType = getVideoType(this.url);
                this.videoNode.append($J.$new('source', {
                  src: this.url,
                  type: vType
                }));
                this.player = videojs(this.videoNode.node, videoOptions);
              }

              this.player.volume(parseInt(this.option('volume'), 10) / 100);
              this.toggleFullscreenButton();
              this.player.on('loadeddata', function () {
                _this209.isLoadeddata = true;
              });
              this.player.on('play', function () {
                _this209.isVideoPaused = false; // const isPaused = this.playingState !== globalVariables.VIDEO.NONE;

                _this209.playingState = globalVariables.VIDEO.PLAYING;

                if (!_this209.isSlideShown || !_this209.isInView) {
                  _this209.lastAction = ACTIONS.PAUSE;

                  _this209.pause();
                } else {
                  var reason = 'user';

                  if (_this209.lastAction === ACTIONS.PLAY_SREEN_IN) {
                    reason = 'viewport';
                  } else if (_this209.lastAction === ACTIONS.PLAY) {
                    reason = 'autoplay';
                  } else if (_this209.lastAction === ACTIONS.PLAY_BY_SWITCHING) {
                    reason = 'itemchange';
                  }

                  _this209.lastAction = ACTIONS.NONE;

                  if (_this209.isPlayed) {
                    _this209.sendEvent('resume', {
                      event: {
                        reason: reason,
                        playbackTime: _this209.player.currentTime()
                      }
                    });
                  } else {
                    _this209.isPlayed = true;

                    _this209.sendEvent('play', {
                      event: {
                        reason: reason
                      }
                    });
                  }
                }
              });
              this.player.on('pause', function () {
                if (_this209.player.currentTime() === _this209.player.duration()) {
                  return;
                }

                _this209.playingState = globalVariables.VIDEO.PAUSE;
                var reason = 'user';

                if (_this209.lastAction === ACTIONS.PAUSE) {
                  reason = 'viewport';
                } else if (_this209.lastAction === ACTIONS.PAUSE_BY_SWITCHING) {
                  reason = 'itemchange';
                }

                _this209.lastAction = ACTIONS.NONE;

                _this209.sendEvent('pause', {
                  event: {
                    reason: reason,
                    playbackTime: _this209.player.currentTime()
                  }
                });
              });
              this.player.on('ended', function () {
                _this209.isPlayed = false;
                _this209.isEnded = true;
                _this209.playingState = globalVariables.VIDEO.PAUSE;

                _this209.sendEvent('end');
              });
              this.player.on('fullscreenchange', function () {
                var eventName = 'fullscreenOut';

                if (_this209.player.isFullscreen()) {
                  eventName = 'fullscreenIn';
                }

                _this209.sendEvent(eventName, {
                  event: {
                    playbackTime: _this209.player.currentTime()
                  }
                });
              });
              var videoSeekStart = null;
              var previousTime = 0;
              var currentTime = 0;
              this.player.on('timeupdate', function () {
                previousTime = currentTime;
                currentTime = _this209.player.currentTime();
              });
              this.player.on('seeking', function () {
                if (videoSeekStart === null) {
                  videoSeekStart = previousTime;
                }
              });
              this.player.on('seeked', function () {
                if (_this209.isEnded) {
                  _this209.isEnded = false;
                } else {
                  _this209.sendEvent('seek', {
                    event: {
                      seekStart: videoSeekStart,
                      seekEnd: _this209.player.currentTime()
                    }
                  });
                }

                videoSeekStart = null;
              });
              this.player.on('error', function (event) {
                // eslint-disable-next-line no-console
                console.log('error', event);
              });

              if ($J.browser.touchScreen && $J.browser.mobile) {
                this.player.on('touchstart', function (e) {
                  if ($J.$(e.target).getTagName() === 'video' && _this209.player.hasClass('vjs-user-active')) {
                    if (_this209.player.paused()) {
                      _this209.lastAction = ACTIONS.PLAY;

                      _this209.play();
                    } else {
                      _this209.pause();
                    }
                  }
                });
              }

              this.player.on('ready', function () {
                // This hack disables fullscreen on double-click without visual glitch.
                // TODO: Use more proper way to disable fullscreen on double-click.
                if (!_this209.option('controls.fullscreen')) {
                  _this209.player.off(_this209.player.tech_, 'dblclick', _this209.player.handleTechDoubleClick_);
                }

                if (_this209.option('controls.enable') && _this209.fullscreenState !== globalVariables.FULLSCREEN.OPENED && _this209.always) {
                  _this209.player.controlBar.hide();

                  _this209.player.bigPlayButton.hide();
                }

                if (_this209.isSlideShown && _this209.isInView && _this209.option('autoplay')) {
                  if (_this209.fullscreenState === globalVariables.FULLSCREEN.OPENED || !_this209.always) {
                    _this209.player.muted(true);

                    _this209.lastAction = ACTIONS.PLAY;

                    _this209.play();

                    _this209.player.muted(true);
                  }
                }

                _Instance2.prototype.done.call(_this209);

                _this209.sendContentLoadedEvent();
              });
            }
          };

          _proto67.getThumbnailPoster = function getThumbnailPoster(basePoster) {
            var result = basePoster;

            if (!result) {
              result = '';
            }

            if (this.thumbnail || this.thumbnail === 0) {
              var prefix = '&video.thumbPos=';
              var floatValueThumbnail = parseFloat(this.thumbnail);

              if (!isNaN(floatValueThumbnail) && floatValueThumbnail < this.info.original.duration) {
                result += prefix + this.thumbnail; // eslint-disable-next-line
              } else if (/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/i.test(this.thumbnail)) {
                result = this.thumbnail;
              }
            }

            return result;
          };

          _proto67.calcContainerSize = function calcContainerSize() {
            var size = this.instanceNode.getSize();

            if (!size.height || !size.width) {
              var originSize = {
                width: 0,
                height: 0
              };
              originSize.width = this.info.original.width;
              originSize.height = this.info.original.height;

              if (!size.height) {
                this.currentSize.width = size.width;
                this.currentSize.height = originSize.height / originSize.width * size.width;
              } else {
                this.currentSize.height = size.height;
                this.currentSize.width = originSize.width / originSize.height * size.height;
              }
            } else {
              this.currentSize = size;
            }
          };

          _proto67.createPinchEvent = function createPinchEvent() {
            var _this210 = this;

            // difference between scale
            var FS_OUT = -0.08;
            var FS_IN = 0.11;

            _Instance2.prototype.createPinchEvent.call(this, this.instanceNode);

            this.pinchCloud.onPinchStart = function (e) {
              if ($J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.CLOSING], _this210.fullscreenState)) {
                return;
              }

              _this210.pinchCloud.pinch = true;
              _this210.pinchCloud.scale = e.scale;

              _this210.sendEvent('pinchStart');
            };

            this.pinchCloud.onPinchMove = function (e) {
              if (_this210.pinchCloud.pinch && !_this210.pinchCloud.block) {
                var s = e.scale - _this210.pinchCloud.scale;

                if (_this210.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                  if (s < FS_OUT) {
                    _this210.pinchCloud.block = true;

                    _this210.sendEvent('fullscreenOut');
                  }
                } else if (e.scale >= FS_IN) {
                  _this210.pinchCloud.block = true;

                  _this210.sendEvent('fullscreenIn');
                }
              }
            };
          };

          _proto67.onResize = function onResize() {
            if (this.player) {
              if (!this.isSlideShown || !this.isInView) {
                if (!this.player.paused() && this.playingState === globalVariables.VIDEO.PLAYING) {
                  this.pause();
                }
              }

              if (this.pluginResizeDebounce) {
                this.pluginResizeDebounce();
              }

              if (this.playingState === globalVariables.VIDEO.NONE) {
                this.calcContainerSize();
                var newSize = this.getThumbnailSize();

                if (newSize > this.posterSize && newSize - this.posterSize >= NEW_IMAGE_FACTOR) {
                  this.posterSize = newSize;
                  this.player.poster(this.getPosterUrl());
                }
              }

              return true;
            }

            return false;
          };

          _proto67.getType = function getType() {
            return this.type;
          };

          _proto67.destroy = function destroy() {
            if (this.player) {
              this.player.off();
              this.player.dispose();
              this.player = null;
            }

            if (this.videoNode) {
              this.videoNode.remove();
              this.videoNode = null;
            }

            if (this.pluginResizeDebounce) {
              this.pluginResizeDebounce.cancel();
              this.pluginResizeDebounce = null;
            }

            this.instanceNode.clearEvents();
            this.instanceNode.removeClass('sirv-video');
            this.instanceNode.removeClass(DISABLE_CLASS);
            this.instanceNode.removeClass(QUALITY_CONTROL);
            this.instanceNode.removeClass(SPEED_CONTROL);
            this.playPromise = null;
            this.HLS = [];

            _Instance2.prototype.destroy.call(this);

            return true;
          };

          return VideoInstance;
        }(Instance);

        return VideoInstance;
      }();

      return Video;
    });
    Sirv.define('Slider', ['require', 'module', 'bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'ResponsiveImage', 'helper', 'Promise!', 'EventEmitter', 'ContextMenu', 'ComponentLoader', 'defaultsVideoOptions', 'ViewerImage', 'SliderBuilder'], function (sirvRequire, sirvModule, bHelpers, magicJS, globalVariables, globalFunctions, ResponsiveImage, helper, Promise, EventEmitter, ContextMenu, ComponentLoader, defaultsVideoOptions, ViewerImage, SliderBuilder) {
      var moduleName = 'Slider';
      var $J = magicJS;
      var $ = $J.$;
      /* eslint-disable no-unused-vars */

      var CSS_MAIN_CLASS = globalVariables.smv;
      var SELECTOR_TAG = CSS_MAIN_CLASS + '-thumbnail';
      var SELECTOR_CLASS = CSS_MAIN_CLASS + '-selector';
      var DPPX = $J.W.node.devicePixelRatio >= 2 ? 2 : 1; // Dots per px. 2 - is equal to Retina.;

      /* eslint-env es6 */

      /* eslint-disable no-extra-semi */

      /* eslint-disable no-unused-vars */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      var defaultOptions = {
        orientation: {
          type: 'string',
          'enum': ['horizontal', 'vertical'],
          defaults: 'horizontal'
        },
        arrows: {
          type: 'boolean',
          defaults: true
        },
        loop: {
          type: 'boolean',
          defaults: true
        },
        // Quality applied to images (1x - 1.49x).
        quality: {
          type: 'number',
          minimum: 0,
          maximum: 100,
          defaults: 80
        },
        // Quality applied to hi-res images (1.5x - 2x).
        hdQuality: {
          type: 'number',
          minimum: 0,
          maximum: 100,
          defaults: 60
        },
        itemsOrder: {
          type: 'array',
          defaults: []
        },
        autostart: {
          oneOf: [
          /*
              created - init and load
              visible - init and load in view
              off - not init
          */
          {
            type: 'string',
            'enum': ['created', 'visible', 'off']
          }, {
            type: 'boolean',
            'enum': [false]
          }],
          defaults: 'visible'
        },
        // A distance from the viewport within which the in-view state should be triggered.
        threshold: {
          type: 'number',
          minimum: 0,
          defaults: 0
        },
        slide: {
          // slide.first
          first: {
            type: 'number',
            minimum: 0,
            defaults: 0
          },
          // slide.delay
          delay: {
            type: 'number',
            minimum: 9,
            defaults: 3000
          },
          // slide.preload
          preload: {
            type: 'boolean',
            defaults: true
          },
          // slide.autoplay
          autoplay: {
            type: 'boolean',
            defaults: false
          },
          animation: {
            // slide.animation.type
            type: {
              oneOf: [{
                type: 'string',
                'enum': ['off', 'slide', 'fade']
              }, {
                type: 'boolean',
                'enum': [false]
              }],
              defaults: 'fade'
            },
            // slide.animation.type
            duration: {
              type: 'number',
              minimum: 9,
              defaults: 200
            }
          },
          socialbuttons: {
            enable: {
              type: 'boolean',
              defaults: false
            },
            types: {
              facebook: {
                type: 'boolean',
                defaults: true
              },
              twitter: {
                type: 'boolean',
                defaults: true
              },
              linkedin: {
                type: 'boolean',
                defaults: true
              },
              reddit: {
                type: 'boolean',
                defaults: true
              },
              tumblr: {
                type: 'boolean',
                defaults: true
              },
              pinterest: {
                type: 'boolean',
                defaults: true
              },
              telegram: {
                type: 'boolean',
                defaults: true
              }
            }
          }
        },
        thumbnails: {
          // thumbnails.enable
          enable: {
            type: 'boolean',
            defaults: true
          },
          // thumbnails.size
          size: {
            type: 'number',
            minimum: 5,
            defaults: 70
          },
          // thumbnails.position
          position: {
            type: 'string',
            'enum': ['top', 'left', 'right', 'bottom'],
            defaults: 'bottom'
          },
          // thumbnails.type
          type: {
            type: 'string',
            'enum': ['square', 'auto', 'bullets', 'grid', 'crop'],
            defaults: 'square'
          },
          // thumbnails.always
          always: {
            type: 'boolean',
            defaults: false
          },
          // thumbnails.target
          target: {
            oneOf: [{
              type: 'string'
            }, {
              type: 'boolean',
              'enum': [false]
            }],
            defaults: false
          },
          // thumbnails.watermark
          watermark: {
            type: 'boolean',
            defaults: true
          }
        },
        fullscreen: {
          // fullscreen.enable
          enable: {
            type: 'boolean',
            defaults: true
          },
          // fullscreen.always
          always: {
            type: 'boolean',
            defaults: false
          },
          // fullscreen.native
          'native': {
            type: 'boolean',
            defaults: false
          },
          // TODO
          // +background: <color>,
          thumbnails: {
            // fullscreen.thumbnails.enable
            enable: {
              type: 'boolean',
              defaults: true
            },
            // fullscreen.thumbnails.size
            size: {
              oneOf: [{
                type: 'string',
                'enum': ['auto']
              }, {
                type: 'number',
                minimum: 5
              }],
              defaults: 'auto'
            },
            // fullscreen.thumbnails.position
            position: {
              type: 'string',
              'enum': ['top', 'left', 'right', 'bottom'],
              defaults: 'bottom'
            },
            // fullscreen.thumbnails.type
            type: {
              type: 'string',
              'enum': ['square', 'auto', 'bullets', 'grid', 'crop'],
              defaults: 'square'
            },
            // thumbnails.always
            always: {
              type: 'boolean',
              defaults: false
            },
            // fullscreen.thumbnails.autohide
            autohide: {
              type: 'boolean',
              defaults: false
            },
            // fullscreen.thumbnails.watermark
            watermark: {
              type: 'boolean',
              defaults: true
            }
          }
        },
        contextmenu: {
          // contextmenu.enable
          enable: {
            type: 'boolean',
            defaults: false
          },
          text: {
            zoom: {
              // contextmenu.text.zoom.in
              'in': {
                oneOf: [{
                  type: 'string'
                }, {
                  type: 'boolean',
                  'enum': [false]
                }],
                defaults: 'Zoom In'
              },
              // contextmenu.text.zoom.out
              out: {
                oneOf: [{
                  type: 'string'
                }, {
                  type: 'boolean',
                  'enum': [false]
                }],
                defaults: 'Zoom Out'
              }
            },
            fullscreen: {
              // contextmenu.fullscreen.enter
              enter: {
                oneOf: [{
                  type: 'string'
                }, {
                  type: 'boolean',
                  'enum': [false]
                }],
                defaults: 'Enter Full Screen'
              },
              // contextmenu.fullscreen.exit
              exit: {
                oneOf: [{
                  type: 'string'
                }, {
                  type: 'boolean',
                  'enum': [false]
                }],
                defaults: 'Exit Full Screen'
              }
            },
            // contextmenu.text.download
            download: {
              oneOf: [{
                type: 'string'
              }, {
                type: 'boolean',
                'enum': [false]
              }],
              defaults: 'Download Image'
            }
          }
        },
        productdetail: {
          enable: {
            type: 'boolean',
            defaults: false
          },
          position: {
            type: 'string',
            'enum': ['top', 'right', 'bottom', 'left'],
            defaults: 'top'
          }
        }
        /*
            TODO
            contextmenu: {
                items: [
                    { action: zoomIn, text: 'Збільшити' }
                    { action: zoomOut }
                ]
            }
         */
        // ready: { type: 'function', defaults: () => {} },
        // beforeSlideIn: { type: 'function', defaults: () => {} },
        // beforeSlideOut: { type: 'function', defaults: () => {} },
        // afterSlideIn: { type: 'function', defaults: () => {} },
        // afterSlideOut: { type: 'function', defaults: () => {} },
        // fullscreenIn: { type: 'function', defaults: () => {} },
        // fullscreenOut: { type: 'function', defaults: () => {} }
        // sendStats: { type: 'function', defaults: () => {} }

      };
      /* eslint-env es6 */

      /* global sirvRequire */

      /* global sirvModule */

      /* global helper */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Spin|Zoom|Video|Description|ProductDetail|SocialButtons|HotSpot|remoteModules" }] */

      var Spin = null;
      var Zoom = null;
      var Video = null; // let Description = null;

      var ProductDetail = null;
      var SocialButtons = null; // let HotSpots = null;

      var remoteModules = function () {
        var sliderConfig = sirvModule.config();
        var promises = {};
        helper.objEach(sliderConfig, function (key, value) {
          if (key !== 'description') {
            promises[key] = new Promise(function (resolve) {
              sirvRequire([value], function (sliderModule) {
                switch (key) {
                  case 'spin':
                    Spin = sliderModule;
                    break;

                  case 'zoom':
                    Zoom = sliderModule;
                    break;

                  case 'video':
                    Video = sliderModule;
                    break;
                  // 'description' is not used
                  // case 'description':
                  //     Description = sliderModule;
                  //     break;

                  case 'productDetail':
                    ProductDetail = sliderModule;
                    break;

                  case 'socialButtons':
                    SocialButtons = sliderModule;
                    break;
                  //no default
                }

                resolve();
              });
            });
          }
        });
        return {
          load: function (arr) {
            var result;
            var mods = [];

            if (!arr) {
              arr = [];
            }

            arr.forEach(function (mod) {
              if (promises[mod]) {
                mods.push(promises[mod]);
              }
            });

            if (!mods.length) {
              result = Promise.resolve();
            } else {
              result = Promise.all(mods);
            }

            return result;
          }
        };
      }();
      /* eslint-env es6 */

      /* global $ */

      /* global $J */

      /* global EventEmitter */

      /* global helper */

      /* global ViewerImage */

      /* global Zoom */

      /* global Spin */

      /* global Video */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint-disable no-lonely-if */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "SirvService" }] */


      var SirvService = /*#__PURE__*/function (_EventEmitter19) {
        "use strict";

        bHelpers.inheritsLoose(SirvService, _EventEmitter19);

        function SirvService(node, options, additionalOptions) {
          var _this211;

          _this211 = _EventEmitter19.call(this) || this;
          _this211.node = $(node);
          _this211.options = options;
          _this211.type = globalVariables.SLIDE.TYPES.NONE;
          _this211.imgSrc = null;
          _this211.effect = null;
          _this211.additionalEffects = [];
          _this211.isStarted = false;
          _this211.isPrepared = false;
          _this211.toolOptions = {};
          _this211.api = {};
          _this211.isActive = false;
          _this211.additionalOptions = additionalOptions;

          _this211.parse();

          _this211.setEvents();

          return _this211;
        }

        SirvService.isExist = function isExist(node) {
          var result = false;
          var resultOfParse = helper.getSirvType(node);
          var deps = {
            Image: ViewerImage,
            Spin: Spin,
            Zoom: Zoom,
            Video: Video
          };

          if (resultOfParse && !!deps[$J.camelize('-' + globalVariables.SLIDE.NAMES[resultOfParse.type])]) {
            result = true;
          }

          return result;
        };

        var _proto68 = SirvService.prototype;

        _proto68.createAPI = function createAPI() {
          var _this212 = this;

          if (this.effect) {
            this.api = this.effect.api;
            var methods = [];
            var t = globalVariables.SLIDE.TYPES;

            switch (this.type) {
              case t.SPIN:
                methods = ['play', 'rotate', 'rotateX', 'rotateY', 'zoomIn', 'zoomOut'];
                break;

              case t.ZOOM:
                if (this.api.zoomIn) {
                  methods = ['zoomIn', 'zoomOut'];
                }

                break;
              // no default
            }

            methods.forEach(function (method) {
              var _oldMethod = _this212.api[method];

              _this212.api[method] = function () {
                var result = false;
                var om = _oldMethod;

                if (_this212.isActive) {
                  for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {
                    args[_key7] = arguments[_key7];
                  }

                  result = om.apply(_this212, args);
                }

                return result;
              };
            });
          }
        };

        _proto68.setEvents = function setEvents() {
          var _this213 = this;

          this.on('stats', function (e) {
            e.stopEmptyEvent();
            e.data.component = globalVariables.SLIDE.NAMES[_this213.type];
          }); // init, ready, zoomIn, zoomOut

          this.on('componentEvent', function (e) {
            e.stopEmptyEvent();
            e.data.component = globalVariables.SLIDE.NAMES[_this213.type];

            if (e.data.type === 'ready') {
              if (_this213.type === globalVariables.SLIDE.TYPES.IMAGE && e.data.data.imageIndex !== null) {
                e.stopAll();
              }

              _this213.toolOptions = _this213.effect.getOptions();
            }
          });
        };

        _proto68.parse = function parse() {
          var resultOfParse = helper.getSirvType(this.node.node);

          if (resultOfParse) {
            this.type = resultOfParse.type;
            this.imgSrc = resultOfParse.imgSrc;
          }
        };

        _proto68.push = function push(imgNode) {
          if (ViewerImage) {
            var effect = new ViewerImage(imgNode, {
              options: this.options.image,
              isFullscreen: this.additionalOptions.isFullscreen,
              imageIndex: this.additionalEffects.length
            });
            effect.setParent(this);
            this.additionalEffects.push({
              node: imgNode,
              src: $(imgNode).attr('src'),
              datasrc: $(imgNode).attr('data-src'),
              effect: effect
            });
          }
        };

        _proto68.sendEvent = function sendEvent(nameOfEvent) {
          if (this.effect && this.effect.sendEvent) {
            this.effect.sendEvent(nameOfEvent);
          }
        };

        _proto68.resize = function resize() {
          this.broadcast('resize');
        };

        _proto68.startFullInit = function startFullInit(options) {
          var _this214 = this;

          if (this.effect) {
            this.effect.startFullInit(options ? options[this.type] : null);

            if (this.additionalEffects.length) {
              this.additionalEffects.forEach(function (effect) {
                if (effect.effect) {
                  effect.effect.startFullInit(options ? options[_this214.type] : null);
                }
              });
            }
          }
        };

        _proto68.getSelectorImgUrl = function getSelectorImgUrl(data) {
          return this.effect.getSelectorImgUrl(data);
        };

        _proto68.getInfoSize = function getInfoSize() {
          var _this215 = this;

          var result = null;

          if (this.type === globalVariables.SLIDE.TYPES.IMAGE) {
            result = new Promise(function (resolve, reject) {
              Promise.all([_this215.effect.getInfoSize()].concat(_this215.additionalEffects.map(function (value) {
                return value.effect.getInfoSize();
              }))).then(function (values) {
                resolve(values[0]);
              }).catch(reject);
            });
          } else {
            result = this.effect.getInfoSize();
          }

          return result;
        };

        _proto68.start = function start() {
          if (this.isPrepared) {
            return;
          }

          this.isPrepared = true;
          var options = {
            isFullscreen: this.additionalOptions.isFullscreen,
            quality: this.additionalOptions.quality,
            hdQuality: this.additionalOptions.hdQuality,
            isHDQualitySet: this.additionalOptions.isHDQualitySet,
            always: this.additionalOptions.always,
            nativeFullscreen: this.additionalOptions.nativeFullscreen
          };
          var t = globalVariables.SLIDE.TYPES;

          switch (this.type) {
            case t.IMAGE:
              if (ViewerImage) {
                this.effect = new ViewerImage(this.node.node, $J.extend(options, {
                  options: this.options.image,
                  imageIndex: null
                }));
                this.effect.setParent(this);
              }

              break;

            case t.PANZOOM:
            case t.ZOOM:
              if (Zoom) {
                this.effect = new Zoom(this.node.node, $J.extend(options, {
                  options: this.options.zoom
                }));
                this.effect.setParent(this);
              }

              break;

            case t.SPIN:
              if (Spin) {
                this.node.setCss({
                  // fix for shadow DOM
                  width: '100%',
                  height: '100%'
                });
                this.effect = new Spin(this.node.node, $J.extend(options, {
                  options: this.options.spin
                }));
                this.effect.setParent(this);
              }

              break;

            case t.VIDEO:
              if (Video) {
                this.effect = new Video(this.node.node, $J.extend(options, {
                  options: this.options.video,
                  nativeFullscreen: this.additionalOptions.nativeFullscreen
                }));
                this.effect.setParent(this);
              }

              break;

            default:
          }

          this.createAPI();
        };

        _proto68.isThumbnailGif = function isThumbnailGif() {
          if (this.effect && this.type === globalVariables.SLIDE.TYPES.SPIN) {
            return this.effect.isThumbnailGif();
          }

          return false;
        };

        _proto68.isZoomSizeExist = function isZoomSizeExist() {
          var t = globalVariables.SLIDE.TYPES;

          if (this.effect && $J.contains([t.SPIN, t.PANZOOM, t.ZOOM], this.type)) {
            return this.effect.isZoomSizeExist();
          }

          return false;
        };

        _proto68.startGettingInfo = function startGettingInfo() {
          if (this.effect) {
            this.effect.startGettingInfo();
          }
        };

        _proto68.startTool = function startTool(isShown, preload, firstSlideAhead) {
          if (!this.isStarted && this.effect) {
            this.isStarted = true;
            this.effect.run(isShown, preload, firstSlideAhead);

            if (this.additionalEffects.length) {
              this.additionalEffects.forEach(function (effect) {
                if (effect.effect) {
                  effect.effect.run(isShown, preload, firstSlideAhead);
                }
              });
            }
          }
        };

        _proto68.loadContent = function loadContent() {
          if (this.isStarted) {
            this.effect.loadContent();
          }
        };

        _proto68.loadThumbnail = function loadThumbnail() {
          if (this.isStarted) {
            this.effect.loadThumbnail();
          }
        };

        _proto68.getType = function getType() {
          return this.type;
        };

        _proto68.getData = function getData() {
          var result = {};

          if (this.effect) {
            result = $J.extend(result, this.api);
            delete result.start;
            delete result.stop;
            delete result.refresh;
          }

          return result;
        };

        _proto68.getOriginImageUrl = function getOriginImageUrl() {
          if (this.effect) {
            return this.effect.getOriginImageUrl();
          }

          return null;
        };

        _proto68.getZoomData = function getZoomData() {
          if ($J.contains([globalVariables.SLIDE.TYPES.SPIN, globalVariables.SLIDE.TYPES.ZOOM], this.type)) {
            return {
              isZoomed: this.effect.isZoomed(),
              zoom: this.effect.getZoomData()
            };
          }

          return null;
        };

        _proto68.getSpinOrientation = function getSpinOrientation() {
          if (this.type === globalVariables.SLIDE.TYPES.SPIN) {
            return this.effect.getOrientation();
          }

          return null;
        };

        _proto68.getSocialButtonData = function getSocialButtonData(data, isSpin) {
          var result = null;

          if (this.isStarted) {
            if (this.type === globalVariables.SLIDE.TYPES.SPIN) {
              result = this.effect.getSocialButtonData(data, isSpin);
            } else {
              result = this.effect.getSocialButtonData(data);
            }
          }

          return result;
        };

        _proto68.loadVideoSources = function loadVideoSources() {
          if (this.effect) {
            this.effect.addSources();
          }
        }
        /**
         * Viewer has touchdrag event for slideing slides and if we have touchdrag event in the effect (spin) it can make conflict
         * The method fixes conflict
         */
        ;

        _proto68.isEffectActive = function isEffectActive() {
          if (this.effect && this.type === 'spin') {
            return this.effect.isActive();
          }

          return false;
        };

        _proto68.activate = function activate() {
          if (!this.isActive) {
            this.isActive = true;
          }
        };

        _proto68.deactivate = function deactivate() {
          this.isActive = false;
        };

        _proto68.getToolOptions = function getToolOptions() {
          return this.toolOptions;
        };

        _proto68.destroy = function destroy() {
          if (this.effect) {
            this.effect.destroy();

            if (this.additionalEffects.length) {
              this.additionalEffects.forEach(function (effect) {
                if (effect.effect) {
                  effect.effect.destroy();
                } else {
                  if (!effect.src && effect.datasrc) {
                    effect.node.removeAttribute('src');
                  }
                }
              });
            }
          }

          this.toolOptions = {};
          this.api = {};
          this.isActive = false;
          this.isStarted = false;
          this.isPrepared = false;
          this.off('stats');
          this.off('componentEvent');

          _EventEmitter19.prototype.destroy.call(this);
        };

        return SirvService;
      }(EventEmitter);
      /* eslint-env es6 */

      /* global EventEmitter */

      /* eslint class-methods-use-this: ["error", {"exceptMethods": ["getNamesOfEffects"]}] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Effect" }] */


      var Effects = {};

      var Effect = function () {
        var getClassName = function (str) {
          return $J.camelize('-' + str);
        };

        var getDirection = function (direction, orientation) {
          var result;

          if (orientation === 'horizontal') {
            result = direction === 'next' ? 'right' : 'left';
          } else {
            result = direction === 'next' ? 'bottom' : 'top';
          }

          return result;
        };

        var Effect_ = /*#__PURE__*/function (_EventEmitter20) {
          "use strict";

          bHelpers.inheritsLoose(Effect_, _EventEmitter20);

          function Effect_(options) {
            var _this216;

            _this216 = _EventEmitter20.call(this) || this;
            _this216.options = $J.extend({
              effect: 'blank',
              orientation: 'horizontal',
              time: 600,
              easing: 'ease-in-out'
            }, options);
            _this216.isMove = false;
            _this216.callbackData = null;
            _this216.effectName = 'blank';
            _this216.effect = null;

            _this216.setEvents();

            return _this216;
          }

          var _proto69 = Effect_.prototype;

          _proto69.setEvents = function setEvents() {
            var _this217 = this;

            this.on('effectStart', function (e) {
              e.data = {
                callbackData: _this217.callbackData
              };
              _this217.isMove = true;
            });
            this.on('effectEnd', function (e) {
              e.data = {
                callbackData: _this217.callbackData
              };
              _this217.isMove = false;

              _this217.effect.destroy();

              _this217.effect = null;
            });
          };

          _proto69.getNamesOfEffects = function getNamesOfEffects() {
            return $J.hashKeys(Effects);
          };

          _proto69.make = function make(element1, element2, options, callbackData) {
            var o = $J.extend(this.options, options || {});
            this.stop();
            var name = getClassName(o.effect);

            if (!Object.prototype.hasOwnProperty.call(Effects, name)) {
              name = 'Blank';
            }

            this.effect = new Effects[name](element1, element2, {
              time: o.time,
              easing: o.easing,
              direction: getDirection(o.direction, o.orientation)
            });
            this.effect.setParent(this);
            this.callbackData = callbackData;
            this.effect.make();
          };

          _proto69.stop = function stop() {
            if (this.effect) {
              this.effect.destroy();
              this.effect = null;
            }

            this.callbackData = null;
          };

          _proto69.destroy = function destroy() {
            this.stop();
            this.off('effectStart');
            this.off('effectEnd');
            this.isMove = false;

            _EventEmitter20.prototype.destroy.call(this);
          };

          return Effect_;
        }(EventEmitter);

        return Effect_;
      }();
      /* eslint-env es6 */

      /* global Effects */

      /* global EventEmitter */

      /* eslint class-methods-use-this: ["error", {"exceptMethods": ["_move"]}] */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var Blank_ = /*#__PURE__*/function (_EventEmitter21) {
        "use strict";

        bHelpers.inheritsLoose(Blank_, _EventEmitter21);

        function Blank_(element1, element2, options) {
          var _this218;

          _this218 = _EventEmitter21.call(this) || this;
          _this218.name = 'blank';
          _this218.elements = [element1, element2];
          _this218.elements[0].node = $(_this218.elements[0].node);
          _this218.elements[1].node = $(_this218.elements[1].node);
          _this218.options = $J.extend({}, options || {});
          _this218.states = {
            NOT_STARTED: 0,
            MOVING: 1,
            ENDED: 2
          };
          _this218.state = _this218.states.NOT_STARTED;
          _this218.isDestroyed = false;
          return _this218;
        }

        var _proto70 = Blank_.prototype;

        _proto70._show = function _show(index) {
          this.elements[index].node.setCss({
            opacity: 1,
            visibility: 'visible'
          });
        };

        _proto70._hide = function _hide(index) {
          this.elements[index].node.setCss({
            opacity: 0,
            visibility: 'hidden'
          });
        };

        _proto70._start = function _start() {
          this.emit('effectStart', {
            name: this.name,
            indexes: [this.elements[0].index, this.elements[1].index]
          });

          this._show(0);

          this.elements[0].node.setCssProp('z-index', 9);

          this._show(1);

          this.elements[1].node.setCssProp('z-index', 7);
        };

        _proto70._move = function _move(callback) {
          callback();
        };

        _proto70._end = function _end() {
          if (this.state !== this.states.ENDED) {
            this.state = this.states.ENDED;

            this._hide(0);

            this.emit('effectEnd', {
              name: this.name,
              indexes: [this.elements[0].index, this.elements[1].index]
            });
          }
        };

        _proto70._clear = function _clear() {
          this.elements.forEach(function (element) {
            element.node.setCss({
              zIndex: '',
              opacity: '',
              visibility: ''
            });
          });
        };

        _proto70.make = function make() {
          var _this219 = this;

          if (this.state === this.states.NOT_STARTED) {
            this.state = this.states.MOVING;

            this._start();

            this._move(function () {
              _this219._end();

              _this219._clear();
            });
          }
        };

        _proto70.destroy = function destroy() {
          if (!this.isDestroyed) {
            this.isDestroyed = true;

            this._end();

            this._clear();

            this.state = this.states.ENDED;

            _EventEmitter21.prototype.destroy.call(this, this);
          }
        };

        return Blank_;
      }(EventEmitter);

      Effects.Blank = Blank_;
      /* global Effects, Blank_ */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      Effects.Slide = function () {
        var toPercentString = function (value) {
          return value + '%';
        };

        var getNormalizeArray = function (arr) {
          return arr.map(function (value) {
            return toPercentString(value);
          });
        };

        var Slide_ = /*#__PURE__*/function (_Blank_) {
          "use strict";

          bHelpers.inheritsLoose(Slide_, _Blank_);

          function Slide_(element1, element2, options) {
            var _this220;

            _this220 = _Blank_.call(this, element1, element2, options) || this;
            _this220.options = $J.extend(_this220.options, $J.extend({
              direction: 'left',
              // top / left / right / bottom
              time: 600,
              easing: 'ease-in-out'
            }, options || {}));
            _this220.name = 'slide';
            _this220.from = $([0, -100]);
            _this220.to = $([100, 0]);

            if ($J.contains(['right', 'bottom'], _this220.options.direction)) {
              _this220.from[1] *= -1;
              _this220.to[0] *= -1;
            }

            _this220.from = getNormalizeArray(_this220.from);
            _this220.to = getNormalizeArray(_this220.to);
            return _this220;
          }

          var _proto71 = Slide_.prototype;

          _proto71._show = function _show(index) {
            var el = this.elements[index].node;

            if ($J.contains(['left', 'right'], this.options.direction)) {
              this.from[index] = this.from[index] + ', 0%';
              this.to[index] = this.to[index] + ', 0%';
            } else {
              this.from[index] = '0%, ' + this.from[index];
              this.to[index] = '0%, ' + this.to[index];
            }

            el.setCssProp('transform', 'translate3d(' + this.from[index] + ', 0px)');

            _Blank_.prototype._show.call(this, index);
          };

          _proto71._move = function _move(callback) {
            var _this221 = this;

            var options = this.options;
            this.elements[1].node.addEvent('transitionend', function (e) {
              if (_this221.elements[1].node.node !== e.getTarget()) {
                return;
              }

              e.stop();

              _Blank_.prototype._move.call(_this221, callback);
            });
            this.elements.forEach(function (element, index) {
              element.node.getSize();
              element.node.setCssProp('transition', 'transform ' + options.time + 'ms ' + options.easing);
              element.node.setCssProp('transform', 'translate3d(' + _this221.to[index] + ', 0px)');
            });
          };

          _proto71._clear = function _clear() {
            this.elements.forEach(function (element) {
              element.node.removeEvent('transitionend');
              element.node.setCss({
                transform: '',
                transition: ''
              });
            });

            _Blank_.prototype._clear.call(this, this);
          };

          return Slide_;
        }(Blank_);

        return Slide_;
      }();
      /* eslint-env es6 */

      /* global Effects, Blank_ */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */


      var Fade_ = /*#__PURE__*/function (_Blank_2) {
        "use strict";

        bHelpers.inheritsLoose(Fade_, _Blank_2);

        function Fade_(element1, element2, options) {
          var _this222;

          _this222 = _Blank_2.call(this, element1, element2, options) || this;
          _this222.options = $J.extend(_this222.options, $J.extend({
            time: 600,
            easing: 'linear'
          }, options || {}));
          _this222.name = 'fade';
          _this222.from = $([1, 0]);
          _this222.to = $([0, 1]);
          return _this222;
        }

        var _proto72 = Fade_.prototype;

        _proto72._show = function _show(index) {
          _Blank_2.prototype._show.call(this, index);

          var el = this.elements[index].node;
          el.setCssProp('opacity', this.from[index]);
        };

        _proto72._move = function _move(callback) {
          var _this223 = this;

          var options = this.options;
          this.elements[1].node.addEvent('transitionend', function (e) {
            if (_this223.elements[1].node.node !== e.getTarget()) {
              return;
            }

            e.stop();

            _Blank_2.prototype._move.call(_this223, callback);
          });
          this.elements.forEach(function (element, index) {
            element.node.getSize();
            element.node.setCssProp('transition', 'opacity ' + options.time + 'ms ' + options.easing);
            element.node.setCssProp('opacity', _this223.to[index]);
          });
        };

        _proto72._clear = function _clear() {
          this.elements.forEach(function (element) {
            element.node.removeEvent('transitionend');
            element.node.setCss({
              opacity: '',
              transition: ''
            });
          });

          _Blank_2.prototype._clear.call(this);
        };

        return Fade_;
      }(Blank_);

      Effects.Fade = Fade_;
      /* eslint-env es6 */

      /* global CSS_MAIN_CLASS */

      /* global EventEmitter */

      /* eslint-disable indent */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Arrows" }] */

      var Arrows = function () {
        var createArrows = function (orientation, customClass) {
          return $(['prev', 'next']).map(function (value) {
            var container = $J.$new('div').addClass(CSS_MAIN_CLASS + '-arrow-control ' + CSS_MAIN_CLASS + '-arrow-control-' + value);
            var arrow = $J.$new('div').addClass(CSS_MAIN_CLASS + '-button').addClass(CSS_MAIN_CLASS + '-arrow').addClass(CSS_MAIN_CLASS + '-arrow-' + value);

            if (customClass && customClass !== '') {
              arrow.addClass(CSS_MAIN_CLASS + '-arrow-' + customClass);
            }

            container.append(arrow);
            return container;
          });
        };

        var Arrows_ = /*#__PURE__*/function (_EventEmitter22) {
          "use strict";

          bHelpers.inheritsLoose(Arrows_, _EventEmitter22);

          function Arrows_(options) {
            var _this224;

            _this224 = _EventEmitter22.call(this) || this;
            _this224.options = $J.extend({
              orientation: 'horizontal',
              customClass: ''
            }, options || {});
            _this224.arrows = createArrows(_this224.options.orientation, _this224.options.customClass);

            _this224.arrows.forEach(function (arrow, index) {
              var _arrowType = !index ? 'prev' : 'next';

              var button = $(arrow.node.firstChild);
              arrow.store('arrowType', _arrowType);
              button.append($J.$new('div').addClass(CSS_MAIN_CLASS + '-icon'));
              button.addEvent('btnclick tap', $(function (typeOfArrow, e) {
                e.stop();

                if (!arrow.fetch('disabled')) {
                  _this224.emit('arrowAction', {
                    data: {
                      type: typeOfArrow
                    }
                  });
                }
              }).bind(bHelpers.assertThisInitialized(_this224), _arrowType));
            });

            _this224.isShow = true;
            return _this224;
          }

          var _proto73 = Arrows_.prototype;

          _proto73.getNodes = function getNodes() {
            return $([this.arrows[0], this.arrows[1]]);
          };

          _proto73.show = function show() {
            if (!this.isShow) {
              this.arrows.forEach(function (arrow) {
                arrow.removeClass(CSS_MAIN_CLASS + '-hidden');
              });
              this.isShow = true;
            }
          };

          _proto73.hide = function hide() {
            if (this.isShow) {
              this.isShow = false;
              this.arrows.forEach(function (arrow) {
                arrow.addClass(CSS_MAIN_CLASS + '-hidden');
              });
            }
          };

          _proto73.disable = function disable(arrow) {
            if (arrow && this.isShow) {
              var indexArrow = arrow === 'forward' ? 1 : 0;
              this.arrows[indexArrow].store('disabled', true);
              $(this.arrows[indexArrow].node.firstChild).attr('disabled', '');
            } else {
              this.arrows.forEach(function (element) {
                $(element.node.firstChild).removeAttr('disabled');
                element.store('disabled', false);
              });
            }
          };

          _proto73.destroy = function destroy() {
            this.arrows.forEach(function (arrow) {
              $(arrow.node.firstChild).removeEvent('btnclick tap');
              arrow.del('arrowType');
              arrow.del('disabled');
              arrow.remove();
            });
            this.arrows = $([]);
            this.isShow = false;

            _EventEmitter22.prototype.destroy.call(this);
          };

          return Arrows_;
        }(EventEmitter);

        return Arrows_;
      }();

      var Selectors = function () {
        /* global helper */

        /* eslint-disable no-unused-vars */
        var getOrientation = function (position) {
          var result = 'horizontal';

          if ($J.contains(['left', 'right'], position)) {
            result = 'vertical';
          }

          return result;
        };

        var equalOptions = function (opt1, opt2) {
          var result = true;
          helper.objEach(opt1, function (key, value) {
            if (result && value !== opt2[key]) {
              result = false;
            }
          });
          return result;
        };

        var DEFAULT_SIZE = {
          width: 560,
          height: 315
        };
        var SELECTORS_STATE = {
          NONE: 0,
          STANDARD: 1,
          FULLSCREEN: 2
        };
        /* eslint-env es6 */

        /* global EventEmitter, globalFunctions, DEFAULT_SIZE, SELECTOR_TAG */

        /* eslint-disable indent */

        /* eslint-disable no-lonely-if */

        /* eslint-disable class-methods-use-this */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

        /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "SelectorContent" }] */

        var SelectorContent = /*#__PURE__*/function (_EventEmitter23) {
          "use strict";

          bHelpers.inheritsLoose(SelectorContent, _EventEmitter23);

          function SelectorContent(node, type, size, orientation) {
            var _this225;

            _this225 = _EventEmitter23.call(this) || this;
            _this225.node = $(node);
            _this225.type = type;
            _this225.size = size; // 70

            _this225.orientation = orientation; // selectors orientation 'horizontal' | 'vertical'

            _this225.getPlaceholderSizePromise = null;
            _this225.destroyed = false;
            _this225.loaded = false;
            _this225.content = null;

            if (_this225.node.getTagName() === SELECTOR_TAG) {
              _this225.content = $J.$A(_this225.node.node.childNodes);
            }

            return _this225;
          }

          var _proto74 = SelectorContent.prototype;

          _proto74.isLoaded = function isLoaded() {
            return this.loaded;
          };

          _proto74.setCssSize = function setCssSize() {
            var css = this.getSelectorSize();
            this.node.setCss(css);
          };

          _proto74.getSelectorSize = function getSelectorSize() {
            var selectorSize = {};

            if ($J.contains(['square', 'crop'], this.type)) {
              selectorSize.width = this.size;
              selectorSize.height = this.size;
            } else {
              if (this.orientation === 'horizontal') {
                selectorSize.height = this.size;
              } else {
                selectorSize.width = this.size;
              }
            }

            return selectorSize;
          };

          _proto74.getPlaceholderSize = function getPlaceholderSize() {
            var _this226 = this;

            if (!this.getPlaceholderSizePromise) {
              this.getPlaceholderSizePromise = new Promise(function (resolve) {
                var size = _this226.getSelectorSize();

                if (size.width && size.height) {
                  resolve(size);
                } else {
                  if (_this226.destroyed) {
                    resolve({
                      width: 0,
                      height: 0
                    });
                  } else {
                    var s;

                    _this226.getProportion().then(function (_size) {
                      s = _size;
                    }).finally(function () {
                      if (!size.width) {
                        size.width = s.width / s.height * size.height;
                      } else {
                        size.height = s.height / s.width * size.width;
                      }

                      resolve(size);
                    });
                  }
                }
              });
            }

            return this.getPlaceholderSizePromise;
          };

          _proto74.getProportion = function getProportion() {
            return Promise.resolve(DEFAULT_SIZE);
          };

          _proto74.complete = function complete() {
            this.node.setCss({
              width: '',
              height: ''
            });
            this.setCssSize();
            return Promise.resolve();
          };

          _proto74.getNode = function getNode() {
            return this.node;
          };

          _proto74.appendTo = function appendTo(container) {
            if (this.content) {
              this.content.forEach(function (node) {
                container.append(node);
              });
            } else {
              container.append(this.getNode());
            }
          };

          _proto74.destroy = function destroy() {
            this.destroyed = true;
            this.node = null;
            this.getPlaceholderSizePromise = null;

            _EventEmitter23.prototype.destroy.call(this);
          };

          return SelectorContent;
        }(EventEmitter);
        /* eslint-env es6 */

        /* global SelectorContent, globalFunctions, DEFAULT_SIZE, helper */

        /* eslint-disable indent */

        /* eslint-disable no-lonely-if */

        /* eslint-disable class-methods-use-this */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

        /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "ImageSelectorContent" }] */


        var ImageSelectorContent = /*#__PURE__*/function (_SelectorContent) {
          "use strict";

          bHelpers.inheritsLoose(ImageSelectorContent, _SelectorContent);

          function ImageSelectorContent(node, type, size, orientation, watermark) {
            var _this227;

            _this227 = _SelectorContent.call(this, node, type, size, orientation) || this;
            _this227.imageOrientation = 'horizontal'; // 'horizontal' | 'vertical'

            _this227.isSirv = false;
            _this227.watermark = watermark;
            _this227.src = null;
            _this227.srcset = null;
            _this227.imageSize = {
              width: 0,
              height: 0
            };
            _this227.getProportionPromise = null;
            _this227.getUrlPromise = null;
            _this227.loadImagePromise = null;
            return _this227;
          }

          var _proto75 = ImageSelectorContent.prototype;

          _proto75.setCssSize = function setCssSize() {
            if ($J.contains(['square', 'crop'], this.type)) {
              this.customSquare();
            } else {
              this.removeCustomSquare();
            }

            _SelectorContent.prototype.setCssSize.call(this);
          };

          _proto75.getProportion = function getProportion() {
            var _this228 = this;

            if (!this.getProportionPromise) {
              this.getProportionPromise = new Promise(function (resolve, reject) {
                if (_this228.destroyed) {
                  resolve({
                    width: 0,
                    height: 0
                  });
                } else {
                  _this228.emit('getSelectorProportion', {
                    data: {
                      resultingCallback: function (data) {
                        var size = data.size;
                        _this228.isSirv = data.isSirv;

                        if (size) {
                          if (!size.width) {
                            size = DEFAULT_SIZE;
                          }

                          resolve(size);
                        } else {
                          resolve(DEFAULT_SIZE);
                        }
                      }
                    }
                  });
                }
              });
            }

            return this.getProportionPromise;
          };

          _proto75.setImageUrl = function setImageUrl(src, srcset, alt, referrerpolicy) {
            this.src = src;
            this.srcset = srcset;

            if (this.node) {
              if (this.src || this.srcset) {
                if (referrerpolicy) {
                  this.node.attr('referrerpolicy', referrerpolicy);
                }

                if (this.srcset) {
                  this.node.attr('srcset', this.srcset + ' 2x');
                }

                this.node.attr('src', this.src);

                if (!$J.browser.mobile) {
                  // fix for firefox
                  // glueing images to cursor
                  this.node.addEvent('mousedown', function (e) {
                    e.stopDefaults();
                  });
                }
              }

              if (alt) {
                this.node.attr('alt', alt);
              }
            }
          };

          _proto75.getUrl = function getUrl() {
            var _this229 = this;

            if (!this.getUrlPromise) {
              this.getUrlPromise = new Promise(function (resolve, reject) {
                if (_this229.destroyed) {
                  resolve(_this229);
                } else {
                  var selectorSize = _this229.getSelectorSize();

                  _this229.emit('getSelectorImgUrl', {
                    data: {
                      crop: _this229.type === 'crop',
                      type: _this229.type,
                      watermark: _this229.watermark,
                      size: selectorSize,
                      resultingCallback: function (result) {
                        if (result) {
                          _this229.setImageUrl(result.src, result.srcset, result.alt, result.referrerpolicy);

                          resolve(_this229);
                        } else {
                          reject(_this229);
                        }
                      }
                    }
                  });
                }
              });
            }

            return this.getUrlPromise;
          };

          _proto75.setImageData = function setImageData(size) {
            this.imageSize = size;
            this.imageOrientation = this.imageSize.width >= this.imageSize.height ? 'horizontal' : 'vertical';
          };

          _proto75.loadImage = function loadImage() {
            var _this230 = this;

            if (!this.loadImagePromise) {
              this.loadImagePromise = new Promise(function (resolve, reject) {
                if (_this230.node) {
                  helper.loadImage(_this230.isSirv ? _this230.node.node : _this230.node.node.src).then(function (imageData) {
                    _this230.loaded = true;

                    _this230.setImageData(imageData.size);

                    _this230.setCssSize();

                    resolve(_this230);
                  }).catch(function (error) {
                    if (_this230.destroyed) {
                      resolve(_this230);
                    } else {
                      reject(_this230);
                    }
                  });
                } else {
                  resolve(_this230);
                }
              });
            }

            return this.loadImagePromise;
          };

          _proto75.customSquare = function customSquare() {
            if (Math.abs(this.imageSize.width - this.imageSize.height) > 2 && this.node.getTagName() !== 'div') {
              var div = $J.$new('div').setCss({
                overflow: 'hidden',
                position: 'relative'
              });
              this.node.attr('data-image-orientation', this.imageOrientation);
              div.append(this.node);
              this.node.setCss({
                width: '',
                height: '',
                'max-width': 'none'
              });

              if (this.type === 'crop') {
                if (this.imageOrientation === 'horizontal') {
                  this.node.setCssProp('height', this.size);
                } else {
                  this.node.setCssProp('width', this.size);
                }
              } else {
                if (this.imageOrientation === 'vertical') {
                  this.node.setCssProp('height', this.size);
                } else {
                  this.node.setCssProp('width', this.size);
                }
              }

              this.node = div;
            }
          };

          _proto75.removeCustomSquare = function removeCustomSquare() {
            if (this.node && this.node.getTagName() === 'div') {
              this.node.removeEvent('touchstart selectstart contextmenu'); // TODO review it

              this.node.remove();
              this.node = $(this.node.node.firstChild);
              this.node.setCss({
                width: '',
                height: '',
                maxWidth: ''
              });
              this.node.removeAttr('data-image-orientation');
            }
          };

          _proto75.complete = function complete() {
            var _this231 = this;

            return this.getUrl().then(function () {
              return _this231.loadImage();
            });
          };

          _proto75.destroy = function destroy() {
            if (this.node) {
              this.node.removeEvent('mousedown');
            }

            this.getProportionPromise = null;
            this.getUrlPromise = null;
            this.loadImagePromise = null;

            _SelectorContent.prototype.destroy.call(this);
          };

          return ImageSelectorContent;
        }(SelectorContent);
        /* eslint-env es6 */

        /* global ImageSelectorContent, globalFunctions, helper, EventEmitter, CSS_MAIN_CLASS, SELECTOR_TAG, SELECTORS_STATE, equalOptions, SelectorContent */

        /* eslint-disable indent */

        /* eslint-disable no-lonely-if */

        /* eslint-disable class-methods-use-this */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

        /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Selector" }] */


        var Selector = /*#__PURE__*/function (_EventEmitter24) {
          "use strict";

          bHelpers.inheritsLoose(Selector, _EventEmitter24);

          function Selector(parentNode, index, selector, uuid, options, infoPromise) {
            var _this232;

            _this232 = _EventEmitter24.call(this) || this;
            _this232.UUID = uuid;
            _this232.options = helper.deepExtend({
              standard: {
                type: 'square',
                // 'square' | 'crop' | 'auto' | 'bullets'
                size: 70,
                orientation: 'horizontal',
                // 'horizontal' | 'vertical'
                watermark: true // true | false

              },
              fullscreen: {
                type: 'square',
                // 'square' | 'crop' | 'auto' | 'bullets'
                size: 70,
                orientation: 'horizontal',
                // 'horizontal' | 'vertical'
                watermark: true // true | false

              },
              activeClass: CSS_MAIN_CLASS + '-active',
              placeholderClass: CSS_MAIN_CLASS + '-thumbnail-placeholder',
              selectorContent: null,
              disabled: false
            }, options || {});
            _this232.parentContainer = $(parentNode);
            _this232.index = index;
            _this232.selector = $(selector) || $J.$new('div');
            _this232.container = $J.$new('div').addClass(CSS_MAIN_CLASS + '-item').setCss({
              display: 'inline-block'
            }); // itemContainer

            _this232.placeholder = $J.$new('div').addClass(_this232.options.placeholderClass);
            _this232.size = {
              width: 0,
              height: 0
            };
            _this232.currentObject = null;
            _this232.isActive = false;
            _this232.disabled = false;
            _this232.destroyed = false;

            _this232.container.append(_this232.selector);

            _this232.parentContainer.append(_this232.container);

            if (_this232.options.disabled) {
              _this232.disable();
            }

            _this232.infoPromise = infoPromise || Promise.resolve(false);
            _this232.state = SELECTORS_STATE.NONE;
            _this232.initPromise = null;

            _this232.init();

            return _this232;
          }

          var _proto76 = Selector.prototype;

          _proto76.init = function init() {
            var _this233 = this;

            if (!this.initPromise) {
              this.initPromise = new Promise(function (resolve) {
                _this233.infoPromise.then(function () {
                  _this233.standard = _this233.createContent(_this233.options.standard);

                  if (_this233.standard && _this233.standard instanceof ImageSelectorContent && equalOptions(_this233.options.standard, _this233.options.fullscreen)) {
                    _this233.fullscreen = _this233.standard;
                  } else {
                    _this233.fullscreen = _this233.createContent(_this233.options.fullscreen, true);
                  }

                  _this233.selector.append(_this233.placeholder);

                  var dataType = _this233.selector.attr('data-type');

                  if (!dataType) {
                    _this233.selector.setCssProp('font-size', 0);
                  }

                  _this233.setEvents();

                  _this233.setCustomEvent();

                  resolve();
                });
              });
            }

            return this.initPromise;
          };

          _proto76.createContent = function createContent(options, fullscreen) {
            var result;

            if (options.type !== 'bullets') {
              if (this.options.selectorContent) {
                result = new SelectorContent(this.options.selectorContent, options.type, options.size, options.orientation);
              } else {
                var img = $(new Image());
                result = new ImageSelectorContent(img, options.type, options.size, options.orientation, options.watermark);
              }

              result.setParent(this);
            }

            return result;
          };

          _proto76.getProportion = function getProportion() {
            var _this234 = this;

            var result = Promise.resolve();

            if (!this.disabled) {
              if (this.state === SELECTORS_STATE.FULLSCREEN && this.fullscreen) {
                result = this.fullscreen.getProportion();
              } else if (this.standard) {
                result = this.standard.getProportion();
              }
            }

            return new Promise(function (resolve, reject) {
              _this234.init().then(function () {
                result.then(resolve).catch(reject);
              });
            });
          };

          _proto76.activatedSelector = function activatedSelector() {
            return this.options.activated;
          };

          _proto76.setEvents = function setEvents() {
            var _this235 = this;

            this.on('getSelectorProportion', function (e) {
              e.data.UUID = _this235.UUID;
            });
            this.on('getSelectorImgUrl', function (e) {
              e.data.UUID = _this235.UUID;
            });
          };

          _proto76.addPlaceholder = function addPlaceholder(selectorType, size) {
            this.container.attr('data-selector-type', selectorType);
            this.selector.append(this.placeholder);
            this.placeholder.setCss(size);
          }
          /*
              1 - SELECTORS_STATE.STANDARD,
              2 - SELECTORS_STATE.FULLSCREEN
          */
          ;

          _proto76.toggle = function toggle(state
          /* 1 or 2 only */
          ) {
            var _this236 = this;

            return new Promise(function (res, rej) {
              _this236.init().then(function () {
                var result;

                var _resolve = Promise.resolve();

                if (_this236.state !== state) {
                  _this236.state = state;

                  if (_this236.disabled) {
                    result = _resolve;
                  } else {
                    var selector = _this236.standard;
                    var selectorType = _this236.options.standard.type;

                    if (state === 2) {
                      selector = _this236.fullscreen;
                      selectorType = _this236.options.fullscreen.type;
                    }

                    if (selectorType === 'bullets') {
                      _this236.selector.node.innerHTML = '';
                      _this236.currentObject = selectorType;

                      _this236.container.attr('data-selector-type', selectorType);

                      _this236.emit('resize');

                      result = _resolve;
                    } else {
                      if (!(selector instanceof ImageSelectorContent)) {
                        _this236.container.attr('data-selector-type', selectorType);
                      }

                      result = new Promise(function (resolve, reject) {
                        if (selector) {
                          selector.getPlaceholderSize().then(function (size) {
                            if (_this236.state === state && !_this236.destroyed) {
                              if (!selector.isLoaded() && !_this236.options.selectorContent) {
                                // NOTE: this.selector.node.innerHTML = ''; doesn't work properly in IE 11
                                while (_this236.selector.node.firstChild) {
                                  _this236.selector.node.removeChild(_this236.selector.node.firstChild);
                                }

                                _this236.addPlaceholder(selectorType, size);
                              }

                              resolve();
                              selector.complete().then(function () {
                                if (_this236.state === state && !_this236.destroyed) {
                                  _this236.container.attr('data-selector-type', selectorType);

                                  _this236.placeholder.remove(); // NOTE: this.selector.node.innerHTML = ''; doesn't work properly in IE 11


                                  while (_this236.selector.node.firstChild) {
                                    _this236.selector.node.removeChild(_this236.selector.node.firstChild);
                                  }

                                  selector.appendTo(_this236.selector);
                                  _this236.currentObject = selector;

                                  _this236.emit('resize');
                                }
                              }).catch(function () {// empty
                              });
                            } else {
                              resolve();
                            }
                          });
                        } else {
                          resolve();
                        }
                      });
                    }
                  }
                } else {
                  result = _resolve;
                }

                result.then(res).catch(rej);
              });
            });
          };

          _proto76.setEvent = function setEvent() {
            var _this237 = this;

            this.container.addEvent('btnclick tap', function (e) {
              e.stop();

              _this237.emit('selectorAction', {
                data: _this237.UUID
              });
            });
          };

          _proto76.setCustomEvent = function setCustomEvent() {
            if (this.options.selectorContent && $J.$(this.options.selectorContent).getTagName() === SELECTOR_TAG) {
              var nodesList = $(this.options.selectorContent).node.querySelectorAll('a');
              $J.$A(nodesList).forEach(function (item) {
                $J.$(item).addEvent('btnclick tap', function (e) {
                  e.stop();

                  if ($J.$(item).attr('href')[0] === '#') {
                    $J.W.node.location.hash = '';
                    $J.W.node.location.hash = $J.$(item).attr('href');
                  } else {
                    $J.W.node.open($J.$(item).attr('href'));
                  }
                });
              });
            }
          };

          _proto76.activate = function activate() {
            if (!this.isActive) {
              this.isActive = true;
              this.container.addClass(this.options.activeClass);
            }
          };

          _proto76.isActivate = function isActivate() {
            return this.isActive;
          };

          _proto76.deactivate = function deactivate() {
            if (this.isActive) {
              this.isActive = false;
              this.container.removeClass(this.options.activeClass);
            }
          };

          _proto76.getSize = function getSize() {
            this.size = this.container.getSize();
            return this.size;
          };

          _proto76.disable = function disable() {
            if (!this.disabled) {
              this.disabled = true;
              this.container.attr('disabled', 'true');
              this.container.setCssProp('display', 'none');
              this.deactivate();
              this.emit('resize');
            }
          };

          _proto76._toggleForEnable = function _toggleForEnable() {
            var neededType;

            if (this.state !== SELECTORS_STATE.NONE) {
              if (this.state === SELECTORS_STATE.STANDARD) {
                neededType = this.standard || 'bullets';
              } else {
                neededType = this.fullscreen || 'bullets';
              }
            }

            var result;

            if (neededType !== this.currentObject) {
              var last = this.state;
              this.state = SELECTORS_STATE.NONE;
              result = this.toggle(last);
            } else {
              result = Promise.resolve();
            }

            return result;
          };

          _proto76.enable = function enable() {
            var _this238 = this;

            if (this.disabled) {
              this.disabled = false;

              this._toggleForEnable().then(function () {
                if (!_this238.disabled) {
                  _this238.container.removeAttr('disabled');

                  _this238.container.setCssProp('display', '');

                  _this238.emit('resize');
                }
              });
            }
          };

          _proto76.setIndex = function setIndex(index) {
            this.index = index;
          };

          _proto76.getContainer = function getContainer() {
            return this.container;
          };

          _proto76.getOptions = function getOptions() {
            return this.options;
          };

          _proto76.isDestroyed = function isDestroyed() {
            return this.destroyed;
          };

          _proto76.isDisabled = function isDisabled() {
            return this.disabled;
          };

          _proto76.destroy = function destroy() {
            this.destroyed = true;
            this.placeholder.remove();
            this.off('getSelectorProportion');
            this.off('getSelectorImgUrl');

            if (this.standard) {
              this.standard.destroy();
              this.standard = null;
            }

            if (this.fullscreen) {
              this.fullscreen.destroy();
              this.fullscreen = null;
            }

            this.container.removeEvent('btnclick tap');
            this.container.remove();
            this.container = null;
            this.parentContainer = null;
            this.selector = null;

            _EventEmitter24.prototype.destroy.call(this);
          };

          return Selector;
        }(EventEmitter);
        /* eslint-env es6 */

        /* global globalFunctions, helper, EventEmitter, CSS_MAIN_CLASS, SELECTORS_STATE, Selector, getOrientation, Arrows */

        /* eslint-disable indent */

        /* eslint-disable no-lonely-if */

        /* eslint-disable class-methods-use-this */

        /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

        /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Selectors_" }] */


        var SELECTORS = 'selectors';

        var getTime = function (maxTime, width, step) {
          var result = maxTime;
          var minTime = parseInt(maxTime / 3, 10);
          result = parseInt(Math.abs(step) / width * maxTime, 10);

          if (result < minTime) {
            result = minTime;
          } else if (result > maxTime) {
            result = maxTime;
          }

          return result;
        };

        var convertToTranslateString = function (value, isHorizontal) {
          if (isHorizontal) {
            value += 'px, 0';
          } else {
            value = '0, ' + value + 'px';
          }

          return value;
        };

        var normalizeIndex = function (index, length) {
          if (index < 0) {
            index = 0;
          } else if (index > length - 1) {
            index = length - 1;
          }

          return index;
        };

        var isPinned = function (value) {
          return value === 'start' || value === 'end';
        };

        var Selectors_ = /*#__PURE__*/function (_EventEmitter25) {
          "use strict";

          bHelpers.inheritsLoose(Selectors_, _EventEmitter25);

          function Selectors_(selectors, options) {
            var _this239;

            _this239 = _EventEmitter25.call(this) || this;
            _this239.options = $J.extend({
              isStandardGrid: false,
              standardStyle: 'square',
              // square | crop | auto | bullets
              standardSize: 70,
              standardPosition: 'bottom',
              // top, left, right, bottom, false
              standardWatermark: true,
              isFullscreenGrid: false,
              fullscreenStyle: 'square',
              // square | crop | auto | bullets
              fullscreenSize: 70,
              fullscreenPosition: 'bottom',
              // top, left, right, bottom, false
              fullscreenAutohide: false,
              fullscreenWatermark: true,
              arrows: true,
              activeClass: CSS_MAIN_CLASS + '-active'
            }, options || {});
            _this239.instanceNode = $J.$new('div').addClass(CSS_MAIN_CLASS + '-' + SELECTORS).setCss({
              opacity: 0,
              visibility: 'hidden',
              transition: ''
            });
            _this239.selectorsContainer = $J.$new('div').addClass(CSS_MAIN_CLASS + '-ss');
            _this239.selectorsScroll = $J.$new('div').addClass(CSS_MAIN_CLASS + '-scroll').setCss({
              transform: 'translate3d(0, 0, 0)'
            });
            _this239.controlButton = $J.$new('div').addClass(CSS_MAIN_CLASS + '-' + SELECTORS + '-toggle-switch');
            _this239.selectorsScrollContainer = $J.$new('div').addClass(CSS_MAIN_CLASS + '-selectors-scroll-container');
            _this239.pinnedNodeAtStart = null;
            _this239.pinnedNodeAtEnd = null;
            _this239.hasPinnedSelector = false;
            _this239.baseSelectorsList = null;
            _this239.blocksPinnedInited = false;
            _this239.pinnedStartList = [];
            _this239.pinnedEndList = [];
            _this239.isMove = false;
            _this239.currentPosition = 0;
            _this239.containerSize = {
              width: 0,
              height: 0
            };
            _this239.halfContainerSize = 0;
            _this239.scrollSize = {
              width: 0,
              height: 0
            };
            _this239.halfScrollSize = 0;
            _this239.currentActiveItem = null;
            _this239.isShown = false;
            _this239.isControlShown = true;
            _this239.isControlInDoc = false;
            _this239.controlDebounce = null;
            _this239.isReady = false;
            _this239.resizeTimeout = null;
            _this239.isActionsEnabled = true;
            _this239.isDone = false;
            _this239.isInView = false;
            _this239.state = SELECTORS_STATE.STANDARD;
            _this239.arrows = null;
            _this239.currentStylePosition = _this239.options.standardPosition;
            _this239.longSide = null;
            _this239.shortSide = null;
            _this239.currentAxis = 'x';
            _this239.isStarted = false;
            _this239.isDestroyed = false;

            _this239.setHasPinnedSelector(selectors);

            _this239.initPinnedBlocks();

            _this239.selectors = [];
            selectors.forEach(function (_selector, index) {
              _this239.selectors.push(_this239.createSelector(_selector, index));
            });

            _this239.sortByBaseSelectors(_this239.selectors);

            _this239.orderPinnedSelectorByType(_this239.selectors);

            _this239.identifyVariables();

            _this239.setContainerCss();

            return _this239;
          }

          var _proto77 = Selectors_.prototype;

          _proto77.getSelectorsIndexByUUID = function getSelectorsIndexByUUID(uuid) {
            var result = null;

            for (var i = 0, l = this.selectors.length; i < l; i++) {
              if (this.selectors[i].UUID === uuid) {
                result = i;
                break;
              }
            }

            return result;
          };

          _proto77.getSelectorByUUID = function getSelectorByUUID(uuid) {
            var result = this.getSelectorsIndexByUUID(uuid);

            if (result !== null) {
              result = this.selectors[result];
            }

            return result;
          };

          _proto77.insertSelectorBefore = function insertSelectorBefore(index, selector) {
            var selectors = this.selectors;
            var selectorsScroll = this.selectorsScroll;

            if (this.hasPinnedSelector) {
              if (!selector.getOptions().pinned) {
                selectors = this.baseSelectorsList;
                index = this.updateIndex(selectors, selector);
              } else if (selector.getOptions().pinned === 'start') {
                selectors = this.pinnedStartList;
                selectorsScroll = $J.$(this.getPinnedScrollContainer(this.pinnedNodeAtStart));
                index = this.updateIndex(selectors, selector);
              } else if (selector.getOptions().pinned === 'end') {
                selectors = this.pinnedEndList;
                selectorsScroll = $J.$(this.getPinnedScrollContainer(this.pinnedNodeAtEnd));
                index = this.updateIndex(selectors, selector);
              }
            }

            var referenceElement = null;

            if (index + 1 < selectors.length) {
              referenceElement = selectors[index + 1].container;
            }

            this.hide();
            selectorsScroll.node.insertBefore(selector.getContainer().node, referenceElement ? referenceElement.node : referenceElement);
          };

          _proto77.insertSelector = function insertSelector(selectorIndex, selectorObj) {
            if (!this.blocksPinnedInited) {
              this.setHasPinnedSelector(selectorObj);
              this.initPinnedBlocks();
              this.addPinnedBlocks();
            }

            var selector = this.createSelector(selectorObj, selectorIndex);

            if (this.isDone) {
              selector.setEvent();
            }

            this.hide();
            this.selectors.splice(selectorIndex, 0, selector);
            this.selectors.forEach(function (_selector, index) {
              _selector.setIndex(index);
            });

            if (selector.getOptions().pinned) {
              this.orderPinnedSelectorByType(selector);

              if (!this.baseSelectorsList || !this.baseSelectorsList.length) {
                this.sortByBaseSelectors(this.selectors);
              }
            } else {
              this.sortByBaseSelectors(this.selectors);
            }

            this.insertSelectorBefore(selectorIndex, selector);
            selector.toggle(this.state);
          };

          _proto77.getScrollContainer = function getScrollContainer(targetSelector) {
            if (targetSelector.pinned === 'start') {
              return this.getPinnedScrollContainer(this.pinnedNodeAtStart);
            } else if (targetSelector.pinned === 'end') {
              return this.getPinnedScrollContainer(this.pinnedNodeAtEnd);
            }

            return this.selectorsScroll;
          };

          _proto77.disableSelector = function disableSelector(selectorUUID) {
            var selector = this.getSelectorByUUID(selectorUUID);

            if (selector) {
              if (this.currentActiveItem && this.currentActiveItem === selector) {
                this.currentActiveItem = null;
              }

              this.hide();
              selector.disable();
            }
          };

          _proto77.enableSelector = function enableSelector(selectorUUID) {
            var selector = this.getSelectorByUUID(selectorUUID);

            if (selector) {
              this.hide();
              selector.enable();
            }
          };

          _proto77.pickOut = function pickOut(selectorUUID) {
            var selector = null;
            var index = this.getSelectorsIndexByUUID(selectorUUID);

            if (index !== null) {
              selector = this.selectors[index];
            }

            if (selector) {
              var pinned = selector.getOptions().pinned;
              selector.destroy();
              this.selectors.splice(index, 1);
              this.selectors.forEach(function (_selector, _index) {
                _selector.setIndex(_index);
              });
              this.reorderDataSelectors(pinned);
            }
          };

          _proto77.reorderDataSelectors = function reorderDataSelectors(statusSelector) {
            if (statusSelector) {
              this.setHasPinnedSelector(this.selectors);
            }

            if (this.hasPinnedSelector && !statusSelector) {
              this.sortByBaseSelectors(this.selectors);
            } else if (this.hasPinnedSelector && statusSelector) {
              this.orderPinnedSelectorByType(this.selectors);
            } else if (!this.hasPinnedSelector) {
              this.baseSelectorsList = [];
              this.pinnedStartList = [];
              this.pinnedEndList = [];
            }
          };

          _proto77.createSelector = function createSelector(selectorData, index) {
            var selector = new Selector(this.getScrollContainer(selectorData), index, selectorData.node, selectorData.UUID, {
              standard: {
                type: this.options.standardStyle,
                size: this.options.standardSize,
                orientation: getOrientation(this.options.standardPosition),
                watermark: this.options.standardWatermark
              },
              fullscreen: {
                type: this.options.fullscreenStyle,
                size: this.options.fullscreenSize,
                orientation: getOrientation(this.options.fullscreenPosition),
                watermark: this.options.fullscreenWatermark
              },
              activeClass: this.options.activeClass,
              selectorContent: selectorData.selectorContent,
              disabled: selectorData.disabled,
              pinned: selectorData.pinned,
              activated: selectorData.activated
            }, selectorData.infoPromise);
            selector.setParent(this);
            return selector;
          };

          _proto77.setEventsFromSelectors = function setEventsFromSelectors() {
            var _this240 = this;

            this.on('selectorAction', function (e) {
              e.stopAll();

              _this240.emit('changeSlide', {
                data: {
                  UUID: e.data
                }
              });

              var index = _this240.getSelectorsIndexByUUID(e.data);

              if (index !== null) {
                _this240.setActiveItem(index);
              }
            });
            var timer;
            this.on('resize', function (e) {
              e.stopAll();
              clearTimeout(timer);
              timer = setTimeout(function () {
                _this240.onResize();
              }, 16);
            });
          };

          _proto77.initPinnedBlocks = function initPinnedBlocks() {
            var getContainers = function () {
              return {
                containerNode: $J.$new('div').addClass(CSS_MAIN_CLASS + '-ss'),
                scrollNode: $J.$new('div').addClass(CSS_MAIN_CLASS + '-scroll').setCss({
                  transform: 'translate3d(0, 0, 0)'
                })
              };
            };

            if (!this.blocksPinnedInited && this.hasPinnedSelector) {
              this.pinnedNodeAtStart = $J.$new('div').addClass(CSS_MAIN_CLASS + '-selectors-pinned-start');
              this.pinnedNodeAtEnd = $J.$new('div').addClass(CSS_MAIN_CLASS + '-selectors-pinned-end');
              var containerNodes = getContainers();
              var startContainer = containerNodes.containerNode;
              startContainer.append(containerNodes.scrollNode);
              this.pinnedNodeAtStart.append(startContainer);
              containerNodes = getContainers();
              var endContainer = containerNodes.containerNode;
              endContainer.append(containerNodes.scrollNode);
              this.pinnedNodeAtEnd.append(endContainer);
              this.blocksPinnedInited = true;
            }
          };

          _proto77.addPinnedBlocks = function addPinnedBlocks() {
            if (this.blocksPinnedInited && this.hasPinnedSelector) {
              this.instanceNode.append(this.pinnedNodeAtStart);
              this.instanceNode.append(this.pinnedNodeAtEnd);
            }
          };

          _proto77.setHasPinnedSelector = function setHasPinnedSelector(dataSelectors) {
            if (Array.isArray(dataSelectors)) {
              if (dataSelectors.length < 1) {
                this.hasPinnedSelector = false;
                return;
              }

              var selectorClass = dataSelectors[0] instanceof Selector;
              this.hasPinnedSelector = dataSelectors.some(function (selector) {
                return isPinned(selectorClass ? selector.getOptions().pinned : selector.pinned);
              });
              return;
            } else if (isPinned(dataSelectors.pinned)) {
              this.hasPinnedSelector = true;
              return;
            }

            this.hasPinnedSelector = false;
          };

          _proto77.orderPinnedSelectorByType = function orderPinnedSelectorByType(dataSelectors) {
            var _this241 = this;

            if (this.hasPinnedSelector) {
              if (Array.isArray(dataSelectors)) {
                this.pinnedStartList = [];
                this.pinnedEndList = [];
                dataSelectors.forEach(function (dataSelector) {
                  var selectorType = dataSelector.options.pinned;

                  if (selectorType === 'start') {
                    _this241.pinnedStartList.push(dataSelector);
                  } else if (selectorType === 'end') {
                    _this241.pinnedEndList.push(dataSelector);
                  }
                });
              } else {
                if (dataSelectors.getOptions().pinned === 'start') {
                  this.pinnedStartList = this.selectors.filter(function (selector) {
                    return selector.getOptions().pinned === 'start';
                  });
                } else if (dataSelectors.getOptions().pinned === 'end') {
                  this.pinnedEndList = this.selectors.filter(function (selector) {
                    return selector.getOptions().pinned === 'end';
                  });
                }
              }
            }
          };

          _proto77.updateIndex = function updateIndex(selectors, selector) {
            return selectors.indexOf(selector);
          };

          _proto77.init = function init() {
            var _this242 = this;

            this.createArrows();
            this.selectorsScrollContainer.append(this.selectorsContainer).appendTo(this.instanceNode);
            this.addPinnedBlocks();

            if (this.arrows) {
              this.arrows.hide();
              var arrowsNodes = this.arrows.getNodes();
              this.selectorsScrollContainer.append(arrowsNodes[0]);
              this.selectorsScrollContainer.append(arrowsNodes[1]);
            }

            this.selectorsContainer.append(this.selectorsScroll);
            this.isShown = true;
            this.hide();
            this.identifyVariables();
            this.setEventsFromSelectors();

            if (!this.currentStylePosition) {
              this.instanceNode.setCssProp('display', 'none');
            }

            Promise.all(this.selectors.map(function (selector) {
              return selector.getProportion();
            })).finally(function () {
              _this242.isReady = true;

              _this242.emit('selectorsReady');
            });
          };

          _proto77.identifyVariables = function identifyVariables() {
            if (this.currentStylePosition) {
              var isHorizontal = getOrientation(this.currentStylePosition) === 'horizontal';
              this.longSide = isHorizontal ? 'width' : 'height';
              this.shortSide = this.longSide === 'width' ? 'height' : 'width';
              this.currentAxis = isHorizontal ? 'x' : 'y';
            } else {
              this.longSide = null;
              this.shortSide = null;
            }
          };

          _proto77.changeSelectors = function changeSelectors(direction) {
            return Promise.all(this.selectors.map(function (selector) {
              return selector.toggle(direction);
            }));
          };

          _proto77.getSelectorsSize = function getSelectorsSize() {
            this.selectors.forEach(function (selector) {
              if (!selector.isDestroyed()) {
                selector.getSize();
              }
            });
          };

          _proto77.enableActions = function enableActions() {
            if (!this.isActionsEnabled) {
              this.isActionsEnabled = true;
              this.show();

              if (this.options.fullscreenAutohide) {
                this.setSelectorsState(true);
              }
            }
          };

          _proto77.disableActions = function disableActions() {
            if (this.isActionsEnabled) {
              this.isActionsEnabled = false;
              this.hide();

              if (this.controlDebounce) {
                this.controlDebounce.cancel();
              }
            }
          };

          _proto77.show = function show(force) {
            if (!this.isShown && this.isActionsEnabled && !this.isDestroyed) {
              var _transition = force ? '' : 'opacity 400ms linear';

              this.isShown = true;
              this.selectorsScroll.setCss({
                display: 'inline-flex'
              }); // for rendering

              this.getSizes();
              this.jump(this.getActiveItem(), true);
              this.instanceNode.setCss({
                opacity: 1,
                visibility: 'visible',
                transition: _transition
              });
            }
          };

          _proto77.getActiveItem = function getActiveItem() {
            return this.currentActiveItem ? this.currentActiveItem.index : 0;
          };

          _proto77.setCurrentActiveItemByUUID = function setCurrentActiveItemByUUID(selectorUUID) {
            var selector = this.getSelectorByUUID(selectorUUID);

            if (selector && !this.currentActiveItem) {
              this.currentActiveItem = selector;
            }
          };

          _proto77.hide = function hide() {
            if (this.isShown) {
              this.isShown = false;
              this.instanceNode.setCss({
                opacity: 0,
                visibility: 'hidden',
                transition: ''
              });
            }
          };

          _proto77.start = function start(parentSlider) {
            var _this243 = this;

            if (!this.isStarted && this.isInView) {
              this.isStarted = true;

              if (this.currentStylePosition) {
                this.changeSelectors(1).then(function () {
                  return globalFunctions.rootDOM.addMainStyle(parentSlider);
                }).then(function () {
                  if (!_this243.isDestroyed) {
                    _this243.getSelectorsSize();

                    _this243.done();

                    _this243.show();
                  }
                });
              } else {
                this.done();
              }
            }
          };

          _proto77.addControl = function addControl() {
            var _this244 = this;

            if (!this.isControlInDoc) {
              this.instanceNode.addEvent('mouseover mouseout', function (e) {
                var relatedTarget = e.getRelated();

                if (relatedTarget) {
                  relatedTarget = $(relatedTarget);
                }

                while (relatedTarget && relatedTarget.node !== _this244.instanceNode.node && relatedTarget.node !== $J.D.node.body) {
                  relatedTarget = relatedTarget.node.parentNode;

                  if (relatedTarget) {
                    relatedTarget = $(relatedTarget);
                  }
                }

                if (!relatedTarget || relatedTarget.node !== _this244.instanceNode.node) {
                  _this244.setControlTimeout(e.type === 'mouseover');
                }
              });
              this.controlButton.addEvent('btnclick tap', function (e) {
                _this244.setControlTimeout(true);

                _this244.setSelectorsState(!_this244.isControlShown);
              });
              $(this.instanceNode.node.parentNode).append(this.controlButton);
              this.controlDebounce = helper.debounce(function () {
                _this244.setSelectorsState(false);
              }, 3000);
              this.isControlInDoc = true;
            }
          };

          _proto77.removeControl = function removeControl() {
            if (this.isControlInDoc) {
              this.instanceNode.removeEvent('mouseover mouseout');
              this.controlDebounce.cancel();
              this.isControlShown = true;
              this.controlButton.removeEvent('btnclick tap');
              this.controlButton.remove();
              this.isControlInDoc = false;
            }
          };

          _proto77.setSelectorsState = function setSelectorsState(open) {
            this.isControlShown = open;
            this.setControlTimeout();
            this.emit('visibility', {
              action: this.isControlShown ? 'show' : 'hide'
            });
          };

          _proto77.setControlTimeout = function setControlTimeout(justClear) {
            if (this.isControlInDoc) {
              this.controlDebounce.cancel();

              if (this.isControlShown && !justClear) {
                this.controlDebounce();
              }
            }
          };

          _proto77.getNode = function getNode() {
            return this.instanceNode;
          };

          _proto77.isHorizontal = function isHorizontal() {
            return getOrientation(this.currentStylePosition) === 'horizontal';
          };

          _proto77.inView = function inView(value, parentSlider) {
            this.isInView = value; // sometimes selectors can be inside external container and we do not know which container with 'Sirv' class name inicialide it
            // so we need pass it for right adding css in shadow dom

            this.start(parentSlider);
          };

          _proto77.done = function done() {
            if (!this.isDone && !this.isDestroyed) {
              this.isDone = true;
              this.getSizes();
              this.selectors.forEach(function (selector) {
                selector.setEvent();
              });
              this.onResize();
              this.setDrag();
              this.emit('selectorsDone');
            }
          };

          _proto77.setActiveItem = function setActiveItem(index) {
            var selector = this.selectors[index];

            if (this.currentActiveItem) {
              this.currentActiveItem.deactivate();
            }

            if (selector && !selector.isDisabled() && selector.activatedSelector()) {
              selector.activate();
              this.currentActiveItem = selector;
            }

            if (!selector.isActivate() && this.currentActiveItem) {
              this.currentActiveItem.activate();
            }
          };

          _proto77.createArrows = function createArrows() {
            var _this245 = this;

            if (!this.options.arrows || this.options.standardStyle === 'grid' && this.options.standardStyle === 'grid') {
              return;
            }

            this.arrows = new Arrows({
              orientation: getOrientation(this.currentPosition || this.options.fullscreenPosition),
              customClass: 'thumbnails'
            });
            this.arrows.setParent(this);
            this.on('arrowAction', function (e) {
              e.stopAll();

              _this245.jump(e.data.type);
            });
          };

          _proto77.isGrid = function isGrid() {
            if (this.state === SELECTORS_STATE.FULLSCREEN) {
              return this.options.isFullscreenGrid;
            }

            return this.options.isStandardGrid;
          };

          _proto77.calculateContainerScroll = function calculateContainerScroll() {
            if (this.hasPinnedSelector || this.blocksPinnedInited) {
              var instanceSize = this.instanceNode.getSize();

              if (this.arrows) {
                this.arrows.hide();
              }

              var maxWidth = instanceSize[this.longSide] - (this.pinnedNodeAtStart.getSize()[this.longSide] + this.pinnedNodeAtEnd.getSize()[this.longSide]);

              if (maxWidth < 0) {
                maxWidth = 0;
              }

              if (this.scrollSize[this.longSide] < maxWidth) {
                maxWidth = this.scrollSize[this.longSide];
              }

              this.selectorsScrollContainer.setCssProp('max-' + this.longSide, maxWidth);
              this.getSizes();
            }
          };

          _proto77.sortByBaseSelectors = function sortByBaseSelectors(selectors) {
            if (this.hasPinnedSelector) {
              this.baseSelectorsList = selectors.filter(function (selector) {
                return !selector.getOptions().pinned;
              });
            }
          };

          _proto77.getIndexBaseSelectors = function getIndexBaseSelectors(index) {
            var result = this.baseSelectorsList.indexOf(this.selectors[index]);

            if (result < 0) {
              result = index;
            }

            return result;
          };

          _proto77.normalizePositionValue = function normalizePositionValue(value) {
            var max = this.containerSize[this.longSide] - this.scrollSize[this.longSide];

            if (this.arrows) {
              this.arrows.disable();

              if (max >= 0 || this.isGrid()) {
                this.arrows.hide();
                this.getSizes();
              } else {
                if (!this.arrows.isShow) {
                  this.arrows.show();
                  this.getSizes();
                }
              }
            }

            if (max === 0) {
              return 0;
            }

            if (this.halfScrollSize <= this.halfContainerSize) {
              value = this.halfContainerSize - this.halfScrollSize;
            } else {
              if (value >= 0) {
                value = 0;

                if (this.arrows) {
                  this.arrows.disable('backward');
                }
              }

              if (value <= max) {
                value = max;

                if (this.arrows) {
                  this.arrows.disable('forward');
                }
              }
            }

            return value;
          };

          _proto77.findItemPosition = function findItemPosition(index) {
            if (!this.selectors[index] || this.selectors[index].options.pinned) {
              return null;
            }

            index = normalizeIndex(index, this.selectors.length);

            if (this.hasPinnedSelector) {
              index = this.getIndexBaseSelectors(index);
            }

            var halfSelectorSize = this.selectors[index].size[this.longSide] / 2;
            var position = 0;
            var currentIndex = 0;

            while (currentIndex < index) {
              if (this.selectors[currentIndex]) {
                position += this.selectors[currentIndex].size[this.longSide];
              }

              currentIndex += 1;
            }

            var transitionPosition = this.halfContainerSize - (position + halfSelectorSize);
            return this.normalizePositionValue(transitionPosition);
          };

          _proto77.stopMoving = function stopMoving() {
            if (this.isMove) {
              var position = helper.getMatrix(this.selectorsScroll);

              if (position) {
                position = position.transform[this.currentAxis];
                this.currentPosition = position;
              }

              this.clearAnimation();
              this.selectorsScroll.setCssProp('transform', 'translate3d(' + convertToTranslateString(this.currentPosition, this.isHorizontal()) + ', 0)');
            }
          };

          _proto77.clearAnimation = function clearAnimation() {
            if (this.selectorsScroll) {
              this.selectorsScroll.removeEvent('transitionend');
              this.selectorsScroll.setCssProp('transition', '');
            }

            this.isMove = false;
          };

          _proto77.jump = function jump(direction, withoutAnimation) {
            var value = this.currentPosition;
            this.stopMoving();

            if ($J.typeOf(direction) === 'string' || $J.typeOf(direction) === 'number') {
              if ($J.typeOf(direction) === 'string') {
                if (direction === 'next') {
                  value -= this.containerSize[this.longSide];
                } else {
                  value += this.containerSize[this.longSide];
                }

                value = this.normalizePositionValue(value);
              } else {
                value = this.findItemPosition(direction);
              }
            } else {
              return;
            }

            if (value !== null) {
              this.move(value, null, withoutAnimation);
            }
          };

          _proto77.move = function move(value, speed, withoutAnimation) {
            var _this246 = this;

            if (!speed) {
              speed = 400;
            }

            if (this.currentPosition === value) {
              return;
            }

            this.selectorsScroll.removeEvent('transitionend');
            var css = {};

            if (!withoutAnimation) {
              this.isMove = true;
              this.selectorsScroll.addEvent('transitionend', function (e) {
                e.stop();

                _this246.clearAnimation();
              });
              css.transition = 'transform ' + getTime(speed, this.containerSize[this.longSide], Math.abs(value) - Math.abs(this.currentPosition)) + 'ms ease';
            }

            css.transform = 'translate3d(' + convertToTranslateString(value, this.isHorizontal()) + ', 0)';
            this.selectorsScroll.setCss(css);
            this.currentPosition = value;
          };

          _proto77.getSizes = function getSizes() {
            this.containerSize = this.selectorsContainer.getSize();
            this.halfContainerSize = this.containerSize[this.longSide] / 2;
            this.scrollSize = this.selectorsScroll.getSize();
            this.halfScrollSize = this.scrollSize[this.longSide] / 2;
          };

          _proto77.setDrag = function setDrag() {
            var _this247 = this;

            var fns = {};
            var lastXY = {
              x: null,
              y: null
            };
            var move = false;
            var containerPosition;
            var last;
            var diffSize;
            var distance;
            var axis;
            var otherAxis;
            var side;
            var direction;
            var startTimeStamp;
            var dragState = 0; // 0 - nothing, 1 - drag, 2 - sroll page

            var getXY = function (x, y) {
              return {
                x: x - containerPosition.left,
                y: y - containerPosition.top
              };
            };

            var getDirection = function (oldValue, newValue) {
              return oldValue > newValue ? 'next' : 'prev';
            };

            var culcDistance = function (dist, speed) {
              var min = dist / 2; // const max = dist * 2;

              return dist + min;
            };

            var onDrag = function (e) {
              fns[e.state](e);
            };

            fns.dragstart = function (e) {
              axis = _this247.currentAxis;
              otherAxis = axis === 'x' ? 'y' : 'x';
              side = _this247.longSide;
              lastXY = {
                x: e.x,
                y: e.y
              };

              if (_this247.containerSize[side] < _this247.scrollSize[side]) {
                move = true;
              }

              containerPosition = _this247.selectorsContainer.getPosition();

              _this247.stopMoving();

              last = getXY(e.x, e.y)[axis];
              diffSize = _this247.containerSize[side] - _this247.scrollSize[side];
              distance = 0;
              startTimeStamp = e.timeStamp;
            };

            fns.dragend = function (e) {
              var value;
              var speed;

              if (move) {
                move = false;
                e.stop();
                speed = e.timeStamp - startTimeStamp;
                value = _this247.currentPosition - culcDistance(distance, speed);

                if (value > 0 || value < diffSize) {
                  if (value > 0) {
                    value = 0;
                  } else {
                    value = diffSize;
                  }
                }

                value = _this247.normalizePositionValue(value);

                _this247.move(value);

                direction = null;
              }

              dragState = 0;
            };

            fns.dragmove = function (e) {
              var point;
              var diff;
              var dir;

              if (!dragState) {
                if (Math.abs(lastXY[axis] - e[axis]) > Math.abs(lastXY[otherAxis] - e[otherAxis])) {
                  dragState = 1;
                } else {
                  dragState = 2;
                }
              }

              if (move && dragState === 1) {
                point = getXY(e.x, e.y);

                if (point[axis] > point[otherAxis]) {
                  e.stop();
                  diff = last - point[axis];
                  _this247.currentPosition -= diff;
                  dir = getDirection(last, point[axis]);

                  if (!direction || dir !== direction) {
                    distance = 0;
                  }

                  distance += diff;
                  last = point[axis];
                  direction = dir;
                }

                _this247.selectorsScroll.setCssProp('transform', 'translate3d(' + convertToTranslateString(_this247.currentPosition, _this247.isHorizontal()) + ', 0)');
              }

              lastXY = {
                x: e.x,
                y: e.y
              };
            };

            this.selectorsContainer.addEvent('mousedrag touchdrag', onDrag);
          };

          _proto77.setContainerCss = function setContainerCss() {
            var css = {};
            var size = this.options.standardSize;

            if (this.state === SELECTORS_STATE.FULLSCREEN) {
              size = this.options.fullscreenSize;
            }

            css['min-' + this.shortSide] = size + 'px';
            css[this.shortSide] = '100%';
            this.instanceNode.setCss(css);
          };

          _proto77.beforeEnterFullscreen = function beforeEnterFullscreen() {
            this.hide();
            this.state = SELECTORS_STATE.FULLSCREEN;
            this.currentStylePosition = this.options.fullscreenPosition;

            if (!this.currentStylePosition) {
              this.instanceNode.setCssProp('display', 'none');
              $(this.instanceNode.node.parentNode).setCssProp('display', 'none');
            }

            this.identifyVariables();
          };

          _proto77.afterEnterFullscreen = function afterEnterFullscreen() {
            var _this248 = this;

            if (this.currentStylePosition) {
              this.instanceNode.setCssProp('display', '');
              $(this.instanceNode.node.parentNode).setCssProp('display', '');
              this.setContainerCss();

              if (this.options.fullscreenAutohide) {
                this.addControl();

                if (this.isActionsEnabled) {
                  this.setSelectorsState(true);
                }
              }

              this.removeStyleForIE();
              this.changeSelectors(2).then(function () {
                _this248.getSelectorsSize();

                setTimeout(function () {
                  _this248.show();
                }, 150); // must be more than resize timeout

                if (_this248.currentStylePosition && _this248.isActionsEnabled) {
                  setTimeout(function () {
                    _this248.setSelectorsState(true);
                  }, 1000);
                }
              });
            }
          };

          _proto77.beforeExitFullscreen = function beforeExitFullscreen() {
            this.hide();
            this.state = SELECTORS_STATE.STANDARD;
            this.currentStylePosition = this.options.standardPosition;

            if (this.options.fullscreenAutohide) {
              this.removeControl();
            }

            if (!this.currentStylePosition) {
              this.instanceNode.setCssProp('display', 'none');
              $(this.instanceNode.node.parentNode).setCssProp('display', 'none');
            }

            this.identifyVariables();
          };

          _proto77.afterExitFullscreen = function afterExitFullscreen() {
            var _this249 = this;

            if (this.currentStylePosition) {
              this.instanceNode.setCssProp('display', '');
              $(this.instanceNode.node.parentNode).setCssProp('display', '');
              this.setContainerCss();
              this.removeStyleForIE();
              this.changeSelectors(1).then(function () {
                _this249.getSelectorsSize();

                _this249.show();
              });
            }
          };

          _proto77.getPinnedScrollContainer = function getPinnedScrollContainer(pinnedNode) {
            return pinnedNode ? pinnedNode.node.firstChild.firstChild : null;
          };

          _proto77.getCurrentStylePosition = function getCurrentStylePosition() {
            return this.getCurrentStylePosition;
          };

          _proto77.removeStyleForIE = function removeStyleForIE() {
            if ($J.browser.uaName === 'ie') {
              this.selectorsScroll.setCssProp(this.shortSide, '');
            }
          };

          _proto77.isSelectorsActionEnabled = function isSelectorsActionEnabled() {
            return this.isActionsEnabled;
          };

          _proto77.getShortSide = function getShortSide() {
            return this.shortSide;
          };

          _proto77.sortSelectorsByUUID = function sortSelectorsByUUID(uuidList) {
            var _this250 = this;

            var sortredSelectors = [];
            uuidList.forEach(function (uuid) {
              for (var i = 0, l = _this250.selectors.length; i < l; i++) {
                if (uuid === _this250.selectors[i].UUID) {
                  sortredSelectors.push(_this250.selectors[i]);
                  break;
                }
              }
            });
            this.selectors = sortredSelectors;
          };

          _proto77.sortNodesSelectors = function sortNodesSelectors(lengthOrder) {
            for (var i = lengthOrder - 1; i >= 0; i--) {
              this.selectorsScroll.node.insertBefore(this.selectors[i].getContainer().node, this.selectorsScroll.node.firstChild);
            }
          };

          _proto77.rewriteSelectorsIndexes = function rewriteSelectorsIndexes() {
            this.selectors.forEach(function (selector, index) {
              selector.setIndex(index);
            });
          };

          _proto77.sortSelectors = function sortSelectors(uuidList, orderLength) {
            this.sortSelectorsByUUID(uuidList);
            this.rewriteSelectorsIndexes();
            this.sortNodesSelectors(orderLength);
          };

          _proto77.onResize = function onResize() {
            var _this251 = this;

            if (this.isDone && this.currentStylePosition && !this.isDestroyed) {
              clearTimeout(this.resizeTimeout);
              this.resizeTimeout = setTimeout(function () {
                // the timer helps calc new size of selectors after changing size of images
                var itemIndex = _this251.getActiveItem();

                _this251.clearAnimation();

                var selectorSize = 0;

                _this251.selectors.forEach(function (selector) {
                  if (!selector.isDestroyed()) {
                    var size = selector.getSize();
                    selectorSize += size[_this251.longSide];
                  }
                });

                if ($J.browser.uaName === 'ie') {
                  if (_this251.isGrid()) {
                    selectorSize = '';
                  }

                  _this251.selectorsScroll.setCssProp(_this251.longSide, selectorSize);
                }

                _this251.getSizes();

                _this251.calculateContainerScroll();

                _this251.setActiveItem(itemIndex);

                _this251.normalizePositionValue();

                _this251.jump(itemIndex, true);

                _this251.show();
              }, 100);
            }
          };

          _proto77.destroy = function destroy() {
            this.isDestroyed = true;
            clearTimeout(this.resizeTimeout);
            this.instanceNode.removeEvent('transitionend');
            this.removeControl();
            this.controlButton = null;
            this.off('selectorAction');
            this.off('resize');
            this.clearAnimation();

            if (this.arrows) {
              this.arrows.destroy();
              this.arrows = null;
              this.off('arrowAction');
            }

            this.selectors.forEach(function (selector) {
              selector.destroy();
            });
            this.selectorsScroll.remove();
            this.selectorsScroll = null;
            this.selectorsContainer.remove();
            this.selectorsContainer = null;
            this.instanceNode.remove();
            this.instanceNode = null;
            this.currentActiveItem = null;

            if (this.blocksPinnedInited) {
              this.hasPinnedSelector = null;
              this.baseSelectorsList = null;
              this.pinnedStartList = null;
              this.pinnedEndList = null;
              this.blocksPinnedInited = false;
              this.pinnedNodeAtEnd = null;
              this.pinnedNodeAtStart = null;
              this.selectorsScrollContainer = null;
              this.pinnedStartList = null;
              this.pinnedEndList = null;
            }

            _EventEmitter25.prototype.destroy.call(this);
          };

          return Selectors_;
        }(EventEmitter);

        return Selectors_;
      }();
      /* eslint-env es6 */

      /* global defaultsVideoOptions */

      /* global EventEmitter */

      /* global helper */

      /* global CSS_MAIN_CLASS */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "slideVideo" }] */


      var slideVideo = function () {
        var correctVideoSrc = function (node) {
          node = $(node);

          var _src = node.attr('data-src');

          if (_src) {
            node.attr('data-src', _src.split('?')[0]);
            node.removeAttr('src');
          } else {
            node.node.src = node.node.src.split('?')[0];
          }

          return node;
        };

        var getOptions = function (node, opts) {
          var options = new $J.Options(defaultsVideoOptions);
          options.fromJSON(opts.common.common);
          options.fromString(opts.local.common);
          options.fromString(node.attr('data-options') || '');

          if ($J.browser.touchScreen && $J.browser.mobile) {
            // options.parseSchema(mobileDefaults, true);
            options.fromJSON(opts.common.mobile);
            options.fromString(opts.local.mobile);
            options.fromString(node.attr('data-mobile-options') || '');
          }

          return options;
        };

        var HTMLVideo = /*#__PURE__*/function (_EventEmitter26) {
          "use strict";

          bHelpers.inheritsLoose(HTMLVideo, _EventEmitter26);

          function HTMLVideo(node, options) {
            var _this252;

            _this252 = _EventEmitter26.call(this) || this;
            _this252.node = $(node);
            _this252.instanceOptions = getOptions(_this252.node, options);

            _this252.option = function () {
              if (arguments.length > 1) {
                return _this252.instanceOptions.set(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]);
              }

              return _this252.instanceOptions.get(arguments.length <= 0 ? undefined : arguments[0]);
            };

            _this252.type = 'video';
            _this252.player = null;
            _this252.state = globalVariables.VIDEO.NONE;
            _this252.isReady = false;
            _this252.isShown = false;
            _this252.id = null;
            _this252.playDebounce = null;
            _this252.currentTime = 0;
            _this252.videoNode = $J.$new('div');
            _this252.videoWrapper = $J.$new('div').addClass(CSS_MAIN_CLASS + '-video').setCss({
              transition: 'opacity .3 linear'
            });

            _this252.videoWrapper.attr('data-video-type', _this252.type);

            _this252.fullscreen = _this252.option('controls.fullscreen');

            _this252.hide();

            return _this252;
          }

          var _proto78 = HTMLVideo.prototype;

          _proto78.isAutoplay = function isAutoplay() {
            return this.option('autoplay');
          };

          _proto78.onBeforeFullscreenIn = function onBeforeFullscreenIn() {
            this.getCurrentTime();
            this.fullscreen = false;
          };

          _proto78.onAfterFullscreenIn = function onAfterFullscreenIn() {};

          _proto78.onBeforeFullscreenOut = function onBeforeFullscreenOut() {
            this.getCurrentTime();
            this.fullscreen = this.option('controls.fullscreen');
          };

          _proto78.onAfterFullscreenOut = function onAfterFullscreenOut() {};

          _proto78.getSize = function getSize() {
            var _this253 = this;

            return new Promise(function (resolve) {
              var size = _this253.videoWrapper.getSize();

              if (size.width && size.height) {
                resolve(size);
              } else {
                helper.videoModule.getAspectRatio(_this253.node).then(function (aspectratio) {
                  if (size.width) {
                    size.height = size.width * aspectratio;
                  } else {
                    size.width = size.height / aspectratio;
                  }

                  resolve(size);
                }).catch(function () {
                  resolve(null);
                });
              }
            });
          };

          _proto78.createPlayer = function createPlayer(player) {
            var _this254 = this;

            this.player = {
              ready: true,
              play: function () {
                _this254.playDebounce();
              },
              pause: function () {
                _this254.player.player.node.pause();
              },
              player: this.node
            };
            this.playDebounce = helper.debounce(function () {
              _this254.player.player.node.play();
            }, 100);

            if (this.option('loop')) {
              this.player.player.attr('loop', 'loop');
            } else {
              this.player.player.removeAttr('loop');
            }

            this.player.player.attr('playsinline', 'playsinline');

            if (this.option('controls.enable')) {
              this.player.player.attr('controls', 'controls');
            } else {
              this.player.player.removeAttr('controls');
            }

            if (this.isAutoplay()) {
              this.player.player.volume = 0;
              this.player.player.attr('muted', 'muted');
            } else {
              this.player.player.volume = this.option('volume') / 100;
            }

            this.player.player.attr('preload', this.option('preload') ? 'auto' : 'none');
            this.setEvents();
            this.emit('slideVideoReady', {
              data: {
                type: this.type,
                error: null
              }
            });
            return Promise.resolve();
          };

          _proto78.getVideoNode = function getVideoNode() {
            return this.videoWrapper;
          };

          _proto78.init = function init() {
            var _this255 = this;

            if (this.type === 'video') {
              var _src = this.node.attr('data-src');

              if (_src) {
                this.node.attr('src', _src);
              }

              $J.$A(this.node.node.children).forEach(function (child) {
                child = $(child);

                if (child && child.getTagName() === 'source') {
                  _src = child.attr('data-src');

                  if (_src) {
                    child.attr('src', _src);

                    if ($J.browser.engine === 'gecko') {
                      child.node.parentNode.load();
                    }
                  }
                }
              });
              this.videoNode = this.node;
            }

            this.id = this.type + '-' + helper.generateUUID();
            this.videoNode.attr('id', this.id);
            this.videoWrapper.append(this.videoNode);
            var data = {
              type: this.type,
              error: null
            };
            helper.videoModule.getAPI(this.node).then(function (player) {
              _this255.createPlayer(player).then(function () {
                data.error = false;
              }).catch(function (_err) {
                data.error = !!_err;
              }).finally(function () {
                _this255.isReady = true; // this.emit('slideVideoReady', { data: data });
              });
            }).catch(function (err) {
              data.error = true;

              _this255.emit('slideVideoReady', {
                data: data
              });
            });
          };

          _proto78.setEvents = function setEvents() {
            var _this256 = this;

            this.player.player.addEvent('play', function (e) {
              e.stop();
              _this256.state = globalVariables.VIDEO.PLAY;

              _this256.emit('slideVideoPlay', {
                data: {
                  type: _this256.type
                }
              });
            });
            this.player.player.addEvent('pause', function (e) {
              e.stop();
              _this256.state = globalVariables.VIDEO.PAUSE;

              _this256.emit('slideVideoPause', {
                data: {
                  type: _this256.type
                }
              });
            });
            this.player.player.addEvent('ended', function (e) {
              e.stop();
              _this256.state = globalVariables.VIDEO.PAUSE;

              _this256.emit('slideVideoEnd', {
                data: {
                  type: _this256.type
                }
              });
            });
          };

          _proto78.play = function play() {
            if (this.player && this.player.ready) {
              this.setCurrentTime();
              this.player.play();
            }
          };

          _proto78.pause = function pause() {
            if (this.player && this.player.ready) {
              this.player.pause();
            }
          };

          _proto78.getCurrentTime = function getCurrentTime() {
            if (this.player && this.player.player) {
              this.currentTime = this.player.player.currentTime;
            }
          };

          _proto78.setCurrentTime = function setCurrentTime() {
            if (this.player && this.player.ready) {
              this.player.player.currentTime = this.currentTime;
            }
          };

          _proto78.isPreStart = function isPreStart() {
            return this.state === globalVariables.VIDEO.NONE;
          };

          _proto78.isPaused = function isPaused() {
            return this.state === globalVariables.VIDEO.PAUSE;
          };

          _proto78.show = function show() {
            this.isShown = true;
            this.videoWrapper.setCssProp('opacity', 1);
          };

          _proto78.hide = function hide() {
            this.isShown = false;
            this.videoWrapper.setCssProp('opacity', 0);
          };

          _proto78.destroy = function destroy() {
            if (this.playDebounce) {
              this.playDebounce.cancel();
              this.playDebounce = null;
            }

            this.pause();
            this.videoWrapper.remove();
            this.node = correctVideoSrc(this.node);

            if (this.type === 'video') {
              $J.$A(this.node.node.children).forEach(function (child) {
                if ($(child).getTagName() === 'source') {
                  correctVideoSrc(child);
                }
              });
            }

            _EventEmitter26.prototype.destroy.call(this);
          };

          return HTMLVideo;
        }(EventEmitter);

        var YouTubeVideo = /*#__PURE__*/function (_HTMLVideo) {
          "use strict";

          bHelpers.inheritsLoose(YouTubeVideo, _HTMLVideo);

          function YouTubeVideo(node, options) {
            var _this257;

            _this257 = _HTMLVideo.call(this, node, options) || this;
            _this257.type = 'youtube';
            _this257.playerState = -1;

            _this257.videoWrapper.attr('data-video-type', _this257.type);

            _this257.apiPlayer = null;
            return _this257;
          }

          var _proto79 = YouTubeVideo.prototype;

          _proto79.setCurrentTime = function setCurrentTime() {
            if (this.player && this.player.ready) {
              this.player.player.seekTo(this.currentTime);
            }
          };

          _proto79.getCurrentTime = function getCurrentTime() {
            if (this.player && this.player.player) {
              if (this.player.player.getCurrentTime) {
                this.currentTime = this.player.player.getCurrentTime();
              } else {
                this.currentTime = 0;
              }
            }
          };

          _proto79.destroyVideoPlayer = function destroyVideoPlayer() {
            this.getCurrentTime();

            if (this.player && this.player.player) {
              this.player.ready = false;
              this.player.player.destroy();
            }

            this.playerState = -1;
          };

          _proto79.onBeforeFullscreenIn = function onBeforeFullscreenIn() {
            this.fullscreen = false; // we must destroy and create player because the 'onStateChange' won't work after change DOM

            this.destroyVideoPlayer();
          };

          _proto79.onAfterFullscreenIn = function onAfterFullscreenIn() {
            this.createPlayer(this.apiPlayer);
          };

          _proto79.onBeforeFullscreenOut = function onBeforeFullscreenOut() {
            this.fullscreen = this.option('controls.fullscreen'); // we must destroy and create player because the 'onStateChange' won't work after change DOM

            this.destroyVideoPlayer();
          };

          _proto79.onAfterFullscreenOut = function onAfterFullscreenOut() {
            this.createPlayer(this.apiPlayer);
          };

          _proto79.createPlayer = function createPlayer(player) {
            var _this258 = this;

            this.apiPlayer = player;
            return new Promise(function (resolve, reject) {
              var videoID = helper.videoModule.getId(_this258.node);
              _this258.player = {
                ready: false,
                play: function () {
                  _this258.player.player.playVideo();
                },
                pause: function () {
                  _this258.player.player.pauseVideo();
                },
                player: new player.Player(_this258.id, {
                  videoId: videoID,
                  playerVars: {
                    playlist: videoID,
                    // it is just for loop parameter
                    fs: _this258.fullscreen ? 1 : 0,
                    rel: 0,
                    loop: _this258.option('loop') ? 1 : 0,
                    autoplay: 0,
                    playsinline: 1,
                    controls: _this258.option('controls.enable') ? 1 : 0
                  },
                  events: {
                    'onReady': function () {
                      _this258.playerState = -1;
                      _this258.player.ready = true;

                      _this258.player.player.setVolume(_this258.option('volume'));

                      _this258.emit('slideVideoReady', {
                        data: {
                          type: _this258.type,
                          error: null
                        }
                      });

                      resolve();
                    },
                    'onError': function (err) {
                      if (err.data === 100) {
                        // 'Video is not found'
                        _this258.player = null;
                      }

                      _this258.emit('slideVideoReady', {
                        data: {
                          type: _this258.type,
                          error: true
                        }
                      });

                      reject(true);
                    },
                    'onStateChange': _this258.setEvents.bind(_this258)
                  }
                })
              };
            });
          };

          _proto79.setEvents = function setEvents(e) {
            var state = (e.target || e.getTarget()).getPlayerState();
            this.playerState = state;

            if (this.state === globalVariables.VIDEO.PLAY) {
              this.state = globalVariables.VIDEO.PAUSE;
            }

            switch (state) {
              case -1:
                break;

              case 0:
                // console.log('finish');
                if (!this.option('loop')) {
                  this.player.pause();
                }

                this.emit('slideVideoEnd', {
                  data: {
                    type: this.type
                  }
                });
                break;

              case 1:
                // console.log('play');
                this.state = globalVariables.VIDEO.PLAY;
                this.emit('slideVideoPlay', {
                  data: {
                    type: this.type
                  }
                });
                break;

              case 2:
                // console.log('pause');
                this.state = globalVariables.VIDEO.PAUSE;
                this.emit('slideVideoPause', {
                  data: {
                    type: this.type
                  }
                });
                break;

              case 3:
                // console.log('buffering');
                break;

              case 5:
                // console.log('video cued');
                break;
              // no default
            }
          };

          _proto79.destroy = function destroy() {
            _HTMLVideo.prototype.destroy.call(this);

            if (this.player && this.player.player) {
              this.player.player.destroy();
              this.player.player = null;
            }
          };

          return YouTubeVideo;
        }(HTMLVideo); // urls
        // http://vimeo.com/6701902
        // http://vimeo.com/670190233
        // https://vimeo.com/11111111
        // https://www.vimeo.com/11111111
        // http://player.vimeo.com/video/67019023
        // http://player.vimeo.com/video/67019022?title=0&byline=0&portrait=0
        // https://vimeo.com/channels/11111111
        // http://vimeo.com/channels/vimeogirls/6701902
        // http://vimeo.com/channels/staffpicks/6701902
        // https://vimeo.com/album/2222222/video/11111111
        // https://vimeo.com/groups/name/videos/11111111
        // https://vimeo.com/11111111?param=test
        // wrong
        // http://vimeo.com/videoschool
        // http://vimeo.com/videoschool/archive/behind_the_scenes
        // http://vimeo.com/forums/screening_room
        // http://vimeo.com/forums/screening_room/topic:42708


        var VimeoVideo = /*#__PURE__*/function (_HTMLVideo2) {
          "use strict";

          bHelpers.inheritsLoose(VimeoVideo, _HTMLVideo2);

          function VimeoVideo(node, options) {
            var _this259;

            _this259 = _HTMLVideo2.call(this, node, options) || this;
            _this259.type = 'vimeo';
            _this259.apiPlayer = null;

            _this259.videoWrapper.attr('data-video-type', _this259.type);

            return _this259;
          }

          var _proto80 = VimeoVideo.prototype;

          _proto80.createPlayer = function createPlayer(player) {
            var _this260 = this;

            this.apiPlayer = player;
            return new Promise(function (resolve, reject) {
              _this260.videoNode.attr('data-vimeo-id', helper.videoModule.getId(_this260.node));

              if (player.Player) {
                var tmp = _this260.videoNode.attr('data-src');

                if (tmp) {
                  _this260.videoNode.attr('src', tmp);
                }

                var opt = {
                  id: helper.videoModule.getId(_this260.node),
                  loop: _this260.option('loop'),
                  controls: _this260.option('controls.enable'),
                  speed: _this260.option('controls.speed')
                };
                _this260.player = {
                  ready: false,
                  play: function () {
                    _this260.player.player.setVolume(0);

                    _this260.player.player.play();
                  },
                  pause: function () {
                    _this260.player.player.pause();
                  },
                  player: new player.Player(_this260.videoNode.node, opt)
                };

                _this260.setEvents(resolve);
              } else {
                reject(true);
              }
            });
          };

          _proto80.destroyVideoPlayer = function destroyVideoPlayer() {
            if (this.player && this.player.player) {
              this.player.ready = false;
              this.player.player.destroy();
            }
          };

          _proto80.play = function play() {
            if (this.player && this.player.ready) {
              this.setCurrentTime();
              this.player.play();
            }
          };

          _proto80.onBeforeFullscreenIn = function onBeforeFullscreenIn() {
            this.destroyVideoPlayer();
          };

          _proto80.onAfterFullscreenIn = function onAfterFullscreenIn() {
            this.createPlayer(this.apiPlayer);
          };

          _proto80.onBeforeFullscreenOut = function onBeforeFullscreenOut() {
            this.destroyVideoPlayer();
          };

          _proto80.onAfterFullscreenOut = function onAfterFullscreenOut() {
            this.createPlayer(this.apiPlayer);
          };

          _proto80.getCurrentTime = function getCurrentTime() {};

          _proto80.setCurrentTime = function setCurrentTime() {
            if (this.player && this.player.ready) {
              this.player.player.setCurrentTime(this.currentTime);
            }
          };

          _proto80.setEvents = function setEvents(callback) {
            var _this261 = this;

            this.player.player.on('play', function () {
              _this261.state = globalVariables.VIDEO.PLAY;

              _this261.emit('slideVideoPlay', {
                data: {
                  type: _this261.type
                }
              });
            });
            this.player.player.on('pause', function () {
              _this261.state = globalVariables.VIDEO.PAUSE;

              _this261.emit('slideVideoPause', {
                data: {
                  type: _this261.type
                }
              });
            });
            this.player.player.on('ended', function () {
              _this261.state = globalVariables.VIDEO.PAUSE;

              _this261.emit('slideVideoEnd', {
                data: {
                  type: _this261.type
                }
              });
            });
            this.player.player.on('loaded', function () {// empty
            });
            this.player.player.on('timeupdate', function (data) {
              _this261.currentTime = data.seconds;
            }); // vimeo api bug
            // If we use the ready event before then we add listerners of vimeo events then events do not work

            if (this.player.player) {
              this.player.player.ready().then(function () {
                _this261.player.ready = true;

                if (_this261.state === globalVariables.VIDEO.PLAY) {
                  _this261.state = globalVariables.VIDEO.PAUSE;
                }

                _this261.player.player.setVolume(0); // this.player.player.setVolume(this.option('volume') / 100);


                _this261.emit('slideVideoReady', {
                  data: {
                    type: _this261.type,
                    error: null
                  }
                });

                callback();
              });
            } else {
              this.emit('slideVideoReady', {
                data: {
                  type: this.type,
                  error: new Error('Player does not exist.')
                }
              });
            }
          };

          _proto80.destroy = function destroy() {
            _HTMLVideo2.prototype.destroy.call(this);

            this.videoNode.remove();
            this.videoNode = null;
            this.videoWrapper.remove();
            this.videoWrapper = null;

            if (this.player && this.player.player) {
              this.player.player.destroy();
              this.player.player = null;
            }

            this.node = null;
          };

          return VimeoVideo;
        }(HTMLVideo);

        return {
          HTMLVideo: HTMLVideo,
          YouTubeVideo: YouTubeVideo,
          VimeoVideo: VimeoVideo
        };
      }();
      /* eslint-env es6 */

      /* global helper */

      /* global $, $J, EventEmitter, SocialButtons */

      /* global ComponentLoader, ResponsiveImage */

      /* eslint-disable no-lonely-if */

      /* global SirvService, CSS_MAIN_CLASS, SELECTOR_TAG, SELECTOR_CLASS, slideVideo */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Slide" }] */


      var Slide = function () {
        var CAN_ZOOM_CLASS = CSS_MAIN_CLASS + '-can-zoom';
        /**
         * because that css can take much time for loading
         * and we can get wrong sizes
         */

        var NECESSARY_CSS = {
          top: 0,
          left: 0,
          width: '100%',
          height: '100%'
        };

        var getContentSize = function (node, count) {
          return new Promise(function (resolve) {
            node = $(node);

            if (count === undefined) {
              count = 10;
            }

            if (count > 0) {
              var size = node.getSize();

              if (!size.width || !size.height) {
                setTimeout(function () {
                  count -= 1;
                  getContentSize(node, count).then(resolve);
                }, 32);
              } else {
                resolve(size);
              }
            } else {
              resolve(null);
            }
          });
        };

        var findSomethingForSelector = function (node) {
          var result = {
            type: 'node',
            data: null
          };

          if (helper.videoModule.isVideo(node)) {
            result.type = helper.videoModule.getType(node);

            if (!result.type) {
              result.data = $J.$new('div');
            }
          } else {
            var tmp;
            var src;

            if ($(node).getTagName() === 'img') {
              tmp = node;
            } else {
              try {
                tmp = node.getElementsByTagName('img')[0];
              } catch (e) {// empty
              }
            }

            if (tmp) {
              src = helper.sliderLib.getSrc($(tmp).attr('src')) || helper.sliderLib.getSrc($(tmp).attr('data-src'));
            }

            if (src) {
              result.type = 'img';
              result.data = src;
            } else {
              if (node.cloneNode) {
                tmp = node.cloneNode(true);
              } else {
                tmp = $J.$new('div');
              }

              result.data = tmp;
            }
          }

          return result;
        };

        var getCustomSelectorNode = function (node) {
          var result = $(node.node.querySelector(SELECTOR_TAG));

          if (!result) {
            if (node.getTagName() === SELECTOR_TAG) {
              result = node;
            } else {
              result = null;
            }
          }

          return result;
        };

        var Slide_ = /*#__PURE__*/function (_EventEmitter27) {
          "use strict";

          bHelpers.inheritsLoose(Slide_, _EventEmitter27);

          function Slide_(node, index, options, isCustomAdded) {
            var _this262;

            _this262 = _EventEmitter27.call(this) || this;
            _this262.$J_UUID = $J.$uuid(bHelpers.assertThisInitialized(_this262));
            _this262.groups = ($(node).attr('data-group') || '').split(/\s*(?:,|$)\s*/);
            var slideData = Slide.parse(node);
            _this262.id = slideData.id; // data-id attr

            _this262.enabled = slideData.enabled;
            _this262.type = slideData.type;
            _this262.url = slideData.url;
            _this262.slideContent = $(node);
            _this262.index = index;
            _this262.isCustomAdded = isCustomAdded || false;
            _this262.options = {};

            _this262.setOptions(options);

            _this262.instanceNode = $J.$new('div').addClass(CSS_MAIN_CLASS + '-slide').setCss({
              position: 'absolute'
            });

            _this262.instanceNode.setCss(NECESSARY_CSS);

            _this262.contentWrapper = $J.$new('div').addClass(CSS_MAIN_CLASS + '-content');

            _this262.contentWrapper.setCss(NECESSARY_CSS);

            _this262.fullscreenOnlyNode = null;
            _this262.selector = {
              UUID: _this262.$J_UUID,
              isCustom: false,
              node: getCustomSelectorNode(_this262.slideContent),
              isSirv: false,
              isVideo: false,
              selectorContent: null,
              size: {
                width: 0,
                height: 0
              },
              src: null,
              srcset: null,
              pinned: null,
              activated: true,
              infoPromise: null,
              isStatic: false
            };
            _this262.selector.isStatic = Slide_.checkNonSirv(_this262.selector.node);
            _this262.selector.pinned = Slide_.findPinnedSelectorSide(_this262.slideContent.node.querySelector(SELECTOR_TAG) || _this262.slideContent.node);
            _this262.selector.isCustom = !!_this262.selector.node;
            _this262.thumbnailReferrerPolicy = _this262.getSelectorReferrerPolicy();
            _this262.availableSlide = true;
            _this262.isStartedFullInit = false;
            _this262.fullscreenState = globalVariables.FULLSCREEN.CLOSED;
            _this262.isStarted = false;
            _this262.sirvService = null;
            _this262.componentSize = null;
            _this262.inView = false;
            _this262.isActive = false;
            _this262.isReady = false;
            _this262.video = null;
            _this262.isVideoPaused = false;
            _this262.isVideoReady = false;
            _this262.slideShownBy = globalVariables.SLIDE_SHOWN_BY.NONE;
            _this262.componentLoader = null;
            _this262.infoSize = null;
            _this262.sizePromise = null;
            _this262.isInDom = 0; // 0 / 1

            _this262.multiImages = [];
            _this262.lastOriginNode = null;
            _this262.dataThumbnailImage = _this262.getThumbnailImage();
            _this262.dataThumbnailHtml = _this262.slideContent.attr('data-thumbnail-html');
            _this262.dataHiddenSelector = _this262.slideContent.hasAttribute('data-hidden-selector'); // Disables switching slides by swipe on touchscreen.

            _this262.swipeDisabled = _this262.slideContent.hasAttribute('data-swipe-disabled');
            _this262.spinWasInited = false;
            _this262.socialbuttons = null;
            _this262.getVideoThumbnailPromise = null;
            _this262.isPlaceholder = false;
            _this262.customThumbnailImageClassPromise = null;
            var this_ = bHelpers.assertThisInitialized(_this262);
            _this262.api = {
              get index() {
                return this_.index;
              },

              get component() {
                if (this_.sirvService) {
                  return globalVariables.SLIDE.NAMES[this_.sirvService.getType()];
                }

                return 'unknown';
              },

              get groups() {
                return this_.groups;
              },

              get thumbnail() {
                return this_.selector.node.node;
              },

              isDisabled: function () {
                return !this_.enabled;
              },
              isActive: function () {
                return this_.isActive;
              },
              getSelector: function () {
                return this.thumbnail;
              } // for backward compatibility

            };

            _this262.sendEventCloseFullscreenByClick = function (e) {
              e.stop();

              _this262.emit('goToFullscreenOut');
            };

            _this262.beforeParseSlide();

            _this262.parseSlide();

            return _this262;
          }

          Slide_.findPinnedSelectorSide = function findPinnedSelectorSide(node) {
            if (node.hasAttribute('data-pinned')) {
              var attrValue = $J.$(node).attr('data-pinned');
              return attrValue !== 'start' ? 'end' : attrValue;
            }

            return null;
          };

          Slide_.parse = function parse(node) {
            node = $(node); // const result = { node: node.node };

            var result = {};
            result.node = node.node;
            result.id = node.attr('data-id');
            var url = null;
            var type = globalVariables.SLIDE.TYPES.HTML;
            var enabled = true;
            /*
                spin, zoom, image, video, html
            */

            if (Slide.isSirvComponent(node)) {
              var tmp = helper.getSirvType(node);
              type = tmp.type;
              url = tmp.imgSrc;
            } else if (helper.videoModule.isVideo(node)) {
              type = globalVariables.SLIDE.TYPES.VIDEO;
              url = helper.videoModule.getSrc(node);
            } else if (node.getTagName() === 'img' || node.getTagName() === 'div' && node.attr('data-src')) {
              type = globalVariables.SLIDE.TYPES.IMAGE;
              url = node.attr('data-src') || node.attr('src');
            }

            result.type = type;
            result.url = url;
            var slideIsDisabled = node.node.getAttribute('data-disabled'); // don't use .attr() method

            if (slideIsDisabled && slideIsDisabled !== 'false' || slideIsDisabled === '') {
              enabled = false;
            }

            result.enabled = enabled;
            return result;
          };

          Slide_.checkNonSirv = function checkNonSirv(node) {
            if (node && $(node).attr('data-type') === 'static') {
              return true;
            }

            return false;
          };

          Slide_.isSirvComponent = function isSirvComponent(node) {
            node = $(node); // const dataEffect = node.attr('data-type') || node.attr('data-effect');

            var dataSrc = node.attr('data-src');
            var src = node.attr('src');
            var nonSirv = Slide.checkNonSirv(node);
            var tagName = node.getTagName();
            var viewContent = node.fetch('view-content');

            if (!nonSirv && ( // (tagName === 'div' && !$J.contains(['youtube', 'vimeo'], helper.videoModule.getType(dataSrc)) && (dataEffect === 'zoom' || helper.isSpin(dataSrc) || helper.isVideo(dataSrc))) ||
            viewContent || tagName === 'div' && !$J.contains(['youtube', 'vimeo'], helper.videoModule.getType(dataSrc)) && dataSrc || tagName === 'img' && (dataSrc || src))) {
              return true;
            }

            return false;
          };

          Slide_.hasComponent = function hasComponent(node) {
            return SirvService.isExist(node);
          };

          var _proto81 = Slide_.prototype;

          _proto81.isSwipeDisabled = function isSwipeDisabled() {
            return this.swipeDisabled;
          };

          _proto81.getThumbnailImage = function getThumbnailImage() {
            var result = this.slideContent.attr('data-thumbnail-image');

            if (!result && this.selector.isCustom) {
              result = this.selector.node.attr('data-src');

              if (!result) {
                var children = this.selector.node.node.children;

                if (children.length === 1 && $(children[0]).getTagName() === 'img') {
                  result = $(children[0]).attr('data-src') || $(children[0]).attr('src');
                }
              }
            }

            return result;
          };

          _proto81.startGettingInfo = function startGettingInfo() {
            if (this.isSirv()) {
              this.sirvService.startGettingInfo();
            }
          };

          _proto81.loadContent = function loadContent() {
            var _this263 = this;

            if (this.isSirv()) {
              this.getSlideSize().then(function (infoSize) {
                if (_this263.isInDom) {
                  _this263.sirvService.loadContent();
                }
              }).catch(function (err) {});
            }
          };

          _proto81.loadThumbnail = function loadThumbnail() {
            var _this264 = this;

            if (this.isSirv()) {
              this.getSlideSize().then(function (infoSize) {
                if (_this264.isInDom) {
                  _this264.sirvService.loadThumbnail();
                }
              }).catch(function (err) {});
            }
          };

          _proto81.isVideoSlide = function isVideoSlide() {
            var result = false;

            if (this.isSirv()) {
              result = this.sirvService.getType() === globalVariables.SLIDE.TYPES.VIDEO;
            } else if (this.video) {
              result = true;
            }

            return result;
          };

          _proto81.belongsTo = function belongsTo(group) {
            var _this265 = this;

            var result = false;

            if (group) {
              if ($J.typeOf(group) === 'string') {
                group = [group];
              }

              result = group.some(function (g) {
                return $J.contains(_this265.groups, g);
              });
            }

            return result;
          };

          _proto81.addGroup = function addGroup(newGroup) {
            var result = false;

            if (newGroup && $J.typeOf(newGroup) === 'string' && !$J.contains(this.groups, newGroup)) {
              result = true;
              this.groups.push(newGroup);
            }

            return result;
          };

          _proto81.removeGroup = function removeGroup(group) {
            var result = false;

            if (group && $J.typeOf(group) === 'string') {
              var index = this.groups.indexOf(group);

              if (index > -1) {
                result = true;
                this.groups.splice(index, 1);
              }
            }

            return result;
          };

          _proto81.isCustomSelector = function isCustomSelector() {
            return this.selector.isCustom;
          };

          _proto81.single = function single(isSingle) {
            if (this.isSirv()) {
              this.broadcast('isSingleSlide', {
                data: {
                  isSingle: isSingle
                }
              });
            }
          };

          _proto81.setNewIndex = function setNewIndex(index) {
            this.index = index;
          };

          _proto81.getIndex = function getIndex() {
            return this.index;
          };

          _proto81.checkReadiness = function checkReadiness(eventName, component) {
            var result = false;

            if (this.isSirv() && globalVariables.SLIDE.NAMES[this.sirvService.getType()] === component) {
              if (eventName === 'init') {
                result = this.spinWasInited;
              } else {
                result = this.isReady;
              }
            }

            return result;
          };

          _proto81.sendReadyEvent = function sendReadyEvent(eventName, component) {
            if (this.isSirv() && globalVariables.SLIDE.NAMES[this.sirvService.getType()] === component) {
              this.sirvService.sendEvent(eventName);
            }
          };

          _proto81.createFullscreenOnlyScreen = function createFullscreenOnlyScreen() {
            var _this266 = this;

            if (this.options.fullscreenOnly) {
              this.fullscreenOnlyNode = $J.$new('div').addClass(CSS_MAIN_CLASS + '-fullscreen-always'); // this.fullscreenOnlyNode.addEvent('mousedown touchstart', (e) => {

              this.fullscreenOnlyNode.addEvent('btnclick tap', function (e) {
                e.stop();

                _this266.emit('goToFullscreen');
              });
              this.createPinchEvent(this.fullscreenOnlyNode);
              this.instanceNode.append(this.fullscreenOnlyNode, 'top');
            }
          };

          _proto81.createPinchEvent = function createPinchEvent(node) {
            var _this267 = this;

            if ($J.browser.touchScreen) {
              // difference between scale
              var FS_IN = 2;
              node.addEvent('pinch', function (e) {
                e.stop();

                switch (e.state) {
                  case 'pinchend':
                    if (_this267.fullscreenState === 0 && e.scale >= FS_IN) {
                      _this267.emit('goToFullscreen');
                    }

                    break;

                  default:
                }
              });
            }
          };

          _proto81.isEnabled = function isEnabled() {
            return this.enabled;
          };

          _proto81.disable = function disable() {
            this.enabled = false;

            if (this.video) {
              this.video.pause();
            }

            if (this.componentLoader) {
              this.componentLoader.hide(true);
            }
          };

          _proto81.enable = function enable() {
            this.enabled = true;
          };

          _proto81.isBlokedTouchdrag = function isBlokedTouchdrag() {
            var result = false;

            if (this.isSirv()) {
              if (this.sirvService.getType() === globalVariables.SLIDE.TYPES.SPIN) {
                result = true;
              } else {
                result = this.sirvService.isEffectActive();
              }
            }

            return result;
          };

          _proto81.setOptions = function setOptions(options) {
            this.options = $J.extend({
              spin: {},
              zoom: {},
              image: {},
              video: {},
              fullscreenOnly: false
            }, options || {});
          };

          _proto81.dragEvent = function dragEvent(type) {
            if (this.sirvService) {
              this.broadcast('dragEvent', {
                data: {
                  type: type
                }
              });
            }
          };

          _proto81.startFullInit = function startFullInit(options) {
            if (this.isStartedFullInit) {
              return;
            }

            this.isStartedFullInit = true;

            if (options) {
              this.setOptions(options);
            }

            if (this.sirvService) {
              this.sirvService.startFullInit(options ? this.options : null);
            }

            this.hide();
            this.instanceNode.append(this.contentWrapper);

            if (!this.isSirv()) {
              this.appendToDOM();
            }
          };

          _proto81.createComponentLoader = function createComponentLoader() {
            if (!this.componentLoader) {
              this.componentLoader = new ComponentLoader(this.instanceNode);
              this.componentLoader.show();
            }
          };

          _proto81.isSlideAvailable = function isSlideAvailable() {
            return this.availableSlide;
          };

          _proto81.isSelectorPinned = function isSelectorPinned() {
            return $J.contains(['start', 'end'], this.selector.pinned);
          };

          _proto81.getPinnedSelectorSide = function getPinnedSelectorSide() {
            return this.selector.pinned;
          };

          _proto81.setFullscreenEvents = function setFullscreenEvents() {
            var _this268 = this;

            this.on('beforeFullscreenIn', function (e) {
              if (_this268.fullscreenState === globalVariables.FULLSCREEN.OPENING) {
                e.stopPropagation();
              } else {
                _this268.fullscreenState = globalVariables.FULLSCREEN.OPENING;

                if (_this268.video) {
                  _this268.isVideoPaused = _this268.video.isPaused();

                  _this268.video.onBeforeFullscreenIn();
                }
              }

              if (_this268.fullscreenOnlyNode) {
                _this268.fullscreenOnlyNode.setCssProp('display', 'none');
              }

              _this268.addEventCloseFullscreenByClick();
            });
            this.on('afterFullscreenIn', function (e) {
              if (_this268.socialbuttons) {
                _this268.socialbuttons.closeButtons();
              }

              if (_this268.fullscreenState === globalVariables.FULLSCREEN.OPENED) {
                e.stopPropagation();
              } else {
                _this268.fullscreenState = globalVariables.FULLSCREEN.OPENED;

                if (_this268.isSirv() && _this268.componentLoader.isHiding()) {
                  _this268.componentLoader.hide(true);
                }

                if (_this268.video) {
                  _this268.video.onAfterFullscreenIn();

                  if (_this268.video.isAutoplay() || !_this268.video.isPreStart()) {
                    _this268.playVideo();
                  }
                }
              }
            });
            this.on('beforeFullscreenOut', function (e) {
              if (_this268.socialbuttons) {
                _this268.socialbuttons.closeButtons();
              }

              if (_this268.fullscreenState === globalVariables.FULLSCREEN.CLOSING) {
                e.stopPropagation();
              } else {
                _this268.fullscreenState = globalVariables.FULLSCREEN.CLOSING;

                if (_this268.video) {
                  _this268.isVideoPaused = _this268.video.isPaused();

                  _this268.video.onBeforeFullscreenOut();
                }
              }

              if (_this268.fullscreenOnlyNode) {
                _this268.fullscreenOnlyNode.setCssProp('display', '');
              }
            });
            this.on('afterFullscreenOut', function (e) {
              if (_this268.fullscreenState === globalVariables.FULLSCREEN.CLOSED) {
                e.stopPropagation();
              } else {
                _this268.fullscreenState = globalVariables.FULLSCREEN.CLOSED;

                if (_this268.video) {
                  _this268.video.onAfterFullscreenOut();

                  if (_this268.video.isAutoplay() || !_this268.video.isPreStart()) {
                    _this268.playVideo();
                  }
                }
              }

              _this268.removeEventCloseFullscreeByClick();
            });
            this.on('inView', function (e) {
              _this268.inView = e.data;

              if (_this268.video) {
                if (_this268.inView) {
                  if (!_this268.isVideoPaused && !_this268.video.isPreStart() || _this268.video.isAutoplay()) {
                    _this268.playVideo();
                  }
                } else {
                  _this268.isVideoPaused = _this268.video.isPaused();

                  _this268.video.getCurrentTime();

                  _this268.video.pause();
                }
              }
            });
          };

          _proto81.addEventCloseFullscreenByClick = function addEventCloseFullscreenByClick() {
            if (this.options.fullscreenOnly && this.type === globalVariables.SLIDE.TYPES.IMAGE) {
              this.contentWrapper.addEvent('btnclick tap', this.sendEventCloseFullscreenByClick);
              this.slideContent.addEvent('btnclick tap', this.sendEventCloseFullscreenByClick);
            }
          };

          _proto81.removeEventCloseFullscreeByClick = function removeEventCloseFullscreeByClick() {
            if (this.options.fullscreenOnly && this.type === globalVariables.SLIDE.TYPES.IMAGE) {
              this.contentWrapper.removeEvent('btnclick tap', this.sendEventCloseFullscreenByClick);
              this.slideContent.removeEvent('btnclick tap', this.sendEventCloseFullscreenByClick);
            }
          };

          _proto81.isSirv = function isSirv() {
            return !!this.sirvService;
          };

          _proto81.getNode = function getNode() {
            return this.instanceNode;
          };

          _proto81.getOriginNode = function getOriginNode() {
            return this.lastOriginNode || this.slideContent;
          };

          _proto81.getOriginImageUrl = function getOriginImageUrl() {
            if (this.isSirv()) {
              return this.sirvService.getOriginImageUrl();
            }

            return null;
          };

          _proto81.zoomIn = function zoomIn(x, y) {
            this.broadcast('zoomUp', {
              data: {
                x: x,
                y: y
              }
            });
          };

          _proto81.zoomOut = function zoomOut(x, y) {
            this.broadcast('zoomDown', {
              data: {
                x: x,
                y: y
              }
            });
          };

          _proto81.mouseAction = function mouseAction(type, originEvent) {
            if (this.isSirv()) {
              this.broadcast('mouseAction', {
                data: {
                  type: type,
                  originEvent: originEvent
                }
              });
            }
          };

          _proto81.getZoomData = function getZoomData() {
            if (this.isSirv()) {
              return this.sirvService.getZoomData();
            }

            return null;
          };

          _proto81.getTypeOfSlide = function getTypeOfSlide() {
            var result = null;

            if (this.isSirv()) {
              result = this.sirvService.getType();
            }

            return result;
          };

          _proto81.getOptions = function getOptions() {
            return this.isSirv() ? this.sirvService.getToolOptions() : {};
          };

          _proto81.createSlideApi = function createSlideApi() {
            if (this.isSirv() && !this.isStarted) {
              this.isStarted = true;
              this.api[globalVariables.SLIDE.NAMES[this.sirvService.getType()]] = this.sirvService.getData();
            }
          };

          _proto81.beforeShow = function beforeShow() {
            this.isActive = true;
            this.show();

            if (this.isSirv()) {
              this.sirvService.activate();
            }

            this.createSlideApi();
          };

          _proto81.afterShow = function afterShow(whoUse) {
            this.slideShownBy = whoUse || globalVariables.SLIDE_SHOWN_BY.NONE;
            this.broadcast('startActions', {
              who: this.slideShownBy
            });

            if (this.video && this.video.isAutoplay()) {
              this.playVideo();
            }
          };

          _proto81.beforeHide = function beforeHide() {
            if (this.video) {
              this.video.pause();
            } else {
              this.broadcast('stopActions');
            }
          };

          _proto81.afterHide = function afterHide() {
            this.slideShownBy = globalVariables.SLIDE_SHOWN_BY.NONE;
            this.isActive = false;
            this.hide();

            if (this.isSirv()) {
              this.sirvService.deactivate();
            }

            if (this.socialbuttons) {
              this.socialbuttons.closeButtons();
            }
          };

          _proto81.show = function show() {
            this.instanceNode.removeClass(CSS_MAIN_CLASS + '-hidden');
            this.instanceNode.addClass(CSS_MAIN_CLASS + '-shown');
          };

          _proto81.hide = function hide() {
            this.instanceNode.removeClass(CSS_MAIN_CLASS + '-shown');
            this.instanceNode.addClass(CSS_MAIN_CLASS + '-hidden');
          };

          _proto81.isZoomSizeExist = function isZoomSizeExist() {
            if (this.isSirv()) {
              return this.sirvService.isZoomSizeExist();
            }

            return false;
          };

          _proto81.startTool = function startTool(isShown, preload, firstSlideAhead) {
            var _this269 = this;

            if (this.isSirv()) {
              this.getSlideSize().then(function (infoSize) {
                if (_this269.isInDom) {
                  _this269.sirvService.startTool(isShown || _this269.isActive, preload, firstSlideAhead);

                  _this269.addSocialButtons();
                }
              }).catch(function (err) {});
            } else {
              this.getSlideSize().then(function () {
                _this269.emit('contentLoaded', {
                  data: {
                    slide: {
                      index: _this269.index
                    }
                  }
                });
              });
            }
          };

          _proto81.getSlideSize = function getSlideSize() {
            var _this270 = this;

            if (!this.sizePromise) {
              this.sizePromise = new Promise(function (resolve, reject) {
                if (_this270.isSirv()) {
                  var result = {
                    UUID: _this270.$J_UUID
                  };

                  _this270.sirvService.getInfoSize().then(function (infoSize) {
                    if (!_this270.infoSize && infoSize.size) {
                      _this270.infoSize = infoSize.size;
                    }

                    result.size = _this270.infoSize;
                    resolve(result);
                  }).catch(function (err) {
                    result.error = true;

                    if (_this270.sirvService) {
                      var typeOfSirvService = _this270.sirvService.getType();

                      _this270.removeSirvService();

                      if (err && err.error && err.error.status && err.error.status === 404) {
                        result.error = err.error;
                        reject(result);
                      } else if (err && (err.error === 'changeSpinToImage' || typeOfSirvService === globalVariables.SLIDE.TYPES.IMAGE || err.isPlaceholder)) {
                        _this270.isPlaceholder = err.isPlaceholder;

                        if (typeOfSirvService === globalVariables.SLIDE.TYPES.IMAGE) {
                          _this270.isInDom = 0;

                          _this270.appendToDOM();

                          var data = findSomethingForSelector(_this270.slideContent.node);

                          if (!_this270.selector.isCustom) {
                            _this270.selector.src = data ? data.data : null;
                            _this270.selector.isSirv = false;
                          }
                        } else {
                          _this270.changeSpinToImage();
                        } // финт ушами


                        var oldPromise = _this270.sizePromise;
                        _this270.sizePromise = null;

                        var newPromise = _this270.getSlideSize();

                        _this270.sizePromise = oldPromise;
                        newPromise.then(resolve).catch(reject);
                      } else {
                        result.error = {
                          status: 404
                        };
                        reject(result);
                      }
                    } else {
                      result.error = {
                        status: 404
                      };
                      reject(result);
                    }
                  }).finally(function () {
                    if (_this270.isCustomAdded) {
                      _this270.emit('infoReady', {
                        data: {
                          index: _this270.index
                        }
                      });
                    }
                  });
                } else {
                  var img;
                  var src;

                  if (_this270.slideContent.getTagName() === 'img') {
                    img = _this270.slideContent.node;
                  } else {
                    try {
                      img = _this270.slideContent.node.getElementsByTagName('img')[0];
                    } catch (e) {// empty
                    }
                  }

                  if (img) {
                    src = helper.sliderLib.getSrc($(img).attr('src'));

                    if (!src) {
                      src = helper.sliderLib.getSrc($(img).attr('data-src'));
                    } // } else {
                    //     src = helper.sliderLib.getSrc($(img).attr('data-src'));

                  }

                  if (src) {
                    helper.loadImage(src).then(function (imageData) {
                      _this270.infoSize = imageData.size;
                      resolve({
                        size: _this270.infoSize,
                        UUID: _this270.$J_UUID
                      });
                    }).catch(function (error) {
                      resolve({
                        size: _this270.infoSize,
                        UUID: _this270.$J_UUID,
                        error: {
                          status: 404
                        }
                      });
                    });
                  } else {
                    if (_this270.video) {
                      _this270.video.getSize().then(function (size) {
                        _this270.infoSize = size || {
                          width: 0,
                          height: 0
                        };
                        resolve({
                          size: _this270.infoSize,
                          UUID: _this270.$J_UUID
                        });
                      }).catch(function (err) {
                        reject({
                          size: _this270.infoSize,
                          UUID: _this270.$J_UUID,
                          error: err
                        });
                      });
                    } else {
                      getContentSize(_this270.slideContent.node).then(function (size) {
                        _this270.infoSize = size || {
                          width: 0,
                          height: 0
                        };
                        resolve({
                          size: _this270.infoSize,
                          UUID: _this270.$J_UUID
                        });
                      }).catch(function (err) {
                        reject({
                          size: _this270.infoSize,
                          UUID: _this270.$J_UUID,
                          error: err
                        });
                      });
                    }
                  }
                }
              });
            }

            return this.sizePromise;
          };

          _proto81.getData = function getData() {
            return this.api;
          };

          _proto81.removeSirvService = function removeSirvService() {
            this.infoSize = null;

            if (this.slideContent) {
              this.slideContent.remove();
            }

            if (this.selector.node) {
              this.selector.node.removeAttr('data-type');
            }

            if (this.sirvService) {
              this.sirvService.destroy();
              this.sirvService = null;
            }

            this.selector.isSirv = false;
            this.off('stats');
            this.off('componentEvent');
            this.off('beforeFullscreenIn');
            this.off('afterFullscreenIn');
            this.off('beforeFullscreenOut');
            this.off('afterFullscreenOut');

            if (this.componentLoader) {
              this.componentLoader.hide(true);
              this.componentLoader.destroy();
              this.componentLoader = null;
            }

            if (this.fullscreenOnlyNode) {
              this.fullscreenOnlyNode.kill();
              this.fullscreenOnlyNode = null;
            }
          };

          _proto81.changeSpinToImage = function changeSpinToImage() {
            this.slideContent.removeClass(CSS_MAIN_CLASS + '-component');
            this.contentWrapper.removeClass(CSS_MAIN_CLASS + '-content-' + globalVariables.SLIDE.NAMES[this.getTypeOfSlide()]);
            this.lastOriginNode = this.slideContent;
            this.slideContent = $J.$new('img', {
              'data-src': this.slideContent.attr('data-src')
            });
            this.slideContent.addClass(CSS_MAIN_CLASS + '-component');
            this.parseSlide();
            this.isInDom = 0;
            this.appendToDOM();

            if (this.isPlaceholder) {
              var data = findSomethingForSelector(this.slideContent);

              if (!this.selector.isCustom) {
                this.selector.src = data ? data.data : null;
              }
            }

            if (this.selector.node && !this.selector.isCustom) {
              this.selector.node.attr('data-type', globalVariables.SLIDE.NAMES[this.getTypeOfSlide()]);
            }

            if (this.isStartedFullInit) {
              this.isStartedFullInit = false;
              this.startFullInit();
            }
          };

          _proto81.setSirvEvents = function setSirvEvents() {
            var _this271 = this;

            this.on('stats', function (e) {
              e.stopEmptyEvent();
              e.data.index = _this271.index;
            }); // init, ready, zoomIn, zoomOut

            this.on('componentEvent', function (e) {
              e.stopEmptyEvent();
              var eventData = e.data.data;
              eventData.type = e.data.type;
              eventData.node = _this271.slideContent;

              if (e.data.type === 'ready') {
                _this271.isReady = true;
              }

              e.data.slide = _this271.getData();
              e.data.componentEventData = eventData;

              if (e.data.component === globalVariables.SLIDE.NAMES[globalVariables.SLIDE.TYPES.SPIN]) {
                if (e.data.type === 'init') {
                  _this271.componentLoader.hide();

                  _this271.spinWasInited = true;
                  var spinTypeClassMap = {
                    row: 'spin-x',
                    col: 'spin-y',
                    'multi-row': 'spin-xy'
                  };

                  if (_this271.selector.node) {
                    _this271.selector.node.addClass(spinTypeClassMap[_this271.sirvService.getSpinOrientation()] || '');
                  }
                }
              } else {
                if (e.data.type === 'ready') {
                  _this271.componentLoader.hide();
                }
              }

              if (e.data.type === 'ready' && $J.contains(['spin', 'zoom'], e.data.component)) {
                if (_this271.sirvService.isZoomSizeExist()) {
                  _this271.contentWrapper.addClass(CAN_ZOOM_CLASS);
                }
              }
            });
          };

          _proto81.addSocialButtons = function addSocialButtons() {
            var _this272 = this;

            if (this.validateComponentSocialButton()) {
              var arr = ['facebook', 'twitter', 'linkedin', 'reddit', 'tumblr', 'pinterest', 'telegram'];
              var sTypes = {};
              arr.forEach(function (value) {
                sTypes[value] = _this272.options['sb' + $J.camelize('-' + value)];
              });
              var dataImageSB = SocialButtons.getDataImage();
              var link = {};
              arr.forEach(function (value) {
                link[value] = _this272.getLinkSocialButton(dataImageSB[value], sTypes[value]);
              });
              this.socialbuttons = new SocialButtons({
                'text': this.slideContent.attr('alt'),
                'link': link,
                'title': this.slideContent.attr('title')
              }, sTypes, this.instanceNode);
            }
          };

          _proto81.validateComponentSocialButton = function validateComponentSocialButton() {
            if (this.options.sbEnable && SocialButtons && !this.socialbuttons) {
              if (this.isSirv() && this.sirvService.getType() !== globalVariables.SLIDE.TYPES.VIDEO || this.video && this.video.type !== 'video' || this.slideContent.getTagName() === 'img') {
                return true;
              }
            }

            return false;
          };

          _proto81.getLinkSocialButton = function getLinkSocialButton(data, isSpin, enable) {
            var result = null;

            if (enable) {
              if (this.isSirv()) {
                result = this.sirvService.getSocialButtonData(data, this.api.component === globalVariables.SLIDE.NAMES[globalVariables.SLIDE.TYPES.SPIN]);
              } else if (this.slideContent.getTagName() === 'iframe') {
                result = this.video.node.attr('data-src');
              } else {
                result = this.slideContent.attr('data-src');
              }
            }

            return result;
          };

          _proto81.searchImagesInHtmlContent = function searchImagesInHtmlContent() {
            var _this273 = this;

            var result = false;
            var images = $J.$A(this.slideContent.node.querySelectorAll('img'));

            if (images.length) {
              result = true;
              this.multiImages = images;
              images.forEach(function (img, index) {
                var isSirvImage = !Slide.checkNonSirv(img);

                if (isSirvImage) {
                  if (!_this273.sirvService) {
                    _this273.setSirvEvents();

                    _this273.selector.isSirv = true;
                    _this273.sirvService = new SirvService(img, _this273.options, {
                      quality: _this273.options.quality,
                      hdQuality: _this273.options.hdQuality,
                      isHDQualitySet: _this273.options.isHDQualitySet,
                      always: _this273.options.fullscreenOnly,
                      isFullscreen: _this273.options.isFullscreen,
                      nativeFullscreen: _this273.options.nativeFullscreen
                    });

                    _this273.sirvService.setParent(_this273);

                    _this273.sirvService.start();

                    _this273.createSlideApi();
                  } else {
                    _this273.sirvService.push(img);
                  }
                }

                _this273.multiImages.push({
                  isSirv: isSirvImage,
                  node: img,
                  src: $(img).attr('src'),
                  datasrc: $(img).attr('data-src')
                });
              });
            }

            return result;
          };

          _proto81.isCustomSlideEmpty = function isCustomSlideEmpty() {
            if (this.isCustomSelector()) {
              var smvSelector = this.slideContent.node.querySelector(SELECTOR_TAG);

              if (smvSelector) {
                $J.$(smvSelector).remove();
                var length = $J.$A(this.slideContent.node.children).length;
                this.slideContent.append(smvSelector);

                if (Slide.isSirvComponent(this.slideContent) && Slide.hasComponent(this.slideContent) && !this.isPlaceholder || length || helper.videoModule.isVideo(this.slideContent)) {
                  return false;
                }
              }
            }

            return true;
          };

          _proto81.beforeParseSlide = function beforeParseSlide() {
            if (this.isCustomSelector()) {
              if (this.isCustomSlideEmpty()) {
                this.availableSlide = false;
                this.selector.activated = false;
              }

              this.selector.node.remove();
            }
          };

          _proto81.createImgFromDiv = function createImgFromDiv() {
            if (this.slideContent.getTagName() === 'div' && this.type === globalVariables.SLIDE.TYPES.IMAGE) {
              var old = this.slideContent;
              this.slideContent = $J.$new('img');
              this.slideContent.attr('data-src', this.url);
              var tmp = old.attr('alt');

              if (tmp) {
                this.slideContent.attr('alt', tmp);
              }

              tmp = old.attr('title');

              if (tmp) {
                this.slideContent.attr('title', tmp);
              }

              tmp = old.attr('data-alt');

              if (tmp) {
                this.slideContent.attr('data-alt', tmp);
              }

              tmp = old.attr('data-referrerpolicy');

              if (tmp) {
                this.slideContent.attr('data-referrerpolicy', tmp);
              }
            }
          };

          _proto81.parseSlide = function parseSlide() {
            if (Slide.isSirvComponent(this.slideContent) && Slide.hasComponent(this.slideContent) && !this.isPlaceholder) {
              this.setSirvEvents();
              this.createImgFromDiv();
              this.sirvService = new SirvService(this.slideContent.node, this.options, {
                quality: this.options.quality,
                hdQuality: this.options.hdQuality,
                isHDQualitySet: this.options.isHDQualitySet,
                always: this.options.fullscreenOnly,
                isFullscreen: this.options.isFullscreen,
                nativeFullscreen: this.options.nativeFullscreen
              });
              this.sirvService.setParent(this);
              this.selector.isSirv = true;
              this.sirvService.start();
              this.createSlideApi();
              this.selector.isVideo = this.sirvService.getType() === globalVariables.SLIDE.TYPES.VIDEO;
              this.contentWrapper.addClass(CSS_MAIN_CLASS + '-content-' + globalVariables.SLIDE.NAMES[this.getTypeOfSlide()]);
            } else {
              this.createImgFromDiv();
              this.searchImagesInHtmlContent();

              if (helper.videoModule.isVideo(this.slideContent)) {
                this.selector.isVideo = true;
                this.initVideo();
                this.contentWrapper.addClass(CSS_MAIN_CLASS + '-content-video');
              }
            }

            if (this.dataThumbnailImage || this.dataThumbnailHtml) {
              this.selector.isSirv = false;
            }
          };

          _proto81.appendToDOM = function appendToDOM() {
            if (!this.isInDom) {
              this.isInDom = 1;
              this.createFullscreenOnlyScreen();

              if (this.isSirv() || this.video) {
                this.createComponentLoader();

                if (this.video) {
                  this.contentWrapper.append(this.video.getVideoNode());
                } else {
                  this.contentWrapper.append(this.slideContent);
                }
              } else {
                if (this.slideContent.getTagName() === 'img') {
                  this.contentWrapper.addClass(CSS_MAIN_CLASS + '-slide-img');

                  if (!helper.sliderLib.getSrc(this.slideContent.attr('src'))) {
                    this.slideContent.attr('src', this.slideContent.attr('data-src'));
                  }
                }

                if (this.multiImages.length) {
                  this.multiImages.forEach(function (img) {
                    if (!img.src && img.datasrc) {
                      $(img.node).attr('src', img.datasrc);
                    }
                  });
                }

                this.contentWrapper.append(this.slideContent);
              }

              this.setFullscreenEvents();
            }
          };

          _proto81.initVideoPlayer = function initVideoPlayer() {
            if (this.video) {
              this.video.init();
            } else if (this.isSirv() && this.sirvService.getType() === globalVariables.SLIDE.TYPES.VIDEO) {
              this.sirvService.loadVideoSources();
            }
          };

          _proto81.secondSelectorClick = function secondSelectorClick() {
            if (this.isSirv()) {
              this.broadcast('secondSelectorClick', {
                data: {
                  slideIndex: this.index
                }
              });
            } else {
              if (this.video) {
                this.video.pause();
              }
            }
          };

          _proto81.isSirvSelector = function isSirvSelector() {
            if (!this.selector.isCustom) {
              return this.isSirv() && this.sirvService.getType() !== globalVariables.SLIDE.TYPES.VIDEO;
            }

            return false;
          };

          _proto81.getSelectorProportion = function getSelectorProportion() {
            var _this274 = this;

            var result;

            if (this.dataThumbnailImage) {
              result = new Promise(function (resolve, reject) {
                _this274.getResponsiveImage().then(function () {
                  return resolve($J.extend({}, _this274.selector));
                }).catch(function (error) {
                  helper.loadImage(_this274.dataThumbnailImage).then(function (imageData) {
                    _this274.selector.size = imageData.size;
                    resolve($J.extend({}, _this274.selector));
                  }).catch(function (error) {
                    reject(error);
                  });
                });
              });
            } else if (this.video) {
              // because proportions of video is not the same as video thumbnail proportions
              result = this.getNonSirvVideoThumbnail();
            } else {
              result = this.getSlideSize();
            }

            return result;
          };

          _proto81.getSelectorReferrerPolicy = function getSelectorReferrerPolicy() {
            var baseReferrerPolicy = 'no-referrer-when-downgrade';

            if (this.selector.isCustom) {
              if (this.selector.node.hasAttribute('data-referrerpolicy')) {
                return this.selector.node.attr('data-referrerpolicy');
              }

              var listImg = $J.$A(this.selector.node.node.children).filter(function (item) {
                return $(item).getTagName() === 'img';
              });

              if (listImg.length === 1) {
                return $(listImg[0]).attr('referrerpolicy') || baseReferrerPolicy;
              }
            }

            return this.slideContent.attr('data-referrerpolicy') || this.slideContent.attr('referrerpolicy') || baseReferrerPolicy;
          };

          _proto81.getResponsiveImage = function getResponsiveImage() {
            var _this275 = this;

            if (!this.customThumbnailImageClassPromise) {
              this.customThumbnailImageClassPromise = new Promise(function (resolve, reject) {
                var image = new ResponsiveImage(_this275.dataThumbnailImage);
                image.getImageInfo().then(function (info) {
                  _this275.selector.isSirv = true;
                  _this275.selector.size = image.getOriginSize();
                  resolve(image);
                }).catch(reject);
              });
            }

            return this.customThumbnailImageClassPromise;
          };

          _proto81.getSirvThumbnailForCustomSelector = function getSirvThumbnailForCustomSelector(data_) {
            var _this276 = this;

            return new Promise(function (resolve, reject) {
              _this276.getResponsiveImage().then(function (rImageInstance) {
                var data = rImageInstance.getThumbnail(data_);
                data.referrerpolicy = _this276.thumbnailReferrerPolicy;
                resolve(data);
              }).catch(reject);
            });
          };

          _proto81.getSelectorImgUrl = function getSelectorImgUrl(type, size, crop, watermark) {
            var _this277 = this;

            var data = {
              crop: crop,
              watermark: watermark
            };

            if (size.width) {
              data.width = size.width;
            }

            if (size.height) {
              data.height = size.height;
            }

            var extend = function (_data) {
              if (_data.src) {
                _this277.selector.src = _data.src;
              }

              if (_data.srcset) {
                _this277.selector.srcset = _data.srcset;
              }

              var selectorData = $J.extend({}, _data);
              selectorData = $J.extend(selectorData, _this277.selector);
              return selectorData;
            };

            return new Promise(function (resolve, reject) {
              if (_this277.isSirv()) {
                _this277.sirvService.getInfoSize().then(function (infoSize) {
                  if (_this277.selector.isCustom) {
                    if (_this277.selector.isStatic) {
                      resolve($J.extend({}, _this277.selector));
                    } else {
                      _this277.getSirvThumbnailForCustomSelector(data).then(function (result) {
                        return resolve(extend(result));
                      }).catch(function () {
                        return resolve($J.extend({}, _this277.selector));
                      });
                    }
                  } else {
                    _this277.sirvService.getSelectorImgUrl(data).then(function (result) {
                      result.referrerpolicy = _this277.thumbnailReferrerPolicy;
                      resolve(extend(result));
                    }).catch(reject);
                  }
                }).catch(reject);
              } else {
                if (_this277.selector.isCustom && _this277.dataThumbnailImage) {
                  if (_this277.selector.isStatic) {
                    resolve($J.extend({}, _this277.selector));
                  } else {
                    _this277.getSirvThumbnailForCustomSelector(data).then(function (_result) {
                      return resolve(extend(_result));
                    }).catch(function () {
                      return resolve($J.extend({}, _this277.selector));
                    });
                  }
                } else if (_this277.slideContent.getTagName() === 'img' || _this277.multiImages.length) {
                  resolve($J.extend({}, _this277.selector));
                } else if (_this277.video) {
                  _this277.getNonSirvVideoThumbnail().then(resolve).catch(reject);
                } // if (this.slideContent.getTagName() === 'img' || this.multiImages.length || this.dataThumbnailImage) {
                //     resolve($J.extend({}, this.selector));
                // } else if (this.video) {
                //     this.getNonSirvVideoThumbnail().then(resolve).catch(reject);
                // }

              }
            });
          };

          _proto81.getNonSirvVideoThumbnail = function getNonSirvVideoThumbnail() {
            var _this278 = this;

            if (!this.getVideoThumbnailPromise) {
              this.getVideoThumbnailPromise = new Promise(function (resolve, reject) {
                helper.videoModule.getImageSrc(_this278.slideContent, true).then(function (data) {
                  if (!_this278.selector.isCustom) {
                    _this278.selector.src = data.thumbnail.url;
                    _this278.selector.size = {
                      width: data.thumbnail.width,
                      height: data.thumbnail.height
                    };
                  }

                  resolve($J.extend({}, _this278.selector));
                }).catch(function (err) {
                  if (!err || err === true) {
                    err = {
                      UUID: _this278.$J_UUID
                    };
                  } else {
                    err.UUID = _this278.$J_UUID;
                  }

                  reject(err);
                });
              });
            }

            return this.getVideoThumbnailPromise;
          };

          _proto81.isSpinInited = function isSpinInited() {
            return this.spinWasInited;
          };

          _proto81.isSlideReady = function isSlideReady() {
            return this.isReady;
          };

          _proto81.getSelector = function getSelector() {
            var _this279 = this;

            if (this.dataHiddenSelector) {
              return null;
            }

            if (!this.selector.node) {
              this.selector.node = $J.$new(SELECTOR_TAG);
              this.selector.node.addClass(SELECTOR_CLASS);
            }

            if (this.dataThumbnailImage) {
              var typeOfSlide = this.getTypeOfSlide();

              if (typeOfSlide !== null) {
                this.selector.node.attr('data-type', globalVariables.SLIDE.NAMES[typeOfSlide]);
              }

              this.selector.src = this.dataThumbnailImage;

              if (!this.selector.isStatic) {
                this.selector.infoPromise = new Promise(function (resolve) {
                  _this279.getResponsiveImage().catch(function (err) {}).finally(function () {
                    resolve(_this279.selector.isSirv, _this279.selector.size);
                  });
                });
              }
            } else if (this.dataThumbnailHtml) {
              var tmp = $J.$new('div');
              tmp.node.innerHTML = this.dataThumbnailHtml;
              this.selector.selectorContent = tmp.node.firstChild;
              this.selector.node.attr('data-type', 'html');
            } else if (this.selector.isCustom) {
              this.selector.node.attr('data-type', 'html');
              this.selector.selectorContent = this.selector.node;
            } else {
              if (this.isSirv()) {
                var t = this.getTypeOfSlide();
                this.selector.node.attr('data-type', globalVariables.SLIDE.NAMES[t]);

                if (t === globalVariables.SLIDE.TYPES.SPIN && this.sirvService.isThumbnailGif()) {
                  this.selector.node.addClass('spin-thumbnail-gif');
                }
              } else {
                var data = findSomethingForSelector(this.slideContent.node);

                if ($J.contains(['youtube', 'vimeo', 'video'], data.type)) {
                  this.selector.node.attr('data-type', data.type);
                } else if (data.type === 'img') {
                  this.selector.src = data.data;
                } else {
                  this.selector.selectorContent = data.data;
                  this.selector.node.attr('data-type', 'html');
                }
              }
            }

            if (this.selector.isCustom) {
              this.selector.node.addClass(CSS_MAIN_CLASS + '-custom-thumbnail');
            }

            this.selector.disabled = !this.enabled;
            return this.selector;
          };

          _proto81.getUUID = function getUUID() {
            return this.$J_UUID;
          };

          _proto81.isSlideActive = function isSlideActive() {
            return this.isActive;
          };

          _proto81.playVideo = function playVideo() {
            if (this.isActive && this.inView && this.video && (this.fullscreenState === globalVariables.FULLSCREEN.OPENED || $J.contains([globalVariables.SLIDE_SHOWN_BY.AUTOPLAY, globalVariables.SLIDE_SHOWN_BY.USER, globalVariables.SLIDE_SHOWN_BY.INIT], this.slideShownBy))) {
              this.video.play();
            }
          };

          _proto81.initVideo = function initVideo() {
            var _this280 = this;

            this.on('slideVideoReady', function (e) {
              e.stop();

              if (!_this280.isVideoReady) {
                _this280.isVideoReady = true;
                _this280.isReady = true;

                _this280.video.show();

                _this280.componentLoader.hide();
              }

              if (_this280.video.isAutoplay() || !_this280.video.isPreStart()) {
                _this280.playVideo();
              }
            });
            this.on('slideVideoPlay', function (e) {
              // e.stop();
              e.data.slide = _this280.getData();

              if (_this280.isVideoPaused && !_this280.video.isAutoplay()) {
                _this280.video.pause();
              }

              _this280.isVideoPaused = false;
            });
            this.on('slideVideoPause', function (e) {
              // e.stop();
              e.data.slide = _this280.getData();
            });
            this.on('slideVideoEnd', function (e) {
              // e.stop();
              e.data.slide = _this280.getData();
            });
            var videoOptions = this.options.video;

            switch (helper.videoModule.getType(this.slideContent)) {
              case 'youtube':
                this.video = new slideVideo.YouTubeVideo(this.slideContent, videoOptions);
                break;

              case 'vimeo':
                this.video = new slideVideo.VimeoVideo(this.slideContent, videoOptions);
                break;

              case 'video':
                this.video = new slideVideo.HTMLVideo(this.slideContent, videoOptions);
                break;

              default: // empty

            }

            this.video.setParent(this);
          };

          _proto81.resize = function resize() {
            if (!this.enabled) {
              return;
            }

            if (this.sirvService) {
              this.sirvService.resize();
              var t = globalVariables.SLIDE.TYPES;

              if (this.isReady && $J.contains([t.SPIN, t.ZOOM], this.getTypeOfSlide())) {
                if (this.sirvService.isZoomSizeExist()) {
                  this.contentWrapper.addClass(CAN_ZOOM_CLASS);
                } else {
                  this.contentWrapper.removeClass(CAN_ZOOM_CLASS);
                }
              }
            } else {// when video leaves viewport and then appears the browser generates resize event on android
              // if (this.video) {
              //     this.video.pause();
              // }
            }
          };

          _proto81.destroy = function destroy() {
            if (this.sirvService) {
              this.sirvService.destroy();
              this.sirvService = null;
              this.off('stats');
              this.off('componentEvent');
            } else if (this.multiImages.length) {
              this.multiImages.forEach(function (img) {
                if (!img.src && img.datasrc) {
                  img.node.removeAttribute('src');
                }
              });
            }

            this.slideContent.del('view-content');
            this.removeEventCloseFullscreeByClick();
            this.sendEventCloseFullscreenByClick = null;

            if (this.lastOriginNode) {
              this.slideContent.remove();
              this.slideContent = this.lastOriginNode;
              this.lastOriginNode = null;
            }

            if (this.fullscreenOnlyNode) {
              this.fullscreenOnlyNode.kill();
              this.fullscreenOnlyNode = null;
            }

            this.off('beforeFullscreenIn');
            this.off('afterFullscreenIn');
            this.off('beforeFullscreenOut');
            this.off('afterFullscreenOut');
            this.off('inView');

            if (this.video) {
              this.off('slideVideoReady');
              this.off('slideVideoPlay');
              this.off('slideVideoPause');
              this.off('slideVideoEnd');
              this.video.destroy();
            }

            this.video = null;

            if (this.componentLoader) {
              this.componentLoader.destroy();
              this.componentLoader = null;
            }

            if (this.socialbuttons) {
              this.socialbuttons.destroy();
            }

            this.sizePromise = null;
            this.componentSize = null;
            this.contentWrapper.remove();
            this.contentWrapper = null;
            this.instanceNode.remove();
            this.instanceNode = null;
            this.slideContent = null;
            this.isReady = false;
            this.availableSlide = null;

            _EventEmitter27.prototype.destroy.call(this);
          };

          return Slide_;
        }(EventEmitter);

        return Slide_;
      }();
      /* eslint-env es6 */

      /* global $, $J, Slide, Selectors, Arrows, Effect, CSS_MAIN_CLASS, SELECTOR_TAG, EventEmitter, ContextMenu, helper, globalVariables, remoteModules, ProductDetail*/

      /* eslint-disable indent */

      /* eslint-disable no-lonely-if */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "SirvSlider" }] */


      var isHandset = null; // DIV used to correctly measure viewport height in Safari > 10 on iPhone

      var iPhoneSafariViewportRuler = null;

      var SirvSlider = function () {
        var FULLSCREEN = 'fullscreen';

        var _FULLSCREEN = $J.camelize('-' + FULLSCREEN);

        var STANDARD_BUTTON_CLASS = CSS_MAIN_CLASS + '-button-' + FULLSCREEN + '-open';
        var FULLSCREEN_BUTTON_CLASS = CSS_MAIN_CLASS + '-button-' + FULLSCREEN + '-close';
        var FULLSCREEN_BUTTON_HIDE_CLASS = CSS_MAIN_CLASS + '-button-hidden'; // const SIZE_MESSAGE = 'can\'t get size';

        var PSEUDO_FULLSCREEN_CLASS = CSS_MAIN_CLASS + '-pseudo-' + FULLSCREEN;
        var STANDARD_CSS = {
          width: '100%',
          height: '100%'
        };
        var MIN_AUTOPLAY = 1000;
        var MAX_SLIDES_TO_CHANGE_PRELOAD_BEHAVIOR = 8;

        var isCustomId = function (id) {
          var result = false;
          id = id.split('-');
          id.splice(id.length - 1, 1);
          id = id.join('-');

          if (id === CSS_MAIN_CLASS) {
            result = true;
          }

          return result;
        };

        var getThumbnailsType = function (type) {
          var result = 'thumbnails';

          if (type === 'bullets') {
            result = type;
          }

          return result;
        }; // const getSelectorsSide = (position) => {
        //     let result = null;
        //     switch (position) {
        //         case 'left':
        //         case 'right':
        //             result = 'width';
        //             break;
        //         case 'top':
        //         case 'bottom':
        //             result = 'height';
        //             break;
        //         // no default
        //     }


        var getExistComponents = function (arr, productDetailsText, socialbuttons) {
          var result = [];
          var t = globalVariables.SLIDE.TYPES;
          arr.forEach(function (slide) {
            if (slide.type && !$J.contains([t.IMAGE, t.HTML], slide.type) && !$J.contains(result, slide.type)) {
              result.push(globalVariables.SLIDE.NAMES[slide.type]);
            }
          });

          if (productDetailsText) {
            result.push('productDetail');
          }

          if (socialbuttons) {
            result.push('socialButtons');
          }

          return result;
        };

        var slidePinnedFilter = function (rawSlides) {
          var slides = [];
          var pinnedAtTheEnd = 0;
          var pinnedAtTheStart = 0;
          var dataPinned;
          var currentNode;

          for (var indexSlide = 0, l = rawSlides.length; indexSlide < l; indexSlide++) {
            currentNode = rawSlides[indexSlide];

            if (currentNode.querySelector(SELECTOR_TAG)) {
              currentNode = currentNode.querySelector(SELECTOR_TAG);
            }

            dataPinned = $J.$(currentNode).attr('data-pinned');
            var pinnedAttr = currentNode.hasAttribute('data-pinned');

            if (pinnedAtTheStart >= 3 && dataPinned === 'start' || pinnedAtTheEnd >= 3 && (pinnedAttr && dataPinned && (dataPinned === 'end' || dataPinned !== 'end' && dataPinned !== 'start') || pinnedAttr && !dataPinned)) {
              // eslint-disable-next-line
              continue;
            }

            if (pinnedAtTheStart < 3 && dataPinned === 'start') {
              pinnedAtTheStart++;
            }

            if (pinnedAtTheEnd < 3 && pinnedAttr && dataPinned && (dataPinned === 'end' || dataPinned !== 'end' && dataPinned !== 'start') || pinnedAttr && !dataPinned) {
              pinnedAtTheEnd++;
            }

            slides.push(rawSlides[indexSlide]);
          }

          return slides;
        };

        var Slider = /*#__PURE__*/function (_EventEmitter28) {
          "use strict";

          bHelpers.inheritsLoose(Slider, _EventEmitter28);

          function Slider(node, options) {
            var _this281;

            _this281 = _EventEmitter28.call(this) || this;
            _this281.instanceNode = $(node);
            _this281.instanceOptions = options.options;
            _this281.viewerFileContent = options.viewerFileContent;

            _this281.option = function () {
              if (arguments.length > 1) {
                return _this281.instanceOptions.set(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]);
              }

              return _this281.instanceOptions.get(arguments.length <= 0 ? undefined : arguments[0]);
            };

            _this281.slideOptions = $J.extend(options.slideOptions, {
              quality: _this281.instanceOptions.isset('quality') ? _this281.option('quality') : null,
              hdQuality: _this281.option('hdQuality'),
              isHDQualitySet: _this281.instanceOptions.isset('hdQuality'),
              fullscreenOnly: _this281.option(FULLSCREEN + '.always'),
              isFullscreen: _this281.option(FULLSCREEN + '.enable'),
              nativeFullscreen: _this281.option(FULLSCREEN + '.native'),
              sbEnable: _this281.option('slide.socialbuttons.enable'),
              sbFacebook: _this281.option('slide.socialbuttons.types.facebook'),
              sbTwitter: _this281.option('slide.socialbuttons.types.twitter'),
              sbLinkedin: _this281.option('slide.socialbuttons.types.linkedin'),
              sbReddit: _this281.option('slide.socialbuttons.types.reddit'),
              sbTumblr: _this281.option('slide.socialbuttons.types.tumblr'),
              sbPinterest: _this281.option('slide.socialbuttons.types.pinterest'),
              sbTelegram: _this281.option('slide.socialbuttons.types.telegram')
            });
            _this281.id = _this281.instanceNode.attr('id');

            if (!_this281.id) {
              _this281.id = CSS_MAIN_CLASS + '-' + helper.generateUUID();

              _this281.instanceNode.attr('id', _this281.id);
            }

            _this281.lazyInit = options.lazyInit;
            _this281.movingContainer = $J.$new('div').addClass(CSS_MAIN_CLASS);
            _this281.slideWrapper = $J.$new('div').addClass(CSS_MAIN_CLASS + '-slides-box');
            _this281.slidesContainer = $J.$new('div').addClass(CSS_MAIN_CLASS + '-slides');
            _this281.selectorsWrapper = $J.$new('div').addClass(CSS_MAIN_CLASS + '-selectors-box');
            _this281.fullScreenBox = $J.$new('div').addClass(CSS_MAIN_CLASS + '-' + FULLSCREEN + '-box');
            _this281.controlsWrapper = $J.$new('div').addClass(CSS_MAIN_CLASS + '-controls');
            _this281.producDetailsText = _this281.instanceNode.attr('data-product-detail');
            _this281.productDetail = null;

            _this281.fullScreenBox.addEvent('mousescroll touchstart', function (e) {
              e.stopDistribution();
            });

            _this281.isReady = false;
            _this281.isMoving = false;
            _this281.isSelectorsReady = false;
            _this281.isToolStarted = false;
            _this281.isInitialized = false;
            _this281.isStartedFullInit = false;
            _this281.inViewModule = null;
            _this281.isInView = false;
            _this281.firstSlideAhead = false;
            _this281.rootMargin = 0;
            _this281.fullscreenButton = null;
            _this281.doSetSize = false;
            _this281.heightProportion = null;
            _this281.slides = [];
            _this281.enabledIndexesOfSlides = [];
            _this281.selectors = null;
            _this281.arrows = null;
            _this281.contextMenu = null;
            _this281.countOfSizes = $([]);
            _this281.isFullscreen = globalVariables.FULLSCREEN.CLOSED;
            _this281.fullscreenStartTime = null;
            _this281.index = 0;
            _this281.movingContainerId = CSS_MAIN_CLASS + '-' + helper.generateUUID();
            _this281.cssRulesId = 'sirv_css_rules-' + helper.generateUUID();
            _this281.isComponentPinching = false;
            _this281.isZoomIn = false;
            _this281.hasSize = false;
            _this281.isPseudo = false;
            _this281.doHistory = true;
            _this281.isAutoplay = _this281.option('slide.autoplay');
            _this281.autoplayDelay = _this281.option('slide.delay');
            _this281.residualAutoplayTime = _this281.autoplayDelay;
            _this281.sliderNodes = [];
            _this281.destroyed = false;
            _this281.autoplayTimer = null;
            _this281.timerRemove = null;
            _this281.onResizeDebounce = helper.debounce(function () {
              _this281.onResizeWithoutSelectors();
            }, 16);
            _this281.selectorsDebounce = null;

            if (_this281.doHistory) {
              _this281.fullscreenViewId = Math.floor(Math.random() * $J.now());
              globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.push(_this281.fullscreenViewId);
            }

            _this281.controlsWrapperWasAppended = false;
            _this281.isStandardGrid = false;
            _this281.isFullscreenGrid = false; // conflict with pinch event make us to inject the timer
            // this.touchDragTimer = null;

            _this281.clearingTouchdragFunction = null;
            _this281.classes = {
              standard: {
                movingContainerClasses: $([]),
                selectorsWrapperClasses: $([])
              },
              fullscreen: {
                movingContainerClasses: $([]),
                selectorsWrapperClasses: $([])
              }
            };
            _this281.externalContainer = null;

            if ($J.browser.mobile) {
              _this281.movingContainer.addClass(CSS_MAIN_CLASS + '-mobile');
            }

            _this281.onResizeHandler = _this281.onResize.bind(bHelpers.assertThisInitialized(_this281));

            _this281.pseudoFSEvent = function (e) {
              if (e.oe.keyCode === 27) {
                // Esc
                $($J.D).removeEvent('keydown', _this281.pseudoFSEvent);

                _this281.exitFullScreen();
              }
            };

            _this281.keyBoardArrowsCallback = function (e) {
              var d;
              var kc = e.oe.keyCode;

              if (_this281.isReady) {
                if ($J.contains([37, 39], kc)) {
                  e.stop();
                  d = kc === 37 ? 'prev' : 'next';

                  _this281.jump(d, 2);
                }
              }
            };

            _this281.onHistoryStateChange = function (e) {
              try {
                if (e.oe.state && e.oe.state.name === 'Sirv.viewer') {
                  if (globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.indexOf(e.oe.state.hash) < 0) {
                    globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.splice(globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.indexOf(_this281.fullscreenViewId), 1);
                    _this281.fullscreenViewId = e.oe.state.hash;
                    globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.push(_this281.fullscreenViewId);
                  }

                  if (e.oe.state.hash === _this281.fullscreenViewId) {
                    _this281.enterFullScreen();
                  }
                } else {
                  if (_this281.isFullscreenState()) {
                    _this281.exitFullScreen();
                  }
                }
              } catch (ex) {// empty
              }
            };

            var parsedSlides = _this281.getSlides();

            _this281.addComponentsCSS = helper.debounce(function () {
              globalFunctions.rootDOM.addCSSStringToHtml();
            }, 100);
            remoteModules.load(getExistComponents(parsedSlides, _this281.producDetailsText, _this281.option('slide.socialbuttons.enable'))).then(function () {
              if (!_this281.destroyed) {
                globalFunctions.rootDOM.addCSSStringToHtml();
                globalFunctions.rootDOM.addCSSString(_this281.instanceNode.node);

                _this281.setComponentsEvents();

                _this281.createSlides(parsedSlides);

                if ($J.browser.ready || $J.D.node.readyState !== 'loading') {
                  _this281.startFullInit();
                }

                if (ProductDetail && _this281.option('productdetail.enable') && _this281.producDetailsText) {
                  _this281.createProductDetails();
                }
              }
            });
            return _this281;
          }

          var _proto82 = Slider.prototype;

          _proto82.isFullscreenState = function isFullscreenState() {
            return $J.contains([globalVariables.FULLSCREEN.OPENING, globalVariables.FULLSCREEN.OPENED], this.isFullscreen);
          };

          _proto82.createProductDetails = function createProductDetails() {
            this.productDetail = new ProductDetail({
              text: this.producDetailsText,
              position: this.option('productdetail.position')
            }, this.movingContainer, this.fullScreenBox);
          };

          _proto82.setRootMargin = function setRootMargin() {
            var value = parseInt(this.option('threshold'), 10);

            if ($J.typeOf(this.option('threshold')) === 'string') {
              var v = ($J.W.node.innerHeight || $J.D.node.documentElement.clientHeight) / 100 * value;
              value = v;
            }

            this.rootMargin = value;
          };

          _proto82.startFullInit = function startFullInit(options) {
            var _this282 = this;

            // the method must be launched after 'this.createSlides' method
            if (this.isStartedFullInit || !this.slides.length) {
              return;
            }

            this.isStartedFullInit = true;

            if (this.isHiddenSlides()) {
              return;
            }

            if (options) {
              this.instanceOptions = options.options;

              this.option = function () {
                if (arguments.length > 1) {
                  return _this282.instanceOptions.set(arguments.length <= 0 ? undefined : arguments[0], arguments.length <= 1 ? undefined : arguments[1]);
                }

                return _this282.instanceOptions.get(arguments.length <= 0 ? undefined : arguments[0]);
              };

              this.slideOptions = $J.extend(options.slideOptions, {
                fullscreenOnly: this.option(FULLSCREEN + '.always'),
                autoplay: this.option('video.autoplay')
              });
              this.lazyInit = options.lazyInit;
              this.isAutoplay = this.option('slide.autoplay');
              this.autoplayDelay = this.option('slide.delay');
              this.residualAutoplayTime = this.autoplayDelay;
            }

            if (this.option(FULLSCREEN + '.always')) {
              this.movingContainer.addClass(CSS_MAIN_CLASS + '-fullsreen-always');
            }

            if (isHandset === null) {
              isHandset = $J.browser.mobile && window.matchMedia && window.matchMedia('(max-device-width: 767px), (max-device-height: 767px)').matches;
            } // Create a ruler div to properly handle viewport height in Safari (>10) on iPhone with and without address bar, bookmark bar and status bar.
            // if (isHandset && $J.browser.platform === 'ios' && $J.browser.uaName === 'safari' && parseInt($J.browser.uaVersion, 10) > 10) {


            if (isHandset && $J.browser.platform === 'ios') {
              iPhoneSafariViewportRuler = $J.$new('div').setCss({
                position: 'fixed',
                top: 0,
                width: 0,
                height: '100vh'
              });
            }

            this.normalizeOptions();
            this.setRootMargin();
            this.slideWrapper.addClass(CSS_MAIN_CLASS + '-' + (this.option('orientation') === 'horizontal' ? 'h' : 'v'));
            this.index = this.option('slide.first');
            var l = this.slides.length;

            if (this.index > l - 1) {
              this.index = 0;
            }

            if (l > 0 && (!this.slides[this.index].isEnabled() || !this.slides[this.index].isSlideAvailable())) {
              var index = null;

              for (var i = 0; i < l; i++) {
                var tmpIndex = helper.sliderLib.findIndex('next', this.index + i, l, true);

                if (this.slides[tmpIndex].isEnabled() && this.slides[tmpIndex].isSlideAvailable()) {
                  index = tmpIndex;
                  break;
                }
              }

              if (index === null) {
                // eslint-disable-next-line no-console
                console.warn('Sirv Media Viewer: All items are disabled.', this.instanceNode.node);
                this.emit('destroy', {
                  data: {
                    id: this.id,
                    node: this.instanceNode.node
                  }
                });
                return;
              }

              this.index = index;
            }

            this.createContextMenu();
            this.setInViewAction();

            if (this.option('thumbnails.enable') && this.option('thumbnails.target')) {
              this.externalContainer = $($J.D.node.querySelector(this.option('thumbnails.target')));

              if (!this.externalContainer) {
                this.externalContainer = null;
              }
            }

            var fragment = $J.D.node.createDocumentFragment();
            fragment.appendChild(this.movingContainer.node);
            this.movingContainer.setCss(STANDARD_CSS);
            this.movingContainer.setCssProp('font-size', 0);
            this.movingContainer.append(this.slideWrapper); // this.slideWrapper.setCss(STANDARD_CSS);

            this.slides.forEach(function (slide) {
              slide.startFullInit(options ? _this282.slideOptions : null);
            });
            this.appendSelectors(true);
            this.createClasses();
            this.setClasses(); // css takes too long time to loading
            // and we have size because display = block by default
            // if selectors wrapper is vertical orientation
            // this.selectorsWrapper.setCssProp('display', 'inline-block');

            this.instanceNode.append(fragment);
            this.instanceNode.setCssProp('font-size', 0);
            this.slideWrapper.append(this.slidesContainer);
            this.slidesContainer.setCss(STANDARD_CSS);
            this.instanceNode.getSize();
            this.movingContainer.getSize();
            this.selectorsWrapper.getSize();
            this.slideWrapper.getSize();
            var containerHasHeight = this.instanceNode.getSize().height > 0;
            this.createSelectors();

            if (this.selectors && this.isStandardGrid) {
              this.selectorsWrapper.setCss({
                flexBasis: this.option('thumbnails.size') + 'px'
              });
            }

            var steps = 10;

            var getSize = function () {
              if (_this282.destroyed) {
                return;
              }

              var size = _this282.slidesContainer.node.getBoundingClientRect();

              if (!size.height) {
                size = _this282.slideWrapper.node.getBoundingClientRect();
              }

              steps -= 1;

              if (steps > 0 && (!size.width && !size.height || containerHasHeight && !size.height)) {
                setTimeout(getSize, 16);
              } else {
                _this282.instanceNode.setCssProp('font-size', '');

                if (size.width) {
                  // size.height / size.width < 0.25 - fix for ie and firefox
                  // if (!size.height || size.height / size.width < 0.25) {
                  if (!size.height) {
                    _this282.doSetSize = true;
                  }
                } else {
                  // Fix for display none
                  _this282.doSetSize = true;
                }

                _this282.slides.forEach(function (slide) {
                  if (slide.isSlideAvailable()) {
                    _this282.slidesContainer.append(slide.getNode());
                  }

                  slide.appendToDOM(); // all elements must be in dom

                  slide.initVideoPlayer();
                });

                _this282.setClasses();

                _this282.searchingOfProportions();

                if (_this282.selectors) {
                  _this282.selectors.init();
                }

                _this282.postInitialization();
              }
            };

            if (this.firstSlideAhead) {
              // if autostart is false
              this.broadcast('inView', {
                data: this.isInView
              });
            }

            setTimeout(getSize, 16);
          };

          _proto82.visibleSlides = function visibleSlides() {
            return this.slides.filter(function (slide) {
              return slide.isSlideAvailable() && slide.isEnabled();
            }).length;
          };

          _proto82.searchingOfProportions = function searchingOfProportions() {
            var _this283 = this;

            var l = this.slides.length;

            var initOtherComponents = function () {
              var i = _this283.index;
              var p = _this283.firstSlideAhead ? false : _this283.option('slide.preload');
              _this283.hasSize = _this283.setContainerSize();

              if (_this283.inViewModule && helper.isIe()) {
                _this283.inViewModule.takeRecords();
              }

              _this283.slides.forEach(function (_slide, index) {
                _slide.startTool(i === index, p, _this283.firstSlideAhead);
              });

              _this283.createEffect();

              _this283.isToolStarted = true;

              _this283.checkSingleSlide();

              _this283.slides[_this283.index].beforeShow();

              _this283.slides[_this283.index].afterShow(globalVariables.SLIDE_SHOWN_BY.INIT);

              _this283.postInitialization();
            };

            var getSlideSize = function (index, indexes) {
              return new Promise(function (resolve, reject) {
                var slide = _this283.slides[index];
                var slidesCount = _this283.slides.length;
                indexes.push(index);

                if (slide) {
                  var nextSearching = function () {
                    var nextIndex = helper.getArrayIndex(index + 1, l);

                    if (slidesCount !== _this283.slides.length && nextIndex > index) {
                      nextIndex = index;
                    }

                    if ($J.contains(indexes, nextIndex)) {
                      var tmp = _this283.slidesContainer.getSize();

                      if (!tmp.width) {
                        tmp.width = 500; // we don'n have any size
                      }

                      if (!tmp.height) {
                        // it can be video without sizes or html, but we have width
                        tmp.height = tmp.width * 0.5625; // (9/16)
                      }

                      _this283.heightProportion = tmp;
                      resolve();
                    } else {
                      getSlideSize(nextIndex, indexes).then(resolve);
                    }
                  };

                  slide.getSlideSize().then(function (data) {
                    var size = data.size;

                    if (size && size.width && size.height) {
                      _this283.heightProportion = size;
                      resolve();
                    } else {
                      nextSearching();
                    }
                  }).catch(function (err) {
                    var _l = _this283.slides.length;

                    if (err && err.error && err.error.status === 404) {
                      _l -= 1;

                      _this283.pickOut(err.UUID);
                    }

                    if (_l > 0) {
                      nextSearching();
                    } else {
                      reject();
                    }
                  });
                }
              });
            };

            if (this.doSetSize) {
              getSlideSize(this.index, []).then(function () {
                initOtherComponents();
              }).catch(function () {});
            } else {
              initOtherComponents();
            }
          };

          _proto82.initTouchDrag = function initTouchDrag() {
            var _this284 = this;

            var axises = ['x', 'left', 'width'];
            var otherAxise = 'y';
            var containerPosition;
            var isMoving = false;
            var startPosition;
            var lastPercent;
            var size;
            var firstSlide = null;
            var middleSlide = null;
            var lastSlide = null;
            var loop = this.option('loop');
            var lastDirection = null;
            var lastPosition = null;
            var makeAnimation = true;
            var isChanging = true;
            var nextSlide = null;
            var useless = null;
            var stateOfScroll = 0; // 0 - nothing, 1 - drag slide, 2 - scroll page

            var lastXY = {
              x: null,
              y: null
            };
            var lastAnimation = false;

            var getSlidePercent = function (value) {
              return value / size * 100;
            };

            var getStyleValue = function (value) {
              var pos = {
                x: 0,
                y: 0
              };
              pos[axises[0]] = value;
              return 'translate3d(' + pos.x + '%, ' + pos.y + '%, 0px)';
            };

            var setCss = function (node, value) {
              if (node) {
                node.getNode().setCssProp('transform', getStyleValue(value));
              }
            };

            var setSlidesCss = function (value) {
              setCss(firstSlide, value - 100);
              setCss(middleSlide, value);
              setCss(lastSlide, value + 100);
            };

            var endOfEffect = function (direction) {
              return new Promise(function (resolve, reject) {
                var tmp;
                var currentSlidePosition = 100;
                var nextSlidePosition = 0;
                var abs = Math.abs(lastPercent);

                if (abs < 25 || stateOfScroll === 2 || direction === 'next' && lastPercent < 0 || direction === 'prev' && lastPercent > 0) {
                  isChanging = false;
                }

                if (!isChanging) {
                  if (lastPercent < 0) {
                    direction = 'prev';
                  } else {
                    direction = 'next';
                  }
                }

                nextSlide = direction === 'next' ? firstSlide : lastSlide;
                useless = direction === 'next' ? lastSlide : firstSlide;

                if (direction !== 'next') {
                  currentSlidePosition *= -1;
                }

                if (useless) {
                  useless.getNode().setCssProp('transform', '');
                  useless.afterHide();
                }

                if (isChanging) {
                  middleSlide.beforeHide();

                  _this284.sendEvent('beforeSlideIn', {
                    slide: nextSlide.getData()
                  });

                  _this284.sendEvent('beforeSlideOut', {
                    slide: middleSlide.getData()
                  });

                  _this284.index = nextSlide.getIndex();
                } else {
                  tmp = currentSlidePosition;
                  currentSlidePosition = nextSlidePosition;
                  nextSlidePosition = tmp;
                  nextSlidePosition *= -1;

                  if (abs < 2) {
                    makeAnimation = false;
                  }
                }

                if (makeAnimation) {
                  middleSlide.getNode().addEvent('transitionend', function (e) {
                    e.stop();
                    resolve();
                  });

                  if (nextSlide) {
                    nextSlide.getNode().setCssProp('transition', 'transform, .3s');
                  }

                  middleSlide.getNode().setCssProp('transition', 'transform, .3s');

                  if (nextSlide) {
                    nextSlide.getNode().getSize();
                  }

                  middleSlide.getNode().getSize();

                  if (_this284.selectors) {
                    _this284.selectors.setActiveItem(_this284.index);

                    _this284.selectors.jump(_this284.index);
                  }
                }

                if (nextSlide) {
                  setCss(nextSlide, nextSlidePosition);
                }

                setCss(middleSlide, currentSlidePosition);

                if (!makeAnimation) {
                  resolve();
                }
              });
            };

            var fullClear = function () {
              if (isMoving) {
                var css = {
                  'transform': '',
                  'transition': ''
                };
                middleSlide.getNode().removeEvent('transitionend');

                if (nextSlide) {
                  if (isChanging) {
                    _this284.checkLoop(_this284.index);

                    nextSlide.afterShow(globalVariables.SLIDE_SHOWN_BY.USER);
                    middleSlide.afterHide();

                    _this284.sendEvent('afterSlideIn', {
                      slide: nextSlide.getData()
                    });

                    _this284.sendEvent('afterSlideOut', {
                      slide: middleSlide.getData()
                    });
                  } else {
                    if (nextSlide) {
                      nextSlide.afterHide();
                    }
                  }

                  if (nextSlide) {
                    nextSlide.getNode().setCss(css);
                  }
                }

                middleSlide.getNode().setCss(css);
                makeAnimation = true;
                isChanging = true;
                nextSlide = null;
                useless = null;

                _this284.enableFullscreenButton();

                _this284.autoplay();

                isMoving = false;
                _this284.isMoving = false;
                lastDirection = null;
                lastPosition = null;
                firstSlide = null;
                middleSlide = null;
                lastSlide = null;
                lastAnimation = false;
              }
            };

            var getNextSlide = function (direction, fromIndex) {
              var result = null;
              var currentIndex = fromIndex;

              if (currentIndex === $J.U) {
                currentIndex = _this284.index;
              }

              var index = _this284.getNextIndex(direction, currentIndex, _this284.slides.length, loop);

              if (index !== null) {
                var slide = _this284.slides[index];

                if (slide.getIndex() !== _this284.index) {
                  if (!slide.isEnabled()) {
                    result = getNextSlide(direction, slide.getIndex());
                  } else {
                    result = slide;
                  }
                }
              }

              return result;
            };

            var start = function (e) {
              if (lastAnimation) {
                return;
              }

              fullClear();

              _this284.effect.stop();

              if (_this284.index === null) {
                return;
              }

              middleSlide = _this284.slides[_this284.index];

              if (middleSlide.isSwipeDisabled()) {
                return;
              }

              isMoving = true;
              _this284.isMoving = true;
              containerPosition = _this284.slidesContainer.getPosition()[axises[1]];
              size = _this284.slidesContainer.getSize()[axises[2]];
              lastPosition = e[axises[0]] - containerPosition;
              startPosition = getSlidePercent(lastPosition);
              lastPercent = startPosition; // const l = this.slides.length;
              // firstSlide = this.slides[helper.sliderLib.getIndexFromDirection(this.index, 'prev', l, loop)];
              // lastSlide = this.slides[helper.sliderLib.getIndexFromDirection(this.index, 'next', l, loop)];

              firstSlide = getNextSlide('prev');
              lastSlide = getNextSlide('next');

              if (firstSlide && lastSlide) {
                if (firstSlide.getIndex() === lastSlide.getIndex()) {
                  if (firstSlide.getIndex() < middleSlide.getIndex()) {
                    lastSlide = null;
                  } else {
                    firstSlide = null;
                  }
                } else if (firstSlide.getIndex() === middleSlide.getIndex() || middleSlide.getIndex() === lastSlide.getIndex()) {
                  if (firstSlide.getIndex() === middleSlide.getIndex()) {
                    firstSlide = null;
                  } else {
                    lastSlide = null;
                  }
                }
              }

              if (firstSlide) {
                setCss(firstSlide, -100);
                firstSlide.beforeShow();
              }

              if (lastSlide) {
                setCss(lastSlide, 100);
                lastSlide.beforeShow();
              }

              _this284.disableFullscreenButton();
            };

            var move = function (e) {
              var direction;
              var current;

              if (isMoving && !lastAnimation) {
                isMoving = true;
                e.stop();
                current = e[axises[0]] - containerPosition;

                if (current < lastPosition) {
                  direction = 'prev';
                } else if (current > lastPosition) {
                  direction = 'next';
                } else {
                  if (!direction) {
                    direction = lastPercent > 0 ? 'next' : 'prev';
                  }
                }

                lastPosition = current;
                lastDirection = direction;
                lastPercent = getSlidePercent(lastPosition) - startPosition;

                if (!lastSlide && lastPercent < -10) {
                  lastPercent = -10;
                }

                if (!firstSlide && lastPercent > 10) {
                  lastPercent = 10;
                }

                setSlidesCss(lastPercent);
              }
            };

            var end = function (e) {
              if (isMoving && !lastAnimation) {
                if (stateOfScroll === 1) {
                  e.stop();
                }

                middleSlide.dragEvent(e.state);
                lastAnimation = true;
                endOfEffect(lastDirection).finally(function () {
                  lastAnimation = false;
                  fullClear();
                });
              }
            };

            var onDrag = function (e) {
              if (_this284.isComponentPinching || _this284.isZoomIn || _this284.slides[_this284.index].isBlokedTouchdrag() || _this284.option(FULLSCREEN + '.always') && _this284.isFullscreen !== globalVariables.FULLSCREEN.OPENED) {
                return;
              }

              if (e.state === 'dragstart') {
                // clearTimeout(this.touchDragTimer);
                lastXY = {
                  x: e.x,
                  y: e.y
                }; // this.touchDragTimer = setTimeout(() => {

                start(e);
                middleSlide.dragEvent(e.state); // }, 16);
              } else if (e.state === 'dragmove') {
                if (!stateOfScroll) {
                  if (Math.abs(lastXY[axises[0]] - e[axises[0]]) > Math.abs(lastXY[otherAxise] - e[otherAxise])) {
                    stateOfScroll = 1;
                  } else {
                    stateOfScroll = 2;
                  }
                }

                if (stateOfScroll === 1) {
                  move(e);
                }

                lastXY = {
                  x: e.x,
                  y: e.y
                };
              } else if (e.state === 'dragend') {
                // clearTimeout(this.touchDragTimer);
                // this.touchDragTimer = null;
                end(e);
                stateOfScroll = 0;
                lastXY = {
                  x: null,
                  y: null
                };
              }
            };

            if (this.option('orientation') === 'vertical') {
              axises = ['y', 'top', 'height'];
              otherAxise = 'x';
            }

            this.clearingTouchdragFunction = fullClear;
            this.slidesContainer.addEvent('touchdrag', onDrag); // this.slidesContainer.addEvent('mousedrag touchdrag', onDrag);
          };

          _proto82.appendSelectors = function appendSelectors(start) {
            var container = this.movingContainer;

            if (this.externalContainer) {
              if (!this.isFullscreenState()) {
                container = this.externalContainer;
                this.selectorsWrapper.addClass(CSS_MAIN_CLASS + '-external');
              } else {
                this.selectorsWrapper.removeClass(CSS_MAIN_CLASS + '-external');
              }
            }

            if (start || this.externalContainer) {
              container.append(this.selectorsWrapper);
            }
          };

          _proto82.createClasses = function createClasses() {
            var _this285 = this;

            var option = this.option;

            var getOrientation = function (value) {
              if ($J.contains(['left', 'right'], value)) {
                return 'v';
              }

              return 'h';
            };

            ['standard', 'fullscreen'].forEach(function (_type) {
              var isStandard = _type === 'standard';
              var en = isStandard ? option('thumbnails.enable') : option('fullscreen.thumbnails.enable');
              var s = isStandard ? option('thumbnails.position') : option('fullscreen.thumbnails.position');
              var ss = getThumbnailsType(isStandard ? option('thumbnails.type') : option('fullscreen.thumbnails.type'));
              var grid = isStandard ? _this285.isStandardGrid : _this285.isFullscreenGrid;

              if (en) {
                if (!isStandard || !_this285.externalContainer) {
                  _this285.classes[_type].movingContainerClasses.push(CSS_MAIN_CLASS + '-selectors-' + s);
                }

                _this285.classes[_type].selectorsWrapperClasses.push(CSS_MAIN_CLASS + '-' + ss);

                _this285.classes[_type].selectorsWrapperClasses.push(CSS_MAIN_CLASS + '-' + getOrientation(s));

                if (grid) {
                  _this285.classes[_type].selectorsWrapperClasses.push(CSS_MAIN_CLASS + '-grid');
                }

                if (option('fullscreen.thumbnails.autohide') && !isStandard) {
                  _this285.classes[_type].movingContainerClasses.push(CSS_MAIN_CLASS + '-autohide');

                  _this285.classes[_type].movingContainerClasses.push(CSS_MAIN_CLASS + '-selectors-closed');
                }
              }
            });
          };

          _proto82.changeClasses = function changeClasses(obj, remove) {
            var _this286 = this;

            var action = remove ? 'removeClass' : 'addClass';
            obj.movingContainerClasses.forEach(function (className) {
              _this286.movingContainer[action](className);
            });
            obj.selectorsWrapperClasses.forEach(function (className) {
              _this286.selectorsWrapper[action](className);
            });
          };

          _proto82.setClasses = function setClasses() {
            if (this.isFullscreenState()) {
              this.changeClasses(this.classes.standard, true);
              this.changeClasses(this.classes.fullscreen);
            } else {
              this.changeClasses(this.classes.fullscreen, true);
              this.changeClasses(this.classes.standard);
            }
          };

          _proto82.setInViewAction = function setInViewAction() {
            var _this287 = this;

            if (this.option('autostart') === 'visible') {
              this.inViewModule = new helper.InViewModule(function (entries) {
                entries.forEach(function (entry) {
                  var last = _this287.isInView; // https://github.com/verlok/vanilla-lazyload/issues/293#issuecomment-469100338
                  // Sometimes 'intersectionRatio' can be 0 but 'isIntersecting' is true

                  var iv = entry.isIntersecting || entry.intersectionRatio > 0;

                  if (_this287.isFullscreenState() && !iv) {
                    iv = true;
                  }

                  if (last !== iv) {
                    _this287.isInView = iv;

                    _this287.postInitialization();

                    _this287.broadcast('inView', {
                      data: iv
                    });

                    if (_this287.isInView) {
                      _this287.autoplay();
                    } else {
                      _this287.pauseAutoplay();
                    }
                  }
                });
              }, {
                rootMargin: this.rootMargin + 'px 0px'
              });
              this.inViewModule.observe(this.instanceNode.node);
            } else {
              this.isInView = true;
            }
          };

          _proto82.sendEvent = function sendEvent(nameOfEvent, data) {
            /*
                slider events: [
                    'ready',
                    'beforeSlideIn',
                    'beforeSlideOut',
                    'afterSlideIn',
                    'afterSlideOut',
                    'fullscreenIn',
                    'fullscreenOut',
                    'enableItem',
                    'disableItem'
                ]
            */
            if (!data) {
              data = {};
            }

            data.node = this.instanceNode;

            if (!data.slider) {
              data.slider = {
                type: nameOfEvent
              };
            }

            this.emit('viewerPublicEvent', {
              data: data
            });
          };

          _proto82.checkReadiness = function checkReadiness(eventName, component) {
            var result = false;

            if ($J.contains(['init', 'ready'], eventName)) {
              if (component === 'viewer') {
                if (eventName === 'ready') {
                  result = this.isReady;
                }
              } else {
                for (var i = 0, l = this.slides.length; i < l; i++) {
                  if (this.slides[i].checkReadiness(eventName, component)) {
                    result = true;
                    break;
                  }
                }
              }
            }

            return result;
          };

          _proto82.sendReadyEvent = function sendReadyEvent(eventName, component) {
            if (component === 'viewer') {
              this.sendEvent('ready');
            } else {
              this.slides.forEach(function (slide) {
                slide.sendReadyEvent(eventName, component);
              });
            }
          };

          _proto82.sendStats = function sendStats(typeOfEvent, data) {
            if (!data) {
              data = {};
            }

            data.slider = this.id;

            if (typeOfEvent) {
              data.data = {};
              data.data.event = typeOfEvent;
            }

            var stats;
            var serverStats;

            switch (data.component) {
              case 'spin':
                stats = {
                  account: data.account,
                  event: {
                    type: data.component,
                    name: data.event,
                    data: data.data || {},
                    sessionId: data.sessionId,
                    origin: data.origin
                  }
                };
                stats.event[data.event === 'sessionStart' ? 'ts' : 'time'] = data.eventTime;
                serverStats = JSON.parse(JSON.stringify(stats));
                serverStats.event = JSON.stringify(serverStats.event);
                break;
              // no default
            }

            if (stats) {
              if (data.useBeacon === true) {
                helper.sendRawStats(serverStats, true);
              } else {
                setTimeout(function () {
                  helper.sendRawStats(serverStats);
                }, 1);
              }

              this.sendEvent('sendStats', $J.detach(stats));
            }
          };

          _proto82.setComponentsEvents = function setComponentsEvents() {
            var _this288 = this;

            // const size = this.slidesContainer.getSize();
            // const getProportionSize = (proportions) => {
            //     let i;
            //     let result = null;
            //     for (i = 0; i < proportions.length; i++) {
            //         if (proportions[i].size) {
            //             result = proportions[i].size;
            //             break;
            //         }
            //     }
            //     return result;
            // };
            var loadContent = function (index) {
              if (_this288.firstSlideAhead && index === _this288.index) {
                var p = _this288.option('slide.preload');

                _this288.enabledIndexesOfSlides.forEach(function (slideIndex) {
                  _this288.slides[slideIndex].startGettingInfo();

                  if (p) {
                    _this288.slides[slideIndex].loadContent();
                  } else {
                    _this288.slides[slideIndex].loadThumbnail();
                  }
                });
              }
            };

            var play = function (index) {
              if (_this288.index === index) {
                _this288.autoplay();
              }
            };

            var pause = function (index) {
              if (_this288.index === index) {
                _this288.pauseAutoplay();
              }
            };

            this.on('stats', function (e) {
              /*
                  e.data = {
                      event: 'rotate',  // name of event
                      data: {},         // event data
                      index: 0          // slide Index
                      component: 'spin' // type of component
                  }
              */
              e.stopAll();
              var doc = $J.D.node;
              var win = $J.W.node;
              var scrn = win.screen;

              if (e.data.event === 'sessionStart') {
                if (!e.data.data) {
                  e.data.data = {};
                }

                e.data.data.screen = {
                  width: scrn.width,
                  height: scrn.height,
                  availWidth: scrn.availWidth,
                  availHeight: scrn.availHeight,
                  colorDepth: scrn.colorDepth,
                  pixelDepth: scrn.pixelDepth
                };
                e.data.data.browser = {
                  width: win.innerWidth || doc.documentElement.clientWidth || doc.body.clientWidth || 0,
                  height: win.innerHeight || doc.documentElement.clientWidth || doc.body.clientWidth || 0
                };
              }

              _this288.sendStats(null, e.data);
            });
            this.on('slideVideoPlay', function (e) {
              e.stopAll();
              pause(e.data.slide.index);
            });
            this.on('slideVideoPause', function (e) {
              e.stopAll(); // pause(e.data.slide.index);
            });
            this.on('slideVideoEnd', function (e) {
              e.stopAll();
              play(e.data.slide.index);
            }); // if slide is not sirv component

            this.on('contentLoaded', function (e) {
              e.stopAll();
              loadContent(e.data.slide.index);
            }); // init,ready,zoomIn,zoomOut
            // fullscreenIn, fullscreenOut
            // pinchStart, pinchEnd

            this.on('componentEvent', function (e) {
              var event = e.data.type;
              e.stopAll();

              switch (event) {
                case 'init':
                  if (_this288.index === e.data.slide.index || _this288.slides[_this288.index] && _this288.slides[_this288.index].isSpinInited()) {
                    _this288.addControllWrapper();

                    _this288.enableFullscreenButton();

                    _this288.visibleFullscreenButton();
                  }

                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'ready':
                  if (_this288.index === e.data.slide.index && e.data.component !== 'spin' && (!_this288.slides[e.data.slide.index].isVideoSlide() || _this288.isFullscreenState())) {
                    _this288.addControllWrapper();

                    _this288.enableFullscreenButton();

                    _this288.visibleFullscreenButton();
                  }

                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'rotate':
                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'fullscreenIn':
                  if (e.data.component === 'video') {
                    _this288.sendEvent('componentEvent', e.data);
                  } else if (_this288.option(FULLSCREEN + '.enable') && _this288.isFullscreen === globalVariables.FULLSCREEN.CLOSED) {
                    _this288.enterFullScreen();
                  }

                  break;

                case 'fullscreenOut':
                  if (e.data.component === 'video') {
                    _this288.sendEvent('componentEvent', e.data);
                  } else {
                    _this288.exitFullScreen();
                  }

                  break;

                case 'pinchStart':
                  // clearTimeout(this.touchDragTimer);
                  // this.touchDragTimer = null;
                  _this288.isComponentPinching = true;
                  break;

                case 'pinchEnd':
                  _this288.isComponentPinching = false;
                  break;

                case 'zoomIn':
                  _this288.isZoomIn = true;
                  pause(e.data.slide.index);

                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'zoomOut':
                  _this288.isZoomIn = false;
                  play(e.data.slide.index);

                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'hotspotOpened':
                  pause(e.data.slide.index);
                  break;

                case 'hotspotClosed':
                  play(e.data.slide.index);
                  break;

                case 'spinStart':
                  pause(e.data.slide.index);
                  break;

                case 'spinEnd':
                  play(e.data.slide.index);
                  break;

                case 'play':
                  if (e.data.component === 'video') {
                    pause(e.data.slide.index);

                    _this288.sendEvent('componentEvent', e.data);
                  }

                  break;

                case 'resume':
                  if (e.data.component === 'video') {
                    pause(e.data.slide.index);

                    _this288.sendEvent('componentEvent', e.data);
                  }

                  break;

                case 'pause':
                  if (e.data.component === 'video') {
                    _this288.sendEvent('componentEvent', e.data);
                  }

                  break;

                case 'end':
                  if (e.data.component === 'video') {
                    play(e.data.slide.index);

                    _this288.sendEvent('componentEvent', e.data);
                  }

                  break;

                case 'seek':
                  // video component event
                  _this288.sendEvent('componentEvent', e.data);

                  break;

                case 'contentLoaded':
                  loadContent(e.data.slide.index);
                  break;

                default: // no default

              }
            });
            this.on('goTo' + _FULLSCREEN, function (e) {
              e.stopAll();

              if (_this288.option(FULLSCREEN + '.enable') && _this288.isFullscreen === globalVariables.FULLSCREEN.CLOSED) {
                _this288.enterFullScreen();
              }
            });
            this.on('goTo' + _FULLSCREEN + 'Out', function (e) {
              e.stopAll();

              _this288.exitFullScreen();
            });
            this.on('infoReady', function (e) {
              // if slide was added by api
              e.stop();

              if (_this288.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                var slide = _this288.slides[e.data.index];
                slide.broadcast('before' + _FULLSCREEN + 'In', {
                  data: {
                    pseudo: _this288.isPseudo
                  }
                });
                slide.broadcast('after' + _FULLSCREEN + 'In', {
                  data: {
                    pseudo: _this288.isPseudo
                  }
                });
              }
            });
            this.on(function (e) {
              e.stopAll();
            });
          };

          _proto82.normalizeOptions = function normalizeOptions() {
            var _this289 = this;

            var opts = $(['contextmenu.text.zoom.in', 'contextmenu.text.zoom.out', 'contextmenu.' + FULLSCREEN + '.enter', 'contextmenu.' + FULLSCREEN + '.exit', 'contextmenu.text.download']);

            var isEmpty = function (str) {
              return $J.typeOf(str) === 'string' && str.trim() === '';
            };

            if (this.option('fullscreen.thumbnails.size') === 'auto') {
              this.option('fullscreen.thumbnails.size', this.option('thumbnails.size'));
            }

            if (this.option('slide.animation.type') === 'off') {
              this.option('slide.animation.type', false);
            }

            if (this.option('thumbnails.type') === 'grid') {
              this.isStandardGrid = true;
              this.option('thumbnails.type', 'square');
            }

            if (this.option('fullscreen.thumbnails.type') === 'grid') {
              this.isFullscreenGrid = false;
              this.option('fullscreen.thumbnails.type', 'square');
            }

            opts.forEach(function (opt) {
              if (isEmpty(_this289.option(opt))) {
                _this289.option(opt, false);
              }
            });

            if (this.option('thumbnails.enable') && this.option('thumbnails.target') && this.option('thumbnails.target').trim() === '') {
              this.option('thumbnails.target', false);
            }

            if (this.option('slide.socialbuttons.enable') && !this.option('slide.socialbuttons.types.facebook') && !this.option('slide.socialbuttons.types.twitter') && !this.option('slide.socialbuttons.types.linkedin') && !this.option('slide.socialbuttons.types.reddit') && !this.option('slide.socialbuttons.types.tumblr') && !this.option('slide.socialbuttons.types.pinterest') && !this.option('slide.socialbuttons.types.telegram')) {
              this.option('slide.socialbuttons.enable', false);
            }

            this.slideOptions.sbEnable = this.option('slide.socialbuttons.enable');
          };

          _proto82.addControllWrapper = function addControllWrapper() {
            if (!this.controlsWrapperWasAppended && this.controlsWrapper.node.childNodes.length) {
              this.controlsWrapperWasAppended = true;
              this.slideWrapper.append(this.controlsWrapper);
            }
          };

          _proto82.postInitialization = function postInitialization() {
            var _this290 = this;

            if (!this.isInitialized && this.isInView && this.isSelectorsReady && this.isToolStarted && this.isStartedFullInit) {
              this.isInitialized = true;

              if (!this.hasSize) {
                this.setContainerSize();
              }

              this.broadcast('inView', {
                data: this.isInView
              });
              this.createArrows();

              if (this.selectors) {
                this.selectors.inView(this.isInView, this.instanceNode);
                this.selectors.setActiveItem(this.index);
              }

              if (!$J.browser.mobile) {
                var eventName = 'mouseout';

                if (helper.isIe()) {
                  eventName = 'pointerout';
                }

                this.movingContainer.addEvent(eventName, function (e) {
                  if (e.pointerType && e.pointerType !== 'mouse') {
                    return;
                  }

                  var toElement = e.getRelated();

                  while (toElement && toElement !== _this290.movingContainer.node) {
                    toElement = toElement.parentNode;
                  }

                  if (_this290.movingContainer.node !== toElement && _this290.index !== null) {
                    _this290.slides[_this290.index].mouseAction('mouseout', e);
                  }
                });
              }

              if (this.slides.length > 1) {
                this.initTouchDrag();
              }

              $($J.W).addEvent('resize', this.onResizeHandler);
              this.showHideArrows();
              this.showHideSelectors();

              if (this.option(FULLSCREEN + '.always')) {
                this.slideWrapper.addClass(globalVariables.CSS_CURSOR_FULSCREEN_ALWAYS);
              }

              this.movingContainer.attr('id', this.movingContainerId);
              this.createFullscreenButton();
              this.addControllWrapper();

              if (this.slides[this.index] && !this.slides[this.index].isSirv() && (!this.slides[this.index].isVideoSlide() || this.isFullscreenState())) {
                this.enableFullscreenButton();
                this.visibleFullscreenButton();
              }

              this.checkLoop(this.index); // we can't reset this style earlier, because youtube and vimeo can't get size if it is first slide

              this.movingContainer.setCssProp('font-size', '');

              if (this.doHistory) {
                $($J.W).addEvent('popstate', this.onHistoryStateChange);
              }

              this.autoplay();
              this.isReady = true;
              this.sendEvent('ready');
            }
          };

          _proto82.addHistory = function addHistory() {
            if (this.doHistory) {
              // Modify browser history so that expanded view can be closed by browser's Back button
              var urlHash = '#sirv-viewer-' + this.fullscreenViewId;

              if ($J.W.node.location.hash !== urlHash) {
                var state = {
                  name: 'Sirv.viewer',
                  hash: this.fullscreenViewId
                };
                var title = $J.D.node.body.title || 'Sirv viewer';

                try {
                  if ($J.W.node.history.state && $J.W.node.history.state.name === 'Sirv.viewer') {
                    $J.W.node.history.replaceState(null, title, '');
                  }

                  $J.W.node.history.pushState(state, title, urlHash);
                } catch (e) {// empty
                }
              }
            }
          };

          _proto82.setContainerSize = function setContainerSize() {
            var result = false;
            var ss = 0;

            if (this.selectors) {
              ss = this.selectorsWrapper.getSize()[this.selectors.getShortSide()];
            }

            var size = this.movingContainer.getSize();
            var selectors = this.option('thumbnails.position');
            var isSelectorsContainer = this.option('thumbnails.enable') && this.canShowSelectors(this.slides.length) && ss > 0 && !this.externalContainer;

            if (size.width || size.height) {
              result = true;

              if (this.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                this.movingContainer.setCssProp('height', '');
                this.slideWrapper.setCssProp('height', '');
              } else {
                if (this.doSetSize && this.heightProportion) {
                  if (isSelectorsContainer && $J.contains(['left', 'right'], selectors)) {
                    size.width -= ss;
                  }

                  var height = size.width * (this.heightProportion.height / this.heightProportion.width);

                  if (height > this.heightProportion.height) {
                    height = this.heightProportion.height;
                  } // if (isSelectorsContainer && $J.contains(['top', 'bottom'], selectors)) { height += ss; }
                  // this.movingContainer.setCssProp('height', height + 'px');


                  if (!isSelectorsContainer || $J.contains(['left', 'right'], selectors) && !this.isStandardGrid) {
                    this.movingContainer.setCssProp('height', height + 'px');
                  } else {
                    this.slideWrapper.setCssProp('height', height + 'px');
                  }
                }
              }
            }

            return result;
          };

          _proto82.findSlideIndex = function findSlideIndex(id) {
            var result = -1;

            for (var i = 0, l = this.slides.length; i < l; i++) {
              if (this.slides[i].id && this.slides[i].id === id) {
                result = this.slides[i].index;
                break;
              }
            }

            return result;
          };

          _proto82.getCountOfEnabledSlides = function getCountOfEnabledSlides(isDisabled) {
            var result = this.enabledIndexesOfSlides.length;

            if (isDisabled) {
              result = this.slides.length - result;
            }

            return result;
          };

          _proto82.getItems = function getItems(settings) {
            /*
                settings = undefined
                settings = {
                    enabled: true|false,
                    group: 'group'|['group', ...]
                }
            */
            var isEnabled = null;
            var slides = this.slides;

            if (settings) {
              if ($J.defined(settings.enabled)) {
                isEnabled = settings.enabled;
              }

              if (settings.group) {
                slides = this.getSlidesByGroup(settings.group);
              }
            }

            var result = [];
            slides.forEach(function (slide) {
              if (isEnabled === true) {
                if (slide.isEnabled()) {
                  result.push(slide.getData());
                }
              } else if (isEnabled === false) {
                if (!slide.isEnabled()) {
                  result.push(slide.getData());
                }
              } else {
                result.push(slide.getData());
              }
            });
            return result;
          };

          _proto82.controlEnabledSlides = function controlEnabledSlides(indexOfSlide, remove) {
            if (remove) {
              this.enabledIndexesOfSlides.splice(this.enabledIndexesOfSlides.indexOf(indexOfSlide), 1);
            } else {
              this.enabledIndexesOfSlides.push(indexOfSlide);
              this.enabledIndexesOfSlides = this.enabledIndexesOfSlides.sort(function (a, b) {
                var result = 0;

                if (a < b) {
                  result = -1;
                } else if (a > b) {
                  result = 1;
                }

                return result;
              });
            }
          };

          _proto82.disableSlide = function disableSlide(indexOfSlide, withoutEvent) {
            var result = false;
            var nextSlide = 'next';
            var l = this.slides.length;

            if ($J.typeOf(indexOfSlide) === 'string') {
              indexOfSlide = this.findSlideIndex(indexOfSlide);
            }

            if ($J.typeOf(indexOfSlide) === 'number' && indexOfSlide >= 0 && indexOfSlide < this.slides.length && this.slides[indexOfSlide].isEnabled()) {
              var slideUUID = this.slides[indexOfSlide].$J_UUID;

              if (this.effect) {
                this.effect.stop();
              }

              if (this.slides[indexOfSlide].isActive) {
                if (this.index === l - 1 && this.option('loop')) {
                  nextSlide = 0;
                }

                if (!this.jump(nextSlide, 4, true)) {
                  this.slides[indexOfSlide].beforeHide();
                  this.slides[indexOfSlide].afterHide();
                }
              }

              if (this.slides[indexOfSlide].isEnabled()) {
                this.controlEnabledSlides(indexOfSlide, true);
              }

              this.slides[indexOfSlide].disable();
              this.checkLoop(this.index);

              if (!this.enabledIndexesOfSlides.length) {
                this.index = null;
              }

              if (this.selectors) {
                this.selectors.disableSelector(slideUUID);
              }

              if (!withoutEvent) {
                this.sendEvent('disableItem', {
                  slide: this.slides[indexOfSlide].getData()
                });
              }

              this.checkSingleSlide();
              this.showHideArrows();
              this.showHideSelectors();
              result = true;
            }

            return result;
          };

          _proto82.enableSlide = function enableSlide(slideIndex) {
            var _this291 = this;

            var result = false;

            if ($J.typeOf(slideIndex) === 'string') {
              slideIndex = this.findSlideIndex(slideIndex);
            }

            if ($J.typeOf(slideIndex) === 'number' && slideIndex >= 0 && slideIndex < this.slides.length && !this.slides[slideIndex].isEnabled()) {
              this.slides[slideIndex].startGettingInfo();
              this.slides[slideIndex].loadThumbnail();
              this.slides[slideIndex].enable();
              this.slides[slideIndex].resize();
              var lenghtAvailableSlides = this.enabledIndexesOfSlides.filter(function (index) {
                return _this291.slides[index].isSlideAvailable();
              });

              if (!this.enabledIndexesOfSlides.length) {
                this.index = slideIndex;
              }

              if (this.slides[slideIndex].isSlideAvailable() && !lenghtAvailableSlides.length) {
                this.index = slideIndex;
                this.slides[slideIndex].loadContent();
                this.slides[slideIndex].beforeShow();
                this.slides[slideIndex].afterShow(globalVariables.SLIDE_SHOWN_BY.ENABLE);
              }

              this.controlEnabledSlides(slideIndex);
              this.checkLoop(this.index);

              if (this.selectors) {
                this.selectors.enableSelector(this.slides[slideIndex].getUUID());

                if (this.slides[slideIndex].isSlideAvailable()) {
                  this.selectors.setCurrentActiveItemByUUID(this.slides[slideIndex].getUUID());
                }
              }

              this.sendEvent('enableItem', {
                slide: this.slides[slideIndex].getData()
              });
              this.checkSingleSlide();
              this.showHideArrows();
              this.showHideSelectors();
              result = true;
            }

            return result;
          };

          _proto82.getSlidesByGroup = function getSlidesByGroup(group) {
            var result = null;

            if (group) {
              result = [];
              this.slides.forEach(function (slide) {
                if (slide.belongsTo(group)) {
                  result.push(slide);
                }
              });
            }

            return result;
          };

          _proto82.enableGroupOfSlides = function enableGroupOfSlides(group) {
            var _this292 = this;

            var result = false;
            var slides = this.getSlidesByGroup(group);

            if (slides && slides.length) {
              result = true;
              slides.forEach(function (slide) {
                _this292.enableSlide(slide.getIndex());
              });
            }

            return result;
          };

          _proto82.disableGroupOfSlides = function disableGroupOfSlides(group) {
            var _this293 = this;

            var result = false;
            var slides = this.getSlidesByGroup(group);

            if (slides && slides.length) {
              result = true;
              slides.forEach(function (slide) {
                _this293.disableSlide(slide.getIndex());
              });
            }

            return result;
          };

          _proto82.switchGroupOfSlides = function switchGroupOfSlides(group) {
            var _this294 = this;

            var result = false;

            if (group) {
              var slides = this.getItems({
                enabled: true
              });
              slides.forEach(function (slide) {
                if (!_this294.slides[slide.index].belongsTo(group)) {
                  _this294.disableSlide(slide.index);
                }
              });
              result = this.enableGroupOfSlides(group);
            }

            return result;
          };

          _proto82.jump = function jump(direction, whoUse, fast, cIndex) {
            var result = false;
            var effect = this.option('slide.animation.type');
            var currentIndex = cIndex;
            var isContains = $J.contains(['next', 'prev'], direction);
            var l = this.slides.length;

            if (!this.effect || !this.enabledIndexesOfSlides.length || this.index === null) {
              return result;
            }

            if (currentIndex === $J.U) {
              currentIndex = this.index;
            }

            if (!isContains) {
              var res = this.findSlideIndex(direction);

              if (res >= 0) {
                direction = res;
              }
            }

            var index = helper.sliderLib.findIndex(direction, currentIndex, l, this.option('loop'));

            if (index === null) {
              return result;
            }

            if (this.index !== index) {
              if (!this.slides[index].isEnabled() || !this.slides[index].isSlideAvailable()) {
                if (isContains) {
                  result = this.jump(direction, whoUse, fast, index);
                }

                return result;
              }

              clearTimeout(this.autoplayTimer);

              if (!isContains) {
                if (index > this.index) {
                  direction = 'next';
                } else {
                  direction = 'prev';
                }
              }

              this.checkLoop(index);

              if (!effect || fast) {
                effect = 'blank';
              }

              if (this.selectors) {
                this.selectors.setActiveItem(index);
                this.selectors.jump(index);
              }

              this.effect.make({
                index: this.index,
                node: this.slides[this.index].getNode()
              }, {
                index: index,
                node: this.slides[index].getNode()
              }, {
                effect: effect,
                direction: direction
              }, {
                whoUse: whoUse
              });
              result = true;
            } else {
              this.slides[index].secondSelectorClick();
            }

            this.index = index;
            return result;
          };

          _proto82.checkLoop = function checkLoop(index) {
            var _this295 = this;

            if (this.arrows) {
              var l = this.enabledIndexesOfSlides.filter(function (indexSlide) {
                return !_this295.slides[indexSlide].isSelectorPinned() && _this295.slides[indexSlide].isSlideAvailable();
              }).length;

              if (l < 2) {
                this.arrows.disable('backward');
                this.arrows.disable('forward');
              } else if (!this.option('loop')) {
                var newIndex = this.enabledIndexesOfSlides.indexOf(index);
                this.arrows.disable();

                if (newIndex === 0 || l === 1) {
                  this.arrows.disable('backward');
                }

                if (newIndex === l - 1 || l === 1) {
                  this.arrows.disable('forward');
                }
              } else {
                this.arrows.disable();
              }
            }
          };

          _proto82.createFullscreenButton = function createFullscreenButton() {
            var _this296 = this;

            if (!this.option(FULLSCREEN + '.enable') || this.fullscreenButton) {
              return;
            }

            this.fullscreenButton = $J.$new('div').addClass(CSS_MAIN_CLASS + '-button').addClass(CSS_MAIN_CLASS + '-button-' + FULLSCREEN).addClass(STANDARD_BUTTON_CLASS);
            this.fullscreenButton.append($J.$new('div').addClass(CSS_MAIN_CLASS + '-icon'));
            this.disableFullscreenButton();
            this.hideFullscreenButton();
            this.fullscreenButton.addEvent('btnclick tap', function (e) {
              e.stop();

              if (_this296.isFullscreen === globalVariables.FULLSCREEN.CLOSED || _this296.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                _this296.disableFullscreenButton();

                _this296.hideFullscreenButton();

                if (_this296.isFullscreen === globalVariables.FULLSCREEN.CLOSED) {
                  _this296.enterFullScreen();
                } else {
                  _this296.exitFullScreen();
                }
              }
            });
            this.controlsWrapper.append(this.fullscreenButton);

            if (this.slides[this.index].isSlideReady()) {
              setTimeout(function () {
                if (!_this296.slides[_this296.index].isVideoSlide() || _this296.isFullscreenState()) {
                  _this296.enableFullscreenButton();

                  _this296.visibleFullscreenButton();
                }
              }, 0);
            }
          };

          _proto82.visibleFullscreenButton = function visibleFullscreenButton() {
            if (this.fullscreenButton) {
              this.fullscreenButton.removeClass(FULLSCREEN_BUTTON_HIDE_CLASS);
            }
          };

          _proto82.hideFullscreenButton = function hideFullscreenButton() {
            if (this.fullscreenButton) {
              this.fullscreenButton.addClass(FULLSCREEN_BUTTON_HIDE_CLASS);
            }
          };

          _proto82.enableFullscreenButton = function enableFullscreenButton() {
            if (this.fullscreenButton) {
              this.fullscreenButton.removeAttr('disabled');
            }
          };

          _proto82.disableFullscreenButton = function disableFullscreenButton() {
            if (this.fullscreenButton) {
              this.fullscreenButton.attr('disabled', 'disabled');
            }
          };

          _proto82.createEffect = function createEffect() {
            var _this297 = this;

            this.effect = new Effect({
              time: this.option('slide.animation.duration'),
              orientation: this.option('orientation')
            });
            this.effect.setParent(this);
            this.on('effectStart', function (e) {
              e.stopAll();
              _this297.isMoving = true;

              _this297.disableFullscreenButton();

              if (_this297.slides[e.indexes[1]].isVideoSlide() && _this297.isFullscreen !== globalVariables.FULLSCREEN.OPENED) {
                _this297.hideFullscreenButton();
              }

              _this297.slides[e.indexes[0]].beforeHide();

              _this297.slides[e.indexes[1]].beforeShow();

              if (e.data.callbackData.whoUse !== 4) {
                _this297.sendEvent('beforeSlideIn', {
                  slide: _this297.slides[e.indexes[1]].getData()
                });

                _this297.sendEvent('beforeSlideOut', {
                  slide: _this297.slides[e.indexes[0]].getData()
                });
              }
            });
            this.on('effectEnd', function (e) {
              e.stopAll();

              if (!_this297.slides[e.indexes[1]].isVideoSlide() || _this297.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                _this297.enableFullscreenButton();

                _this297.visibleFullscreenButton();
              }

              _this297.slides[e.indexes[0]].afterHide();

              _this297.slides[e.indexes[1]].afterShow(e.data.callbackData.whoUse);

              if (e.data.callbackData.whoUse !== 4) {
                _this297.sendEvent('afterSlideIn', {
                  slide: _this297.slides[e.indexes[1]].getData()
                });

                _this297.sendEvent('afterSlideOut', {
                  slide: _this297.slides[e.indexes[0]].getData()
                });
              }

              _this297.autoplay();

              _this297.isMoving = false;
              _this297.residualAutoplayTime = _this297.autoplayDelay;
            });
          };

          _proto82.createArrows = function createArrows() {
            var _this298 = this;

            var option = this.option;

            if (!option('arrows')) {
              return;
            }

            this.arrows = new Arrows({
              orientation: option('orientation')
            });
            this.arrows.hide();
            this.arrows.setParent(this);
            this.on('arrowAction', function (e) {
              e.stopAll(); // e.data.type === 'next' || 'prev'

              var index = _this298.getNextIndex(e.data.type, _this298.index, _this298.slides.length, _this298.option('loop'));

              _this298.jump(index, 2);
            });
            this.arrows.getNodes().forEach(function (node) {
              _this298.controlsWrapper.append(node);
            });
          };

          _proto82.getNextIndex = function getNextIndex(direction, index, length, loop) {
            var resultIndex = helper.sliderLib.findIndex(direction, index, length, loop);
            var result = resultIndex;

            if (resultIndex !== null && resultIndex !== this.index && (this.slides[resultIndex].isSelectorPinned() || !this.slides[resultIndex].isSlideAvailable() || !this.slides[resultIndex].isEnabled())) {
              result = this.getNextIndex(direction, resultIndex, length, loop);
            }

            return result;
          };

          _proto82.isHiddenSlides = function isHiddenSlides() {
            return !this.slides.some(function (slide) {
              return !slide.isCustomSelector() || slide.isCustomSelector() && slide.isSlideAvailable();
            });
          };

          _proto82.createSelectors = function createSelectors() {
            var _this299 = this;

            var option = this.option;

            if (!option('thumbnails.enable') && !option('fullscreen.thumbnails.enable')) {
              this.isSelectorsReady = true;
              return;
            }

            this.selectors = new Selectors(this.slides.map(function (slide) {
              return slide.getSelector();
            }), {
              isStandardGrid: this.isStandardGrid,
              standardStyle: option('thumbnails.type'),
              standardSize: option('thumbnails.size'),
              standardPosition: option('thumbnails.enable') ? option('thumbnails.position') : false,
              standardWatermark: option('thumbnails.watermark'),
              isFullscreenGrid: this.isFullscreenGrid,
              fullscreenStyle: option('fullscreen.thumbnails.type'),
              fullscreenSize: option('fullscreen.thumbnails.size'),
              fullscreenPosition: option('fullscreen.thumbnails.enable') ? option('fullscreen.thumbnails.position') : false,
              fullscreenAutohide: option('fullscreen.thumbnails.autohide'),
              fullscreenWatermark: option('fullscreen.thumbnails.watermark'),
              arrows: option('arrows')
            });
            this.selectors.setParent(this);
            this.on('selectorsReady', function (e) {
              e.stopAll();
              _this299.isSelectorsReady = true;

              _this299.postInitialization();
            });
            this.on('getSelectorProportion', function (e) {
              e.stopAll();

              var index = _this299.getSlideByUUID(e.data.UUID);

              if (index !== null) {
                var slide = _this299.slides[index];

                if (slide) {
                  var result = {
                    size: null,
                    isSirv: true
                  };
                  slide.getSelectorProportion().then(function (data) {
                    result.isSirv = slide.isSirvSelector();
                    result.size = data.size;
                    e.data.resultingCallback(result);
                  }).catch(function (err) {
                    result.isSirv = slide.isSirvSelector();

                    _this299.pickOut(err.UUID);

                    e.data.resultingCallback(result);
                  });
                } else {
                  e.data.resultingCallback(null);
                }
              } else {
                e.data.resultingCallback(null);
              }
            });
            this.on('getSelectorImgUrl', function (e) {
              e.stopAll();

              var index = _this299.getSlideByUUID(e.data.UUID);

              if (index !== null) {
                var slide = _this299.slides[index];

                if (slide) {
                  slide.getSelectorImgUrl(e.data.type, e.data.size, e.data.crop, e.data.watermark).then(function (result) {
                    e.data.resultingCallback({
                      src: result.src,
                      srcset: result.srcset,
                      size: result.size,
                      alt: result.alt,
                      referrerpolicy: result.referrerpolicy
                    });
                  }).catch(function (err) {
                    e.data.resultingCallback(null);
                  });
                } else {
                  e.data.resultingCallback(null);
                }
              } else {
                e.data.resultingCallback(null);
              }
            });
            this.on('changeSlide', function (e) {
              e.stopAll();

              var index = _this299.getSlideByUUID(e.data.UUID);

              if (index !== null) {
                var _tmp = _this299.option(FULLSCREEN + '.enable') && _this299.option(FULLSCREEN + '.always');

                if (_this299.slides[index].isCustomSelector()) {
                  _this299.sendEvent('thumbnailClick', {
                    slide: _this299.slides[index].getData()
                  });
                }

                _this299.jump(index, 2, _tmp);

                if (_tmp) {
                  _this299.enterFullScreen();
                }
              }
            });
            this.on('visibility', function (e) {
              e.stop();

              switch (e.action) {
                case 'show':
                  _this299.movingContainer.removeClass(CSS_MAIN_CLASS + '-selectors-closed');

                  break;

                case 'hide':
                  _this299.movingContainer.addClass(CSS_MAIN_CLASS + '-selectors-closed');

                  break;
                // no default
              }
            });
            this.on('selectorsDone', function (e) {
              e.stopAll();

              if ($J.contains(['left', 'right'], _this299.selectors.getCurrentStylePosition())) {
                _this299.onResize();
              }
            });
            this.selectorsWrapper.append(this.selectors.getNode());
            this.slides.forEach(function (slide, index) {
              if (!slide.isEnabled()) {
                _this299.selectors.disableSelector(slide.getUUID());
              }
            });
            this.showHideSelectors(true);
          };

          _proto82.findSlide = function findSlide() {
            var dataSrc = this.instanceNode.attr('data-src');

            if (dataSrc) {
              var tmp;

              try {
                if (this.viewerFileContent) {
                  tmp = this.viewerFileContent;
                } else {
                  tmp = dataSrc.split('?')[0];
                  tmp = tmp.split('.');
                  tmp = tmp[tmp.length - 1];
                }
              } catch (e) {// empty
              }

              var node;

              if (tmp === 'spin' || helper.isVideo(dataSrc)) {
                node = $J.$new('div', {
                  'data-src': dataSrc
                });
                tmp = globalVariables.SLIDE.TYPES.SPIN;
              } else {
                if ($J.contains([this.instanceNode.attr('data-type'), this.instanceNode.attr('data-effect')], 'zoom')) {
                  tmp = globalVariables.SLIDE.TYPES.ZOOM;
                  node = $J.$new('div', {
                    'data-type': 'zoom',
                    'data-src': dataSrc
                  });
                } else {
                  tmp = globalVariables.SLIDE.TYPES.IMAGE;
                  node = $J.$new('img', {
                    'data-src': dataSrc
                  });
                }
              }

              if (this.viewerFileContent) {
                node.store('view-content', tmp);
              }

              this.instanceNode.append(node);
            } else {
              dataSrc = this.instanceNode.attr('data-bg-src');

              if (dataSrc) {
                this.instanceNode.append($J.$new('img', {
                  'data-src': dataSrc
                }));
              }
            }

            return this.getSlides(true);
          };

          _proto82.canPinSlide = function canPinSlide(node) {
            var side = Slide.findPinnedSelectorSide(node);
            var pinnedSlides = this.slides.filter(function (slide) {
              return slide.getPinnedSelectorSide() === side;
            });

            if (pinnedSlides.length < 3) {
              return true;
            }

            return false;
          };

          _proto82.getSlideByUUID = function getSlideByUUID(uuid) {
            var result = null;

            for (var i = 0, l = this.slides.length; i < l; i++) {
              var slide = this.slides[i];

              if (slide.getUUID() === uuid) {
                result = i;
                break;
              }
            }

            return result;
          };

          _proto82.pickOut = function pickOut(uuid) {
            var index = this.getSlideByUUID(uuid);

            if (index === null) {
              return;
            }

            this.removeSlide(index);

            if (!this.slides.length) {
              this.emit('destroy', {
                data: {
                  id: this.id,
                  node: this.instanceNode.node
                }
              });
              return;
            }

            if (this.slides.length < 2) {
              // clear selectors class and additional things
              if (this.option('thumbnails.enable') || this.option('fullscreen.thumbnails.enable')) {
                this.changeClasses(this.classes.standard, true);
                this.setContainerSize();
              }
            }

            if (!this.isToolStarted) {
              this.searchingOfProportions();
            }

            this.postInitialization();
          };

          _proto82.getSlides = function getSlides(fromFindSlide) {
            var _this300 = this;

            var slides;

            if (fromFindSlide) {
              slides = $J.$A(this.instanceNode.node.childNodes);
            } else {
              slides = $J.$A(this.instanceNode.node.childNodes).filter(function (slide) {
                var result = false;

                _this300.sliderNodes.push(slide.cloneNode(true));

                if (slide.tagName && $J.contains(['div', 'img', 'iframe', 'figure', 'video', 'picture', SELECTOR_TAG], $(slide).getTagName())) {
                  result = true;
                }

                slide.parentNode.removeChild(slide);
                return result;
              });
              slides = slidePinnedFilter(slides);
            }

            var filteredSlides = slides.map(function (slide) {
              return Slide.parse(slide);
            });
            globalFunctions.viewerFilters.forEach(function (callback) {
              var fs = [].concat(filteredSlides);
              fs = fs.map(function (s) {
                var r = {};
                helper.objEach(s, function (key, value) {
                  if (key === 'type') {
                    value = globalVariables.SLIDE.NAMES[value];
                  }

                  helper.createReadOnlyProp(r, key, value);
                });
                return r;
              });
              var result = callback(_this300.id, fs);

              if (Array.isArray(result)) {
                filteredSlides = result.map(function (s) {
                  var r = s;

                  for (var i = 0, l = filteredSlides.length; i < l; i++) {
                    if (s.node === filteredSlides[i].node) {
                      r = filteredSlides.splice(i, 1)[0];
                      break;
                    }
                  }

                  return r;
                });
              }
            });
            slides = filteredSlides;

            if (!fromFindSlide && !slides.length) {
              slides = this.findSlide();
            }

            slides = helper.sortSlidesByOrder(this.option('itemsOrder'), slides);
            return slides;
          };

          _proto82.createSlides = function createSlides(slides) {
            var _this301 = this;

            var index = 0;
            slides.forEach(function (slide) {
              if (!Slide.isSirvComponent(slide.node) || Slide.hasComponent(slide.node)) {
                slide = $(slide.node);

                if (slide.getTagName() === SELECTOR_TAG) {
                  var div = $J.$new('div');

                  if (slide.attr('data-id')) {
                    div.attr('data-id', slide.attr('data-id'));
                  }

                  if (slide.attr('data-group')) {
                    div.attr('data-group', slide.attr('data-group'));
                  }

                  div.append(slide);
                  slide = div;
                }

                slide.addClass(CSS_MAIN_CLASS + '-component');

                var _slide = new Slide(slide.node, index, _this301.slideOptions);

                _slide.setParent(_this301);

                _this301.slides.push(_slide);

                if (_slide.isEnabled() && _slide.isSlideAvailable()) {
                  _this301.enabledIndexesOfSlides.push(index);
                }

                index += 1;
              }
            });
            this.firstSlideAhead = this.enabledIndexesOfSlides.length > MAX_SLIDES_TO_CHANGE_PRELOAD_BEHAVIOR;
            this.enabledIndexesOfSlides.forEach(function (slideindex, i) {
              if (!_this301.firstSlideAhead || i < MAX_SLIDES_TO_CHANGE_PRELOAD_BEHAVIOR) {
                _this301.slides[slideindex].startGettingInfo();
              }
            });

            if (this.index > this.slides.length - 1) {
              this.index = 0;
            }

            this.postInitialization();
          };

          _proto82.checkSingleSlide = function checkSingleSlide() {
            var _this302 = this;

            var isSingle = this.enabledIndexesOfSlides.length === 1;
            this.enabledIndexesOfSlides.forEach(function (index) {
              _this302.slides[index].single(isSingle);
            });
          };

          _proto82.showHideArrows = function showHideArrows() {
            if (this.arrows) {
              var visibleSlides = this.visibleSlides();

              if (visibleSlides < 2 || this.option(FULLSCREEN + '.always') && !this.isFullscreenState()) {
                this.arrows.hide();
              } else if (visibleSlides > 1 && (!this.option(FULLSCREEN + '.always') || this.isFullscreenState())) {
                this.arrows.show();
              }
            }
          };

          _proto82.canShowSelectors = function canShowSelectors(selectorCount) {
            var property = this.isFullscreen === globalVariables.FULLSCREEN.OPENED ? 'fullscreen.thumbnails.always' : 'thumbnails.always';
            return this.option(property) || selectorCount > 1;
          };

          _proto82.showHideSelectors = function showHideSelectors(force
          /* container size can be set faster than we can detect selector's visibility */
          ) {
            var _this303 = this;

            if (this.selectors) {
              if (!this.selectorsDebounce) {
                this.selectorsDebounce = helper.debounce(function () {
                  if (_this303.selectors) {
                    var canShow = _this303.canShowSelectors(_this303.enabledIndexesOfSlides.length);

                    if (canShow) {
                      if (!_this303.selectors.isSelectorsActionEnabled()) {
                        _this303.movingContainer.setCssProp('height', '100%');

                        _this303.selectorsWrapper.removeClass(CSS_MAIN_CLASS + '-hide-selectors');

                        _this303.selectors.enableActions();

                        _this303.onResize();
                      }
                    } else {
                      if (_this303.selectors.isSelectorsActionEnabled()) {
                        _this303.selectorsWrapper.addClass(CSS_MAIN_CLASS + '-hide-selectors');

                        _this303.selectors.disableActions();

                        _this303.onResize();
                      }
                    }
                  }
                }, force ? 0 : 32);
              }

              this.selectorsDebounce();
            }
          };

          _proto82.getAvailableSlideIndex = function getAvailableSlideIndex(startIndex) {
            if (startIndex === this.slides.length - 1 && !this.slides[startIndex].isSlideAvailable()) {
              return -1;
            }

            if (this.slides[startIndex + 1].isSlideAvailable()) {
              return startIndex + 1;
            }

            return this.getAvailableSlideIndex(startIndex + 1);
          };

          _proto82.addAvailableSlideNode = function addAvailableSlideNode(slide, index) {
            var slideNode = slide.getNode();
            var l = this.slides.length;

            if (slide.isSlideAvailable()) {
              if (l > 1 && index !== l - 1) {
                if (this.slides[index + 1].isSlideAvailable()) {
                  this.slidesContainer.node.insertBefore(slideNode.node, this.slides[index + 1].getNode().node);
                } else {
                  var indexAvailableSlide = this.getAvailableSlideIndex(index);

                  if (indexAvailableSlide < 0) {
                    this.slidesContainer.append(slideNode);
                  } else {
                    this.slidesContainer.node.insertBefore(slideNode.node, this.slides[indexAvailableSlide].getNode().node);
                  }
                }
              } else {
                this.slidesContainer.append(slideNode);
              }
            }
          };

          _proto82.sortItems = function sortItems(order) {
            if (!Array.isArray(order)) {
              order = this.option('itemsOrder');
            }

            if (!order.length) {
              return;
            }

            this.slides = helper.sortSlidesByOrder(order, this.slides);

            if (this.selectors) {
              this.selectors.sortSelectors(this.slides.map(function (slide) {
                return slide.getUUID();
              }), order.length);
            }

            this.slides.forEach(function (slide, index) {
              slide.setNewIndex(index);
            });

            for (var indexSlide = 0, l = this.slides.length; indexSlide < l; indexSlide++) {
              if (this.slides[indexSlide].isSlideActive()) {
                this.index = this.slides[indexSlide].getIndex();
                break;
              }
            }
          };

          _proto82.insertSlide = function insertSlide(indexOfSlide, htmlNodeSlide) {
            var _this304 = this;

            var pinnedNode = htmlNodeSlide.querySelector(SELECTOR_TAG) || htmlNodeSlide;

            if (Slide.findPinnedSelectorSide(pinnedNode) && !this.canPinSlide(pinnedNode)) {
              return false;
            }

            if (!$J.defined(indexOfSlide)) {
              indexOfSlide = this.slides.length + 1;
            }

            if ($J.typeOf(indexOfSlide) === 'number' && indexOfSlide >= 0 && htmlNodeSlide && (!Slide.isSirvComponent(htmlNodeSlide) || Slide.hasComponent(htmlNodeSlide))) {
              $(htmlNodeSlide).addClass(CSS_MAIN_CLASS + '-component');

              if (indexOfSlide > this.slides.length) {
                indexOfSlide = this.slides.length;
              }

              clearTimeout(this.timerRemove);
              var slide = new Slide(htmlNodeSlide, indexOfSlide, this.slideOptions, true);
              slide.setParent(this);
              this.slides.splice(indexOfSlide, 0, slide);
              var nonIndex = this.index === null;

              if (this.index === null) {
                if (slide.isEnabled() && slide.isSlideAvailable()) {
                  // this.index = 0; // TODO check it
                  this.index = indexOfSlide;
                } else {
                  nonIndex = false;
                }
              } else if (indexOfSlide <= this.index) {
                this.index += 1;
              }

              this.enabledIndexesOfSlides = [];
              this.slides.forEach(function (_slide, index) {
                _slide.setNewIndex(index);

                if (_slide.isEnabled()) {
                  _this304.controlEnabledSlides(index);
                }
              });
              this.addAvailableSlideNode(slide, indexOfSlide);
              /*
                  new component for slider is needed css
              */

              this.addComponentsCSS();
              slide.appendToDOM(); // all elements need to be in dom

              slide.initVideoPlayer();
              slide.startGettingInfo();
              slide.loadThumbnail();
              slide.startFullInit(null);
              slide.startTool(this.index === indexOfSlide, this.firstSlideAhead ? false : this.option('slide.preload'), this.firstSlideAhead);
              slide.broadcast('inView', {
                data: this.isInView
              });

              if (this.index === indexOfSlide) {
                slide.loadContent();
                slide.beforeShow();
                slide.afterShow(globalVariables.SLIDE_SHOWN_BY.INIT);
              }

              if (this.isFullscreen === globalVariables.FULLSCREEN.OPENED && !slide.isSirv()) {
                slide.broadcast('before' + _FULLSCREEN + 'In', {
                  data: {
                    pseudo: this.isPseudo
                  }
                });
                slide.broadcast('after' + _FULLSCREEN + 'In', {
                  data: {
                    pseudo: this.isPseudo
                  }
                });
              }

              this.checkLoop(this.index);

              if (this.selectors) {
                this.selectors.insertSelector(indexOfSlide, slide.getSelector());

                if (nonIndex) {
                  this.selectors.setActiveItem(this.index);
                }
              }

              this.checkSingleSlide();
              this.showHideSelectors();
              this.showHideArrows();
              return true;
            }

            return false;
          };

          _proto82.removeSlide = function removeSlide(indexOfSlide) {
            var _this305 = this;

            var flag = false;

            if ($J.typeOf(indexOfSlide) === 'string') {
              indexOfSlide = this.findSlideIndex(indexOfSlide);
            }

            if ($J.typeOf(indexOfSlide) === 'number' && indexOfSlide >= 0 && indexOfSlide < this.slides.length) {
              var slideUUID = this.slides[indexOfSlide].$J_UUID;

              if (this.slides[indexOfSlide].isEnabled()) {
                this.disableSlide(indexOfSlide, true);
              } else {
                flag = true;
              }

              this.slides[indexOfSlide].destroy();
              this.slides.splice(indexOfSlide, 1);
              this.enabledIndexesOfSlides = [];
              this.slides.forEach(function (slide, index) {
                slide.setNewIndex(index);

                if (slide.isEnabled()) {
                  _this305.controlEnabledSlides(index);
                }
              });

              if (this.selectors) {
                this.selectors.pickOut(slideUUID);
              }

              if (this.index !== null && indexOfSlide <= this.index && this.index !== 0) {
                this.index -= 1;
              }

              if (flag) {
                this.checkSingleSlide();
              }

              if (this.isHiddenSlides()) {
                this.timerRemove = setTimeout(function () {
                  if (_this305.instanceNode) {
                    _this305.emit('destroy', {
                      data: {
                        id: _this305.id,
                        node: _this305.instanceNode.node
                      }
                    });
                  }
                }, 100);
              }

              return true;
            }

            return false;
          };

          _proto82.createContextMenu = function createContextMenu() {
            var _this306 = this;

            var option = this.option;
            var contextmenuData = $([]);

            if (option('contextmenu.enable')) {
              if (option('contextmenu.text.zoom.in') || option('contextmenu.text.zoom.out')) {
                if (option('contextmenu.text.zoom.in')) {
                  contextmenuData.push({
                    id: 'zoomin',
                    label: option('contextmenu.text.zoom.in'),
                    hidden: false,
                    action: function (e) {
                      _this306.slides[_this306.index].zoomIn(e.left, e.top);
                    }
                  });
                }

                if (option('contextmenu.text.zoom.out')) {
                  contextmenuData.push({
                    id: 'zoomout',
                    label: option('contextmenu.text.zoom.out'),
                    disabled: true,
                    hidden: false,
                    action: function (e) {
                      _this306.slides[_this306.index].zoomOut(e.left, e.top);
                    }
                  });
                }
              }

              if (option(FULLSCREEN + '.enable') && (option('contextmenu.text.' + FULLSCREEN + '.enter') || option('contextmenu.text.' + FULLSCREEN + '.exit'))) {
                if (option('contextmenu.text.' + FULLSCREEN + '.enter')) {
                  // isExist
                  contextmenuData.push({
                    id: 'enter' + FULLSCREEN,
                    label: option('contextmenu.text.' + FULLSCREEN + '.enter'),
                    hidden: !option(FULLSCREEN + '.enable'),
                    action: function () {
                      _this306.enterFullScreen();
                    }
                  });
                }

                if (option('contextmenu.text.' + FULLSCREEN + '.exit')) {
                  contextmenuData.push({
                    id: 'exit' + FULLSCREEN,
                    label: option('contextmenu.text.' + FULLSCREEN + '.exit'),
                    hidden: true,
                    action: function () {
                      _this306.exitFullScreen();
                    }
                  });
                }
              }

              if (option('contextmenu.text.download')) {
                if (contextmenuData.length) {
                  contextmenuData.push({
                    id: 'sirv-separator',
                    hidden: false,
                    separator: true
                  });
                }

                contextmenuData.push({
                  id: 'download',
                  label: option('contextmenu.text.download'),
                  action: function () {
                    var dlw;

                    var url = _this306.slides[_this306.index].getOriginImageUrl();

                    if (url) {
                      dlw = $J.$new('iframe').setCss({
                        width: 0,
                        height: 0,
                        display: 'none'
                      }).appendTo($J.D.node.body);
                      dlw.node.src = url + '?format=original&dl';
                    }
                  }
                });
              }

              this.movingContainer.addEvent('contextmenu', function (e) {
                var magnify;
                var canShow = false;
                var zoomData;
                var dl = true;
                var zoomMenu = false;
                var fullscreenMenu = false;
                var downloadMenu = false;
                var zoomin = 'zoomin';
                var zoomout = 'zoomout';
                var enterfullscreen = 'enter' + FULLSCREEN;
                var exitfullscreen = 'exit' + FULLSCREEN;
                e.stopDefaults();

                if (_this306.contextMenu && !_this306.isMoving && _this306.enabledIndexesOfSlides.length) {
                  var item = _this306.slides[_this306.index];
                  var typeOfSlide = item.getTypeOfSlide();
                  var t = globalVariables.SLIDE.TYPES;

                  if (_this306.isReady && item.isReady && item.isSirv() && typeOfSlide) {
                    var opts = item.getOptions();

                    switch (typeOfSlide) {
                      case t.SPIN:
                        magnify = true;
                        break;

                      case t.ZOOM:
                        magnify = opts.mode === 'deep';
                        break;

                      case t.IMAGE:
                        break;

                      case t.VIDEO:
                        dl = false;
                        break;
                      // no default
                    }

                    if (magnify && _this306.slides[_this306.index].isZoomSizeExist() && (option('contextmenu.text.zoom.in') || option('contextmenu.text.zoom.out'))) {
                      zoomData = _this306.slides[_this306.index].getZoomData();

                      _this306.contextMenu.showItem(zoomin);

                      if (zoomData.isZoomed && zoomData.zoom === 1) {
                        _this306.contextMenu.disableItem(zoomin);
                      } else {
                        _this306.contextMenu.enableItem(zoomin);
                      }

                      _this306.contextMenu.showItem(zoomout); // if (!zoomData.isZoomed || zoomData.zoom === 0) {


                      if (!zoomData.isZoomed) {
                        _this306.contextMenu.disableItem(zoomout);
                      } else {
                        _this306.contextMenu.enableItem(zoomout);
                      }

                      zoomMenu = true;
                    } else {
                      _this306.contextMenu.hideItem(zoomin);

                      _this306.contextMenu.hideItem(zoomout);
                    }

                    if (option(FULLSCREEN + '.enable')) {
                      if (_this306.isFullscreenState()) {
                        _this306.contextMenu.hideItem(enterfullscreen);

                        if (_this306.contextMenu.isExist(exitfullscreen)) {
                          _this306.contextMenu.showItem(exitfullscreen);

                          if (zoomData && zoomData.isZoomed) {
                            _this306.contextMenu.disableItem(exitfullscreen);
                          } else {
                            _this306.contextMenu.enableItem(exitfullscreen);
                          }

                          fullscreenMenu = true;
                        }
                      } else {
                        if (_this306.contextMenu.isExist(enterfullscreen)) {
                          _this306.contextMenu.showItem(enterfullscreen);

                          if (zoomData && zoomData.isZoomed) {
                            _this306.contextMenu.disableItem(enterfullscreen);
                          } else {
                            _this306.contextMenu.enableItem(enterfullscreen);
                          }

                          fullscreenMenu = true;
                        }

                        _this306.contextMenu.hideItem(exitfullscreen);
                      }
                    }

                    if (_this306.contextMenu.isExist('download') && dl) {
                      _this306.contextMenu.showItem('download');

                      downloadMenu = true;
                    } else {
                      _this306.contextMenu.hideItem('download');
                    }

                    if (zoomMenu || fullscreenMenu || downloadMenu) {
                      if ((zoomMenu || fullscreenMenu) && downloadMenu && typeOfSlide !== t.VIDEO) {
                        _this306.contextMenu.showItem('sirv-separator');
                      } else {
                        _this306.contextMenu.hideItem('sirv-separator');
                      }

                      canShow = true;

                      _this306.broadcast('stopContext');
                    }
                  }

                  _this306.contextMenu.setCanShow(canShow);
                }
              });

              if (contextmenuData.length && !$J.browser.mobile) {
                this.contextMenu = new ContextMenu(this.movingContainer, contextmenuData, 'sirv');

                if (option('fullscreen.enable')) {
                  this.contextMenu.setFullScreenBox(this.fullScreenBox);
                }
              }
            } else {
              this.movingContainer.addEvent('contextmenu', function (e) {
                e.stop();
              });
            }
          };

          _proto82.enterFullScreen = function enterFullScreen() {
            var _this307 = this;

            if (this.isFullscreen !== globalVariables.FULLSCREEN.CLOSED) {
              return false;
            }

            this.addHistory();
            this.isFullscreen = globalVariables.FULLSCREEN.OPENING;
            this.fullscreenStartTime = +new Date();
            var isPseudo = !this.option('fullscreen.native') || !$J.browser.fullScreen.capable || !$J.browser.fullScreen.enabled();

            if (iPhoneSafariViewportRuler) {
              iPhoneSafariViewportRuler.appendTo($J.D.node.body);
            }

            this.disableFullscreenButton();
            this.hideFullscreenButton();

            if (this.selectors) {
              this.setClasses();

              if (this.option('fullscreen.thumbnails.enable')) {
                this.appendSelectors();
              }

              this.selectors.beforeEnterFullscreen();
            }

            this.slideWrapper.removeClass(globalVariables.CSS_CURSOR_FULSCREEN_ALWAYS);
            this.fullScreenBox.setCss({
              position: 'fixed',
              top: 0,
              left: 0,
              width: '100%',
              height: '100%',
              overflow: 'hidden',
              zIndex: 99999999999
            });
            this.boxSize = this.instanceNode.getSize();
            this.boxBoundaries = this.instanceNode.getRect();
            this.fullScreenBox.append(this.movingContainer);
            $($J.D.node.body).append(this.fullScreenBox);
            this.movingContainer.setCssProp('height', '100%');
            this.broadcast('before' + _FULLSCREEN + 'In', {
              data: {
                pseudo: isPseudo
              }
            });
            this.slideWrapper.setCssProp('height', '');

            if (ProductDetail && this.productDetail) {
              this.productDetail.open();
            }

            $J.browser.fullScreen.request(this.fullScreenBox, {
              windowFullscreen: !this.option('fullscreen.native'),
              onEnter: this.onEnteredFullScreen.bind(this),
              // onExit: this.onExitFullScreen.bind(this),
              onExit: function () {
                if ($J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.OPENING], _this307.isFullscreen)) {
                  return;
                }

                _this307.isFullscreen = globalVariables.FULLSCREEN.CLOSING;

                _this307._beforeExitFullscreen();

                _this307.broadcast('before' + _FULLSCREEN + 'Out', {
                  data: {
                    pseudo: false
                  }
                });

                _this307.onExitFullScreen();
              },
              fallback: function () {
                var rootTag = $J.D.node.getElementsByTagName('html')[0];
                $(rootTag).addClass(PSEUDO_FULLSCREEN_CLASS);
                $(document.body).getSize();
                setTimeout(function () {
                  return _this307.onEnteredFullScreen(true);
                }, 64); // const fullSize = $J.D.getSize();
                // const scrolls = $J.W.getScroll();
                // // const docFullSize = $($J.D).getFullSize();
                // const rootTag = $J.D.node.getElementsByTagName('html')[0];
                // $(rootTag).addClass(PSEUDO_FULLSCREEN_CLASS);
                // let top = 0 + scrolls.y;
                // // Properly handle iPhone Safari (>10) address bar, bookmark bar and status bar
                // // if (isHandset && $J.browser.platform === 'ios' && $J.browser.uaName === 'safari' && parseInt($J.browser.uaVersion, 10) > 10) {
                // if (iPhoneSafariViewportRuler) {
                //     top = Math.abs(iPhoneSafariViewportRuler.node.getBoundingClientRect().top);
                //     // this.expandBox.setCss({ height: window.innerHeight, maxHeight: '100vh', top: Math.abs(iPhoneSafariViewportRuler,node.getBoundingClientRect().top) });
                // }
                // if (!this.fullScreenFX) {
                //     this.fullScreenFX = new $J.FX(this.fullScreenBox, {
                //         duration: 1,
                //         transition: $J.FX.getTransition().expoOut,
                //         onStart: () => {
                //             this.fullScreenBox.setCss({
                //                 width: this.boxSize.width,
                //                 height: this.boxSize.height,
                //                 top: this.boxBoundaries.top,
                //                 left: this.boxBoundaries.left
                //             }).appendTo($J.D.node.body);
                //         },
                //         onAfterRender: () => {},
                //         onComplete: () => {
                //             this.onEnteredFullScreen(true);
                //             this.fullScreenFX = null;
                //         }
                //     });
                // }
                // this.fullScreenFX.start({
                //     width:  [this.boxSize.width, fullSize.width],
                //     height: [this.boxSize.height, fullSize.height],
                //     // top:    [this.boxBoundaries.top, 0 + scrolls.y],
                //     top:    [this.boxBoundaries.top, top],
                //     left:   [this.boxBoundaries.left, 0 + scrolls.x],
                //     opacity: [0, 1]
                // });
              }
            });
            return true;
          };

          _proto82.onEnteredFullScreen = function onEnteredFullScreen(pseudo) {
            var _this308 = this;

            if (this.isFullscreen !== globalVariables.FULLSCREEN.OPENING) {
              return;
            }

            this.isPseudo = pseudo; // the variable is necessary for custom inserting slide

            if (pseudo && this.isFullscreen === globalVariables.FULLSCREEN.OPENING) {
              this.fullScreenBox.setCss({
                top: iPhoneSafariViewportRuler ? Math.abs(iPhoneSafariViewportRuler.node.getBoundingClientRect().top) : 0,
                left: 0,
                right: 0,
                bottom: 0,
                width: 'auto',
                height: iPhoneSafariViewportRuler ? $J.W.node.innerHeight : 'auto',
                display: this.productDetail ? 'flex' : 'block',
                position: 'fixed'
              }); // if (iPhoneSafariViewportRuler) {
              //     this.fullScreenBox.setCss({ height: $J.W.node.innerHeight, top: Math.abs(iPhoneSafariViewportRuler.node.getBoundingClientRect().top) });
              // }

              $J.D.addEvent('keydown', this.pseudoFSEvent);
            }

            this.isFullscreen = globalVariables.FULLSCREEN.OPENED;

            if (this.fullscreenButton) {
              this.fullscreenButton.removeClass(STANDARD_BUTTON_CLASS);
              this.fullscreenButton.addClass(FULLSCREEN_BUTTON_CLASS);

              if (!this.slides[this.index] || !this.slides[this.index].isVideoSlide() || this.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                setTimeout(function () {
                  _this308.enableFullscreenButton();

                  _this308.visibleFullscreenButton();
                }, 1);
              }
            }

            if (this.selectors) {
              this.selectors.afterEnterFullscreen();
            }

            if (this.slides.length > 1) {
              $J.D.addEvent('keyup', this.keyBoardArrowsCallback);
            }

            this.showHideArrows();
            this.showHideSelectors();
            this.broadcast('after' + _FULLSCREEN + 'In', {
              data: {
                pseudo: pseudo
              }
            });
            this.onResize();
            var eventData = {};

            if (this.enabledIndexesOfSlides.length) {
              eventData = {
                slide: this.slides[this.index].getData()
              };
            }

            this.sendEvent(FULLSCREEN + 'In', eventData);
          };

          _proto82._beforeExitFullscreen = function _beforeExitFullscreen() {
            this.disableFullscreenButton();
            this.hideFullscreenButton();

            if (this.option(FULLSCREEN + '.always')) {
              this.slideWrapper.addClass(globalVariables.CSS_CURSOR_FULSCREEN_ALWAYS);
            }

            if (this.selectors) {
              if (this.option('fullscreen.thumbnails.enable')) {
                this.appendSelectors();
              }

              this.setClasses();
              this.selectors.beforeExitFullscreen();
            }

            if (ProductDetail && this.productDetail) {
              this.productDetail.close();
            }
          };

          _proto82.exitFullScreen = function exitFullScreen() {
            if (this.isFullscreen !== globalVariables.FULLSCREEN.OPENED) {
              return false;
            }

            this.isFullscreen = globalVariables.FULLSCREEN.CLOSING;

            this._beforeExitFullscreen();

            if (iPhoneSafariViewportRuler) {
              iPhoneSafariViewportRuler.remove();
            }

            if ($J.browser.fullScreen.capable && $J.browser.fullScreen.enabled() && this.option('fullscreen.native')) {
              this.broadcast('before' + _FULLSCREEN + 'Out', {
                data: {
                  pseudo: false
                }
              });
              $J.browser.fullScreen.cancel.call(document);
            } else {
              var rootTag = $J.D.node.getElementsByTagName('html')[0];
              $(rootTag).removeClass(PSEUDO_FULLSCREEN_CLASS);
              this.broadcast('before' + _FULLSCREEN + 'Out', {
                data: {
                  pseudo: true
                }
              });
              this.onExitFullScreen(true); // const fullSize = this.fullScreenBox.getSize();
              // const fsBoxBoundaries = this.fullScreenBox.getRect();
              // const rootTag = $J.D.node.getElementsByTagName('html')[0];
              // $(rootTag).removeClass(PSEUDO_FULLSCREEN_CLASS);
              // this.broadcast('before' + _FULLSCREEN + 'Out', { data: { pseudo: true } });
              // if (!this.fullScreenExitFX) {
              //     this.fullScreenExitFX = new $J.FX(this.fullScreenBox, {
              //         duration: 1,
              //         transition: $J.FX.getTransition().expoOut,
              //         onStart: () => {
              //             $($J.D).removeEvent('keydown', this.pseudoFSEvent);
              //             this.fullScreenBox.setCss({ position: 'absolute' });
              //         },
              //         onAfterRender: () => {},
              //         onComplete: () => {
              //             this.onExitFullScreen(true);
              //             this.fullScreenExitFX = null;
              //         }
              //     });
              // }
              // this.fullScreenExitFX.start({
              //     width:  [fullSize.width, this.boxSize.width],
              //     height: [fullSize.height, this.boxSize.height],
              //     top:    [0 + fsBoxBoundaries.top, this.boxBoundaries.top],
              //     left:   [0 + fsBoxBoundaries.left, this.boxBoundaries.left],
              //     opacity: [1, 0.5]
              // });
            }

            return true;
          };

          _proto82.onExitFullScreen = function onExitFullScreen(pseudo) {
            var _this309 = this;

            if ($J.contains([globalVariables.FULLSCREEN.CLOSED, globalVariables.FULLSCREEN.OPENING], this.isFullscreen)) {
              return;
            }

            $J.D.removeEvent('keyup', this.keyBoardArrowsCallback);
            this.showHideArrows();
            this.showHideSelectors();
            this.instanceNode.append(this.movingContainer);
            this.fullScreenBox.remove();

            if (this.fullscreenButton) {
              this.fullscreenButton.removeClass(FULLSCREEN_BUTTON_CLASS);
              this.fullscreenButton.addClass(STANDARD_BUTTON_CLASS);

              if (!this.slides[this.index] || !this.slides[this.index].isVideoSlide() || this.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                setTimeout(function () {
                  _this309.enableFullscreenButton();

                  _this309.visibleFullscreenButton();
                }, 1);
              }
            }

            if (this.doHistory) {
              // If close initiated not by the Back button
              var urlHash = '#sirv-viewer-' + this.fullscreenViewId;

              try {
                if ($J.W.node.location.hash === urlHash) {
                  $J.W.node.history.back();
                }
              } catch (e) {// empty
              }
            }

            this.isFullscreen = globalVariables.FULLSCREEN.CLOSED;
            this.isPseudo = false;

            if (this.selectors) {
              this.selectors.afterExitFullscreen();
            }
            /*
                this.setContainerSize(); - it must be under this.isFullscreen = globalVariables.FULLSCREEN.CLOSED; and this.selectors.afterExitFullscreen();
                because after exit from fullscreen with this options:
                {
                    thumbnails: {
                        enable: true,
                        position: 'bottom'
                    },
                     fullscreen: {
                        thumbnails: {
                            enable: false
                        },
                    }
                }
                slider container is got wrong size
            */


            this.setContainerSize(); // this.sendStats(FULLSCREEN + 'Close', { duration: +new Date() - this.fullscreenStartTime });

            this.fullscreenStartTime = null;
            this.broadcast('after' + _FULLSCREEN + 'Out', {
              data: {
                pseudo: pseudo
              }
            });
            var eventData = {};

            if (this.enabledIndexesOfSlides.length) {
              eventData = {
                slide: this.slides[this.index].getData()
              };
            }

            this.sendEvent(FULLSCREEN + 'Out', eventData);
            this.onResize();
          };

          _proto82.getSlide = function getSlide(index) {
            var _this$slides$index;

            if (index === null || $J.typeOf(index) === 'number' && index >= this.slides.length) {
              index = this.index;
            }

            if ($J.typeOf(index) === 'string') {
              index = this.findSlideIndex(index);
            }

            return (_this$slides$index = this.slides[index]) == null ? void 0 : _this$slides$index.getData();
          };

          _proto82.onResizeWithoutSelectors = function onResizeWithoutSelectors() {
            if (!this.destroyed) {
              // Properly handle address bar and status bar on iPhone
              // if (isHandset && $J.browser.platform === 'ios' && $J.browser.uaName === 'safari' && parseInt($J.browser.uaVersion, 10) > 10) {
              if (iPhoneSafariViewportRuler && this.isFullscreen === globalVariables.FULLSCREEN.OPENED) {
                // this.fullScreenBox.setCss({ top: Math.abs(iPhoneSafariViewportRuler.node.getBoundingClientRect().top) });
                this.fullScreenBox.setCss({
                  height: $J.W.node.innerHeight,
                  top: Math.abs(iPhoneSafariViewportRuler.node.getBoundingClientRect().top)
                });
              }

              this.setRootMargin();
              this.setContainerSize();
              this.slides.forEach(function (slide) {
                slide.resize();
              });
            }
          };

          _proto82.onResize = function onResize() {
            if (this.destroyed) {
              return;
            } // this.setContainerSize();


            if (this.selectors) {
              this.selectors.onResize();
            }

            this.onResizeDebounce();
          };

          _proto82.play = function play(delay) {
            var result = false;
            var currentDelay = this.option('slide.delay');

            if ($J.defined(delay) && $J.typeOf(delay) === 'number' && delay > 9
            /* 9 is min delay */
            ) {
                currentDelay = delay;
              }

            if (this.autoplayTimer === null && !this.isAutoplay || currentDelay !== this.autoplayDelay) {
              this.autoplayDelay = currentDelay;
              this.isAutoplay = true;
              this.residualAutoplayTime = this.autoplayDelay;
              this.autoplay();
              result = true;
            }

            return result;
          };

          _proto82.pause = function pause() {
            var result = this.autoplayTimer;
            this.isAutoplay = false;
            clearTimeout(this.autoplayTimer);
            this.autoplayTimer = null;
            this.residualAutoplayTime = this.autoplayDelay;
            return result === null;
          };

          _proto82.pauseAutoplay = function pauseAutoplay() {
            clearTimeout(this.autoplayTimer);
            this.autoplayTimer = null;
            this.residualAutoplayTime -= $J.now() - this.currentAutoplayTime;
          };

          _proto82.autoplay = function autoplay() {
            var _this310 = this;

            if (this.isAutoplay) {
              this.currentAutoplayTime = $J.now();
              var delay = this.autoplayDelay;

              if (this.residualAutoplayTime !== delay) {
                if (this.residualAutoplayTime < MIN_AUTOPLAY) {
                  delay = MIN_AUTOPLAY;
                } else {
                  delay = this.residualAutoplayTime;
                }
              }

              clearTimeout(this.autoplayTimer);
              this.autoplayTimer = setTimeout(function () {
                if (!_this310.destroyed) {
                  _this310.jump('next', globalVariables.SLIDE_SHOWN_BY.AUTOPLAY);
                }
              }, delay);
            }
          };

          _proto82.destroy = function destroy() {
            var _this311 = this;

            this.destroyed = true;
            this.onResizeDebounce.cancel();
            this.onResizeDebounce = null;
            clearTimeout(this.autoplayTimer);
            this.autoplayTimer = null;

            if (this.selectorsDebounce) {
              this.selectorsDebounce.cancel();
              this.selectorsDebounce = null;
            }

            $($J.W).removeEvent('resize', this.onResizeHandler);
            this.onResizeHandler = null;
            $($J.D).removeEvent('keyup', this.keyBoardArrowsCallback);

            if (this.inViewModule) {
              this.inViewModule.disconnect();
              this.inViewModule = null;
            }

            if (this.doHistory) {
              $($J.W).removeEvent('popstate', this.onHistoryStateChange);
              globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.splice(globalVariables.FULLSCREEN_VIEWERS_IDs_ARRAY.indexOf(this.fullscreenViewId), 1);
            }

            this.movingContainer.removeEvent('mouseout');
            this.slideWrapper.removeClass(globalVariables.CSS_CURSOR_FULSCREEN_ALWAYS);

            if (this.clearingTouchdragFunction) {
              this.clearingTouchdragFunction();
            }

            this.slidesContainer.removeEvent('touchdrag');

            if (isCustomId(this.id)) {
              this.instanceNode.removeAttr('id');
            }

            if (this.contextMenu) {
              this.movingContainer.removeEvent('contextmenu');
              this.contextMenu.destroy();
              this.contextMenu = null;
            }

            if (this.productDetail) {
              this.productDetail.destroy();
              this.productDetail = null;
            }

            if (this.fullscreenButton) {
              this.fullscreenButton.removeEvent('btnclick tap');
              this.fullscreenButton.remove();
            }

            this.fullscreenButton = null;

            if (this.effect) {
              this.effect.destroy();
              this.effect = null;
              this.on('effectStart');
              this.on('effectEnd');
            }

            if (this.arrows) {
              this.arrows.destroy();
              this.arrows = null;
              this.off('arrowAction');
            }

            if (this.selectors) {
              this.selectors.destroy();
              this.selectors = null;
              this.off('visibility');
              this.off('changeSlide');
              this.off('selectorsReady');
              this.off('getSelectorImgUrl');
              this.off('selectorsDone');
              this.off('getSelectorProportion');
            }

            this.off('componentEvent');
            this.off('goTo' + _FULLSCREEN);
            this.off('goTo' + _FULLSCREEN + 'Out');
            this.off('infoReady');
            this.off('slideVideoPlay');
            this.off('slideVideoPause');
            this.off('slideVideoEnd');
            this.slides.forEach(function (slide) {
              var node = slide.getOriginNode();
              $(node).removeClass(CSS_MAIN_CLASS + '-component');
              slide.destroy();
            });
            this.slides = [];
            this.off('stats');
            this.sliderNodes.forEach(function (node) {
              return _this311.instanceNode.append(node);
            });
            this.sliderNodes = [];
            $($J.D).removeEvent('keydown', this.pseudoFSEvent);
            this.pseudoFSEvent = null;
            $($J.D).removeEvent('keyup', this.keyBoardArrowsCallback);
            this.keyBoardArrowsCallback = null;
            this.fullScreenBox.remove();
            this.fullScreenBox = null;
            this.controlsWrapper.remove();
            this.controlsWrapper = null;
            this.slidesContainer.remove();
            this.slidesContainer = null;
            this.selectorsWrapper.remove();
            this.selectorsWrapper = null;
            this.slideWrapper.remove();
            this.slideWrapper = null;
            this.movingContainer.remove();
            this.movingContainer = null;
            this.isReady = false;
            this.doSetSize = false;
            this.instanceNode = null;
            this.externalContainer = null;

            _EventEmitter28.prototype.destroy.call(this);
          };

          return Slider;
        }(EventEmitter);

        return Slider;
      }();
      /* eslint-env es6 */

      /* global defaultOptions, SirvSlider, helper, EventEmitter, $, $J, globalFunctions, SliderBuilder, Promise, SELECTOR_TAG */

      /* eslint-disable dot-notation */

      /* eslint-disable no-use-before-define */

      /* eslint quote-props: ["error", "as-needed", { "keywords": true, "unnecessary": false }] */

      /* eslint no-unused-vars: ["error", { "args": "none", "varsIgnorePattern": "Slider" }] */


      var Slider = function () {
        var checkArgument = function (value) {
          if ($J.typeOf(value) !== 'number' && $J.typeOf(value) !== 'string') {
            value = null;
          }

          return value;
        };

        var clearPrivateOptions = function (obj) {
          helper.objEach(obj, function (key, value) {
            value = $(value.split(';'));

            if (value.length) {
              if (value[value.length - 1] === '') {
                value.splice(value.length - 1, 1);
              }

              value = value.map(function (_value) {
                return _value.replace(new RegExp('^' + key + '\\.'), '');
              });
              obj[key] = value.join(';');
            }
          });
          return obj;
        };

        var getOptions = function (source, opt) {
          var optType = $J.typeOf(opt);
          var value;
          var result = null;

          if (optType === 'string') {
            result = source[opt];
          } else if (optType === 'array') {
            value = opt.shift();

            if (source[value]) {
              if (opt.length) {
                result = getOptions(source[value], opt);
              } else {
                result = source[value];
              }
            }
          }

          return result;
        };

        var getOptionsByType = function (options, oType, def) {
          return {
            common: getOptions(options.common, oType) || def,
            mobile: getOptions(options.mobile, oType) || def
          };
        };

        var removeProperties = function (obj) {
          var rm = function (_obj) {
            ['spin', 'zoom', 'image', 'video'].forEach(function (v) {
              if (_obj[v]) {
                delete _obj[v];
              }
            });
          };

          rm(obj.common);
          rm(obj.mobile);
        };

        var Slider_ = /*#__PURE__*/function (_EventEmitter29) {
          "use strict";

          bHelpers.inheritsLoose(Slider_, _EventEmitter29);

          function Slider_(node, options, force, lazyInit) {
            var _this312;

            _this312 = _EventEmitter29.call(this) || this;
            _this312.node = node;
            _this312.slider = null;
            _this312.lazyInit = lazyInit;
            _this312.options = {};
            _this312.spinOptions = {};
            _this312.zoomOptions = {};
            _this312.imageOptions = {};
            _this312.videoOptions = {};
            _this312.sliderBuilder = new SliderBuilder(options, _this312.node);

            _this312.parseOptions(options);

            _this312.privateOptions = {
              common: {},
              mobile: {}
            };
            _this312.toolOptions = null;
            _this312.inViewTimer = null;
            _this312.isRun = false;
            _this312.api = {
              isReady: _this312.isReady.bind(bHelpers.assertThisInitialized(_this312)),
              // start: this.start.bind(this),
              // stop: this.stop.bind(this),
              items: _this312.items.bind(bHelpers.assertThisInitialized(_this312)),
              disableItem: _this312.disableItem.bind(bHelpers.assertThisInitialized(_this312)),
              enableItem: _this312.enableItem.bind(bHelpers.assertThisInitialized(_this312)),
              enableGroup: _this312.enableGroup.bind(bHelpers.assertThisInitialized(_this312)),
              disableGroup: _this312.disableGroup.bind(bHelpers.assertThisInitialized(_this312)),
              switchGroup: _this312.switchGroup.bind(bHelpers.assertThisInitialized(_this312)),
              insertItem: _this312.insertItem.bind(bHelpers.assertThisInitialized(_this312)),
              removeItem: _this312.removeItem.bind(bHelpers.assertThisInitialized(_this312)),
              removeAllItems: _this312.removeAllItems.bind(bHelpers.assertThisInitialized(_this312)),
              jump: _this312.jump.bind(bHelpers.assertThisInitialized(_this312)),
              itemsCount: _this312.itemsCount.bind(bHelpers.assertThisInitialized(_this312)),
              next: _this312.next.bind(bHelpers.assertThisInitialized(_this312)),
              prev: _this312.prev.bind(bHelpers.assertThisInitialized(_this312)),
              isFullscreen: _this312.isFullscreen.bind(bHelpers.assertThisInitialized(_this312)),
              fullscreen: _this312.fullscreen.bind(bHelpers.assertThisInitialized(_this312)),
              child: _this312.child.bind(bHelpers.assertThisInitialized(_this312)),
              play: _this312.play.bind(bHelpers.assertThisInitialized(_this312)),
              pause: _this312.pause.bind(bHelpers.assertThisInitialized(_this312)),
              sortItems: _this312.sortItems.bind(bHelpers.assertThisInitialized(_this312))
            };

            _this312.on('viewerPublicEvent', function (e) {
              $J.extend(e.data.slider, _this312.api);

              if (e.data.slide) {
                e.data.slide.parent = function () {
                  return _this312.api;
                };

                if (e.data.slide[e.data.slide.component]) {
                  e.data.slide[e.data.slide.component].parent = function () {
                    return e.data.slide;
                  };
                }
              }
            });

            _this312.makeOptions();

            var as = _this312.toolOptions.get('autostart');

            if (as && as !== 'off' || force) {
              _this312.run();
            }

            return _this312;
          }

          var _proto83 = Slider_.prototype;

          _proto83.parseOptions = function parseOptions(options) {
            var viewer = 'viewer';
            var spin = 'spin';
            var zoom = 'zoom';
            var image = 'image';
            var video = 'video';
            var common = options.common;
            var mobile = options.mobile;
            this.options = getOptionsByType(options, viewer, {});
            this.spinOptions = {
              common: getOptions(common, [viewer, spin]) || getOptions(common, spin) || {},
              mobile: getOptions(mobile, [viewer, spin]) || getOptions(mobile, spin) || {}
            };
            this.zoomOptions = {
              common: getOptions(common, [viewer, zoom]) || getOptions(common, zoom) || {},
              mobile: getOptions(mobile, [viewer, zoom]) || getOptions(mobile, zoom) || {}
            };
            this.imageOptions = {
              common: getOptions(common, [viewer, image]) || getOptions(common, image) || {},
              mobile: getOptions(mobile, [viewer, image]) || getOptions(mobile, image) || {}
            };
            this.videoOptions = {
              common: getOptions(common, [viewer, video]) || getOptions(common, video) || {},
              mobile: getOptions(mobile, [viewer, video]) || getOptions(mobile, video) || {}
            };
            removeProperties(this.options);
          };

          _proto83.getSlideOptions = function getSlideOptions() {
            var spin = getOptionsByType(this.privateOptions, 'spin', '');
            var zoom = getOptionsByType(this.privateOptions, 'zoom', '');
            var image = getOptionsByType(this.privateOptions, 'image', '');
            var video = getOptionsByType(this.privateOptions, 'video', '');
            return {
              spin: {
                common: this.spinOptions,
                local: spin
              },
              zoom: {
                common: this.zoomOptions,
                local: zoom
              },
              image: {
                common: this.imageOptions,
                local: image
              },
              video: {
                common: this.videoOptions,
                local: video
              }
            };
          };

          _proto83.makeOptions = function makeOptions() {
            var exclude = {
              spin: /^spin/,
              zoom: /^zoom/,
              image: /^image/,
              video: /^video/
            };
            this.toolOptions = new $J.Options(defaultOptions);
            this.toolOptions.fromJSON(this.options.common);
            this.privateOptions.common = this.toolOptions.fromString(this.node.attr('data-options') || '', exclude);
            this.privateOptions.common = clearPrivateOptions(this.privateOptions.common);

            if ($J.browser.touchScreen && $J.browser.mobile) {
              this.toolOptions.fromJSON(this.options.mobile);
              this.privateOptions.mobile = this.toolOptions.fromString(this.node.attr('data-mobile-options') || '', exclude);
              this.privateOptions.mobile = clearPrivateOptions(this.privateOptions.mobile);
            }
          };

          _proto83.createSlider = function createSlider(content) {
            this.slider = new SirvSlider(this.node, {
              options: this.toolOptions,
              slideOptions: this.getSlideOptions(),
              lazyInit: this.lazyInit,
              viewerFileContent: content
            });
            this.slider.setParent(this);
            this.api.id = this.slider.id;
          };

          _proto83.run = function run(force) {
            var _this313 = this;

            this.isRun = true;
            this.sliderBuilder.getOptions().then(function (data) {
              _this313.parseOptions(data.dataOptions);

              if (force) {
                _this313.makeOptions();
              }

              if (data.content) {
                _this313.createSlider(data.content);
              } else {
                _this313.sliderBuilder.buildViewer().then(function (data2) {
                  _this313.node = data2.mainNode;

                  _this313.createSlider();
                });
              }
            }).catch(function (error) {
              // eslint-disable-next-line no-console
              console.log('Sirv: cannot get view from ' + error.error);
            });
            return true;
          };

          _proto83.isReady = function isReady() {
            var result = false;

            if (this.slider) {
              result = this.slider.isReady;
            }

            return result;
          };

          _proto83.isFullscreen = function isFullscreen() {
            var result = false;

            if (this.isReady()) {
              result = this.slider.isFullscreen === 2;
            }

            return result;
          };

          _proto83.startFullInit = function startFullInit(options, force, lazyInit) {
            var as;

            if (this.slider) {
              this.lazyInit = lazyInit;
              this.parseOptions(options);
              this.makeOptions();
              as = this.toolOptions.get('autostart');

              if (as && as !== 'off' || force) {
                this.slider.startFullInit({
                  options: this.toolOptions,
                  slideOptions: this.getSlideOptions(),
                  lazyInit: this.lazyInit
                });
              }
            }
          };

          _proto83.start = function start() {
            var result = false;

            if (!this.slider) {
              result = this.run(true);
            }

            return result;
          };

          _proto83.stop = function stop() {
            var result = false;

            if (this.slider) {
              result = true;
              this.slider.destroy();
              this.slider = null;
              this.off('viewerPublicEvent');
              this.isRun = false;
              this.sliderBuilder.destroy();
              this.sliderBuilder = null;
              this.destroy();
            }

            return result;
          };

          _proto83.insertItem = function insertItem(htmlSlide, indexOfSlide) {
            var result = false;

            if (this.isReady()) {
              if ($J.typeOf(htmlSlide) === 'string') {
                var div = $J.$new('div');
                div.node.innerHTML = htmlSlide.trim();
                htmlSlide = div.node.firstChild;

                if (htmlSlide && (htmlSlide.nodeType === 3 || htmlSlide.nodeType === 8 || !$J.contains(['div', 'img', SELECTOR_TAG], $(htmlSlide).getTagName()))) {
                  htmlSlide = null;
                }
              } else if ($(htmlSlide).getTagName() === SELECTOR_TAG) {
                var _div = $J.$new('div');

                _div.append(htmlSlide);

                htmlSlide = _div.node;
              }

              result = this.slider.insertSlide(indexOfSlide, htmlSlide);
            }

            return result;
          };

          _proto83.removeItem = function removeItem(indexOfSlide) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.removeSlide(indexOfSlide);
            }

            return result;
          };

          _proto83.removeAllItems = function removeAllItems() {
            var result = true;

            if (this.isReady()) {
              for (var i = this.itemsCount() - 1; i >= 0; i--) {
                var r = this.removeItem(i);

                if (result) {
                  result = r;
                }
              }
            } else {
              result = false;
            }

            return result;
          };

          _proto83.itemsCount = function itemsCount(settings) {
            var result = 0;

            if (this.isReady()) {
              var items = this.items(settings);

              if (items !== null) {
                result = items.length;
              }
            }

            return result;
          };

          _proto83.items = function items(settings) {
            var _this314 = this;

            var result = null;

            if (this.isReady()) {
              result = this.slider.getItems(settings);
              result.forEach(function (item) {
                item.parent = function () {
                  return _this314.api;
                };
              });
            }

            return result;
          };

          _proto83.disableItem = function disableItem(indexOfSlide) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.disableSlide(indexOfSlide);
            }

            return result;
          };

          _proto83.enableItem = function enableItem(indexOfSlide) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.enableSlide(indexOfSlide);
            }

            return result;
          };

          _proto83.enableGroup = function enableGroup(group) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.enableGroupOfSlides(group);
            }

            return result;
          };

          _proto83.disableGroup = function disableGroup(group) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.disableGroupOfSlides(group);
            }

            return result;
          };

          _proto83.switchGroup = function switchGroup(group) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.switchGroupOfSlides(group);
            }

            return result;
          };

          _proto83.jump = function jump(indexOfSlide) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.jump(indexOfSlide);
            }

            return result;
          };

          _proto83.next = function next() {
            var result = false;

            if (this.isReady()) {
              result = this.slider.jump('next');
            }

            return result;
          };

          _proto83.prev = function prev() {
            var result = false;

            if (this.isReady()) {
              result = this.slider.jump('prev');
            }

            return result;
          };

          _proto83.fullscreen = function fullscreen() {
            var result = false;

            if (this.isReady()) {
              if (this.isFullscreen()) {
                result = this.slider.exitFullScreen();
              } else {
                result = this.slider.enterFullScreen();
              }
            }

            return result;
          };

          _proto83.child = function child(numberOfSlide) {
            var _this315 = this;

            var result = null;

            if (this.isReady()) {
              numberOfSlide = checkArgument(numberOfSlide);
              result = this.slider.getSlide(numberOfSlide);

              if (result) {
                result.parent = function () {
                  return _this315.api;
                };
              }
            }

            return result;
          };

          _proto83.play = function play(delay) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.play(delay);
            }

            return result;
          };

          _proto83.pause = function pause() {
            var result = false;

            if (this.isReady()) {
              result = this.slider.pause();
            }

            return result;
          };

          _proto83.sortItems = function sortItems(order) {
            if (this.isReady()) {
              this.slider.sortItems(order);
            }
          };

          _proto83.isEqual = function isEqual(node) {
            return node === this.node;
          };

          _proto83.checkReadiness = function checkReadiness(eventname, component) {
            var result = false;

            if (this.isReady()) {
              result = this.slider.checkReadiness(eventname, component);
            }

            return result;
          };

          _proto83.sendEvent = function sendEvent(eventname, component) {
            if (this.isReady()) {
              this.slider.sendReadyEvent(eventname, component);
            }
          };

          return Slider_;
        }(EventEmitter);

        return Slider_;
      }();

      return Slider;
    });
    /* eslint-env es6 */

    /* global sirvRequirejs */

    /* global isLazyImage */

    /* global SIRV_ASSETS_URL */

    /* global SIRV_BASE_URL */

    /* global SIRV_HTTP_PROTOCOL */

    /* global sirvDeps */

    /* eslint-disable indent */

    /* eslint no-template-curly-in-string: "off" */

    /* eslint-disable dot-notation */

    /* eslint-disable no-use-before-define */

    /* eslint-disable no-lonely-if */

    /* eslint-disable no-case-declarations */

    /* eslint-disable no-global-assign */

    var w = window;
    var _Sirv = {
      items: {},
      eventManager: null,
      options: {}
    };

    sirvRequirejs.require(['globalVariables'], function (globalVariables) {
      globalVariables.SIRV_ASSETS_URL = SIRV_ASSETS_URL;
      globalVariables.SIRV_BASE_URL = SIRV_BASE_URL;
      globalVariables.SIRV_HTTP_PROTOCOL = SIRV_HTTP_PROTOCOL;
    });

    var waitModules = function () {
      var allCallbacks = [];

      var result = function (callback) {
        if (_Sirv.start) {
          callback();
        } else {
          allCallbacks.push(callback);
        }
      };

      result.start = function () {
        while (allCallbacks.length) {
          allCallbacks.shift()();
        }
      };

      return result;
    }();

    var baseModules = ['bHelpers', 'magicJS', 'globalVariables', 'globalFunctions', 'EventManager', 'helper', 'Slider'];

    if (isLazyImage) {
      baseModules.push('LazyImage');
    }

    sirvRequirejs.require(baseModules, function (bHelpers, magicJS, globalVariables, globalFunctions, EventManager, helper, Slider, LazyImage
    /* that 'LazyImage' argument must be last */
    ) {
      var $J = magicJS; // eslint-disable-next-line

      var $ = $J.$;

      var getQuerySelector = function (qSelector, context) {
        var result = qSelector;

        if ($J.typeOf(result) === 'string') {
          result = (context || document).querySelector(result);
        }

        return $J.$(result);
      };

      var findSirvItem = function (qSelector, type, context) {
        var t = [];
        var a = null;
        var storage = _Sirv.items[type];

        if (storage.length && qSelector) {
          a = getQuerySelector(qSelector, context);

          if (a) {
            t = storage.filter(function (_) {
              // return _.isEqual(a); // TODO ?????
              return _.node === a;
            });
          }
        }

        return t.length ? t[0] : null;
      };

      var getShadowDOM = function (node) {
        var result = false;
        var parent = node.parentNode;

        if (parent) {
          if (parent instanceof ShadowRoot) {
            result = parent;
          } else {
            result = getShadowDOM(parent);
          }
        }

        return result;
      };

      var getNodes = function (qSelectorAll, from) {
        var result;

        if (!from) {
          from = document;
        }

        if ($J.typeOf(qSelectorAll) === 'collection') {
          result = qSelectorAll;
        } else if ($J.typeOf(qSelectorAll) === 'element' || $J.typeOf(qSelectorAll) === 'magicjs-element') {
          result = [qSelectorAll];
        } else {
          // shadow dom is not magicjs element
          result = $J.$A(($J.$(from).node || from).querySelectorAll(qSelectorAll || '.Sirv')); // result = result.concat(getSirvShadowDOM(qSelectorAll || '.Sirv'));
        }

        return result;
      };

      var getTypeOfView = function (node) {
        var result = null; // let tmp;

        node = $J.$(node);

        if (node.hasClass('Sirv')) {
          if (node.getTagName() === 'img' || node.attr('data-bg-src') || node.getCss('background-image') && node.getCss('background-image') !== 'none') {
            result = 'image';
          } else {
            // tmp = node.attr('data-effect');
            // if (tmp) {
            //     result = tmp;
            // } else {
            //     tmp = node.attr('data-src');
            //     if (tmp) {
            //         result = 'spin';
            //     } else {
            //         result = 'viewer';
            //     }
            // }
            // if (node.attr('data-effect') || node.attr('data-src')) {
            result = 'viewer'; // }
          }
        }

        return result;
      };

      var stopLaunching = function (options, type) {
        var result = false;
        var currentType = type;

        if (currentType === 'image') {
          currentType = 'lazyImage';
        }

        if (options.common[currentType] && (options.common[currentType].autostart === false || $J.contains(['false', 'off'], options.common[currentType].autostart))) {
          result = true;
        }

        if (!result && $J.browser.touchScreen && $J.browser.mobile) {
          if (options.mobile[currentType] && (options.mobile[currentType].autostart === false || $J.contains(['false', 'off'], options.mobile[currentType].autostart))) {
            result = true;
          }
        }

        return result;
      };

      _Sirv.items.image = [];
      _Sirv.items.viewer = [];

      _Sirv.start = function (qSelectorAll, context, typeOfComponent, force) {
        var effect = null;
        var type;
        var lazyInit = false;

        if ($J.typeOf(qSelectorAll) === 'boolean') {
          lazyInit = qSelectorAll;
          qSelectorAll = undefined;
        }

        $J.$A(getNodes(qSelectorAll, context)).forEach(function (node) {
          var magicNode = $J.$(node);

          if (node && magicNode.hasClass('Sirv')) {
            type = getTypeOfView(magicNode.node);

            if (typeOfComponent) {
              if (typeOfComponent !== type) {
                type = null;
              }
            }

            _Sirv.options.common = helper.deepExtend({}, $J.W.node['SirvOptions'] || {});
            _Sirv.options.mobile = helper.deepExtend({}, $J.W.node['SirvMobileOptions'] || {});

            if (type) {
              if ($J.contains(['image', 'viewer'], type)) {
                if (!force && stopLaunching(_Sirv.options, type)) {
                  return;
                }

                effect = findSirvItem(magicNode.node, type);

                if (effect) {
                  effect.startFullInit($J.extend({}, _Sirv.options), force, lazyInit);
                } else {
                  switch (type) {
                    case 'image':
                      if (isLazyImage) {
                        globalFunctions.rootDOM.attachNode(node);
                        globalFunctions.rootDOM.resetGlobalCSS(node);
                        effect = new LazyImage(magicNode.node, {
                          options: {
                            common: helper.deepExtend({}, _Sirv.options.common.lazyImage || {}),
                            mobile: helper.deepExtend({}, _Sirv.options.mobile.lazyImage || {})
                          }
                        }, force); // if inline autostart option is not false

                        if (effect.isRun) {
                          _Sirv.items.image.push(effect);

                          effect.setParent(_Sirv.eventManager);
                        } else {
                          globalFunctions.rootDOM.detachNode(node);
                        }
                      } else {
                        console.info('Sirv: Image component wasn\'t found.');
                      }

                      break;

                    case 'viewer':
                      globalFunctions.rootDOM.attachNode(node);
                      globalFunctions.rootDOM.addMainStyle(node);
                      effect = new Slider(magicNode, $J.extend({}, _Sirv.options), force, lazyInit); // if inline autostart option is not false or off

                      if (effect.isRun) {
                        _Sirv.items.viewer.push(effect);

                        effect.setParent(_Sirv.eventManager);
                      } else {
                        globalFunctions.rootDOM.detachNode(node);
                      }

                      break;
                    // no default
                  }
                }
              }
            }
          }
        });
      };

      _Sirv.stop = function (qSelectorAll, context, typeOfComponent) {
        var types = ['image', 'viewer'];

        if (typeOfComponent) {
          types = [typeOfComponent];
        }

        types.forEach(function (type) {
          if (qSelectorAll || context) {
            $J.$A(getNodes(qSelectorAll, context)).forEach(function (node) {
              var item = findSirvItem(node, type);

              if (item && item.stop()) {
                _Sirv.items[type].splice(_Sirv.items[type].indexOf(item), 1);
              }
            });
          } else {
            _Sirv.items[type] = _Sirv.items[type].filter(function (_item) {
              return !_item.stop(true);
            });
          }
        });
      };

      _Sirv.getInstance = function (qSelector, type, context) {
        var inst = findSirvItem(qSelector, type, context);
        return inst ? inst.api : inst;
      };

      _Sirv.eventManager = new EventManager(_Sirv.items);

      _Sirv.addFilterCallback = function (callback, first) {
        if (first) {
          globalFunctions.viewerFilters.unshift(callback);
        } else {
          globalFunctions.viewerFilters.push(callback);
        }
      };

      _Sirv.removeFilterCallback = function (callback) {
        var newArray = [];
        globalFunctions.viewerFilters.forEach(function (cb) {
          if (cb !== callback) {
            newArray.push(cb);
          }
        });
        globalFunctions.viewerFilters = newArray;
      };

      _Sirv.removeAllFilterCallback = function () {
        globalFunctions.viewerFilters = [];
      };

      globalFunctions.stop = function (node, viewer) {
        return _Sirv.stop(node, null, viewer);
      };
      /**
       * Observe DOM changes; automatically start newly added .Sirv instances and stop removed ones.
       * @return
       */


      var observeDOM = function () {
        var notChild = function (node) {
          var result = false;

          if (node.closest) {
            result = !node.closest('div.Sirv');
          } else {
            result = $J.browser.engine === 'trident';
          }

          return result;
        };

        var domChanges = {
          added: [],
          removed: []
        };
        var processDOMChanges = helper.debounce(function () {
          var added = domChanges.added.splice(0);
          var removed = domChanges.removed.splice(0); // Process added nodes

          added.forEach(function (node) {
            node = $J.$(node);

            if (node.node && node.node.nodeType !== 3 && node.node.nodeType !== 8 && node.node.getElementsByClassName) {
              if (node.hasClass('Sirv')) {
                _Sirv.start(node, null, getTypeOfView(node));
              } else if (globalFunctions.rootDOM.rootContains(node.node) && notChild(node.node)) {
                _Sirv.start(null, node);
              }
            }
          }); // Process removed nodes

          var removedInstances = [];
          removed.forEach(function (node) {
            node = $J.$(node);

            if (node.node && node.node.nodeType !== 3 && node.node.nodeType !== 8 && node.node.getElementsByClassName) {
              if (node.hasClass('Sirv')) {
                removedInstances.push(node);
              } else {
                [].push.apply(removedInstances, node.node.getElementsByClassName('Sirv'));
              }
            }

            removedInstances.forEach(function (_node) {
              _node = $J.$(_node);

              if (!$J.D.node.body.contains(_node.node)) {
                try {
                  _Sirv.stop(_node, null, getTypeOfView(_node));
                } catch (ex) {
                  /* empty */
                }
              }
            });
          });
        }, 250); // eslint-disable-next-line

        var collectDOMChanges = function (mutations, observer) {
          for (var i = 0, l = mutations.length; i < l; i++) {
            if (mutations[i].type === 'childList') {
              [].push.apply(domChanges.added, mutations[i].addedNodes);
              [].push.apply(domChanges.removed, mutations[i].removedNodes);
            }
          }

          processDOMChanges();
        };

        if ($J.W.node.MutationObserver) {
          new MutationObserver(collectDOMChanges).observe($J.D.node.body, {
            childList: true,
            subtree: true,
            attributes: false
          });
        }
      };

      globalFunctions.rootDOM.resetGlobalCSS();
      globalFunctions.iconsHash.make();

      if ($J.D.node.readyState === 'loading') {
        _Sirv.start(true);
      }

      $J.D.addEvent('domready', function () {
        _Sirv.start();

        observeDOM(globalFunctions);
      });
      waitModules.start();
    });

    var sayDeprecated = function (apiName) {
      console.log('sirv.js: The method Sirv' + apiName + '.refresh() is deprecated. \r\n         Use Sirv' + apiName + '.stop() and Sirv' + apiName + '.start() instead.');
    };

    w.Sirv.version = '[[SirvJS_version]]';
    w.Sirv.build = '[[build_datetime]]';
    w.Sirv.options = {}; // w.Sirv.magicJS = null;

    w.Sirv.lazyimage = {
      start: function (qSelectorAll, context) {
        waitModules(function () {
          _Sirv.start(qSelectorAll, context, 'image', true);
        });
      },
      stop: function (qSelectorAll, context) {
        waitModules(function () {
          _Sirv.stop(qSelectorAll, context, 'image');
        });
      },
      getInstance: function (qSelector, context) {
        var result = null;

        if (_Sirv.getInstance) {
          result = _Sirv.getInstance(qSelector, 'image', context);
        }

        return result;
      },
      refresh: function () {
        sayDeprecated('.image');
      },
      on: function (nameOfEvent, callback) {
        return w.Sirv.on(nameOfEvent, callback);
      },
      off: function (nameOfEvent, callback) {
        return w.Sirv.off(nameOfEvent, callback);
      }
    };
    w.Sirv.viewer = {
      start: function (qSelectorAll, context) {
        waitModules(function () {
          _Sirv.start(qSelectorAll, context, 'viewer', true);
        });
      },
      stop: function (qSelectorAll, context) {
        waitModules(function () {
          _Sirv.stop(qSelectorAll, context, 'viewer');
        });
      },
      getInstance: function (qSelector, context) {
        var result = null;

        if (_Sirv.getInstance) {
          result = _Sirv.getInstance(qSelector, 'viewer', context);
        }

        return result;
      },
      refresh: function () {
        sayDeprecated('.viewer');
      },
      on: function (nameOfEvent, callback) {
        return w.Sirv.on(nameOfEvent, callback);
      },
      off: function (nameOfEvent, callback) {
        return w.Sirv.off(nameOfEvent, callback);
      },
      filters: {
        add: function (callback, first) {
          if (_Sirv.addFilterCallback) {
            _Sirv.addFilterCallback(callback, first);
          } else {
            waitModules(function () {
              _Sirv.addFilterCallback(callback, first);
            });
          }
        },
        remove: function (callback) {
          if (_Sirv.removeFilterCallback) {
            _Sirv.removeFilterCallback(callback);
          } else {
            waitModules(function () {
              _Sirv.removeFilterCallback(callback);
            });
          }
        },
        removeAll: function () {
          if (_Sirv.removeAllFilterCallback) {
            _Sirv.removeAllFilterCallback();
          } else {
            waitModules(function () {
              _Sirv.removeAllFilterCallback();
            });
          }
        }
      }
    };

    w.Sirv.start = function (qSelectorAll, context) {
      waitModules(function () {
        _Sirv.start(qSelectorAll, context, null, true);
      });
    };

    w.Sirv.stop = function (qSelectorAll, context) {
      waitModules(function () {
        _Sirv.stop(qSelectorAll, context);
      });
    };

    w.Sirv.getInstance = function (qSelector, type, context) {
      var instance = null;

      if (_Sirv.getInstance) {
        if (type === 'viewer') {
          instance = w.Sirv.viewer.getInstance(qSelector, context);
        } else if (type === 'lazyimage') {
          instance = w.Sirv.lazyimage.getInstance(qSelector, context);
        } else {
          instance = w.Sirv.viewer.getInstance(qSelector, context);
        }
      }

      return instance;
    };

    w.Sirv.refresh = function () {
      sayDeprecated('');
    };

    w.Sirv.on = function (nameOfEvent, callback) {
      var result = null;

      if (_Sirv.eventManager) {
        result = _Sirv.eventManager.addEvent(nameOfEvent, callback);
      } else {
        result = function () {
          var state = 1;

          var cb = function () {
            return true;
          };

          waitModules(function () {
            if (state) {
              cb = _Sirv.eventManager.addEvent(nameOfEvent, callback);
            }
          });
          return function () {
            state = 0;
            return cb();
          };
        }();
      }

      return result;
    };

    w.Sirv.off = function (nameOfEvent, callback) {
      var result = null;

      if (_Sirv.eventManager) {
        result = _Sirv.eventManager.removeEvent(nameOfEvent, callback);
      } else {
        result = function () {
          var state = 1;

          var cb = function () {
            return true;
          };

          waitModules(function () {
            if (state) {
              cb = _Sirv.eventManager.removeEvent(nameOfEvent, callback);
            }
          });
          return function () {
            state = 0;
            return cb();
          };
        }();
      }

      return result;
    };

    w.Sirv.whenReady = function (callback) {
      waitModules(callback);
    };

    w.Sirv.whenLoaded = function (callback) {
      sirvRequirejs.require(sirvDeps, function () {
        callback();
      });
    };
  })();
}
//# sourceMappingURL=sirv.full.js.map
