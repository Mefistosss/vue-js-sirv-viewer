Sirv.define("Zoom",["bHelpers","magicJS","globalVariables","globalFunctions","helper","EventEmitter","Zoominstance","Hint","ResponsiveImage","RoundLoader","Hotspots"],(function(t,i,e,o,s,n,a,h,r,d,l){var c=i,m=c.$;o.rootDOM.addModuleCSSByName("Zoom",(function(){return".smv-zoom-view{display:inline-block;position:relative;top:0;left:0;width:100%;height:100%;outline:0!important;backface-visibility:hidden!important;-ms-user-select:none!important;user-select:none!important;-webkit-tap-highlight-color:transparent!important;-webkit-touch-callout:none!important;touch-action:pan-y}.smv-zoom-view::after{display:inline-block;height:100%;content:'';vertical-align:middle}.smv-zoom-view .zoom-loader{bottom:0;left:0;margin:5px}.smv-zoom-view>img.smv-zoomed-in{visibility:hidden!important}.smv-zoom-view .sirv-zoom{z-index:126}.smv .smv-slides-box .smv-zoom-view>img{display:inline-block!important;position:relative!important;width:auto;max-width:100%;height:auto;max-height:100%;margin:0;padding:0;vertical-align:middle}.zoom-controls{display:flex;position:absolute;right:16px;bottom:16px;flex-flow:row-reverse;height:28px;z-index:168}.zoom-controls>button{background-color:rgba(245,245,245,.9);color:#777}.zoom-controls>button::after,.zoom-controls>button::before{transition:opacity .2s linear;opacity:.65}.zoom-controls>button:hover::after,.zoom-controls>button:hover::before{opacity:1}.zoom-controls>button.disable::after,.zoom-controls>button.disable::before{opacity:.2}.zoom-controls>button+button{margin-right:4px}.zoom-controls .zoom-close,.zoom-controls .zoom-in,.zoom-controls .zoom-out{display:inline-block;position:relative;width:28px;height:28px;padding:0;border:1px solid #d7d7d7;border-radius:2px;outline:0;cursor:pointer}.zoom-controls .zoom-close::after,.zoom-controls .zoom-close::before,.zoom-controls .zoom-in::after,.zoom-controls .zoom-in::before,.zoom-controls .zoom-out::before{transform:translate3d(-50%,-50%,0);position:absolute;top:50%;left:50%;width:65%;border-top:2px solid currentcolor;font-size:0;line-height:100%;content:''}.zoom-controls .zoom-close::after,.zoom-controls .zoom-in::after{transform-origin:center;border-left:1px solid}.zoom-controls .zoom-in::after{transform:translate3d(-50%,-50%,0) rotateZ(-90deg)}.zoom-controls .zoom-close{display:none!important}.zoom-controls .zoom-close::before{transform:translate3d(-50%,-50%,0) rotateZ(-45deg)}.zoom-controls .zoom-close::after{transform:translate3d(-50%,-50%,0) rotateZ(-135deg)}"}));var u={mode:{type:"string",enum:["top","left","right","bottom","inner","magnifier","deep"],defaults:"inner"},margin:{type:"number",defaults:9},width:{oneOf:[{type:"number"},{type:"string",enum:["auto"]}],defaults:"auto"},height:{oneOf:[{type:"number"},{type:"string",enum:["auto"]}],defaults:"auto"},pan:{type:"boolean",defaults:!1},ratio:{oneOf:[{type:"number",minimum:0},{type:"string",enum:["max"]}],defaults:2.5},wheel:{type:"boolean",defaults:!0},tiles:{type:"boolean",defaults:!0},trigger:{oneOf:[{type:"string",enum:["hover","click","dblclick"]},{type:"boolean",enum:[!1]}],defaults:"click"},hint:{enable:{type:"boolean",defaults:!0},text:{hover:{type:"string",defaults:"Hover to zoom"},click:{type:"string",defaults:"Click to zoom"},dblclick:{type:"string",defaults:"Double click to zoom"}}},map:{enable:{type:"boolean",defaults:!1},size:{type:"number",minimum:0,maximum:50,defaults:25}}};c.browser.touchScreen&&(u=s.deepExtend(u,{hint:{text:{hover:{defaults:"Tap and hold to zoom"}}}}));var p,g,f,z,S={hint:{text:{hover:{type:"string",defaults:"Tap and hold to zoom"},click:{type:"string",defaults:"Tap to zoom"},dblclick:{type:"string",defaults:"Double tap to zoom"}}}},v={trigger:{oneOf:[{type:"string",enum:["hover","click","dblclick"]},{type:"boolean",enum:[!1]}],defaults:"hover"}},b={trigger:{oneOf:[{type:"string",enum:["hover","click","dblclick"]},{type:"boolean",enum:[!1]}],defaults:"dblclick"}},y={ratio:{oneOf:[{type:"number",minimum:0},{type:"string",enum:["max"]}],defaults:"max"}},w=function(i){"use strict";function e(t,e,o){var s;return(s=i.call(this)||this).parentNode=m(t),s.options=Object.assign({class:null,disabledClass:"disable"},e),s.events=o||{},s.disabled=!1,s.isDisabledClassAdded=!1,s.instanceNode=c.$new("button"),s.options.class&&s.instanceNode.addClass(s.options.class),Object.entries(s.events).forEach((function(t){var i;(i=s.instanceNode).addEvent.apply(i,t)})),s}t.inheritsLoose(e,i);var o=e.prototype;return o.append=function(){this.parentNode.append(this.instanceNode)},o.changeState=function(t){t?(this.disable(!0),this.isDisabledClassAdded||(this.isDisabledClassAdded=!0,this.instanceNode.addClass(this.options.disabledClass))):(this.isDisabledClassAdded&&(this.isDisabledClassAdded=!1,this.instanceNode.removeClass(this.options.disabledClass)),this.disable())},o.disable=function(t){t?this.disabled||(this.disabled=!0,this.instanceNode.attr("disabled","disabled")):this.disabled&&(this.disabled=!1,this.instanceNode.removeAttr("disabled"))},o.destroy=function(){var t=this;Object.entries(this.events).forEach((function(i){var e;(e=t.instanceNode).removeEvent.apply(e,i)})),this.events={},this.changeState(),this.instanceNode.remove(),this.instanceNode=null,i.prototype.destroy.call(this)},e}(n),N=function(i){"use strict";function e(e){var o;return(o=i.call(this)||this).parentNode=m(e),o.instanceNode=c.$new("div").addClass("zoom-controls"),o.zoomInButton=new w(o.instanceNode,{class:"zoom-in"},{btnclick:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomin"}})},tap:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomin"}})}}),o.zoomInButton.parentClass=t.assertThisInitialized(o),o.zoomOutButton=new w(o.instanceNode,{class:"zoom-out"},{btnclick:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomout"}})},tap:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomout"}})}}),o.zoomOutButton.parentClass=t.assertThisInitialized(o),o.zoomCloseButton=new w(o.instanceNode,{class:"zoom-close"},{btnclick:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomclose"}})},tap:function(t){t.stop(),o.emit("zoomControlsAction",{data:{type:"zoomclose"}})}}),o.zoomCloseButton.parentClass=t.assertThisInitialized(o),o.zoomInButton.append(),o.zoomOutButton.append(),o.zoomCloseButton.append(),o}t.inheritsLoose(e,i);var o=e.prototype;return o.show=function(){this.parentNode.append(this.instanceNode)},o.hide=function(){this.instanceNode.remove()},o.invisibleDisable=function(t){this.zoomInButton.disable(t),this.zoomOutButton.disable(t),this.zoomCloseButton.disable(t)},o.disable=function(t){t?"in"===t?(this.zoomInButton.changeState(!0),this.zoomOutButton.changeState(),this.zoomCloseButton.changeState()):(this.zoomOutButton.changeState(!0),this.zoomCloseButton.changeState(!0),this.zoomInButton.changeState()):(this.zoomInButton.changeState(),this.zoomOutButton.changeState(),this.zoomCloseButton.changeState())},o.destroy=function(){this.zoomInButton.destroy(),this.zoomOutButton.destroy(),this.zoomCloseButton.destroy(),this.hide(),i.prototype.destroy.call(this)},e}(n);return p="smv",g=function(t){t.stop()},f=function(t){for(var i=null;t.node!==c.D.node.body&&!i;)(t=m(t.node.parentNode)).hasClass(p+"-slides-box")&&(i=t);return i},z=function(t,i){return new Promise((function(e,o){var s=m(t).size;i||(i=100),i-=1,s.width||s.height?e(s):i>0?setTimeout((function(){z(t,i).then(e).catch(o)}),16):o(null)}))},function(i){"use strict";function n(n,a){var h;if((h=i.call(this,n,a,u)||this).type=e.SLIDE.TYPES.ZOOM,h.insideOptions={type:"outside",position:"right",hideZoomForClickTrigger:!0,zooming:!0,map:!1,mapSize:50,controls:!1,trigger:"click",outsideModeWasChanged:!1},h.imageUrl=h.instanceNode.attr("data-src"),h.src=o.normalizeURL(h.imageUrl.replace(e.REG_URL_QUERY_STRING,"$1")),h.queryParams=s.paramsFromQueryString(h.imageUrl.replace(e.REG_URL_QUERY_STRING,"$2")),h.queryParams){var r=parseInt(h.queryParams.quality,10);isNaN(r)?delete h.queryParams.quality:h.queryParams.quality=r}return h.isFullscreen=a.isFullscreen,h.nativeFullscreen=a.nativeFullscreen,h.queryParamsQuality=h.queryParams.quality||null,h.imageNode=null,h.loader=null,h.image=null,h.controls=null,h.differenceBetweenSizes=100,h.currentSize={width:0,height:0},h.currentImageSize={width:0,height:0},h.isInfoLoaded=!1,h.zoomIsOpened=!1,h.imageShowPromise=null,h.hint=null,h.longTapTimer=null,h.setImageCss=!1,h.lastTriggerAction=null,h.isNotMouse=!1,h.accountInfo={},h.postInitState=0,h.clonedImage=null,h.isHidden=!1,h.destroyed=!1,h.waitingCallbacks=[],h.lastImageSize={width:0,height:0},h.hotspotsTurnedOn=!0,h.scrollDebounce=s.debounce((function(){h.replaceZoom()}),16),h.zoomDebounce=s.debounce((function(){h.controls&&(h.controls.invisibleDisable(),h.changeControlsState(h.zoom.getZoomData()))}),42),h.onScrollHandler=h.onScroll.bind(t.assertThisInitialized(h)),h.instanceNode.addEvent("selectstart",(function(t){t.stop()})),h.createHotspotsClass(),h.createSirvImage(),h}t.inheritsLoose(n,i);var a=n.prototype;return a.makeOptions=function(){var t=new c.Options(this.defaultSchema);return t=this.makeGlobalOptions(t),["top","left","right","bottom","inner","magnifier"].includes(t.get("mode"))&&t.parseSchema(v,!0),c.browser.touchScreen&&c.browser.mobile&&(t.parseSchema(S,!0),t=this.makeMobileOptions(t),["inner","deep"].includes(t.get("mode"))&&t.parseSchema(b,!0)),"deep"===t.get("mode")&&t.parseSchema(y,!0),t},a.getInfo=function(){var t=this;return this.gettingInfoPromise||(this.gettingInfoPromise=new Promise((function(i,e){t.waitGettingInfo.wait((function(){t.image.loadInfo().then((function(e){t.destroyed||(t.isInfoLoaded=!0,t.accountInfo=t.image.accountInfo,t.dataAlt||(t.dataAlt=t.image.description),t.hotspotsData=e.hotspots,t.infoSize=t.image.originSize,t.hotspots&&(t.hotspots.originImageSize=t.infoSize),i())})).catch((function(i){t.destroyed||e(i)}))}))}))),this.gettingInfoPromise},a.showHint=function(){this.hint&&(this.always&&![e.FULLSCREEN.OPENING,e.FULLSCREEN.OPENED].includes(this.fullscreenState)||this.hint.show())},a.onStartActions=function(){this.ready?this.isInView&&this.isZoomSizeExist()&&this.showHint():this.isStarted&&this.isInView&&this.isSlideShown&&!this.preload&&this.postInit(),i.prototype.onStartActions.call(this)},a.onStopActions=function(){this.zoomOut(!0),this.hint&&this.hint.hide(),i.prototype.onStopActions.call(this)},a.onInView=function(t){t&&(this.ready?this.isSlideShown&&this.isZoomSizeExist()&&this.showHint():this.isStarted&&(this.isInView||!this.preload&&!this.isSlideShown||(this.isInView=!0,this.postInit())))},a.startFullInit=function(t){this.isStartedFullInit||(i.prototype.startFullInit.call(this,t),this.normalizeOptions(),this.getId("zoom-"),this.instanceNode.addClass(p+"-zoom-view"),this.instanceNode.addEvent("mousedown",g),this.createLoader())},a.imageSettings=function(t){t||(t={}),t.imageSettings||(t.imageSettings={}),t.imageSettings.scale||(t.imageSettings.scale={}),t.callbackData||(t.callbackData={}),t.imageSettings.scale.option="fill",null!==this.quality&&null===this.queryParamsQuality&&(t.src||(t.src={}),t.src.quality=this.quality);var i=this.hdQuality;return(null===this.queryParamsQuality||this.isHDQualitySet&&i<this.queryParamsQuality)&&(t.srcset={quality:i}),t},a.setHDQuality=function(t){return t.dppx>1&&t.dppx<1.5&&(null===this.queryParamsQuality&&null!==this.quality?t.srcset.quality=this.quality:t.srcset&&delete t.srcset.quality),t},a.isOutsideZoom=function(){return["top","left","right","bottom"].includes(this.option("mode"))},a.createHint=function(t){this.option("hint.enable")&&(this.hint=new h(this.instanceNode,{html:"<span>"+t+"<span>"}),this.hint.append())},a.clearZoom=function(){this.zoom&&(this.off("zooming"),this.off("zoomUp"),this.off("zoomDown"),this.imageNode&&this.imageNode.removeClass(this.zoomClassName)),i.prototype.clearZoom.call(this)},a.replaceZoom=function(){var t=!1,i=this.option("trigger"),o={clickBehavior:"both"};if(this.ready){"hover"===i&&"magnifier"!==this.option("mode")&&([e.FULLSCREEN.OPENING,e.FULLSCREEN.OPENED].includes(this.fullscreenState)?(t="click",o.trigger=t):t=i);var s,n=t&&this.insideOptions.trigger!==t;if(t&&this.insideOptions.trigger!==t&&(n=!0),"outside"===this.insideOptions.type){((s=this.canIUseOutsideZoom())&&this.insideOptions.outsideModeWasChanged||!s&&!this.insideOptions.outsideModeWasChanged)&&(this.insideOptions.outsideModeWasChanged=!this.insideOptions.outsideModeWasChanged,n=!0);var a=this.imageNode.size;!n&&s&&this.lastImageSize.width!==a.width&&(this.lastImageSize=a,n=!0)}n&&(this.clearZoom(),"outside"===this.insideOptions.type&&(s?o.type="outside":(o.type="inner",c.browser.mobile&&(o.pan=!0,"hover"===i&&(t="dblclick",o.trigger=t)))),t&&(this.insideOptions.trigger=t),this.setTriggerAction(t),this.createZoom(o),this.setZoomEvents())}},a.canIUseOutsideZoom=function(){var t=!1;if("outside"===this.insideOptions.type){if([e.FULLSCREEN.OPENING,e.FULLSCREEN.OPENED].includes(this.fullscreenState))return t;var i,o=this.option("margin"),s=this.imageNode.size,n=c.W.scroll,a=this.imageNode.position,h=this.option("width"),r=this.option("height"),d={width:s.width,height:s.height};switch("auto"!==h&&(/%$/.test(h)?s.width=s.width/100*parseInt(h,10):s.width=parseInt(h,10)),"auto"!==r&&(/%$/.test(r)?s.height=s.height/100*parseInt(r,10):s.height=parseInt(r,10)),this.insideOptions.position){case"top":(i=a.top-n.y-o)>s.height&&(t=!0);break;case"left":(i=a.left-n.x-o)>=s.width&&(t=!0);break;case"right":i=a.left-n.x,i+=d.width+o,c.W.node.innerWidth-i>=s.width&&(t=!0);break;case"bottom":i=a.top-n.y,i+=d.height+o,c.W.node.innerHeight-i>=s.height&&(t=!0)}}return t},a.createHotspotsClass=function(){"magnifier"!==this.option("mode")&&(c.browser.mobile||"hover"!==this.option("trigger")||(this.hotspotsTurnedOn=!1),i.prototype.createHotspotsClass.call(this,l))},a.run=function(t,e,o){var s=this,n=i.prototype.run.call(this,t,e,o);return n&&(this.getInfo().finally((function(){s.calcContainerSize(),s.isInView&&(s.preload||s.isSlideShown)&&s.postInit()})),this.startGettingInfo()),n},a.done=function(){if(!this.ready&&!this.destroyed){i.prototype.done.call(this),this.hotspots&&(this.hotspots.instanceComponentNode=this.imageNode,this.hotspots.containerSize=this.imageNode.node.getBoundingClientRect()),this.createZoom(),this.replaceZoom(),this.createControls();var t=this.isZoomSizeExist();if(this.controls&&(this.controls.disable("out"),t&&this.controls.show()),this.imageNode&&t&&this.imageNode.addClass(e.CSS_CURSOR_ZOOM_IN),this.setZoomEvents(),this.isSlideShown&&this.isInView&&t&&this.showHint(),this.accountInfo.branded){var s=o.getNodeWithSirvClassName(this.instanceNode)||c.D.node.head||c.D.node.body;o.rootDOM.showSirvAd(s,this.instanceNode,"https://sirv.com/about-zoom/?utm_source=client&utm_medium=sirvembed&utm_content=typeofembed(zoom)&utm_campaign=branding","Deep zoom image viewer by Sirv")}}},a.normalizeOptions=function(){switch("deep"!==this.option("mode")&&this.option("map.enable",!1),("deep"===this.option("mode")||c.browser.mobile)&&this.option("pan",!0),"magnifier"!==this.option("mode")||c.browser.mobile||this.option("pan",!1),this.isOutsideZoom()||"auto"===this.option("width")&&"auto"===this.option("height")&&this.option("width","70%"),this.option("trigger")){case"hover":"deep"===this.option("mode")&&this.option("trigger","click");break;case"click":case"dblclick":break;default:this.option("trigger",!1)}switch(this.option("mode")){case"top":case"left":case"right":case"bottom":this.insideOptions.type="outside",this.insideOptions.position=this.option("mode");break;case"magnifier":this.insideOptions.type="circle";break;case"inner":this.insideOptions.type="inner";break;case"deep":this.insideOptions.type="deep",this.insideOptions.controls=!0}"deep"===this.insideOptions.type&&this.option("map.enable")&&(this.insideOptions.map=0!==this.option("map.size"),this.insideOptions.map&&(this.insideOptions.mapSize=2*this.option("map.size"))),this.insideOptions.trigger=this.option("trigger"),c.browser.mobile&&(this.insideOptions.hideZoomForClickTrigger=!1),"max"!==this.option("ratio")&&this.option("ratio")<e.MIN_RATIO&&this.option("ratio",0),this.setDefaultZoomOptions()},a.setDefaultZoomOptions=function(){var t="deep"===this.insideOptions.type;i.prototype.setDefaultZoomOptions.call(this),this.defaultZoomOptions=Object.assign(this.defaultZoomOptions,{trigger:this.option("trigger"),tiles:this.option("tiles"),width:this.option("width"),height:this.option("height"),map:this.insideOptions.map,clickBehavior:t?"up":"both",outsidePosition:this.insideOptions.position,margin:this.option("margin"),type:t?"inner":this.insideOptions.type,pan:this.option("pan"),customZooming:this.option("wheel"),mapSize:this.insideOptions.mapSize})},a.onZoomGetImage=function(t){i.prototype.onZoomGetImage.call(this,t),t.data=this.imageSettings(t.data),t.data=this.setHDQuality(t.data);var e=this.image.getImage(t.data);this.checkImage(t.data,t.data.dontLoad)&&this.zoom.addLoadedImage(e)},a.onZoomCancelLoadingOfTiles=function(t){i.prototype.onZoomCancelLoadingOfTiles.call(this,t),t.data=this.imageSettings(t.data),this.image.cancelLoadingImage(t.data)},a.onZoomBeforeShow=function(t){"magnifier"!==this.option("mode")&&("outside"!==this.insideOptions.type||this.insideOptions.outsideModeWasChanged?this.imageNode.addClass(this.zoomClassName):this.imageNode.addClass("sirv-filter-bw"),this.hotspots&&this.hotspots.disableAll())},a.onZoomShown=function(t){this.isSlideShown&&this.sendEvent("zoomIn",{trigger:this.option("trigger"),isOutsideZoom:this.isOutsideZoom()})},a.onZoomHidden=function(t){this.imageNode.removeClass(this.zoomClassName),this.imageNode.removeClass("sirv-filter-bw"),this.sendEvent("zoomOut"),this.isNotMouse=!1,this.zoomIsOpened=!1,this.pinchCloud&&this.pinchCloud.addEvent(),this.hotspots&&(this.hotspotsTurnedOn&&[e.FULLSCREEN.CLOSED,e.FULLSCREEN.OPENING].includes(this.fullscreenState)||"hover"!==this.insideOptions.trigger&&[e.FULLSCREEN.OPENED,e.FULLSCREEN.CLOSING].includes(this.fullscreenState))&&(this.hotspots.enableAll(),this.isInView&&this.isSlideShown&&this.hotspots.showNeededElements())},a.setZoomEvents=function(){var t=this;i.prototype.setZoomEvents.call(this),this.on("zooming",(function(i){var e=i.data.zoom;i.stopAll(),t.controls&&(t.controls.invisibleDisable(!0),t.changeControlsState(e),t.zoomDebounce())})),this.on("zoomUp",(function(i){i.stop(),t.makeZoom("zoomin",i.data.x,i.data.y)})),this.on("zoomDown",(function(i){i.stop(),t.makeZoom("zoomout",i.data.x,i.data.y)}))},a.onBeforeFullscreenIn=function(t){this.zoomIsOpened&&(this.zoom.hide(!0),this.controls&&this.controls.disable("out")),this.ready&&this.isSlideShown&&this.isInView&&this.imageNode&&(this.isHidden=!0,this.imageNode.setCss({opacity:0,visibility:"hidden"})),i.prototype.onBeforeFullscreenIn.call(this,t),this.hotspots&&this.hotspots.disableAll()},a.onAfterFullscreenIn=function(t){var i=this;this.calcContainerSize(),this.replaceZoom(),this.isHidden&&(this.isHidden=!1,setTimeout((function(){i.setImageWidthHeight(),i.imageNode.setCss({opacity:"",visibility:""})}),0)),this.hotspots&&setTimeout((function(){i.hotspotsTurnedOn&&i.fullscreenState===e.FULLSCREEN.OPENED&&(i.hotspots.enableAll(),i.isInView&&i.isSlideShown&&i.hotspots.showNeededElements())}),100)},a.onBeforeFullscreenOut=function(t){this.zoomIsOpened&&(this.zoom.hide(!0),this.controls&&this.controls.disable("out")),i.prototype.onBeforeFullscreenOut.call(this,t),this.hotspots&&(this.hotspotsTurnedOn||this.hotspots.disableAll()),this.replaceZoom(),this.ready&&this.isSlideShown&&this.isInView&&this.imageNode&&(this.isHidden=!0,this.imageNode.setCss({opacity:0,visibility:"hidden"}))},a.onAfterFullscreenOut=function(t){var e=this;this.isHidden&&(this.isHidden=!1,setTimeout((function(){e.destroyed||(e.setImageWidthHeight(),e.imageNode.setCss({opacity:"",visibility:""}))}),0)),i.prototype.onAfterFullscreenOut.call(this,t)},a.onSecondSelectorClick=function(){this.zoomOut(!0)},a.onMouseAction=function(t){"mouseout"===t&&(["deep","magnifier"].includes(this.option("mode"))||!("outside"===this.insideOptions.type&&this.insideOptions.outsideModeWasChanged||"inner"===this.insideOptions.type)||"hover"!==this.insideOptions.trigger&&!this.insideOptions.hideZoomForClickTrigger||this.isNotMouse||this.zoomOut(!0))},a.makeZoom=function(t,i,e){var o=!1;if(this.ready&&this.zoom)switch(t){case"zoomin":this.zoomIsOpened?(1===this.zoom.nextMinZoom&&this.controls.disable("in"),o=this.zoom.zoomUp(i,e)):o=this.openZoom(i,e,"deep"===this.insideOptions.type&&"first");break;case"zoomout":this.zoomIsOpened&&(0===this.zoom.getZoomData()||0===this.zoom.nextMinZoom?(o=this.zoom.hide(),this.controls&&this.controls.disable("out")):o=this.zoom.zoomDown(i,e));break;default:this.zoomIsOpened&&(o=this.zoom.hide(),this.controls&&this.controls.disable("out"))}return o},a.calcContainerSize=function(){var t=this.instanceNode.size;if(t.height&&t.width)this.currentSize=t;else{var i=this.image.originSize;t.height?(this.currentSize.height=t.height,this.currentSize.width=i.width/i.height*t.height):(this.currentSize.width=t.width,this.currentSize.height=i.height/i.width*t.width)}},a.getImageSize=function(){var t,i,e=this.currentSize,o=this.image.originSize;return e.width>=e.height?(i=Math.min(e.height,o.height),(t=o.width/o.height*i)>e.width&&(t=Math.min(e.width,o.width),i=o.height/o.width*t)):(t=Math.min(e.width,o.width),(i=o.height/o.width*t)>e.height&&(i=Math.min(e.height,o.height),t=o.width/o.height*i)),Object.assign({realWidth:t,realHeight:i},this.image.getClearSizeWithoutProcessingSettings({width:t,height:i}))},a.setTriggerAction=function(t){var i=this,o=this.option("trigger");if(this.isNotMouse=!1,!("max"!==this.option("ratio")&&this.option("ratio")<e.MIN_RATIO)&&o){var s,n,a=!1;switch(this.lastTriggerAction&&(this.lastTriggerAction(),this.lastTriggerAction=null,this.hint&&(this.hint.destroy(),this.hint=null,a=!0)),t&&(o=t),o){case"click":s=["btnclick","tap"],n=this.option("hint.text.click");break;case"dblclick":s=["dblbtnclick","dbltap"],n=this.option("hint.text.dblclick");break;case"hover":s="mouseover",n=this.option("hint.text.hover"),c.browser.mobile&&this.outsideModeWasChanged&&(n=this.option("hint.text.dblclick"),o=s="dbltap")}this.createHint(n),a&&this.isSlideShown&&this.isInView&&this.isZoomSizeExist()&&this.showHint();var h=[];if("hover"===o)c.browser.touchScreen&&h.push(this.setLongTapEvents()),c.browser.mobile||h.push(this.setHoverEvents());else{var r=function(t){if((i.fullscreenState===e.FULLSCREEN.OPENED||!i.always)&&(t.stop(),i.isFullscreenActionEnded())){var o=t.pageXY;i.openZoom(o.x,o.y,!1)}};if(c.browser.touchScreen){var d=function(t){i.isNotMouse=t.isTouchEvent()};this.imageNode.addEvent("pointerup",d),h.push(m((function(t){i.isNotMouse=!1,i.imageNode.removeEvent("pointerup",t)})).bind(this,d))}this.imageNode.addEvent(s,r),h.push(m((function(t,e){i.imageNode.removeEvent(t,e)})).bind(this,s,r))}this.lastTriggerAction=m((function(t){m(t).forEach((function(t){t()}))})).bind(this,h)}},a.setImageSrc=function(t,i,e){this.imageNode&&(this.imageNode.attr("src",t),i?this.imageNode.attr("srcset",i+" "+e+"x"):this.imageNode.removeAttr("srcset"),this.clonedImage=m(this.imageNode.node.cloneNode(!0)),this.clonedImage.node.className="")},a.setImageWidthHeight=function(){this.destroyed||(this.currentImageSize.realWidth/this.currentImageSize.realHeight>=this.currentSize.width/this.currentSize.height?this.imageNode.setCss({width:"100%",height:""}):this.imageNode.setCss({width:"",height:"100%"}))},a.createImage=function(t,i,e,o){var s=this;if(!this.imageNode){this.imageNode=t?m(t):c.$new("img"),this.imageNode.attr("referrerpolicy",this.referrerPolicy);var n=this.image.originSize;this.imageNode.setCss({maxWidth:n.width,maxHeight:n.height}),this.setImageWidthHeight(),this.setTriggerAction(),this.option("wheel")&&"deep"===this.option("mode")&&this.imageNode.addEvent("mousescroll",(function(t){!s.zoomIsOpened&&t.delta>0&&(t.stop(),s.openZoom(t.x,t.y,"first"))})),c.W.addEvent("scroll",this.onScrollHandler),this.dataAlt&&this.imageNode.attr("alt",this.dataAlt),this.setImageSrc(i,e,o)}},a.setLongTapEvents=function(){var t=this,i=!1,o=!1,s=function(e){clearTimeout(t.longTapTimer),t.zoomIsOpened||e.isTouchEvent()&&!e.isPrimaryTouch()||t.isFullscreenActionEnded()&&(t.longTapTimer=setTimeout((function(){if(!e.isTouchEvent()||e.isPrimaryTouch()){e.stop(),i=!0;var o=e.pageXY;t.openZoom(o.x,o.y,!1,!0)}}),201),o=!0)},n=function(e){if(!e.isTouchEvent()||e.isPrimaryTouch(e))if(i){e.stop();var o=e.pageXY;t.zoom.customMove(o.x,o.y)}else clearTimeout(t.longTapTimer)},a=function(e){e.isTouchEvent()&&!e.isPrimaryTouch(e)||(o&&(o=!1,clearTimeout(t.longTapTimer)),i&&(e.stop(),i=!1,t.zoom.hide(!0)))};return this.fullscreenState!==e.FULLSCREEN.OPENED&&this.always||(this.instanceNode.addEvent(["touchstart","pointerdown"],s),this.instanceNode.addEvent(["touchmove","pointermove"],n),this.instanceNode.addEvent(["touchend","pointerup"],a)),function(){t.instanceNode.removeEvent(["touchstart","pointerdown"],s),t.instanceNode.removeEvent(["touchmove","pointermove"],n),t.instanceNode.removeEvent(["touchend","pointerup"],a)}},a.setHoverEvents=function(){var t,i,o,s=this,n=!1,a=function(){return c.browser.touchScreen&&!c.browser.mobile},h=function(h){var r=h.pageXY;t=r.x,i=r.y,a()&&h.isTouchEvent()||n||!s.isSlideShown||s.fullscreenState!==e.FULLSCREEN.OPENED&&s.always||(n=!0,o=setTimeout((function(){s.openZoom(t,i,!1)}),84))},r=function(h){var r=m(h.related);if((!a()||!h.isTouchEvent())&&n&&(s.fullscreenState===e.FULLSCREEN.OPENED||!s.always)&&(n=!1,s.isFullscreenActionEnded())){for(;r&&r!==s.imageNode.node&&r!==c.D.node.body;)r=m(r.parentNode);r!==s.imageNode.node&&(t=null,i=null,clearTimeout(o))}},d=function(){},l="mousemove",u="mouseout";return a()&&["edge","ie"].includes(c.browser.uaName)&&(d=this.on("zoomHidden",(function(t){t.stop(),n=!1})),l="pointermove",u="pointerup"),this.imageNode.addEvent(l,h),this.imageNode.addEvent(u,r),function(){d(),s.imageNode.removeEvent(l,h),s.imageNode.removeEvent(u,r)}},a.getZoomImageSize=function(){var t=this.image.originSize,i=t.width,e=t.height,o=this.option("ratio"),s={width:i,height:e};return"max"!==o&&(s.width=this.currentImageSize.realWidth*o,s.height=this.currentImageSize.realHeight*o,s=r.roundImageSize(s)),s.width=Math.min(i,s.width),s.height=Math.min(e,s.height),{width:s.width,height:s.height,originWidth:i,originHeight:e}},a.openZoom=function(t,i,e,o){"deep"===this.insideOptions.type&&"zero"!==e&&(e="first");var s=!1;if(!this.zoom||!this.isZoomSizeExist())return s;this.zoomIsOpened=!0,this.hint&&this.hint.hide(),this.hotspots&&this.hotspots.hideActiveHotspotBox(!0);var n=this.clonedImage,a=this.getZoomImageSize();return s=void 0===t?this.zoom.showCenter(n,a,e):this.zoom.show(n,a,t,i,o,e)},a.createPinchEvent=function(){var t,o,s,n,a,h,r,d,l,m=this,u=function(){a=1,h=1,o=m.zoom.baseScale.x,r=1,d=o,s=1-o};i.prototype.createPinchEvent.call(this,this.instanceNode),this.pinchCloud.onPinchStart=function(t){[e.FULLSCREEN.OPENING,e.FULLSCREEN.CLOSING].includes(m.fullscreenState)||"outside"===m.insideOptions.type&&!m.insideOptions.outsideModeWasChanged||(m.pinchCloud.pinch=!0,clearTimeout(m.longTapTimer),l=!1,m.pinchCloud.scale=t.scale,n=1,m.hotspots&&m.hotspots.hideActiveHotspotBox(!0),m.zoomIsOpened&&(n=m.zoom.scale.x,o===c.U&&u(),n/=o),m.sendEvent("pinchStart"))},this.pinchCloud.onPinchResize=function(t){m.pinchCloud.pinch&&!m.pinchCloud.block&&m.zoom&&m.fullscreenState===e.FULLSCREEN.OPENED&&m.zoomIsOpened&&(m.pinchCloud.scale=t.scale,m.zoom.basePercent=t.centerPoint)},this.pinchCloud.onPinchMove=function(i){m.pinchCloud.pinch&&!m.pinchCloud.block&&(m.fullscreenState!==e.FULLSCREEN.OPENED&&m.isFullscreenEnabled?i.scale>=2&&(m.pinchCloud.block=!0,m.sendEvent("fullscreenIn")):m.zoomIsOpened?m.zoom&&(l?(t=i.scale,r<(t*=o)&&(d=o,h=1,a=s/((r=t)-o)),d>t&&(r=1,a=1,h=o/(d=t)),t=(o+((t*=n)-o)*a)*h,m.zoom.setScale(t,i.centerPoint.x,i.centerPoint.y)):(l=!0,m.zoom.basePercent=i.centerPoint),m.pinchCloud.scale=i.scale):i.scale>1.1?"magnifier"!==m.option("mode")&&m.option("wheel")&&(m.openZoom(i.centerPoint.x,i.centerPoint.y,"zero"),u(),n=1):i.scale<.2&&m.isFullscreenEnabled&&(m.pinchCloud.block=!0,m.sendEvent("fullscreenOut")))},this.pinchCloud.onPinchEnd=function(t){m.pinchCloud.pinch&&(m.pinchCloud.pinch=!1,m.sendEvent("pinchEnd")),m.zoomIsOpened&&m.pinchCloud.removeEvent(),m.pinchCloud.block=!1}},a.loadContent=function(){this.postInit()},a.postInit=function(){var t=this;this.postInitState||(this.postInitState=1,this.waitToStart.start(),z(this.instanceNode.node).then((function(i){t.currentSize=i})).catch((function(i){t.destroyed||t.calcContainerSize()})).finally((function(){t.destroyed||(t.postInitState=2,t.getImage())})))},a.getImage=function(){var t,i,o,n,a=this,h=this.getImageSize(),d=(t=r.roundImageSize({width:this.currentImageSize.width}).width,i=r.roundImageSize({width:h.width}).width,Math.abs(t-i));if(this.setImageCss=!1,!this.ready||d>=this.differenceBetweenSizes||this.fullscreenState===e.FULLSCREEN.OPENED){if(!this.ready&&!h.width&&!h.height)return void setTimeout((function(){a.calcContainerSize(),a.getImage()}),16);(d>=this.differenceBetweenSizes||this.fullscreenState===e.FULLSCREEN.OPENED||!this.currentImageSize.width)&&(this.currentImageSize=h);var l=this.imageSettings({width:this.currentImageSize.realWidth,height:this.currentImageSize.realHeight,round:!0,dontLoad:!0});if(c.DPPX>1&&(o=this.image.originSize,n=l.height>l.width?s.getDPPX(l.round?r.roundImageSize({height:l.height}).height:l.height,o.height,this.upscale):s.getDPPX(l.round?r.roundImageSize({width:l.width}).width:l.width,o.width,this.upscale),l.dppx=n),l=this.setHDQuality(l),this.checkImage(l,!0)&&this.ready){var m=this.image.getImage(l);this.setImageSrc(m.src,m.srcset,n)}else this.image.getImage(l)}else d<this.differenceBetweenSizes&&(this.setImageCss=!0)},a.imageRequest=function(){this.image.getImage(this.imageSettings({width:this.currentImageSize.width,height:this.currentImageSize.height}))},a.showImage=function(){var t=this;return this.imageShowPromise||(this.imageShowPromise=new Promise((function(i,e){var o=null,n=null;t.isInView&&t.isSlideShown?(t.imageNode.setCss({opacity:0,transition:"opacity .3s linear"}),t.instanceNode.append(t.imageNode),s.loadImage(t.imageNode.node).then((function(t){o=t})).catch((function(t){n=t})).finally((function(){t.destroyed||(t.imageNode.addEvent("transitionend",(function(s){s.stop(),t.imageNode.removeEvent("transitionend"),t.imageNode.setCss({opacity:"",transition:""}),o?(t.sendContentLoadedEvent(),i(o)):e(n)})),t.imageNode.render(),t.imageNode.setCssProp("opacity",1))}))):(t.instanceNode.append(t.imageNode),s.loadImage(t.imageNode.node).then((function(t){o=t})).catch((function(t){n=t})).finally((function(){o?(t.sendContentLoadedEvent(),i(o)):e(n)})))}))),this.imageShowPromise},a.createLoader=function(){this.loader=new d(this.instanceNode,{class:"zoom-loader"})},a.createSirvImage=function(){var t=this;this.imageUrl&&(this.on("imageOnload",(function(i){i.stopAll(),i.data.callbackData.lens?(t.zoom.shown||t.zoom.showing)&&t.zoomIsOpened&&t.zoom.addLoadedImage(i.data):t.ready?t.imageShowPromise&&t.setImageSrc(i.data.src,i.data.srcset,i.data.dppx):(t.createImage(i.data.node,i.data.src,i.data.srcset,i.data.dppx),t.showImage().finally((function(){t.loader&&t.loader.hide(),t.done(),t.sendContentLoadedEvent()})))})),this.on("imageOnerror",(function(i){i.stopAll(),t.loader&&t.loader.hide(),console.log("image error")})),this.image=new r(this.imageUrl,{imageSettings:this.queryParams,referrerPolicy:this.referrerPolicy}),this.image.parentClass=this,this.getInfo())},a.getInfoSize=function(){var t=this;return new Promise((function(i,e){t.getInfo().then((function(){i({size:t.infoSize})})).catch((function(t){e({error:t,isPlaceholder:t._isplaceholder})}))}))},a.getSelectorImgUrl=function(t){var i=this;return new Promise((function(e,o){var s=i.imageSettings();s.src&&(t.src=s.src),t.srcset=s.srcset,i.isInfoLoaded?i.waitToStart.wait((function(){e(Object.assign(i.image.getThumbnail(t),{alt:i.dataAlt}))})):i.getInfo().then((function(){i.waitToStart.wait((function(){e(Object.assign(i.image.getThumbnail(t),{alt:i.dataAlt}))}))})).catch(o)}))},a.getThumbnailData=function(t){return this.image.getThumbnail(t)},a.createControls=function(){var t=this;this.insideOptions.controls&&(this.controls=new N(this.instanceNode),this.controls.parentClass=this,this.on("zoomControlsAction",(function(i){i.stopAll(),t.zoom&&t.makeZoom(i.data.type)})))},a.changeControlsState=function(t){this.controls&&(1===t||0===t?1===t?this.controls.disable("in"):this.controls.disable("out"):this.controls.disable())},a.createZoom=function(t){var o=null;if(!this.destroyed){var s=this.zoomContainer;o=i.prototype.createZoom.call(this,this.instanceNode,t),"magnifier"===this.option("mode")?s=f(this.instanceNode):[e.FULLSCREEN.OPENING,e.FULLSCREEN.OPENED].includes(this.fullscreenState)||"outside"===o.type&&(s=f(this.instanceNode),s=c.D.node.body),s&&(this.zoom.lensContainer=s)}return o},a.zoomIn=function(){var t=!1;return this.ready&&this.zoom&&(this.option("fullscreenOnly")&&this.fullscreenState===e.FULLSCREEN.CLOSED?this.sendEvent("fullscreenIn"):t=this.makeZoom("zoomin")),t},a.zoomOut=function(t){var i=!1;return this.ready&&this.zoom&&(t?this.zoomIsOpened&&(i=this.zoom.hide(!this.zoom.getZoomData())):i=this.makeZoom("zoomout")),i},a.isZoomSizeExist=function(){var t=!1;if(this.ready){var i=this.currentImageSize;this.getZoomImageSize().originWidth-i.realWidth>=100&&("max"===this.option("ratio")||this.option("ratio")>=e.MIN_RATIO)&&(t=!0)}return t},a.onResize=function(){var t=!1;if(!this.destroyed)return this.isStarted&&2===this.postInitState&&(this.calcContainerSize(),this.getImage(),this.hotspots&&(this.hotspotsTurnedOn&&[e.FULLSCREEN.CLOSED,e.FULLSCREEN.OPENING].includes(this.fullscreenState)||"hover"!==this.insideOptions.trigger&&[e.FULLSCREEN.OPENED,e.FULLSCREEN.CLOSING].includes(this.fullscreenState))&&(this.hotspots.containerSize=this.imageNode.node.getBoundingClientRect(),this.isInView&&this.isSlideShown&&this.hotspots.showNeededElements()),this.imageNode&&(this.setImageWidthHeight(),this.isZoomSizeExist()?this.imageNode.addClass(e.CSS_CURSOR_ZOOM_IN):(this.hint&&this.hint.hide(),this.imageNode.removeClass(e.CSS_CURSOR_ZOOM_IN))),t=!0),this.controls&&(this.isZoomSizeExist()?this.controls.show():this.controls.hide()),this.replaceZoom(),this.zoom&&this.zoom.onResize(),t},a.onScroll=function(t){this.zoomIsOpened&&t.stop(),clearTimeout(this.longTapTimer),this.scrollDebounce()},a.destroy=function(){return this.destroyed=!0,this.loader&&(this.loader.destroy(),this.loader=null),m(c.W).removeEvent("scroll",this.onScrollHandler),this.onScrollHandler=null,this.lastTriggerAction&&(this.lastTriggerAction(),this.lastTriggerAction=null),this.hint&&(this.hint.destroy(),this.hint=null),this.image&&(this.off("imageOnload"),this.off("imageOnerror"),this.image.destroy(),this.image=null),this.controls&&(this.controls.destroy(),this.controls=null,this.off("zoomControlsAction")),this.hotspots&&(this.hotspotsTurnedOn=!1,this.instanceNode.removeEvent("tap")),this.zoom&&(this.off("zooming"),this.off("zoomUp"),this.off("zoomDown")),this.instanceNode.clearEvents(),this.instanceNode.removeClass(p+"-zoom-view"),this.imageNode&&(this.imageNode.remove(),this.imageNode=null),this.clonedImage&&(this.clonedImage=null),this.zoomDebounce.cancel(),this.zoomDebounce=null,this.scrollDebounce.cancel(),this.scrollDebounce=null,clearTimeout(this.longTapTimer),this.longTapTimer=null,this.hotspotsData=null,i.prototype.destroy.call(this),!0},t.createClass(n,[{key:"imageClassContainer",get:function(){return this.image}},{key:"originImageUrl",get:function(){return this.ready?this.image.originUrl:null}}]),n}(a)}));