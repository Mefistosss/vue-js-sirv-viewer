Sirv.define("LazyImage",["bHelpers","magicJS","globalVariables","globalFunctions","helper","ResponsiveImage","BaseInstance","getDPPX"],(function(t,i,e,s,a,n,o,r){var h=i,c=h.$,d={resize:{type:"boolean",defaults:!0},threshold:{type:"number",minimum:0,defaults:0},fit:{type:"string",enum:["contain","cover","crop","none"],defaults:"contain"},quality:{type:"number",minimum:0,maximum:100,defaults:80},hdQuality:{type:"number",minimum:0,maximum:100,defaults:60},autostart:{oneOf:[{type:"string",enum:["created","visible","off"]},{type:"boolean",enum:[!1]}],defaults:"visible"},onReady:{type:"function",defaults:function(){}}},l=function(){"use strict";function t(t){this.node=c(t),this.state=0,this.states=c(["sirv-image-loading","sirv-image-loaded"])}var i=t.prototype;return i.setState=function(t){this.state!==t&&(this.state-1>=0&&this.node.removeClass(this.states[this.state-1]),this.state=t,this.node.addClass(this.states[t-1]))},i.destroy=function(){var t=this;this.state=0,this.states.forEach((function(i){t.node.removeClass(i)})),this.node=null},t}(),g="smv",u=function(t){var i=t.getBoundingClientRect();return!(0===i.top&&0===i.right&&0===i.bottom&&0===i.left&&0===i.width&&0===i.height)};return function(i){"use strict";function o(t,s,n){var o;s.options={common:{common:s.options.common,mobile:{}},local:{common:"",mobile:""}},(o=i.call(this,t,s,d)||this).node=o.instanceNode,o.type=e.SLIDE.TYPES.IMAGE,o.isLazy="visible"===o.option("autostart"),o.image=null,o.isInfoLoaded=!1,o.infoSize={width:0,height:0},o.isNotSirv=!1,o.isInView=!1,o.isStaticImage=!1,o.dppx=1,o.getImageInfoPromise=null,o.loadStaticImagePromise=null,o.upscale=!1,o.size={width:0,height:0},o.maxSize={},o.lastImageSize={width:0,height:0},o.srcWasSetted=!1,o.originAlt=null,o.infoAlt=null,o.originTitle=null,o.src=null,o.srcset=null,o.startedSrc=null,o.dataSrc=null,o.imageUrl=null,o.dontLoad=!0,o.appearanceState=null,o.dataBgSrc=null,o.inViewModule=null,o.rootMargin=0,o.fitSize=null,o.backgroundNodeSize=null,o.isMaxWidthSet=!1,o.cropPosition={x:null,y:null},o.cssBackgroundSize=null,o.isPlaceholder=!1,o.isRun=!1,o.inited=!1,o.resizeDebounce=a.debounce((function(){o._setRootMargin(),o.onResize()}),50),o.resizeHandler=function(t){o.resizeDebounce()};var r=o.instanceOptions.get("autostart");return(r&&"off"!==r||n)&&o.preInit(),o}t.inheritsLoose(o,i);var m=o.prototype;return m.preInit=function(){var t=this;this.isRun=!0,this.inViewModule=new a.InViewModule((function(i){i.forEach((function(i){var e=i.isIntersecting||i.intersectionRatio>0;t.isInView!==e&&(t.inited?t.inViewCallback(e):(t.isInView=e,(e||u(t.instanceNode.node))&&t.init()))}))}),{rootMargin:this.rootMargin+"px 0px"}),this.inViewModule.observe(this.instanceNode),u(this.instanceNode.node)&&this.init()},m.init=function(){this.inited=!0;try{this.maxWidth=this.instanceNode.node.style.maxWidth}catch(t){}this._getBaseData(),this.imageUrl&&(h.browser.ready||"loading"!==h.D.node.readyState)&&this.startFullInit(),this.createSirvImage()},m.stop=function(){return this.destroy(),!0},m.getOptionsForStartFullInit=function(t){t&&(t={common:{common:t.common.lazyImage||{},mobile:t.mobile.lazyImage||{}},local:{common:"",mobile:""}}),i.prototype.getOptionsForStartFullInit.call(this,t)},m.checkReadiness=function(t,i){return"onLoad"===t&&this.ready},m._setRootMargin=function(){var t=parseInt(this.option("threshold"),10);"string"===h.typeOf(this.option("threshold"))&&(t=(h.W.node.innerHeight||h.D.node.documentElement.clientHeight)/100*t),this.rootMargin=t},m._getQueryParams=function(){if(this.imageUrl){if(this.queryParams=a.paramsFromQueryString(this.imageUrl.replace(e.REG_URL_QUERY_STRING,"$2")),this.queryParams){var t=parseInt(this.queryParams.quality,10);isNaN(t)?delete this.queryParams.quality:this.queryParams.quality=t}this.queryParamsQuality=this.queryParams.quality||null}},m._getBaseData=function(){this.originAlt=this.instanceNode.attr("alt"),this.originTitle=this.instanceNode.attr("title"),this.src=this.instanceNode.attr("src"),this.srcset=this.instanceNode.attr("srcset"),this.startedSrc=this.src,this.dataSrc=this.instanceNode.attr("data-src"),this.isStaticImage=this.src&&!this.dataSrc,this.imageUrl=this.dataSrc||this.src,(a.isSVG(this.imageUrl)||"static"===this.instanceNode.attr("data-type"))&&(this.isNotSirv=!0),this.dataBgSrc=this.instanceNode.attr("data-bg-src"),this.isStaticImage=this.isStaticImage&&!this.dataBgSrc,this.imageUrl=this.dataBgSrc||this.imageUrl,"img"===this.instanceNode.tagName&&(this.instanceNode.attr("referrerpolicy",this.referrerPolicy),this.dataBgSrc&&(this.dataSrc||(this.dataSrc=this.dataBgSrc),this.dataBgSrc=null)),this.dataBgSrc&&(this.dontLoad=!1),this.imageUrl&&(this.src=s.normalizeURL(this.imageUrl.replace(e.REG_URL_QUERY_STRING,"$1"))),this._getQueryParams(),this.startedSrc&&this.dataSrc&&this.startedSrc!==this.dataSrc&&(this.isPlaceholder=this.instanceNode.attr("src"))},m.createSirvImage=function(){var t=this;this.imageUrl&&!this.isNotSirv&&(this.on("imageOnload",(function(i){if(i.stopAll(),t.replaceSrc(),!t.ready)if(t.isStaticImage)t.done();else{var e=function(){t.appearanceState&&(t.appearanceState.setState(2),t.done())};i.data.node?e():a.loadImage(t.instanceNode).finally((function(){e()}))}})),this.on("imageOnerror",(function(t){t.stopAll(),console.log("image error")})),this.image=new n(this.imageUrl,{imageSettings:this.queryParams,round:!0,dontLoad:this.dontLoad,convertSmallerSideToZero:"crop"!==this.option("fit"),referrerPolicy:this.referrerPolicy}),this.image.parentClass=this,this.getInfoSize().catch((function(i){i._isplaceholder&&(t.infoSize=i,t.isNotSirv=!0)})).finally((function(){"loading"!==h.D.node.readyState&&t.isStartedFullInit&&t.run()})))},m.getInfoSize=function(){var t=this;return this.getImageInfoPromise||(this.getImageInfoPromise=new Promise((function(i,e){t.image?t.image.loadInfo().then((function(e){t.isInfoLoaded=!0,t.infoAlt=t.image.description,t.infoSize=t.image.originSize,t.cropPosition=t.image.getCropPosition(),i(e)})).catch((function(i){t.isInfoLoaded=!0,i.status&&404===i.status||(t.isNotSirv=!0),e(i)})):e()}))),this.getImageInfoPromise},m.getId=function(t,e){this.id=this.instanceNode.attr("id"),this.id||this.isStaticImage||i.prototype.getId.call(this,t,e)},m.startFullInit=function(t,e){if(!this.isStartedFullInit&&this.inited){this.getOptionsForStartFullInit(t);var s=this.option("autostart");if(this.inited||s&&"off"!==s||e){i.prototype.startFullInit.call(this,t),t&&(this.isLazy="visible"===this.option("autostart")),this.getId("responsive-image-"," "),this.dataBgSrc&&(this.cssBackgroundSize=a.imageLib.getBackgroundSize(this.instanceNode),this.cssBackgroundSize&&this.option("fit","none"),this.instanceNode.addClass(g+"-bg-image"),"none"!==this.option("fit")&&("contain"===this.option("fit")?this.instanceNode.addClass(g+"-bg-contain"):this.instanceNode.addClass(g+"-bg-cover"))),this._setRootMargin(),this.isStaticImage?this.isLazy=!1:(this.appearanceState=new l(this.instanceNode),this.isPlaceholder||this.appearanceState.setState(1));var n="img"===this.instanceNode.tagName;this.isLazy&&n&&this.instanceNode.attr("loading","lazy"),(!this.isLazy||n&&"ie"!==h.browser.uaName)&&(this.isInView=!0,this.inViewModule.disconnect(),this.inViewModule=null),(this.isInfoLoaded||this.isNotSirv)&&"loading"!==h.D.node.readyState&&this.run(),h.W.addEvent("resize",this.resizeHandler)}}},m.fixHeight=function(t){0!==t&&((t===parseInt(this.instanceNode.getCss("block-size"),10)||t<=16)&&(t=0));return t},m.run=function(){var t=this,e=i.prototype.run.call(this);if(e){this.instanceNode.removeAttr("alt"),this.instanceNode.removeAttr("title"),this.instanceNode.setCss({display:"inline-flex"}).render(),this.instanceNode.setCss({display:""}).render();var s=null;a.imageLib.getSize(this.instanceNode).then((function(t){s=t})).finally((function(){if(!t.destroyed){if(0===(s=a.fixSize(t.instanceNode,s)).width&&0===s.height&&(t.instanceNode.setCss({width:"100%"}),s.width=t.instanceNode.size.width),0===s.width&&0===s.height&&(s.width=h.W.node.innerWidth),"contain"===t.option("fit")?t.fitSize={width:"contain",height:"contain"}:t.fitSize={width:"cover",height:"cover"},"none"===t.option("fit")?t.cssBackgroundSize?t.size=a.imageLib.calcProportionalBackgroundSize(t.cssBackgroundSize,t.infoSize):t.size=t.infoSize:t.size=a.imageLib.calcProportionSize(s,t.infoSize,t.fitSize),!t.dataBgSrc){var i=t.instanceNode.getCss("objectFit");t.maxWidth||!(t.infoSize.width>0)||i&&"fill"!==i||t.instanceNode.attr("width")||(t.isMaxWidthSet=!0,t.instanceNode.setCss({maxWidth:t.infoSize.width}))}(t.originAlt||t.infoAlt)&&t.instanceNode.attr("alt",t.originAlt||t.infoAlt),t.originTitle&&t.instanceNode.attr("title",t.originTitle),t.isStaticImage?t.loadStaticImage().finally((function(){t.isInfoLoaded&&t.done()})):t.isLazy&&!t.isInView||t.getImage()}}))}return e},m._setSrc=function(t,i){this.dataBgSrc?this.instanceNode.setCss({backgroundImage:'url("'+(i||t)+'")'}):(this.instanceNode.attr("src",t),i?!this.isNotSirv&&this.dppx>1&&this.instanceNode.attr("srcset",i+" "+this.dppx+"x"):this.instanceNode.removeAttr("srcset"))},m._setHDQuality=function(t){if(t.dppx>1&&t.dppx<1.5){var i=this.instanceOptions.isset("quality")?this.option("quality"):null;null===this.queryParamsQuality&&null!==i?t.srcset.quality=i:t.srcset&&delete t.srcset.quality}return t},m.replaceSrc=function(){var t;if(this.isNotSirv){if(this.srcWasSetted)return;this.srcWasSetted=!0,t={src:this.imageUrl}}else{var i=this._getImageCreateSettings();i.dppx>1&&i.dppx<1.5&&delete i.srcset.quality,i=this._setHDQuality(i),t=this.image.getImage(i),this.lastImageSize.width=t.width||t.serverWidth,this.lastImageSize.height=t.height||t.serverHeight}this._setSrc(t.src,t.srcset)},m.loadStaticImage=function(){var t=this;return this.loadStaticImagePromise||(this.loadStaticImagePromise=new Promise((function(i,e){t.isStaticImage?t.instanceNode.node.complete?i():(t.instanceNode.addEvent("load",(function(t){i()})),t.instanceNode.addEvent("error",(function(t){e()}))):i()}))),this.loadStaticImagePromise},m._getImageCreateSettings=function(){var t={src:{},srcset:{}},i=this.instanceOptions.isset("quality")?this.option("quality"):null;null!==i&&null===this.queryParamsQuality&&(t.src.quality=i);var e=this.option("hdQuality");return(null===this.queryParamsQuality||this.instanceOptions.isset("hdQuality")&&e<this.queryParamsQuality)&&(t.srcset={quality:e}),t.width=this.size.width,this.size.height&&(t.height=this.size.height),t=a.imageLib.checkMaxSize(t,this.infoSize),this.infoSize.width!==t.width&&this.infoSize.height!==t.height||(t.round=!1),h.DPPX>1&&(t.dppx=this.dppx),"crop"===this.option("fit")&&(t.round=!1),t=this.setCrop(t)},m.setCrop=function(t){if("crop"===this.option("fit")){var i=c(this.instanceNode.node).getInnerSize(!!this.dataBgSrc);t.imageSettings||(t.imageSettings={}),t.imageSettings.crop||(t.imageSettings.crop={}),t.imageSettings.crop={x:this.cropPosition.x||"center",y:this.cropPosition.y||"center",width:i.width,height:i.height}}return t},m.getImage=function(){this.isStaticImage||(this.isNotSirv?this.getNonSirvImg():this.getSirvImg())},m.getNonSirvImg=function(){var t=this;this.isPlaceholder?a.loadImage(this.dataSrc).finally((function(){t.replaceSrc(),t.appearanceState.setState(2),t.done()})):(this.replaceSrc(),this.appearanceState.setState(2),this.done())},m.getSirvImg=function(){var t=this._getImageCreateSettings();if(t.width&&(this.maxSize.width=t.width),t.height&&(this.maxSize.height=t.height),h.DPPX>1){var i=this.image.originSize;this.dppx=r(t.width,t.height,i.width,i.height,!h.defined(t.round)||t.round,this.upscale),t.dppx=this.dppx}t=this._setHDQuality(t),this.checkImage(t)?this.replaceSrc():this.image.getImage(t)},m.checkSize=function(t){var i=this.infoSize.width,e=this.infoSize.height;return(t.width>i||t.height>e)&&(t.width=i,t.height&&(t.height=e),t.round=!1),t},m.done=function(){i.prototype.done.call(this),this.option("onReady")(this.id),this.sendEvent("ready")},m.inViewCallback=function(t){t&&!this.isStaticImage&&(this.ready||this.isInView||this.isStarted&&(this.isInView=!0,this.isNotSirv?this.srcWasSetted||this.getImage():this.isInfoLoaded&&this.getImage())),this.isInView=t},m.sendEvent=function(t,i){i||(i={}),i.image||(i.image={}),i.image.event||(i.image.event={}),"ready"===t&&(t="onLoad"),i.type=t,i.image.id=this.id,i.image.url=this.instanceUrl,i.image=Object.assign(i.image,this.api),i.node=this.instanceNode,i.image.node=this.instanceNode.node,i.image.event.timestamp=+new Date,i.image.event.type="lazyimage:"+t,this.emit("imagePublicEvent",{data:i})},m.onResize=function(){if(!this.isStarted||this.isStaticImage||!this.option("resize")||this.isNotSirv)return!1;var t;if(["crop","cover"].includes(this.option("fit"))?t=c(this.instanceNode.node.parentNode).size:(t=this.instanceNode.size).height=this.fixHeight(t.height),t=a.imageLib.calcProportionSize(t,this.infoSize,this.fitSize),this.size.width=t.width,this.size.height&&(this.size.height=t.height),this.ready&&!this.isNotSirv){"crop"===this.option("fit")?(Math.abs(this.size.width-this.lastImageSize.width)>50||Math.abs(this.size.height-this.lastImageSize.height)>50)&&this.getImage():(this.size.width-this.lastImageSize.width>50||this.size.height-this.lastImageSize.height>50)&&this.getImage()}return!0},m.destroy=function(){if(this.dataBgSrc&&(this.instanceNode.removeClass(g+"-bg-image"),this.instanceNode.setCssProp("background-image","")),this.isMaxWidthSet&&(this.isMaxWidthSet=!1,this.instanceNode.setCss({maxWidth:""})),this.appearanceState&&this.appearanceState.destroy(),this.inViewModule&&(this.inViewModule.disconnect(),this.inViewModule=null),h.W.removeEvent("resize",this.resizeHandler),this.resizeDebounce.cancel(),this.resizeDebounce=null,this.image&&(this.off("imageOnload"),this.off("imageOnerror"),this.image.destroy(),this.image=null),this.instanceNode.node.hasAttribute("src"))try{this.instanceNode.removeAttr("src"),this.isStaticImage&&this.instanceNode.attr("src",this.imageUrl)}catch(t){}if(this.isStaticImage?this.instanceNode.attr("src",this.src):this.instanceNode.removeAttr("src"),this.srcset)this.instanceNode.attr("srcset",this.srcset);else try{this.instanceNode.removeAttr("srcset")}catch(t){}this.srcset=null,!this.originAlt&&this.infoAlt&&this.instanceNode.removeAttr("alt"),this.instanceNode.removeEvent("load"),this.isPlaceholder&&(this.instanceNode.attr("src",this.isPlaceholder),this.isPlaceholder=!1),i.prototype.destroy.call(this)},t.createClass(o,[{key:"imageClassContainer",get:function(){return this.image}},{key:"originImageUrl",get:function(){return this.src}}]),o}(o)}));