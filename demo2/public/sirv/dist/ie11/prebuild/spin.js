Sirv.define("Spin",["bHelpers","magicJS","globalVariables","globalFunctions","helper","EventEmitter","Zoominstance","ResponsiveImage","Hint","ProgressLoader","SpinHotspots"],(function(t,e,i,n,s,o,a,r,h,c,u){var l=e,m=l.$;n.rootDOM.addModuleCSSByName("Spin",(function(){return".sirv-spin{-ms-user-select:none!important;user-select:none!important;display:inline-block;position:relative;width:100%;max-width:100%;height:100%;padding:0!important;transform:translate3d(0,0,0);outline:0;outline:0!important;color:#000;font-size:0!important;line-height:100%!important;text-decoration:none;overflow:hidden;vertical-align:middle;visibility:visible;backface-visibility:hidden;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none!important}.sirv-spin::before{display:inline-block;height:0;content:'';vertical-align:top}.sirv-spin .spin-canvas-container{position:absolute}.sirv-spin .spin-canvas-container,.sirv-spin canvas{top:0;right:0;bottom:0;left:0;margin:auto}.sirv-spin canvas{transition:opacity 1s linear,filter 2s linear;opacity:0;z-index:1}.sirv-spin canvas.smv-shown{opacity:1!important}.sirv-spin canvas.smv-zoomed-in{visibility:hidden!important}.sirv-spin-message{display:block;position:absolute;top:50%;left:33%;width:33%;padding:6px;border:1px solid #aaa;border-radius:15px;background-color:#fff;background-image:none;color:#000;font-size:10px;text-align:center;border-collapse:separate;box-shadow:0 0 10px #000;overflow:hidden;z-index:100}.sirv-hint .spin-hint-animation{display:none;position:relative;width:40px;height:40px;margin-right:10px;transform-style:preserve-3d;vertical-align:middle;perspective:200px}.sirv-hint .sirv-hint-message .spin-hint-animation::before{display:inline-block;position:absolute;top:0;right:0;bottom:0;left:0;width:40%;height:30%;margin:auto;transform-origin:50% 50% -15px;border:1px solid #fff;box-shadow:inset 0 0 1px 1px rgba(255,255,255,.5);content:'';box-sizing:border-box}.sirv-hint.spin-hint-horizontal-animation .sirv-hint-message .spin-hint-animation::before{transform:translateZ(0) rotateY(0);animation:sirv-spin-hint-horizontal-rotate 3s infinite linear}@keyframes sirv-spin-hint-horizontal-rotate{0%{transform:translateZ(0) rotateY(0)}5%{transform:translateZ(100px) rotateY(0)}7%{transform:translateZ(75px) rotateY(0)}20%{transform:translateZ(75px) rotateY(0)}30%{transform:translateZ(75px) rotateY(45deg)}40%{transform:translateZ(75px) rotateY(0)}50%{transform:translateZ(75px) rotateY(-45deg)}60%{transform:translateZ(75px) rotateY(0)}63%{transform:translateZ(75px) rotateY(0)}68%{transform:translateZ(-25px) rotateY(0)}70%{transform:translateZ(0) rotateY(0)}80%{transform:translateZ(0) rotateY(0)}100%{transform:translateZ(0) rotateY(0)}}.sirv-hint.spin-hint-vertical-animation .spin-hint-message .spin-hint-animation::before{transform:translateZ(0) rotateX(0);animation:sirv-spin-hint-vertical-rotate 3s infinite linear}@keyframes sirv-spin-hint-vertical-rotate{0%{transform:translateZ(0) rotateX(0)}5%{transform:translateZ(100px) rotateX(0)}7%{transform:translateZ(75px) rotateX(0)}20%{transform:translateZ(75px) rotateX(0)}30%{transform:translateZ(75px) rotateX(45deg)}40%{transform:translateZ(75px) rotateX(0)}50%{transform:translateZ(75px) rotateX(-45deg)}60%{transform:translateZ(75px) rotateX(0)}63%{transform:translateZ(75px) rotateX(0)}68%{transform:translateZ(-25px) rotateX(0)}70%{transform:translateZ(0) rotateX(0)}80%{transform:translateZ(0) rotateX(0)}100%{transform:translateZ(0) rotateX(0)}}.sirv-hint.spin-hint-horizontal-animation.spin-hint-vertical-animation .sirv-hint-message .spin-hint-animation::before{transform:translateZ(0) rotateX(0) rotateY(0);animation:sirv-spin-hint-double-rotate 5s infinite linear}@keyframes sirv-spin-hint-double-rotate{0%{transform:translateZ(0) rotateX(0) rotateY(0)}4%{transform:translateZ(100px) rotateX(0) rotateY(0)}5%{transform:translateZ(75px) rotateX(0) rotateY(0)}10%{transform:translateZ(75px) rotateX(0) rotateY(0)}19%{transform:translateZ(75px) rotateX(0) rotateY(45deg)}28%{transform:translateZ(75px) rotateX(0) rotateY(0)}37%{transform:translateZ(75px) rotateX(0) rotateY(-45deg)}45%{transform:translateZ(75px) rotateX(0) rotateY(0)}54%{transform:translateZ(75px) rotateX(45deg) rotateY(0)}63%{transform:translateZ(75px) rotateX(0) rotateY(0)}72%{transform:translateZ(75px) rotateX(-45deg) rotateY(0)}81%{transform:translateZ(75px) rotateX(0) rotateY(0)}85%{transform:translateZ(-25px) rotateX(0) rotateY(0)}86%{transform:translateZ(0) rotateX(0) rotateY(0)}90%{transform:translateZ(0) rotateX(0) rotateY(0)}100%{transform:translateZ(0) rotateX(0) rotateY(0)}}.smv-progress-loader{bottom:0;left:0;margin-bottom:5px;margin-left:5px}"}));var d,p,g,f,v,w,S,I,y,C,b,x,z={swapSides:{type:"boolean",defaults:!1},wheel:{type:"boolean",defaults:!0},initialize:{type:"string",enum:["load","hover","click","tap"],defaults:"load"},freeDrag:{type:"boolean",defaults:!1},tappingFirst:{type:"boolean",defaults:!1},thumbnail:{type:{type:"string",enum:["image","gif"],defaults:"image"},gifParams:{type:"string",defaults:""}},zoom:{enable:{type:"boolean",defaults:!0},ratio:{oneOf:[{type:"number",minimum:0},{type:"string",enum:["max"]}],defaults:2.5},tiles:{type:"boolean",defaults:!0},pan:{type:"boolean",defaults:!0}},inactivity:{type:"number",minimum:1e3,defaults:3e3},autospin:{enable:{type:"boolean",defaults:!1},type:{type:"string",enum:["row","sphere","full","helix"],defaults:"sphere"},resume:{type:"number",minimum:0,defaults:3e3},duration:{type:"number",minimum:0,defaults:3600}},hint:{message:{enable:{type:"boolean",defaults:!0},text:{type:"string",defaults:"Drag to spin"}},onStart:{enable:{type:"boolean",defaults:!0},effect:{oneOf:[{type:"string",enum:["intro","twitch","spin","momentum","sphere","none"]},{type:"boolean",enum:[!1]}],defaults:"intro"}},onVisible:{enable:{type:"boolean",defaults:!0},effect:{oneOf:[{type:"string",enum:["intro","twitch","spin","momentum","sphere","none"]},{type:"boolean",enum:[!1]}],defaults:"twitch"}},onInactive:{enable:{type:"boolean",defaults:!0},effect:{oneOf:[{type:"string",enum:["intro","twitch","spin","momentum","sphere","none"]},{type:"boolean",enum:[!1]}],defaults:"twitch"}}},row:{start:{type:"number",minimum:1,defaults:1},loop:{type:"boolean",defaults:!1},increment:{type:"number",minimum:1,defaults:1},reverse:{type:"boolean",defaults:!1},sensitivity:{type:"number",minimum:1,maximum:100,defaults:50}},column:{start:{type:"number",minimum:1,defaults:1},loop:{type:"boolean",defaults:!0},increment:{type:"number",minimum:1,defaults:1},reverse:{type:"boolean",defaults:!1},sensitivity:{type:"number",minimum:1,maximum:100,defaults:50}}},E=function(e){"use strict";function i(t,i,n,s){var o;return(o=e.call(this,t,i)||this).col=n,o.row=s,o}t.inheritsLoose(i,e);var n=i.prototype;return n._createImageData=function(t,i){var n=e.prototype._createImageData.call(this,t,i);return n.col=this.col,n.row=this.row,n},n.getThumbnail=function(t){var i=e.prototype.getThumbnail.call(this,t);return i.col=this.col,i.row=this.row,i},i}(r),R=(d=m([.45,.19,.56,.86]),p=function(t,e,i,n,o){for(var a=[],r=!1,h=t;h!==e||!r&&o;)r=!0,i?h+=1:h-=1,h=s.getArrayIndex(h,n),a.push(h);return a},g=function(t,e){var i="col";null===e.row&&(i="row");var n=[];return t.forEach((function(t){var s={col:e.column,row:e.row};s[i]=t,n.push(s)})),n},f=function(t,e,i,n){var o,a=[t],r=!0;return[t+e,t-e,t].forEach((function(t){o=function(t){var e;return n?e=s.getArrayIndex(t,i):((e=t)<0&&(e=0),e>i-1&&(e=i-1)),e}(t),a=a.concat(p(a[a.length-1],o,r,i,n)),r=!r})),a},v=function(t,e,i){return i?p(t,s.getArrayIndex(t+e,e),!0,e,i):f(t,e,e,!1)},w=function(t){var e=t.length,i=[];return t.forEach((function(t,n){for(var s,o=(s=n,Math.round(5*l.FX.cubicBezierAtTime(s/e,600,d))+1);o>0;)o-=1,i.push(t)})),i},S=function(t){var e=s.deepExtend({degree:30,swapSides:!1,axelerate:!1,isBackward:!1,justFirstLine:!1,row:{length:1,loop:!1,current:1,jumpCount:0},column:{length:36,loop:!0,current:1,jumpCount:0},firstSide:"column",secondSide:"row"},t||{});return["row","column"].forEach((function(t){e[t].current>e[t].length-1&&(e[t].current=0)})),e.swapSides&&(e.secondSide=e.firstSide,e.firstSide="row"),e},I={lib:{getRightIndex:function(t,e,i){var n;return i?n=s.getArrayIndex(t,e):(t>=e?t=e-1:t<0&&(t=0),n=t),n}},twitch:function(t){var e,i=S(t),n={column:0,row:0},s=[];return[i.firstSide,i.secondSide].forEach((function(t){var o=t===i.firstSide?i.secondSide:i.firstSide;i[t].length>1&&(n[t]=Math.floor(i[t].length/360*i.degree)||1),n[t]&&((e={})[t]=null,e[o]=i[o].current,s=s.concat(g(f(i[t].current,n[t],i[t].length,i[t].loop),e)))})),s},sphere:function(t){var e=S(t),i=[];return(e.justFirstLine?[e.firstSide]:[e.firstSide,e.secondSide]).forEach((function(t){var n=t===e.firstSide?e.secondSide:e.firstSide,s={};if(1!==e[t].length){s[t]=null,s[n]=e[n].current;var o=g(v(e[t].current,e[t].length,e[t].loop),s);e.isBackward&&o.reverse(),i=i.concat(o)}})),e.axelerate&&(i=w(i)),i},intro:function(t){var e=S(t),i={swapSides:e.swapSides,justFirstLine:!0,isBackward:e.isBackward,row:s.deepExtend({},e.row),column:s.deepExtend({},e.column)};return I.sphere(i).concat(I.twitch(i))},full:function(t){var e,i=S(t),n=i[i.secondSide].length;e=n>1?v(i[i.secondSide].current,n,i[i.secondSide].loop):[i[i.secondSide].current];var o=s.deepExtend({},i[i.firstSide]),a=s.deepExtend({},i[i.secondSide]),r=[];return e.forEach((function(t){var e={swapSides:i.swapSides,justFirstLine:!0};a.current=t,e[i.firstSide]=o,e[i.secondSide]=a,r=r.concat(I.sphere(e))})),i.isBackward&&r.reverse(),r},custom:function(t){var e=S(t),i={x:e.column.current,y:e.row.current},n={x:e.column.current+e.column.jumpCount,y:e.row.current+e.row.jumpCount},s=[];return s=function(t,e){var i={x:[],y:[]},n=function(t,e,n,s){var o,a,r=n-t,h=s-e,c=1,u=e;for(h<0&&(c=-1,h=-h),a=2*h-r,o=t;o<=n;o++)i.x.push(o),i.y.push(u),a>0&&(u+=c,a-=2*r),a+=2*h},s=function(t,e,n,s){var o,a,r=n-t,h=s-e,c=1,u=t;for(r<0&&(c=-1,r=-r),a=2*r-h,u=t,o=e;o<=s;o++)i.x.push(u),i.y.push(o),a>0&&(u+=c,a-=2*h),a+=2*r};return Math.abs(e.y-t.y)<Math.abs(e.x-t.x)?t.x>e.x?n(e.x,e.y,t.x,t.y):n(t.x,t.y,e.x,e.y):t.y>e.y?s(e.x,e.y,t.x,t.y):s(t.x,t.y,e.x,e.y),i}(i,n),s=function(t){var e=[];t.x[0]!==i.x&&t.x.reverse(),t.y[0]!==i.y&&t.y.reverse();for(var n=0,s=t.x.length;n<s;n++)e.push({col:t.x[n],row:t.y[n]});return e}(s),s=m(s).map((function(t){return{col:I.lib.getRightIndex(t.col,e.column.length,e.column.loop),row:I.lib.getRightIndex(t.row,e.row.length,e.row.loop)}}))}}),O={_:y={getStep:function(t){var e=1;return t>24&&(e=Math.floor(t/24))>3&&(e=3),e},getIndexes:function(t){var e=[],i=[],n=!0,s=y.getStep(t);do{for(var o=[],a=0;a<t;a+=s)i[a]||(o.push(a),i[a]=1);1===s&&(n=!1),e.push(o),s=Math.ceil(s/2)}while(s>=1&&n);return e},getRightIdexes:function(t,e,i,n){t.forEach((function(t){var o=t+e,a=s.getArrayIndex(o,i);(o<i||a<e)&&n(a)}))},getOptions:function(t){var e=s.deepExtend({},t);return e.schemaOfImages=e.images.map((function(t){return t.map((function(t){return 0}))})),e.rowLength=e.images.length,e.colLength=e.images[e.startRow].length,e},all:function(t,e,i){for(var n=[],s=0,o=t.length;s<o;s++)for(var a=0,r=t[s].length;a<r;a++)e[s][a]||(n.push([s,a]),e[s][a]=i+1);return n},getSideOpt:function(t){var e={length:t.colLength,start:t.startCol,otherLength:t.rowLength,otherStart:t.startRow};if(t.swapSides){var i=e.length;e.length=e.otherLength,e.otherLength=i,i=e.start,e.start=e.otherStart,e.otherStart=i}return e}},all:function(t){var e=[],i=y.getOptions(t),n=y.getIndexes(i.colLength),o=[];return i.images.forEach((function(t,e){var a=t.length;y.getRightIdexes(n[0],i.startCol,a,(function(t){var n=s.getArrayIndex(e+i.startRow,i.rowLength);o.push([n,t]),i.schemaOfImages[n][t]=1}))})),e.push(o),e.push([].concat(y.all(i.images,i.schemaOfImages,1))),e},fastLine:function(t){for(var e=[],i=y.getOptions(t),n=y.getSideOpt(i),o=[],a=0,r=n.length;a<r;a++){var h=s.getArrayIndex(a+n.start,n.length);i.swapSides?(o.push([h,i.startCol]),i.schemaOfImages[h][i.startCol]=1):(o.push([i.startRow,h]),i.schemaOfImages[i.startRow][h]=1)}return e.push(o),e.push([].concat(y.all(i.images,i.schemaOfImages,1))),e},line:function(t){var e=[],i=y.getOptions(t),n=y.getSideOpt(i),s=y.getIndexes(n.length),o=[],a=1;for(y.getRightIdexes(s[0],n.start,n.length,(function(t){i.swapSides?(o.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=1):(o.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=1)})),e.push(o),o=[];a<s.length;)s[a]&&y.getRightIdexes(s[a],n.start,n.length,(function(t){i.swapSides?(o.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=a+1):(o.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=a+1)})),a+=1;return e.push(o.concat(y.all(i.images,i.schemaOfImages,a))),e},sphere:function(t){var e=[],i=y.getOptions(t),n=y.getSideOpt(i),s=y.getIndexes(n.length),o=y.getIndexes(n.otherLength),a=Math.max(s.length,o.length),r=[],h=1;for(y.getRightIdexes(s[0],n.start,n.length,(function(t){i.swapSides?(r.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=1):(r.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=1)})),y.getRightIdexes(o[0],n.otherStart,n.otherLength,(function(t){i.swapSides?i.schemaOfImages[i.startRow][t]||(r.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=1):i.schemaOfImages[t][i.startCol]||(r.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=1)})),e.push(r),r=[];h<a;)s[h]&&y.getRightIdexes(s[h],n.start,n.length,(function(t){i.swapSides?(r.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=h+1):(r.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=h+1)})),o[h]&&y.getRightIdexes(o[h],n.otherStart,n.otherLength,(function(t){i.swapSides?(r.push([i.startRow,t]),i.schemaOfImages[i.startRow][t]=h+1):(r.push([t,i.startCol]),i.schemaOfImages[t][i.startCol]=h+1)})),h+=1;return e.push(r.concat(y.all(i.images,i.schemaOfImages,h))),e}},M=(C=function(t,e){return t+"."+e},b=function(t,e){return t%e==0},x=function(t,e,i){return/^\//.test(i)?t+i:e+"/"+i},function(e){"use strict";function i(t){var i,n,o;return(i=e.call(this)||this).o=t,i._startColumn=0,i._startRow=0,i._currentColumn=0,i._currentRow=0,i.nextColumn=0,i.nextRow=0,i.futureColumn=0,i.futureRow=0,i.imgMap=[],i.isAvailableOfLoading=!0,i.images=[],i.isStartedFullInit=!1,i.imageInfoPromise=null,i.loadingMap={queue:[]},i.url=s.spinLib.getUrl(i.o.url),i.absoluteURL=(n=i.url,o=[],o=m(n.split("//")),n=o[1],(o=[o=o[0],n=n.split("/")[0]]).join("//")),i.infoImg=null,i.imageInfoId="img-"+s.generateUUID(),i.addEvents(),i}t.inheritsLoose(i,e);var o=i.prototype;return o.createImageInfo=function(){var t,e,i=this;return this.infoImg||(this.infoImg=new E(n.normalizeURL(x(this.absoluteURL,this.url,(t=Object.keys(i.o.layers)[0],e=Object.keys(i.o.layers[t])[0],i.o.layers[t][e]))),{imageSettings:this.o.imageSettings,infoId:this.imageInfoId,round:!0,referrerPolicy:this.o.referrerPolicy},null,null),this.infoImg.parentClass=this),this.infoImg},o.loadImageInfo=function(){var t=this;return this.imageInfoPromise||(this.imageInfoPromise=new Promise((function(e,i){t.createImageInfo(),t.infoImg.loadInfo().then((function(i){t.isStartedFullInit&&t.createQueue(),e({size:t.infoImg.originSize})})).catch((function(t){i({error:t})}))}))),this.imageInfoPromise},o.startFullInit=function(t){var e=this;this.isStartedFullInit||(this.isStartedFullInit=!0,this.o=Object.assign(this.o,t),this.o.layers=s.spinLib.checkLayers(this.o.layers),this.o.layers=s.spinLib.swapLayers(this.o.layers,this.o.swapSides),this.imgMap=Object.values(this.o.layers).filter((function(t,i){return b(i,e.o.rowIncrement)})).map((function(t){return Object.values(t).filter((function(t,i){return b(i,e.o.columnIncrement)})).map((function(t){return n.normalizeURL(x(e.absoluteURL,e.url,t))}))})),s.spinLib.reverse(this.o.reverseColumn,this.o.reverseRow,this.imgMap),this.createImages(this.imgMap),this.setFirstImage(),this.imageInfoPromise&&this.infoImg.loadInfo().then((function(t){e.loadingMap.queue.length||e.createQueue()})).catch((function(t){})))},o.setImageSettings=function(t){return t||(t={}),t.imageSettings||(t.imageSettings={}),t.imageSettings.scale||(t.imageSettings.scale={}),t.callbackData||(t.callbackData={}),t.imageSettings.scale.option="fill",t.srcset||(t.srcset={}),null!==this.o.quality&&(t.src||(t.src={}),t.src=this.o.quality),t.dppx>=1.5?t.srcset.quality=this.o.hdQuality:null!==this.o.quality&&(t.srcset.quality=this.o.quality),t},o.getImage=function(t,e){var i=t,n=e;return l.defined(t)||(i=this._currentRow,n=this._currentColumn),this.images[i][n]},o.getThumbnail=function(t){return this.getImage(this._startRow,this._startColumn).getThumbnail(t)},o.addEvents=function(){var t=this,e=!1,i=!1,n=!1,s=function(s){e&&i&&n||s.lens||(e||s.col!==t._currentColumn||s.row!==t._currentRow||(e=!0,t.emit("mapFirstImageLoaded",{data:s})),!i&&t.loadingMap.checkOfFirstPartImagesLoading(s.row,s.col)&&(i=!0,t.emit("mapImagesReady")),!n&&t.loadingMap.checkOtherImagesLoading(s.row,s.col)&&(n=!0),e&&i&&n&&t.emit("mapAllImagesLoaded"))};this.on("imageOnload",(function(e){e.stopAll();var i=Object.assign({isCurrent:t.isCurrent(e.data)},e.data);t.emit("mapImageLoaded",{data:i}),s(i)})),this.on("imageOnerror",(function(e){e.stopAll(),e.data.error=!0,t.emit("mapImageLoaded",{data:e.data}),s(e.data),console.log("image error")}))},o.getHintType=function(){var t=this.countOfRows,e=this.countOfFrames;return t>1&&e>1?"multi-row":t>1?"col":"row"},o.isLoaded=function(t){var e=this.getImage();return t=this.setImageSettings(t),e.isLoaded(t)},o.isExist=function(t){var e=this.getImage();return t=this.setImageSettings(t),e.isExist(t)},o.isCurrent=function(t){return t.row===this._currentRow&&t.col===this._currentColumn},o.pixelPerFrame=function(t){var e=t,i=this.countOfFrames;return i>1?(this.o.loopColumn||(e/=2),e/=i):e/=this.countOfRows,e/=Math.pow(this.o.columnSpeed/50,2)},o.pixelPerRow=function(t){var e=t,i=this.countOfRows;return i>1?(this.o.loopRow||(e/=2),e/=i):e/=this.countOfFrames,e/=Math.pow(this.o.rowSpeed/50,2)},o.createImages=function(t){for(var e=0,i=t.length;e<i;e++){for(var s=[],o=0,a=t[e].length;o<a;o++){var r=new E(n.adjustURL(t[e][o]),{imageSettings:this.o.imageSettings,infoId:this.imageInfoId,round:!0,referrerPolicy:this.o.referrerPolicy},o,e);r.parentClass=this,s.push(r)}this.images.push(s)}},o.setFirstImage=function(){var t=this.o.startRow,e=this.o.startColumn;this.o.reverseRow&&(t=this.images.length+1-t),this.o.reverseColumn&&(e=this.images[0].length+1-e),this._currentRow=t-1,this._currentColumn=e-1,this._currentRow>this.images.length-1&&(this._currentRow=0),this._currentColumn>this.images[0].length-1&&(this._currentColumn=0),this._startColumn=this.futureColumn=this.nextColumn=this._currentColumn,this._startRow=this.futureRow=this.nextRow=this._currentRow},o.loadImage=function(t,e,i){var n=this.getImage(e,i);t=this.setImageSettings(t),n.getImage(t)},o.loadFirstImage=function(t){if(this.loadingMap.queue.length){var e=this.loadingMap.queue[0].shift();this.loadImage(t,e[0],e[1])}},o.loadFirstPartOfImages=function(t){var e=this;this.loadingMap.queue.length&&this.loadingMap.queue[0].forEach((function(i){e.loadImage(t,i[0],i[1])}))},o.loadOtherImages=function(t){var e=this;this.isAvailableOfLoading&&this.loadingMap.queue.length&&(t=this.setImageSettings(t),this.loadingMap.queue[1].forEach((function(i){e.loadImage(t,i[0],i[1])})))},o.loadImages=function(t){var e=this._currentColumn;this.isAvailableOfLoading&&(t=this.setImageSettings(t),this.o.swapSides?this.images.forEach((function(i){var n=i[e];n.isExist(t)?n.sendLoad(t):n.getImage(t)})):this.images.forEach((function(e){e.forEach((function(e){e.isExist(t)?e.sendLoad(t):e.getImage(t)}))})))},o.isImagesExist=function(t){return t=this.setImageSettings(t),!this.images.some((function(e){return e.some((function(e){return!e.isExist(t)}))}))},o.createQueue=function(){var t,e=this;switch(this.o.loadingSchema){case"momentum":t="fastLine";break;case"full":t="all";break;case"row":case"spin":t="line";break;case"sphere":case"intro":case"twitch":t="sphere";break;default:t="all"}this.loadingMap.queue=O[t]({swapSides:this.o.swapSides,images:this.images,startRow:this._currentRow,startCol:this._currentColumn}),this.loadingMap.checkOfFirstPartImagesLoading=function(){var t=[];e.loadingMap.queue[0].forEach((function(e){t.push(C(e[0],e[1]))})),t.shift();var i=t.length,n=!1;return i||(n=!0),function(e,s){return n||t.indexOf(C(e,s))>=0&&0==(i-=1)&&(t=[],n=!0),n}}(),this.loadingMap.checkOtherImagesLoading=function(){var t,i=[];e.loadingMap.queue[1].forEach((function(t){i.push(C(t[0],t[1]))}));var n=!1;return(t=i.length)||(n=!0),function(e,s){return n||i.indexOf(C(e,s))>=0&&0==(t-=1)&&(i=[],n=!0),n}}()},o.prepareFutureImage=function(t,e){var i,n,s;e||(e=1),["next","prev"].includes(t)?(s=this.o.loopColumn,i=this.futureColumn,n=this.countOfFrames,"next"===t?i+=e:i-=e,this.futureColumn=R.lib.getRightIndex(i,n,s)):(s=this.o.loopRow,i=this.futureRow,n=this.countOfRows,"down"===t?i+=e:i-=e,this.futureRow=R.lib.getRightIndex(i,n,s))},o.setPreparedNextImage=function(){this.futureColumn=this._currentColumn=this.nextColumn,this.futureRow=this._currentRow=this.nextRow,this.emit("frameChange",{data:{column:this._currentColumn,row:this._currentRow}})},o.setPreparedFutureImage=function(){var t=this.getImage(this.futureRow,this.futureColumn);t&&t.ready&&(this._currentColumn=this.futureColumn,this._currentRow=this.futureRow,this.emit("frameChange",{data:{column:this._currentColumn,row:this._currentRow}}))},o.resetPreparedImage=function(){this.futureColumn=this.nextColumn=this._currentColumn,this.futureRow=this.nextRow=this._currentRow},o.getCurrentImage=function(t){t=this.setImageSettings(t);var e=this._currentColumn,i=this._currentRow,n=this.getImage(i,e);return n=n.getImage(t)},o.jump=function(t,e,i){var n,o=this,a=!1,r=function(t,e){var i=!1;return o.getImage(t,e).ready&&(o.nextRow=t,o.nextColumn=n,o.setPreparedNextImage(),i=!0),i};switch(t){case"row":a=r(s.spinLib.getNextIndex(this._currentRow,e,i,this.countOfRows,this.o.loopRow),n=this._currentColumn);break;case"col":n=s.spinLib.getNextIndex(this._currentColumn,e,i,this.countOfFrames,this.o.loopColumn),a=r(this._currentRow,n)}return a},o.setNextAnimationFrame=function(t){var e=this._imagesBuffer[t],i=this.getImage(e.row,e.col);i&&i.ready&&(this.nextColumn=e.col,this.nextRow=e.row)},o.getNextBufferIndex=function(t){var e,i=this,n=0,s=this._imagesBuffer.length,o=function(t){var e=i.getImage(t.row,t.col),n=!1;return e&&e.ready&&(n=!0),n};do{n+=1,(t+=1)>=s?n=0:e=this._imagesBuffer[t]}while(n>0&&(!e||!o(e)));return n},o.createAnimation=function(t,e){var i=!1,n=!1,s=0,o=0;switch(t){case"as-row":t="sphere",i=!0;break;case"as-sphere":t="sphere";break;case"as-full":t="full";break;case"as-helix":t="sphere";break;case"intro":t="intro",i=!0;break;case"twitch":t="twitch";break;case"spin":t="sphere",i=!0;break;case"momentum":t="sphere",i=!0,n=!0;break;case"sphere":t="sphere";break;default:s=t.cols,o=t.rows,t="custom"}return this._imagesBuffer=R[t]({justFirstLine:i,swapSides:this.o.swapSides,axelerate:n,isBackward:e,count:t,row:{length:this.countOfRows,loop:this.o.loopRow,current:this._currentRow,jumpCount:o},column:{length:this.countOfFrames,loop:this.o.loopColumn,current:this._currentColumn,jumpCount:s}}),this._imagesBuffer.length},o.clearFramesQueue=function(){this._imagesBuffer=[]},o.cancelLoadingImage=function(t){var e=this.getImage();e&&(t=this.setImageSettings(t),e.cancelLoadingImage(t))},o.destroy=function(t){this.isAvailableOfLoading=!1,this.resetPreparedImage(),this.clearFramesQueue(),this.images.forEach((function(t){t.forEach((function(t){t.destroy()}))})),this.off("imageOnload"),this.off("imageOnerror"),this.loadingMap={queue:[]},this.imgMap=[],this.images=m([]),this._currentColumn=0,this._currentRow=0,e.prototype.destroy.call(this)},t.createClass(i,[{key:"map",get:function(){return this.imgMap.map((function(t){return t.map((function(t){return!1}))}))}},{key:"countOfImages",get:function(){return this.countOfFrames*this.countOfRows}},{key:"countOfFrames",get:function(){return this.images[0].length||0}},{key:"countOfRows",get:function(){return this.images.length}},{key:"originImageUrl",get:function(){var t=this._currentColumn,e=this._currentRow,i=this.getImage(e,t);return i=i.originUrl}},{key:"startRow",get:function(){return this._startRow}},{key:"startColumn",get:function(){return this._startColumn}},{key:"currentRow",get:function(){return this._currentRow}},{key:"currentColumn",get:function(){return this._currentColumn}},{key:"imagesBuffer",get:function(){return this._imagesBuffer}}]),i}(o)),P="smv",F=function(){"use strict";function t(t,e){this.parentNode=t,this.activeNode=e,this.activatedCurtain=l.$new("div").addClass("spin-activated-curtain").setCss({top:0,left:0,width:"100%",height:"100%",position:"absolute","z-index":999999999}),this.state=0}var e=t.prototype;return e.show=function(){this.state&&(this.activatedCurtain.setCssProp("display","block"),this.activeNode.addClass(P+"-activated"))},e.hide=function(){this.state&&(this.activatedCurtain.setCssProp("display","none"),this.activeNode.removeClass(P+"-activated"))},e.activateCurtain=function(){this.state||(this.state=1,this.activeNode.addClass(P+"-sleeping"),this.parentNode.append(this.activatedCurtain))},e.deactivateCurtain=function(){this.state&&(this.state=0,this.activeNode.removeClass(P+"-sleeping"),this.activatedCurtain.remove())},e.addTapEvents=function(t){var e=this;this.activatedCurtain.addEvent("tap",(function(i){e.state&&(i.action="activate",t(i))})),this.activeNode.addEvent("tap",(function(i){e.state&&(i.action="deactivate",t(i))}))},e.addPinchEvent=function(t){this.activeNode.addEvent("pinch",t)},e.removePinchEvent=function(t){this.activeNode.removeEvent("pinch",t)},e.destroy=function(){this.state=1,this.hide(),this.deactivateCurtain(),this.removePinchEvent(),this.activeNode.removeEvent("tap"),this.activatedCurtain.remove(),this.activatedCurtain.removeEvent("tap"),this.activatedCurtain=null},t}(),L=function(t){t.stopDefaults()};return function(e){"use strict";function o(o,a){var r;return(r=e.call(this,o,a,z)||this).type=i.SLIDE.TYPES.SPIN,r.canvas=null,r.canvasContainer=l.$new("div").addClass("spin-canvas-container"),r.coreNode=l.$new("div").addClass("sirv-spin"),r.instanceNode.append(r.coreNode),r.ctx=null,r.isSmoothing=!1,r.smooseTimeout=null,r.minSizeOfFrame=0,r.minSizeOfRow=0,r.size={width:0,height:0},r.isDragMove=!1,r.longTapTimer=!1,r.imagesMap=null,r.isInited=!1,r.loader=null,r.hint=null,r.openedImg=null,r.scale=1,r.cssId=-1,r.boxBoundaries=null,r.hotspots=null,r.animationFX=null,r.loadedImages=[],r.currentSize={width:0,height:0},r.currentImageSize={width:0,height:0},r.standardSize={width:0,height:0},r.lastImg=null,r.startLoadingTime=null,r.isOver=!1,r.isSpinActivated=!l.browser.mobile,r.canvasPromise=null,r.firstImageLoaded=!1,r.firstPartOfImagesLoaded=!1,r.isInfoLoaded=!1,r.customActionWas=!1,r.isAutoplayPaused=!1,r.reflectDirection=!1,r.configURL=r.instanceNode.attr("data-src")||r.instanceNode.attr("data-config")||"",r.imageBaseURL=n.normalizeURL(r.configURL.replace(/([^#?]+)\/.*$/,"$1/")),r.absoluteURL=r.imageBaseURL.replace(/(^https?:\/\/[^/]*).*/,"$1/"),r.configHash=l.getHashCode(r.configURL.replace(/^http(s)?:\/\//,"")),r.configPath="/"+r.configURL.replace(r.absoluteURL,""),r.imageInfoCallbackName="sirv_spin_image_info_",r.sessionId=l.getHashCode(r.configURL.replace(/^http(s)?:\/\//,"")+l.D.node.location.href.replace(/^http(s)?:\/\//,"")+ +new Date),r.layers={},r.imageSettings={},r.hotspotsData=[],r.fullscreenStartTime=0,r.meta={},r.isFullscreen=a.isFullscreen,r.nativeFullscreen=a.nativeFullscreen,r.infoSettings={},r.autospinResumeTimer=null,r.isHidden=!1,r.sessionStartTime=0,r.animationCloud=null,r.touchDragCloud=null,r.slideDragEventStart=!1,r.dppx=null,r.startTimeForZommEvent=null,r.resizeAnimationTimer=s.debounce((function(){r.animate("inactive")}),1e3),r.keyPressHandlerForShiftButton=null,r.firstUserInteraction=!1,r.userColumn=0,r.userRow=0,r.placeholder=r.instanceNode.node.querySelector("img"),r.placeholder&&(r.placeholder=m(r.placeholder)),r.replaceTextParamURLFromMetadata(),r.trackUnload=function(){r.sendStats("Page Unload",+new Date-r.sessionStartTime,{message:"Stopped"},!0)},r.disableScrollOnMobile=function(){var t=l.D.fullSize,e=r.instanceNode.size;Math.abs(e.height-t.height)<=50?r.instanceNode.addEvent("touchmove",L):r.instanceNode.removeEvent("touchmove",L)},r.resizeWindowTimer=null,r.windowResizeCallback=function(){clearTimeout(r.resizeWindowTimer),r.resizeWindowTimer=setTimeout((function(){r.disableScrollOnMobile()}),10)},r.api=Object.assign(r.api,{isInitialized:r.isInitialized.bind(t.assertThisInitialized(r)),play:r.play.bind(t.assertThisInitialized(r)),pause:r.pause.bind(t.assertThisInitialized(r)),rotate:r.rotateXY.bind(t.assertThisInitialized(r)),rotateX:r.rotateX.bind(t.assertThisInitialized(r)),rotateY:r.rotateY.bind(t.assertThisInitialized(r)),jump:r.jump.bind(t.assertThisInitialized(r)),jumpRows:r.jumpRows.bind(t.assertThisInitialized(r)),jumpCols:r.jumpCols.bind(t.assertThisInitialized(r)),currentFrame:r.currentFrame.bind(t.assertThisInitialized(r))}),r.createHotspotsClass(u),r.getInfo().then((function(){l.browser.mobile&&r.option("tappingFirst")?r.activatedCurtain=new F(r.instanceNode,r.coreNode):r.isSpinActivated=!0,r.createMap(r.quality,r.hdQuality,r.isHDQualitySet)})).catch((function(t){})),r}t.inheritsLoose(o,e);var a=o.prototype;return a.isInitialized=function(){return this.isInited},a.rotateXY=function(t,e){return!(!this.ready||this.isZoomed())&&this.rotate(t,e)},a.rotateX=function(t){return!(!this.ready||this.isZoomed())&&this.rotate(t,null)},a.rotateY=function(t){return!(!this.ready||this.isZoomed())&&this.rotate(null,t)},a.jump=function(t){return this.jumpRows(t)},a.jumpRows=function(t){return!(!this.ready||this.isZoomed())&&this.jumpTo(t,"row")},a.jumpCols=function(t){return!(!this.ready||this.isZoomed())&&this.jumpTo(t,"col")},a.currentFrame=function(){return this.ready?this.getCurrentFrame():null},a.isActive=function(){return this.isSpinActivated},a.makeGlobalOptions=function(t){var e=this._options.options;return t.fromJSON(e.common.common),this.infoSettings&&Object.entries(this.infoSettings).forEach((function(e){["images","hotspots"].includes(e[0])||t.set.apply(t,e)})),t.fromString(e.local.common),t.fromString(this.instanceNode.attr("data-options")||""),t},a.makeOptions=function(){var t;return this._options.options=((t=this._options.options).common||(t.common={}),t.common.common||(t.common.common={}),t.common.mobile||(t.common.mobile={}),t.local||(t.local={}),t.local.common||(t.local.common=""),t.local.mobile||(t.local.mobile=""),t),e.prototype.makeOptions.call(this)},a.sendStats=function(t,e,i,n){var s={account:this.config.account,useBeacon:!!n,event:t,eventTime:e,sessionId:this.sessionId,origin:this.configPath};i&&(s.data=i),this.emit("stats",{data:s})},a.getInfo=function(){var t=this;return this.gettingInfoPromise||(this.gettingInfoPromise=new Promise((function(e,i){t.waitGettingInfo.wait((function(){var n="sirv_spin_info_v1_"+t.configHash,o=t.configURL+(l.stringHas(t.configURL,"?")?"&":"?")+"info="+n;s.getRemoteData(o,n,t.referrerPolicy).then((function(n){t.destroyed||(n.layers?(t.config=n,t.layers=t.config.layers,t.meta=t.config._file.meta||null,t.infoSettings=t.config.settings,t.hotspotsData=t.config.settings.hotspots||[],t.imageSettings=t.config.settings.images.main,t.accountInfo={account:t.config.account,branded:t.config.branded},t.sessionStartTime=+new Date,t.sendStats("sessionStart",t.sessionStartTime),l.W.addEvent("beforeunload",t.trackUnload),e()):n.contentType&&/image/.test(n.contentType)||n._isplaceholder?i({error:"changeSpinToImage",isPlaceholder:n._isplaceholder,account:n.account}):i({error:{status:404}}))})).catch((function(e){t.destroyed||i({error:e})}))}))}))),this.gettingInfoPromise},a.replaceTextParamURLFromMetadata=function(){var t=this;this.imageSettings.text&&this.imageSettings.text.text&&(this.imageSettings.text.text=this.imageSettings.text.text.replace(/\$\{spin\.(title|description)\}/g,(function(e,i){var n=t.meta[i]||"";return"string"==typeof n?n:i})),""===this.imageSettings.text.text&&delete this.imageSettings.text)},a.getDPPX=function(t){var e=t.height>t.width?"height":"width",i={};i[e]=t[e],this.dppx=s.getDPPX(r.roundImageSize(i)[e],this.infoSize[e],this.upscale)},a.showHint=function(){var t=!1;return this.hint&&(this.always&&![i.FULLSCREEN.OPENING,i.FULLSCREEN.OPENED].includes(this.fullscreenState)||this.option("autospin.enable")&&this.firstUserInteraction||(t=!0,this.hint.show())),t},a.onStartActions=function(){this.ready?this.animate("slideIn"):this.isStarted&&(this.isInited&&!this.initNameEvent?this.loadFirstPartOfImages():this.isInView&&this.loadFirstImage())},a.onStopActions=function(){this.zoomOut(),this.stopSmoothing(),this.stopAnimation(),this.deactivateSpin(),this.setUserFrame(),this.customActionWas=!1,this.hint&&this.hint.hide(),e.prototype.onStopActions.call(this)},a.onInView=function(t){t?this.isInView||(this.ready?(this.isInView=!0,this.animate("inView")):(this.preload||this.isSlideShown)&&(this.isInView=!0,this.isInited?this.isSlideShown&&!this.initNameEvent&&this.loadFirstPartOfImages():this.loadFirstImage())):this.isInView&&this.ready&&(this.option("autospin.enable")?this.animationCloud.pause():(this.stopAnimation(),this.setUserFrame()),this.deactivateSpin())},a.startFullInit=function(t){var i=this;this.isStartedFullInit||(e.prototype.startFullInit.call(this,t),this.getInfo().then((function(){i.normalizeOptions(),i.getId("spin-");var t=i.option;i.imagesMap.startFullInit({swapSides:t("swapSides"),startColumn:t("column.start"),startRow:t("row.start"),reverseColumn:t("column.reverse"),reverseRow:t("row.reverse"),loopColumn:t("column.loop"),loopRow:t("row.loop"),rowSpeed:t("row.sensitivity"),columnSpeed:t("column.sensitivity"),columnIncrement:t("column.increment"),rowIncrement:t("row.increment")}),i.loadedImages=i.imagesMap.map,i.loader=new c(i.coreNode,{max:i.imagesMap.countOfImages,class:"spin-loader"}),i.loader.parentClass=i,i.coreNode.addEvent(["btnclick","tap"],(function(t){t.stop()})),i.on("isSingleSlide",(function(t){t.stop(),i.activatedCurtain&&(t.data.isSingle?i.activatedCurtain.deactivateCurtain():i.activatedCurtain.activateCurtain())})),i.hotspots&&(i.hotspots.Options={columnsRevers:i.option("column.reverse"),rowsRevers:i.option("row.reverse"),rows:i.imagesMap.countOfRows,columns:i.imagesMap.countOfFrames}),i.initAnimation()})).catch((function(){})),l.browser.touchScreen&&this.on("dragEvent",(function(t){"dragstart"===t.data.type?(i.slideDragEventStart=!0,i.touchDragCloud&&i.touchDragCloud.removeEvent()):"dragend"===t.data.type&&(i.slideDragEventStart=!1,i.touchDragCloud&&i.touchDragCloud.addEvent())})))},a.getThumbnailData=function(t){return this.imagesMap.getThumbnail(t)},a.setUserFrame=function(){this.jumpTo(this.userRow,"row"),this.jumpTo(this.userColumn,"col")},a.getSocialButtonData=function(t,i){return i?this.instanceNode.attr("data-src"):e.prototype.getSocialButtonData.call(this,t)},a.turnOnOff=function(){var t=this;l.browser.mobile&&this.activatedCurtain&&this.activatedCurtain.addTapEvents((function(e){"activate"===e.action?(t.isSpinActivated||(e.stop(),t.activateSpin()),t.hotspots&&t.hotspots.hideActiveHotspotBox(!0)):t.isSpinActivated&&(e.stop(),t.stopSmoothing(),t.stopAnimation(),t.hotspots&&t.hotspots.isHotspotActivated()?t.hotspots.hideActiveHotspotBox(!0):t.deactivateSpin())}))},a.activateSpin=function(){this.isSpinActivated||(this.isSpinActivated=!0,l.browser.mobile&&(this.stopAnimation(),this.customActionWas=!0,this.hint&&this.hint.hide(),this.activatedCurtain&&this.activatedCurtain.hide()))},a.deactivateSpin=function(){this.isSpinActivated&&(this.isSpinActivated=!1,l.browser.mobile&&(this.customActionWas||this.showHint(),this.activatedCurtain&&this.activatedCurtain.show()))},a.createPinchEvent=function(){var t,n,s,o,a,r,h,c,u,m=this,d=function(){a=1,r=1,s=m.zoom.baseScale.x,h=1,c=s,t=1-s};e.prototype.createPinchEvent.call(this,this.coreNode),this.pinchCloud.onPinchStart=function(t){[i.FULLSCREEN.OPENING,i.FULLSCREEN.CLOSING].includes(m.fullscreenState)||(m.pinchCloud.pinch=!0,clearTimeout(m.longTapTimer),m.stopSmoothing(),m.stopAnimation(),m.touchDragCloud&&m.touchDragCloud.removeEvent(),m.hotspots&&m.hotspots.hideActiveHotspotBox(!0),m.customActionWas=!0,u=!1,m.pinchCloud.scale=t.scale,o=1,m.openedImg&&(o=m.zoom.scale.x,s===l.U&&d(),o/=s),m.sendEvent("pinchStart"))},this.pinchCloud.onPinchResize=function(t){m.pinchCloud.pinch&&!m.pinchCloud.block&&m.zoom&&m.fullscreenState===i.FULLSCREEN.OPENED&&m.openedImg&&(m.pinchCloud.scale=t.scale,m.zoom.basePercent=t.centerPoint)},this.pinchCloud.onPinchMove=function(e){m.pinchCloud.pinch&&!m.pinchCloud.block&&(m.fullscreenState!==i.FULLSCREEN.OPENED&&m.isFullscreenEnabled?e.scale>=2&&(m.pinchCloud.block=!0,m.sendEvent("fullscreenIn")):m.openedImg?m.zoom&&(u?(n=e.scale,h<(n*=s)&&(c=s,r=1,a=t/((h=n)-s)),c>n&&(h=1,a=1,r=s/(c=n)),n=(s+((n*=o)-s)*a)*r,m.zoom.setScale(n,e.centerPoint.x,e.centerPoint.y)):(u=!0,m.zoom.basePercent=e.centerPoint),m.pinchCloud.scale=e.scale):e.scale>1.1?(m.firstUserInteraction=!0,m.openLens(e.centerPoint.x,e.centerPoint.y,!1,"zero"),d(),o=1):e.scale<.2&&(m.pinchCloud.block=!0,m.sendEvent("fullscreenOut")))},this.pinchCloud.onPinchEnd=function(t){m.pinchCloud.pinch&&(m.pinchCloud.pinch=!1,m.openedImg&&m.activateSpin(),setTimeout((function(){m.touchDragCloud&&m.touchDragCloud.addEvent()}),16),m.sendEvent("pinchEnd")),m.openedImg&&m.pinchCloud.removeEvent(),m.pinchCloud.block=!1,m.pinchCloud.scale=0}},a.onStopContext=function(){this.stopSmoothing(),this.stopAnimation(),this.hint&&this.hint.hide()},a.onSecondSelectorClick=function(){this.zoomOut()},a.setGlobalEvents=function(){var t=this;this.on("zoomUp",(function(e){var i=e.data;e.stop(),t.ready&&t.zoom&&!t.isDragMove&&t.isFullscreenActionEnded()&&(t.firstUserInteraction=!0,t.openLens(i.x,i.y))})),this.on("zoomDown",(function(e){e.stop(),t.ready&&t.zoom&&t.isZoomed()&&t.zoom.hide()}))},a.normalizeOptions=function(){var t=this;this.option("autospin.enable")||this.option("autospin.duration",0),this.option("swapSides")&&["start","loop","increment","reverse","sensitivity"].forEach((function(e){var i=t.option("row."+e);t.option("row."+e,t.option("column."+e)),t.option("column."+e,i)})),["onStart","onVisible","onInactive"].forEach((function(e){var i="hint."+e+".effect";"none"===t.option(i)&&t.option(i,!1)})),l.browser.mobile&&"load"!==this.option("initialize")&&this.option("initialize","tap"),this.setDefaultZoomOptions(),this.option("zoom.enable")&&"max"!==this.option("zoom.ratio")&&this.option("zoom.ratio")<i.MIN_RATIO&&this.option("zoom.enable",!1)},a.setDefaultZoomOptions=function(){e.prototype.setDefaultZoomOptions.call(this),this.defaultZoomOptions=Object.assign(this.defaultZoomOptions,{tiles:this.option("zoom.tiles"),pan:this.option("zoom.pan"),trigger:l.browser.mobile?"dblclick":"click",type:"inner",height:"auto"})},a.loadFirstPartOfImages=function(){this.firstPartOfImagesLoaded||(this.firstPartOfImagesLoaded=!0,this.startLoadingTime=+new Date,this.imagesMap.loadFirstPartOfImages({width:this.currentImageSize.width,height:this.currentImageSize.height,dppx:this.dppx}),this.loader&&this.loader.show())},a.isThumbnailGif=function(){return"gif"===this.option("thumbnail.type")},a.init=function(){var t=this;if(this.infoSize&&!this.isInited){switch(this.isInited=!0,this.initNameEvent=null,this.initFnEvent=function(e){e.stop(),t.coreNode.removeEvent(e.type,t.initFnEvent),t.activatedCurtain&&t.activatedCurtain.activatedCurtain.removeEvent(t.initNameEvent,t.initFnEvent),t.loadFirstPartOfImages()},this.option("initialize")){case"hover":this.initNameEvent="mouseover";break;case"click":this.initNameEvent="btnclick";break;case"tap":this.initNameEvent="tap"}this.initNameEvent?(this.coreNode.addEvent(this.initNameEvent,this.initFnEvent),this.activatedCurtain&&this.activatedCurtain.activatedCurtain.addEvent(this.initNameEvent,this.initFnEvent),this.loadFirstImage()):this.isInView&&this.isSlideShown&&this.loadFirstPartOfImages(),this.sendEvent("init")}},a.run=function(t,i,n){var s=e.prototype.run.call(this,t,i,n);return s&&(l.W.addEvent("resize",this.windowResizeCallback),this.initCanvas(),this.startGettingInfo()),s},a.initCanvas=function(){this.canvas=l.$new("canvas"),this.canvas.node.getContext&&(this.ctx=this.canvas.node.getContext("2d"));var t=this.rightAlt;t&&(this.canvas.attr("role","img"),this.canvas.attr("aria-label",t),this.canvas.attr("alt",t));var e=this.infoSize.width,i=this.infoSize.height,n=this.coreNode.size;e<n.width&&(e=n.width),i<n.height&&(i=n.height),0===n.height&&(this.cssId=l.addCSS("#"+this.id+" .smv-spin:before",{"padding-top":this.infoSize.height/this.infoSize.width*100+"%"},this.id+"-css"),n.height=n.width*(this.infoSize.height/this.infoSize.width)),this.currentSize=s.spinLib.calcProportionSize(n,this.infoSize),this.getDPPX(this.currentSize),this.standardSize.width=this.currentSize.width,this.standardSize.height=this.currentSize.height,this.setImageSize(),this.canvas.setCss({top:"0",left:"0",zIndex:10,position:"absolute"}),this.setCanvasSize(),this.canvasContainer.append(this.canvas),this.coreNode.append(this.canvasContainer),this.isInView&&(this.preload||this.isSlideShown)&&this.loadFirstImage()},a.loadContent=function(){this.loadFirstImage()},a.loadFirstImage=function(){if(!this.firstImageLoaded&&this.isInfoLoaded){if(this.currentImageSize.width&&this.currentImageSize.height||(this.currentSize=s.spinLib.calcProportionSize(this.coreNode.size,this.infoSize),this.getDPPX(this.currentSize),this.currentSize.width&&this.currentSize.height&&(this.setImageSize(),this.isStarted&&this.currentImageSize.width&&this.currentImageSize.height&&(this.setCanvasSize(),this.draw()))),!this.currentImageSize.width||!this.currentImageSize.height)return;this.waitToStart.start(),this.firstImageLoaded=!0,this.imagesMap.loadFirstImage({width:this.currentImageSize.width,height:this.currentImageSize.height,dppx:this.dppx})}},a.createMap=function(t,e,i){var n=this,s=this.option,o=null;s("autospin.enable")?o=s("autospin.type"):s("hint.onStart.enable")&&s("hint.onStart.effect")&&(o=s("hint.onStart.effect")),this.imagesMap=new M({url:this.configURL,imageSettings:this.imageSettings,layers:this.layers,swapSides:s("swapSides"),startColumn:s("column.start"),startRow:s("row.start"),reverseColumn:s("column.reverse"),reverseRow:s("row.reverse"),loopColumn:s("column.loop"),loopRow:s("row.loop"),rowSpeed:s("row.sensitivity"),columnSpeed:s("column.sensitivity"),columnIncrement:s("column.increment"),rowIncrement:s("row.increment"),loadingSchema:o,quality:t,hdQuality:e,isHDQualitySet:i,referrerPolicy:this.referrerPolicy}),this.imagesMap.parentClass=this,this.userColumn=this.imagesMap.startColumn,this.userRow=this.imagesMap.startRow,this.on("mapFirstImageLoaded",(function(t){if(t.stopAll(),n.placeholder&&n.placeholder.setCssProp("display","none"),n.isInited||(n.firstImageLoaded&&(n.draw(),n.canvas.setCssProp("transition","none"),n.canvas.render(),n.canvas.setCssProp("transition","")),n.loader&&n.loader.progress(),n.setCanvas().finally((function(){n.init()}))),n.hotspots){var e=n.imagesMap.getCurrentImage({width:n.currentSize.width,height:n.currentSize.height});n.hotspots.setFramePosition(e.row,e.col),n.hotspots.updateAndShow(),n.isInView&&n.isSlideShown&&n.hotspots.showNeededElements()}})),this.on("mapImagesReady",(function(t){t.stopAll(),n.imagesMap.loadOtherImages({width:n.currentImageSize.width,height:n.currentImageSize.height,dppx:n.dppx}),n.calcMinSizeForDrag();var e=+new Date;n.sendStats("framesPreloaded",e-n.sessionStartTime,{duration:e-n.startLoadingTime}),n.done(),n.sendContentLoadedEvent()})),this.on("mapImageLoaded",(function(t){t.stopAll(),n.loader&&(n.loadedImages[t.data.row][t.data.col]||(n.loadedImages[t.data.row][t.data.col]=!0,n.loader.progress())),t.data.error||t.data.isCurrent&&(t.data.callbackData.lens?n.zoom&&(n.zoom.shown||n.zoom.showing)&&n.openedImg&&n.openedImg.col===t.data.col&&n.openedImg.row===t.data.row&&n.zoom.addLoadedImage(t.data):n.lastImg&&(n.lastImg.width!==t.data.width||n.lastImg.height!==t.data.height)&&n.firstImageLoaded&&n.draw())})),this.on("mapAllImagesLoaded",(function(t){t.stopAll();var e=+new Date;n.sendStats("framesLoaded",e-n.sessionStartTime,{duration:e-n.startLoadingTime}),n.loader&&2!==n.loader.getProgressState()&&n.loader.hide()})),this.on("frameChange",(function(t){t.stop(),n.ready&&n.sendEvent("frameChange",{row:t.data.row,column:t.data.column})})),this.imagesMap.loadImageInfo().then((function(t){n.isInfoLoaded=!0;var e=Object.assign({},t.size);n.infoSize=e,n.hotspots&&(n.hotspots.originImageSize=n.infoSize)})).catch((function(t){n.isInfoLoaded=!0}))},a.getSelectorImgUrl=function(t){var e=this;return new Promise((function(i,n){e.getInfo().then((function(){e.imagesMap.loadImageInfo().then((function(n){e.waitToStart.wait((function(){var n=e.imagesMap.setImageSettings({dppx:e.dppx});n.src&&(t.src=n.src),t.srcset=n.srcset,"gif"===e.option("thumbnail.type")&&(t.originUrl=e.configURL.split("?")[0],t.imageSettings={image:24},e.option("thumbnail.gifParams")&&(t.imageSettings=s.paramsFromQueryString(e.option("thumbnail.gifParams")))),i(Object.assign(e.imagesMap.getThumbnail(t),{alt:e.rightAlt}))}))})).catch(n)})).catch(n)}))},a.getInfoSize=function(){var t=this;return new Promise((function(e,i){t.getInfo().then((function(){t.imagesMap.loadImageInfo().then(e).catch(i)})).catch(i)}))},a.onHotspotActivate=function(t){this.customActionWas=!0,this.stopAnimation(),e.prototype.onHotspotActivate.call(this,t)},a.onHotspotDeactivate=function(t){e.prototype.onHotspotDeactivate.call(this,t),this.animateWithDelay()},a.createHint=function(){if(this.option("hint.message.enable")){var t='<div class="spin-hint-animation"></div>',e=["spin-hint-horizontal-animation"],i=["spin-hint-vertical-animation"],n=[];switch(t+="<span>",t+=this.option("hint.message.text"),t+="</span>",this.imagesMap.getHintType()){case"multi-row":n=e.concat(i);break;case"row":n=e;break;case"col":n=i}var s={html:t,additionalClass:n};(l.browser.mobile||this.option("autospin.enable"))&&(s.autohide=0),this.hint=new h(this.coreNode,s),this.isSlideShown&&this.isInView&&"infinite"===this.option("autospin.type")&&this.showHint()}},a.createZoom=function(){var t=this,i=null;return!this.destroyed&&this.option("zoom.enable")&&(i=e.prototype.createZoom.call(this,this.coreNode,{}),this.zoomContainer&&(this.zoom.lensContainer=this.zoomContainer),this.coreNode.addEvent(["btnclick","dbltap"],(function(e){t.isFullscreenActionEnded()&&(t.firstUserInteraction=!0,t.openLens(e.x,e.y))})),l.browser.mobile),i},a.onZoomGetImage=function(t){e.prototype.onZoomGetImage.call(this,t),this.checkImage(t.data,t.data.dontLoad)?this.zoom.addLoadedImage(this.imagesMap.getCurrentImage(t.data)):this.imagesMap.loadImage(t.data)},a.onZoomCancelLoadingOfTiles=function(t){e.prototype.onZoomGetImage.call(this,t),t.data.round=!1,this.imagesMap.cancelLoadingImage(t.data)},a.onZoomBeforeShow=function(t){this.canvas.addClass(this.zoomClassName),this.hotspots&&this.hotspots.hideAll()},a.onZoomShown=function(t){this.isSlideShown?(this.startTimeForZommEvent=+new Date,this.openedImg&&this.sendStats("zoomIn",+new Date-this.sessionStartTime,{frame:{row:this.openedImg.row,column:this.openedImg.col},clientX:t.data.clientPosition.x,clientY:t.data.clientPosition.y,pageX:t.data.pagePosition.x,pageY:t.data.pagePosition.y}),this.sendEvent("zoomIn")):this.zoom.hide(!0)},a.onZoomHidden=function(t){if(this.openedImg){this.canvas.removeClass(this.zoomClassName);var e=+new Date;this.sendStats("zoomOut",e-this.sessionStartTime,{duration:e-this.startTimeForZommEvent,frame:{row:this.openedImg.row,column:this.openedImg.col},clientX:t.data.clientPosition.x,clientY:t.data.clientPosition.y,pageX:t.data.pagePosition.x,pageY:t.data.pagePosition.y}),this.hotspots&&(this.hotspots.showAll(),this.isInView&&this.isSlideShown&&this.hotspots.showNeededElements())}this.sendEvent("zoomOut"),this.isSlideShown&&this.animateWithDelay(),this.startTimeForZommEvent=null,this.openedImg=null,this.pinchCloud&&this.pinchCloud.addEvent()},a.setLongTapEvents=function(){var t=this,e=l.W.node.navigator.pointerEnabled,i=!1,n=!1,s=["touchstart"];e?s.push("pointerdown"):s.push("MSPointerDown"),this.coreNode.addEvent(s,(function(e){t.isDragMove||t.pinchCloud.pinch||!t.isFullscreenActionEnded()||(clearTimeout(t.longTapTimer),t.longTapTimer=setTimeout((function(){e.stop(),i=!0,t.customActionWas=!0;var n=e.pageXY;t.touchDragCloud&&t.touchDragCloud.removeEvent(),t.firstUserInteraction=!0,t.openLens(n.x,n.y,!0)}),500),n=!0)})),s=["touchmove"],e?s.push("pointermove"):s.push("MSPointerMove"),this.coreNode.addEvent(s,(function(e){if(i&&t.isFullscreenActionEnded()){e.stop();var n=e.pageXY;t.zoom.customMove(n.x,n.y)}}),1),s=["touchend"],e?s.push("pointerup"):s.push("MSPointerUp"),this.coreNode.addEvent(s,(function(e){n&&(e.stop(),n=!1,clearTimeout(t.longTapTimer)),i&&t.isFullscreenActionEnded()&&(e.stop(),i=!1,t.zoom.hide(!0),t.touchDragCloud&&t.touchDragCloud.addEvent())}))},a.openLens=function(t,e,i,n){var s=!1;if(this.isZoomSizeExist()){var o=this.zoomSize;s=!0,this.stopSmoothing(),this.stopAnimation(),this.hint&&this.hint.hide(),this.hotspots&&this.hotspots.hideActiveHotspotBox(!0);var a,r,h=!1;this.isFullscreenActionEnded()&&this.imagesMap.isLoaded({width:this.currentImageSize.width,height:this.currentImageSize.height})?(a=this.currentImageSize.width,r=this.currentImageSize.height,h=!0):(a=this.lastImg.serverWidth,r=this.lastImg.serverHeight);var c=this.imagesMap.getCurrentImage({width:a,height:r,round:h});this.openedImg=c,s=void 0===t?this.zoom.showCenter(c.node,o):this.zoom.show(c.node,o,t,e,i,n)}return s},a.done=function(){var t=this.imagesMap.countOfRows,s=this.imagesMap.countOfFrames;if(this.loader&&this.loader.setMaxOpacity(.5),this.setBrowserEvents(),this.createHint(),this.createZoom(),this.setZoomEvents(),t>1&&s>1?this.coreNode.setCssProp("touch-action","none"):t>1?this.coreNode.setCssProp("touch-action","pan-x"):this.coreNode.setCssProp("touch-action","pan-y"),this.boxBoundaries=this.coreNode.rect,this.animate("start"),this.accountInfo.branded){var o=n.getNodeWithSirvClassName(this.instanceNode)||l.D.node.head||l.D.node.body;n.rootDOM.showSirvAd(o,this.instanceNode,"https://sirv.com/about-spin/?utm_source=client&utm_medium=sirvembed&utm_content=typeofembed(spin)&utm_campaign=branding","360-degree viewer by Sirv")}this.sendStats("viewerReady",+new Date-this.sessionStartTime,{rows:this.imagesMap.countOfRows,columns:this.imagesMap.countOfFrames,viewerSize:{width:this.currentSize.width,height:this.currentSize.height}}),this.isZoomSizeExist()&&this.coreNode.addClass(i.CSS_CURSOR_ZOOM_IN),this.setGlobalEvents(),this.turnOnOff(),e.prototype.done.call(this),this.hotspots&&(this.hotspots.instanceComponentNode=this.canvasContainer,this.hotspots.containerSize=this.canvasContainer.node.getBoundingClientRect())},a.setBrowserEvents=function(){this.setDrag(this.coreNode),this.setMouseWheel(this.coreNode)},a.setCanvas=function(){var t=this;if(!this.canvasPromise){var e,i,n=null;this.canvasPromise=s.makeQueryblePromise(new Promise((function(s,o){e=s,t.firstImageLoaded&&t.draw(),t.isInView&&t.isSlideShown?(n=setTimeout((function(){t.canvas&&t.canvas.removeEvent("transitionend",i),s()}),1100),i=function(e){"opacity"===e.propertyName&&(e.stop(),clearTimeout(n),t.canvas.removeEvent(e.type,i),s())},t.canvas.addEvent("transitionend",i),t.canvas.render(),t.canvas.addClass(P+"-shown")):(t.canvas.addClass(P+"-shown"),s())}))),this.canvasPromise.resolve=function(){t.canvas.removeEvent("transitionend",i),e()}}return this.canvasPromise},a.clearCanvas=function(){this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},a.draw=function(t){if(this.ctx){var e=t||this.currentImageSize,i={width:e.width,height:e.height,maxSize:!0,dppx:this.dppx},n=this.imagesMap.getCurrentImage(i);if(this.lastImg=n,!n)return;this.ctx.imageSmoothingQuality="high",this.hotspots&&this.hotspots.changeHotspotsPosition(n.row,n.col),this.clearCanvas(),this.canvas.node.width=n.node.node.width,this.canvas.node.height=n.node.node.height,this.ctx.drawImage(n.node.node,0,0,this.canvas.node.width,this.canvas.node.height)}},a.setCanvasSize=function(){var t=this.currentSize;this.canvas.setCss({width:t.width,height:t.height}),this.canvasContainer.setCss({width:t.width,height:t.height}),this.canvas.width=t.width,this.canvas.height=t.height},a.calcMinSizeForDrag=function(){var t=this.currentSize;this.minSizeOfFrame=this.imagesMap.pixelPerFrame(t.width),this.minSizeOfRow=this.imagesMap.pixelPerRow(t.height)},a.smoothing=function(t,e,i){var n=this;if(e){var s=t/e,o=function(){s*=.97,n.smooseTimeout=setTimeout((function(){n.imagesMap.prepareFutureImage(i),n.imagesMap.setPreparedFutureImage(),n.draw(),s>.3&&o()}),n.minSizeOfFrame/s)};this.isSmoothing||(this.isSmoothing=!0,o())}},a.stopSmoothing=function(){this.isSmoothing&&(this.isSmoothing=!1,clearTimeout(this.smooseTimeout),this.smooseTimeout=null,this.imagesMap.resetPreparedImage())},a.animateWithDelay=function(t){var e=this,i="inactive";t&&(i=t),this.option("autospin.enable")?(clearTimeout(this.autospinResumeTimer),this.autospinResumeTimer=setTimeout((function(){e.animate(i)}),this.option("autospin.resume"))):this.animate(i)},a.setDrag=function(t){var e=this,n=this.imagesMap.countOfRows,o=this.imagesMap.countOfFrames,a=n>1&&o>1,r={x:{minSize:this.minSizeOfFrame,count:o},y:{minSize:this.minSizeOfRow,count:n}},h=this.option("freeDrag"),c={x:0,y:0},u={x:0,y:0},l=null;a||(l=o>1?"x":"y");var m,d,p,g=null,f={},v={x:{next:0,prev:0},y:{up:0,down:0}},w=!1,S=s.debounce((function(){w=!1}),50),I=65e-5,y={x:I*o*9.8,y:I*n*9.8},C={x:["prev","next"],y:["down","up"]};!a&&h&&(o>1?C.y=C.x:C.x=C.y);var b=function(t){clearTimeout(e.longTapTimer),f[t.state](t)},x=function(t,e,i,n){v[t][n]+=i},z=function(t){var e=v[t],i="x"===t?["next","prev"]:["up","down"];return e[i[0]]>e[i[1]]?{distance:e[i[0]],direction:i[0]}:{distance:e[i[1]],direction:i[1]}},E=function(t,e,i,n,s){var o;return o=e*Math.pow(i/n,2)/(2*t),o=Math.floor(o/s)},R=function(t,e,i,n){return e*(i/n)/t},O=function(t,e){return C[e][t>=0?0:1]};f.dragstart=function(t){e.firstUserInteraction=!0,e.isDragMove=!0,e.stopSmoothing(),e.stopAnimation(),e.hint&&e.hint.hide(),e.hotspots&&e.hotspots.hideNeededElements(!0),e.userColumn=e.imagesMap.startColumn,e.userRow=e.imagesMap.startRow,e.fullscreenState===i.FULLSCREEN.OPENED&&t.stop(),c.x=t.x,c.y=t.y,g=t.timeStamp,p=+new Date;var n=+new Date-e.sessionStartTime;e.sendStats("dragStart",n,{clientX:t.x-e.boxBoundaries.left,clientY:t.y-e.boxBoundaries.top,pageX:t.x,pageY:t.y}),e.sendEvent("spinStart"),e.sendEvent("rotate"),e.sendStats("rotate",n,{}),e.pinchCloud.removeEvent()},f.dragend=function(t){var i,n,s,f,I,C=[];if(e.isDragMove){t.stop(),e.isDragMove=!1,S.cancel(),w&&l===m||w&&(a||h)?(i=+new Date-p,n=z(m),s=E(y[m],o,n.distance,i,r[m].minSize),f=R(y[m],o,n.distance,i),C.push({items:s,direction:n.direction}),a&&(n=z(d),s=E(y[d],o,n.distance,i,r[d].minSize),(I=R(y[d],o,n.distance,i))>f&&(f=I),C.push({items:s,direction:n.direction})),e.animateTo(f,C),e.pinchCloud.addEvent()):(e.hotspots&&e.isInView&&e.isSlideShown&&e.hotspots.showNeededElements(),e.animateWithDelay()),e.sendEvent("spinEnd");var b=+new Date;e.sendStats("dragEnd",b-e.sessionStartTime,{duration:b-p,clientX:t.x-e.boxBoundaries.left,clientY:t.y-e.boxBoundaries.top,pageX:t.x,pageY:t.y}),c={x:0,y:0},g=null,u={x:0,y:0},v={x:{next:0,prev:0},y:{up:0,down:0}},w=!1}};var M=function(t,i){var n=!1;if(u[t]>r[t].minSize){n=!0;var s=Math.floor(u[t]/r[t].minSize);u[t]=u[t]%r[t].minSize,e.imagesMap.prepareFutureImage(i,s),e.imagesMap.setPreparedFutureImage()}return n};f.dragmove=function(t){var s={},r={x:0,y:0},p={x:0,y:0};e.isDragMove&&(w=!0,e.customActionWas=!0,r.x=t.x-c.x,r.y=t.y-c.y,p.x=Math.abs(r.x),p.y=Math.abs(r.y),t.timeStamp-g,g=t.timeStamp,m=p.x>=p.y?"x":"y",d="x"===m?"y":"x",(e.fullscreenState===i.FULLSCREEN.OPENED||a||h||"x"===m&&o>1||"y"===m&&n>1)&&t.stop(),s[m]=O(r[m],m),s[d]=O(r[d],d),x(m,0,p[m],s[m]),x(d,0,p[d],s[d]),a||h?(u.x+=p.x,u.y+=p.y):l&&(l===m&&"x"===l?u.x+=p.x:l===m&&"y"===l&&(u.y+=p.y)),M(m,s[m])&&h&&(u[d]=0),a&&M(d,s[d]),e.userColumn=e.imagesMap.currentColumn,e.userRow=e.imagesMap.currentRow,c.x=t.x,c.y=t.y,e.draw(),S())};var P={eventAdded:!1,addEvent:function(){P.eventAdded||(P.eventAdded=!0,t.addEvent(["mousedrag","touchdrag"],b))},removeEvent:function(){P.eventAdded&&(P.eventAdded=!1,t.removeEvent(["mousedrag","touchdrag"],b))}};this.touchDragCloud=P,this.slideDragEventStart||this.touchDragCloud.addEvent()},a.animateTo=function(t,e){var i=this,n=[],s=[],o={};clearTimeout(this.autospinResumeTimer),this.animationFX&&this.animationFX.stop();for(var a=0,r=e.length;a<r;a++)s.push(e[a].direction),n.push(0),o[e[a].direction]=[0,e[a].items];this.animationFX=new l.FX(l.$new("div"),{duration:Math.abs(t),transition:l.FX.getTransition().inCubic,onBeforeRender:m((function(t,e){var s,o;for(s=0;s<t.length;s++)o=Math.round(e[t[s]]),n[s]!==o&&(i.imagesMap.prepareFutureImage(t[s],o-n[s]),i.imagesMap.setPreparedFutureImage(),i.userColumn=i.imagesMap.currentColumn,i.userRow=i.imagesMap.currentRow,n[s]=o);i.draw()})).bind(this,s),onComplete:function(){i.stopAnimation(),i.animateWithDelay(),i.hotspots&&i.isInView&&i.isSlideShown&&i.hotspots.showNeededElements()}}).start(o)},a.setMouseWheel=function(t){var e,i,n=this,o=0,a=!1,r=s.debounce((function(t){a=!1,n.sendEvent("spinEnd"),t?o=0:n.animateWithDelay()}),200),h=this.imagesMap.countOfRows,c=this.imagesMap.countOfFrames,u=h>1&&c>1,m=this.option("freeDrag");if(this.option("wheel")){var d=!1;this.keyPressHandlerForShiftButton=function(t){16===t.oe.keyCode&&(d="keydown"===t.type)},l.W.addEvent(["keydown","keyup"],this.keyPressHandlerForShiftButton),t.addEvent("mousescroll",(function(t){n.firstUserInteraction=!0;var s=!!t.isMouse&&d,c=Math.abs(t.deltaY)<Math.abs(t.deltaX);(c||u||m)&&(n.customActionWas=!0,t.stop(),n.animationFX&&(n.animationFX.stop(),n.animationFX=null),n.stopSmoothing(),n.stopAnimation(),n.hotspots&&n.hotspots.hideActiveHotspotBox(),a||(a=!0,n.sendEvent("spinStart"),n.sendEvent("rotate"),n.sendStats("rotate",+new Date-n.sessionStartTime,{})),c?(e=t.deltaX,i=e>=0?"next":"prev"):(e=t.deltaY,i=h>1&&!s?e>=0?"down":"up":e>=0?"next":"prev"),t.isMouse?(e=e/Math.abs(e)*3,o+=Math.abs(e),n.animateTo(200,[{direction:i,items:o}])):(o+=e*=.14814814814814814,Math.abs(o)>1&&(e=parseInt(o,10),o-=e,n.imagesMap.prepareFutureImage(i,Math.abs(e)),n.imagesMap.setPreparedFutureImage(),n.draw())),r(t.isMouse))}))}},a.animate=function(t,e,i,n){var s=this,o="autoplay"===t||this.option("autospin.enable");if(this.isInView&&this.isSlideShown&&!this.animationCloud.isMoving()&&!this.isDragMove&&(!this.customActionWas||o||n)&&!this.openedImg)if(this.animationCloud.isPaused())this.animationCloud.resume();else{clearTimeout(this.animationCloud.hintTimer),clearTimeout(this.autospinResumeTimer);var a=!1,r=null;if(o){if(this.isAutoplayPaused)return;r="as-"+(i||this.option("autospin.type")),"start"!==t&&(a=!0)}else{var h;switch(t){case"start":h="onStart";break;case"inView":case"slideIn":h="onVisible";break;case"inactive":a=!0,h="onInactive";break;default:r=t}if(h&&this.option("hint."+h+".enable")){var c=this.option("hint."+h+".effect");c&&(r=c)}}this.animationCloud.start({speed:e||this.option("autospin.duration"),type:r,infinite:o,delay:a,isBackward:this.reflectDirection,userInteraction:n},(function(){var t=s.showHint();s.hotspots&&s.isInView&&s.isSlideShown&&s.hotspots.showNeededElements(),s.option("hint.onInactive.enable")&&(t?s.animationCloud.hintTimer=setTimeout((function(){s.animationCloud.hintTimer=null,s.animate("inactive")}),s.hint.movingTime):s.animate("inactive"))}))}},a.initAnimation=function(){var t,e,i=this,n=!1,s=!1,o=!1,a=null,r=null,h=0,c=null,u=this.imagesMap.countOfFrames;this.option("swapSides")&&(u=this.imagesMap.countOfRows);var l=function(){n=!1,h=0,c&&c()},m=function(){var n=i.imagesMap.getNextBufferIndex(h);n||e.infinite?(!n&&e.infinite&&(n=1,h=e.infinite?-1:0),h+=n,i.imagesMap.setNextAnimationFrame(h),a=setTimeout((function(){i.imagesMap.setPreparedNextImage(),i.draw(),m()}),n*t)):l()},d={hintTimer:null,isMoving:function(){return n},isPaused:function(){return s},start:function(s,a){if(!n){n=!0,o=!1;var h=function(){if(r=null,e.type){if(!i.imagesMap)return;if(i.imagesMap.createAnimation(e.type,e.isBackward),e.userInteraction&&i.imagesMap.imagesBuffer&&i.imagesMap.imagesBuffer.length){var n=i.imagesMap.imagesBuffer[i.imagesMap.imagesBuffer.length-1];i.userColumn=n.col,i.userRow=n.row}t=e.speed/u,e.infinite&&i.showHint(),m()}else l()};c=a,(e=Object.assign({speed:3600,type:"row",delay:!1,infinite:!1,isBackward:!1,userInteraction:!1},s)).speed=function(t,e){var i=t;if(!i)switch(e){case"intro":i=3600;break;case"twitch":i=2200;break;case"spin":i=3600;break;case"momentum":i=10;break;default:i=3600}return i}(e.speed,e.type),e.delay&&!e.infinite?r=setTimeout(h,i.option("inactivity")):h()}},resume:function(){s&&(n=!0,s=!1,m())},pause:function(){s||o||(n=!1,s=!0,clearTimeout(d.hintTimer),clearTimeout(r),clearTimeout(a))},stop:function(){d.pause(),o=!0,s=!1,h=0,c=null,i.imagesMap.clearFramesQueue(),i.imagesMap.resetPreparedImage()}};this.animationCloud=d},a.stopAnimation=function(){this.animationFX&&(this.animationFX.stop(),this.animationFX=null),clearTimeout(this.autospinResumeTimer),this.animationCloud&&this.animationCloud.stop()},a.onBeforeFullscreenIn=function(t){this.stopSmoothing(),this.stopAnimation(),this.zoom&&this.zoom.hide(!0),this.deactivateSpin(),this.boxBoundaries=this.coreNode.rect,e.prototype.onBeforeFullscreenIn.call(this,t),this.hotspots&&this.hotspots.hideAll(),this.isInited&&this.isInView&&this.isSlideShown&&(this.isHidden=!0,this.canvas.setCss({opacity:0,visibility:"hidden"}))},a.onAfterFullscreenIn=function(t){var e=this;if(this.infoSize){this.canvasPromise&&this.canvasPromise.isPending()&&this.canvasPromise.resolve();var n=this.coreNode.size;this.currentSize=s.spinLib.calcProportionSize(n,this.infoSize,!0,this.standardSize),this.getDPPX(this.currentSize),this.setImageSize(),this.setCanvasSize(),this.ready&&(this.imagesMap.isImagesExist({width:this.currentImageSize.width,height:this.currentImageSize.height})||this.imagesMap.loadImages({width:this.currentImageSize.width,height:this.currentImageSize.height,dppx:this.dppx})),this.firstImageLoaded&&this.draw(),this.isHidden&&(this.isHidden=!1,setTimeout((function(){e.canvas.setCss({opacity:"",visibility:""})}),0)),this.hotspots&&this.fullscreenState===i.FULLSCREEN.OPENED&&(this.hotspots.showAll(),this.isInView&&this.isSlideShown&&this.hotspots.showNeededElements()),this.ready&&(this.animate("inactive"),l.browser.mobile||this.showHint(),this.fullscreenStartTime=+new Date,this.sendStats("fullscreenOpen",+new Date-this.sessionStartTime))}},a.onBeforeFullscreenOut=function(t){this.stopSmoothing(),this.stopAnimation(),this.zoom&&this.zoom.hide(!0),this.deactivateSpin(),this.hint&&this.always&&this.hint.hide(),e.prototype.onBeforeFullscreenOut.call(this,t),this.isInited&&this.isInView&&this.isSlideShown&&(this.isHidden=!0,this.canvas.setCss({opacity:0,visibility:"hidden"}))},a.onAfterFullscreenOut=function(t){var i=this;if(this.infoSize&&(this.canvasPromise&&this.canvasPromise.isPending()&&this.canvasPromise.resolve(),this.currentSize=s.spinLib.calcProportionSize(this.coreNode.size,this.infoSize),this.getDPPX(this.currentSize),this.standardSize.width=this.currentSize.width,this.standardSize.height=this.currentSize.height,this.currentImageSize.width=this.currentSize.width,this.currentImageSize.height=this.currentSize.height,this.setCanvasSize(),this.ready&&(this.imagesMap.isImagesExist({width:this.currentSize.width,height:this.currentSize.height})||this.imagesMap.loadImages({width:this.currentSize.width,height:this.currentSize.height,dppx:this.dppx})),this.firstImageLoaded&&this.draw(),this.isHidden&&(this.isHidden=!1,setTimeout((function(){i.destroyed||i.canvas.setCss({opacity:"",visibility:""})}),0)),e.prototype.onAfterFullscreenOut.call(this,t),this.ready)){this.animate("inactive"),l.browser.mobile||this.showHint();var n=+new Date;this.sendStats("fullscreenClose",n-this.sessionStartTime,{duration:n-this.fullscreenStartTime})}},a.play=function(t,e){var i=!1;return this.ready&&!this.isZoomed()&&(this.isAutoplayPaused=!1,this.stopSmoothing(),this.stopAnimation(),this.instanceOptions.checkValue("autospin.duration",t)||(t=null),this.instanceOptions.checkValue("autospin.type",e)||(e=null),this.animate("autoplay",t,e),i=!0),i},a.pause=function(){var t=!1;return this.ready&&!this.isZoomed()&&(this.isAutoplayPaused=!0,this.stopSmoothing(),this.stopAnimation(),this.animateWithDelay(),t=!0),t},a.rotate=function(t,e){var i=!1,n=function(t){return t?"string"===l.typeOf(t)&&(t=parseInt(t,10),isNaN(t)&&(t=0)):t=0,t};return this.ready&&(t=n(t),e=n(e),0===t&&0===e||(this.stopAnimation(),this.stopSmoothing(),this.isDragMove||(this.sendEvent("rotate"),this.sendStats("rotate",+new Date-this.sessionStartTime,{}),this.animate({cols:t,rows:e},l.U,l.U,!0),i=!0))),i},a.jumpTo=function(t,e){var i=!1,n=null;return this.ready&&("string"===l.typeOf(t)&&(t=t.trim(),n=/^-/.test(t)?"prev":"next"),t=parseInt(t,10),isNaN(t)||(i=this.imagesMap.jump(e,t,n))&&this.firstImageLoaded&&(this.sendEvent("rotate"),this.sendStats("rotate",+new Date-this.sessionStartTime,{}),this.draw())),i},a.zoomIn=function(){return!(!this.ready||!this.zoom||this.isDragMove||!this.isFullscreenActionEnded())&&this.openLens()},a.zoomOut=function(){return!(!this.ready||!this.zoom)&&this.zoom.hide()},a.getCurrentFrame=function(){if(this.ready){var t=this.imagesMap.getCurrentImage({width:this.currentSize.width,height:this.currentSize.height});return{row:t.row+1,column:t.col+1}}return!1},a.setCallback=function(t,e){return!!this.ready&&(this.option(t,e),!0)},a.setImageSize=function(){this.currentImageSize.width=this.currentSize.width,this.currentImageSize.height=this.currentSize.height},a.isZoomSizeExist=function(){var t=!1;if(this.option("zoom.enable")){var e=this.currentImageSize;this.zoomSize.originWidth-e.width>=100&&(t=!0)}return t},a.onResize=function(){if(this.fullscreenState===i.FULLSCREEN.OPENING||!this.isStarted)return!1;var t=this.fullscreenState===i.FULLSCREEN.OPENED;return this.stopSmoothing(),this.option("autospin.enable")?this.animationCloud.pause():this.stopAnimation(),this.boxBoundaries=this.coreNode.rect,this.currentSize=s.spinLib.calcProportionSize(m(this.coreNode.node.parentNode).size,this.infoSize,t,this.standardSize),this.getDPPX(this.currentSize),this.standardSize.width=this.currentSize.width,this.standardSize.height=this.currentSize.height,this.setImageSize(),this.setCanvasSize(),this.calcMinSizeForDrag(),this.isZoomSizeExist()?this.coreNode.addClass(i.CSS_CURSOR_ZOOM_IN):this.coreNode.removeClass(i.CSS_CURSOR_ZOOM_IN),this.zoom&&this.zoom.onResize(),this.imagesMap.isImagesExist({width:this.currentSize.width,height:this.currentSize.height})||this.imagesMap.loadImages({width:this.currentSize.width,height:this.currentSize.height,dppx:this.dppx}),this.firstImageLoaded&&this.draw(),this.ready&&this.hotspots&&(this.hotspots.containerSize=this.canvasContainer.node.getBoundingClientRect(),this.hotspots.updateAndShow()),this.resizeAnimationTimer(),!0},a.getContainerForBoundengClientRect=function(){return this.canvasContainer},a.destroy=function(){return this.instanceNode.removeEvent("touchmove",L),l.W.removeEvent("resize",this.windowResizeCallback),clearTimeout(this.resizeWindowTimer),this.isInited&&this.sendStats("sessionEnd",+new Date-this.sessionStartTime,{message:"Stopped"}),this.coreNode.removeEvent(["btnclick","tap"]),this.coreNode.del("instance"),this.resizeAnimationTimer.cancel(),this.resizeAnimationTimer=null,this.touchDragCloud&&(this.touchDragCloud.removeEvent(),this.touchDragCloud=null),this.placeholder&&this.placeholder.setCssProp("display",""),this.keyPressHandlerForShiftButton&&(l.W.removeEvent(["keydown","keyup"],this.keyPressHandlerForShiftButton),this.keyPressHandlerForShiftButton=null),this.cssId>-1&&(l.removeCSS(this.id+"-css",this.cssId),l.$(this.id+"-css").remove()),this.cssId=-1,this.initNameEvent&&this.coreNode.removeEvent(this.initNameEvent,this.initFnEvent),this.activatedCurtain&&this.activatedCurtain.destroy(),this.stopSmoothing(),this.stopAnimation(),this.hint&&(this.hint.destroy(),this.hint=null),this.coreNode.removeEvent(["mousedrag","touchdrag","pinch"]),this.loader&&(this.loader.destroy(),this.loader=null),this.imagesMap&&(this.imagesMap.destroy(),this.imagesMap=null,this.off("mapFirstImageLoaded"),this.off("mapImagesReady"),this.off("mapImageLoaded"),this.off("mapAllImagesLoaded")),this.clearCanvas(),this.canvas&&(this.canvas.removeEvent("transform"),this.canvas.removeClass(this.zoomClassName),this.canvas.remove()),this.canvasContainer.removeEvent("transform"),this.canvasContainer.removeEvent("mouseover"),this.canvasContainer.removeEvent("mouseout"),this.canvasContainer.remove(),this.canvasContainer=null,this.ctx=null,this.canvas=null,this.loadedImages=[],this.off("isSingleSlide"),this.off("zoomUp"),this.off("zoomDown"),this.off("frameChange"),this.coreNode.remove(),this.infoSize=null,this.startLoadingTime=null,this.isInited=!1,this.openedImg=null,this.coreNode=null,this.firstUserInteraction=!1,this.animationCloud&&(clearTimeout(this.animationCloud.hintTimer),this.animationCloud=null),this.lastImg=null,this.hotspotsData=null,e.prototype.destroy.call(this),!0},t.createClass(o,[{key:"rightAlt",get:function(){return!this.dataAlt&&this.meta&&this.meta.description?this.meta.description:this.dataAlt}},{key:"imageClassContainer",get:function(){return this.imagesMap}},{key:"zoomSize",get:function(){var t=this.option("zoom.ratio"),e=this.infoSize.width,i=this.infoSize.height,n={width:e,height:i};return"max"!==t&&(n.width=this.currentImageSize.width*t,n.height=this.currentImageSize.height*t,n=r.roundImageSize(n)),n.width=Math.min(e,n.width),n.height=Math.min(i,n.height),{width:n.width,height:n.height,originWidth:e,originHeight:i}}},{key:"originImageUrl",get:function(){return this.ready?this.imagesMap.originImageUrl:null}},{key:"orientation",get:function(){return this.imagesMap.getHintType()}}]),o}(a)}));