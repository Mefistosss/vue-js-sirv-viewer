{"version":3,"sources":["../sirv-modules/globalFunctions.js"],"names":["Sirv","define","bHelpers","magicJS","globalVariables","helper","Promise","moduleName","$J","$","adjustURLProto","url","result","replace","test","sanitizeURLComponent","str","decodeURIComponent","ex","encodeURIComponent","sanitizeURL","match","proto","uri","split","map","index","join","RootDOM","CSSMap","sirvNodesMap","WeakMap","rootNodesMap","Map","rootNodes","sirvCSSSrc","mainCSSID","getShadowDOM","node","parent","parentNode","window","ShadowRoot","rootContains","some","root","D","body","contains","addModuleCSSByName","functionOfCssString","id","position","getRootNode","shadowDOM","rootNode","has","set","isResetCSSAdded","isVideoCSSAdded","isSirvAdAdded","styles","modulesCss","isShadowDOM","push","attachNode","detachNode","delete","addCSSStringToHtml","addCSSString","head","get","rootObject","shadowRoot","objEach","key","value","addCss","addMainStyleToHtml","resetGlobalCSS","addStyle","SIRV_ASSETS_URL","CSS_RULES_ID","addMainStyle","querySelector","resolve","reject","_shadowRoot","loadStylesheet","then","catch","addCSS","display","width","height","margin","showSirvAd","targetNode","landing","desc","location","hostname","crId","Math","floor","random","now","BRAND_LOGO","src","visibility","transform","left","top","bottom","right","padding","opacity","el","$new","href","target","attr","setCss","overflow","appendTo","addEvent","e","stopDistribution","W","open","append","setProps","alt","GLOBAL_FUNCTIONS","rootDOM","viewerFilters","getNodeWithSirvClassName","hasClass","iconsHash","nodes","elements","classes","attrs","name","waitBody","document","setTimeout","make","forEach","data","reverse","className","addClass","i","l","length","finally","remove","adjustURL","SIRV_BASE_URL","normalizeURL"],"mappings":"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","sourcesContent":["Sirv.define(\n    'globalFunctions',\n    ['bHelpers','magicJS','globalVariables','helper','Promise!'],\n    (bHelpers,magicJS,globalVariables,helper,Promise) => {\n        const moduleName = 'globalFunctions';\n        \n        const $J = magicJS;\n        const $ = $J.$;\n        \n        \n        /* eslint-env es6 */\n/* global $ */\n/* global $J */\n/* global globalVariables */\n/* global helper */\n/* eslint-disable no-restricted-syntax */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n/* eslint-disable no-unused-vars */\n\n\n// const SIRV_CSS = {\n//     src: 'viewer.css',\n//     state: -1\n// };\n\nconst adjustURLProto = (url) => {\n    let result = url.replace(/^(https?:)?/, 'https:');\n\n    if (/^(http(s)?:)?\\/\\/[^/]+?sirv\\.localhost(:\\d+)?\\/.*$/i.test(url)) { // dev env on localhost\n        result = url.replace(/^(https?:)?/, 'http:');\n    }\n\n    return result;\n};\n\nconst sanitizeURLComponent = (str) => {\n    try {\n        str = decodeURIComponent(str);\n    } catch (ex) { /* empty */ }\n    return encodeURIComponent(str);\n};\n\nconst sanitizeURL = (url) => {\n    return url.replace(/^((?:https?:)?\\/\\/)([^/].*)/, function (match, proto, uri) {\n        return proto + uri.split('/').map(function (str, index) {\n            if (index === 0) {\n                return str;\n            }\n            return sanitizeURLComponent(str);\n        }).join('/');\n    });\n};\n\nclass RootDOM {\n    constructor() {\n        this.CSSMap = {};\n        this.sirvNodesMap = new WeakMap();\n        this.rootNodesMap = new Map();\n        this.rootNodes = []; // ie11 does not support this.rootNodesCollection.keys()\n        this.sirvCSSSrc = 'viewer.css';\n        this.mainCSSID = 'sirv-stylesheet-sirv';\n    }\n\n    static getShadowDOM(node /* Element which has 'Sirv' class name */) {\n        node = $(node).node;\n        let result = false;\n        const parent = node.parentNode;\n\n        if (parent && window.ShadowRoot) {\n            if (parent instanceof window.ShadowRoot) {\n                result = parent;\n            } else {\n                result = RootDOM.getShadowDOM(parent);\n            }\n        }\n\n        return result;\n    }\n\n\n    rootContains(node) {\n        return this.rootNodes.some((root) => {\n            if (root === $J.D.node) {\n                root = $J.D.node.body;\n            }\n\n            if (root) {\n                return root.contains(node);\n            }\n\n            return false;\n        });\n    }\n\n    addModuleCSSByName(moduleName, functionOfCssString, id, position) {\n        if (!this.CSSMap[moduleName]) {\n            this.CSSMap[moduleName] = {\n                functionOfCssString: functionOfCssString,\n                id: id,\n                position: position\n            };\n        }\n    }\n\n    getRootNode(node /* Element which has 'Sirv' class name */) {\n        node = $(node).node;\n        const shadowDOM = RootDOM.getShadowDOM(node);\n        const rootNode = shadowDOM || $J.D.node;\n\n        if (!this.rootNodesMap.has(rootNode)) {\n            this.rootNodesMap.set(rootNode, {\n                isResetCSSAdded: false,\n                isVideoCSSAdded: false,\n                isSirvAdAdded: false,\n                styles: {},\n                modulesCss: {},\n                isShadowDOM: !!shadowDOM\n            });\n\n            this.rootNodes.push(rootNode);\n        }\n\n        return rootNode;\n    }\n\n    /*\n        Attach node to root node\n    */\n    attachNode(node /* Element which has 'Sirv' class name */) {\n        node = $(node).node;\n        if (!this.sirvNodesMap.has(node)) {\n            const rootNode = this.getRootNode(node);\n            this.sirvNodesMap.set(node, rootNode);\n        }\n    }\n\n    /*\n        Detach node from root node\n    */\n    detachNode(node /* Element which has 'Sirv' class name */) {\n        node = $(node).node;\n        return this.sirvNodesMap.delete(node);\n    }\n\n    addCSSStringToHtml() {\n        this.addCSSString($J.D.node.head || $J.D.node.body);\n    }\n\n    addCSSString(node /* Element which has 'Sirv' class name */) {\n        if (!node) { node = $J.D.node.head || $J.D.node.body; }\n        node = $(node).node;\n\n        const root = this.sirvNodesMap.get(node);\n        const rootObject = this.rootNodesMap.get(root);\n\n        let shadowRoot = null;\n        if (rootObject.isShadowDOM) {\n            shadowRoot = root;\n        }\n\n        helper.objEach(this.CSSMap, (key, value) => {\n            if (!rootObject.modulesCss[key]) {\n                rootObject.modulesCss[key] = 1;\n                helper.addCss(value.functionOfCssString(), value.id, value.position, shadowRoot, '#' + this.mainCSSID);\n            }\n        });\n    }\n\n    addMainStyleToHtml() {\n        this.resetGlobalCSS($J.D.node.head || $J.D.node.body);\n        this.addStyle($J.D.node.head || $J.D.node.body, globalVariables.SIRV_ASSETS_URL + this.sirvCSSSrc, this.mainCSSID, '#' + globalVariables.CSS_RULES_ID);\n    }\n\n    addMainStyle(node /* Element which has 'Sirv' class name */) {\n        this.addMainStyleToHtml();\n        this.resetGlobalCSS(node);\n        return this.addStyle(node, globalVariables.SIRV_ASSETS_URL + this.sirvCSSSrc, this.mainCSSID, '#' + globalVariables.CSS_RULES_ID);\n    }\n\n    addStyle(node /* Element which has 'Sirv' class name */, url, id, querySelector) {\n        node = $(node).node;\n        const root = this.sirvNodesMap.get(node);\n        const rootObject = this.rootNodesMap.get(root);\n\n        if (!rootObject.styles[id]) {\n            rootObject.styles[id] = new Promise((resolve, reject) => {\n                let _shadowRoot = null;\n                if (rootObject.isShadowDOM) {\n                    _shadowRoot = root;\n                }\n\n                helper.loadStylesheet(url, id, _shadowRoot, querySelector)\n                    .then(resolve)\n                    .catch(reject);\n            });\n        }\n\n        return rootObject.styles[id];\n    }\n\n    resetGlobalCSS(node /* Element which has 'Sirv' class name */) {\n        if (!node) { node = $J.D.node.head || $J.D.node.body; }\n        node = $(node).node;\n\n        const root = this.sirvNodesMap.get(node);\n        const rootObject = this.rootNodesMap.get(root);\n\n        if (rootObject.isResetCSSAdded) { return; }\n        rootObject.isResetCSSAdded = true;\n\n        let shadowRoot = null;\n        if (rootObject.isShadowDOM) {\n            shadowRoot = root;\n        }\n\n        $J.addCSS('.smv', {\n            display: 'flex !important'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.smv.smv-selectors-top', {\n            'flex-direction': 'column-reverse'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.smv.smv-selectors-left', {\n            'flex-direction': 'row-reverse'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.smv.smv-selectors-right', {\n            'flex-direction': 'row'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.smv.smv-selectors-bottom', {\n            'flex-direction': 'column'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.smv-slides-box', {\n            'flex-grow': 1,\n            'flex-shrink': 1\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('figure > .Sirv', {\n            'vertical-align': 'top'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv > iframe, .Sirv > video', {\n            'display': 'none'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        // Hide custom thumbnail content until the viewer initialized.\n        $J.addCSS(':not(.smv) smv-thumbnail', {\n            'display': 'none'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv, .Sirv .smv-component', {\n            '-webkit-box-sizing': 'border-box !important',\n            '-moz-box-sizing': 'border-box !important',\n            'box-sizing': 'border-box !important'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('div.Sirv, div.Sirv div.smv-component, figure.Sirv, div.smv-component', {\n            width: '100%',\n            height: '100%',\n            margin: 0,\n            'text-align': 'center'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        // It was added in 'fix video empty height' commit\n        // I do not know why I added it, but it break Sirv if block where Sirv is has height. See test/zoom-test.html\n        // $J.addCSS('div.Sirv', {\n        //     'block-size': 'auto'\n        // }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('div.Sirv', {\n            'max-height': '100%',\n            'block-size': 'inherit'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv img', {\n            'width': '100%',\n            'height': '100%'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        // ResponsiveImage\n        $J.addCSS('img.Sirv, .Sirv img', { 'max-width': '100%' }, globalVariables.CSS_RULES_ID, shadowRoot);\n        $J.addCSS('img.Sirv:not([width]):not([height])', { 'width': '100%' }, globalVariables.CSS_RULES_ID, shadowRoot);\n        $J.addCSS('img.Sirv', {\n            'display': 'inline-block',\n            'font-size': 0,\n            'line-height': 0\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv.smv-bg-image.smv-bg-contain, .Sirv.smv-bg-image.smv-bg-cover', {\n            'background-repeat': 'no-repeat',\n            'background-position': 'center',\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv.smv-bg-image.smv-bg-contain', {\n            'background-size': 'contain'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('.Sirv.smv-bg-image.smv-bg-cover', {\n            'background-size': 'cover'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        // $J.addCSS('img.Sirv[width], .Sirv img[width], img.Sirv[height], .Sirv img[height]', {\n        //     'max-width': 'none'\n        // }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('img.Sirv:not([src]), img.Sirv.sirv-image-loading:not([src])', {\n            'opacity': '0',\n            // 'transition': 'opacity 0.5s linear'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS('img.Sirv.sirv-image-loaded', {\n            'opacity': '1',\n            'transition': 'opacity 0.5s linear'\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n    }\n\n    showSirvAd(node /* Element which has 'Sirv' class name */, targetNode, landing, desc) {\n        if (/^my.sirv.(com|localhost)$/i.test($J.D.node.location.hostname)) { // do not show Ad inside web app\n            return;\n        }\n\n        if (!node) { node = $J.D.node.head || $J.D.node.body; }\n        node = $(node).node;\n\n        const root = this.sirvNodesMap.get(node);\n        const rootObject = this.rootNodesMap.get(root);\n\n        let shadowRoot = null;\n        if (rootObject.isShadowDOM) {\n            shadowRoot = root;\n        }\n\n        const crId = 'sirvCR' + Math.floor(Math.random() * $J.now());\n\n        const BRAND_LOGO = {\n            width: 90,\n            height: 18,\n            src: 'data:image/png;base64,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'\n        };\n\n        $J.addCSS('#' + crId, {\n            display: 'inline-block !important;',\n            visibility: 'visible !important;',\n            'z-index': '2147483647 !important;',\n            width: 'auto !important;',\n            height: 'auto !important;',\n            'max-width': 'none !important;',\n            'max-height': 'none !important;',\n            transform: 'none !important;',\n            left: 'auto !important;',\n            top: 'auto !important;',\n            bottom: '8 !important;',\n            right: '8 !important;',\n            margin: 'auto !important',\n            padding: '0 !important',\n            opacity: '1 !important;',\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        $J.addCSS(('#crSirv' + crId) + ' > img', {\n            display: 'inline-block !important;',\n            visibility: 'visible !important;',\n            position: 'static !important;',\n            width: '90px !important;',\n            height: '18px !important;',\n            'max-width': 'none !important;',\n            'max-height': 'none !important;',\n            transform: 'none !important;',\n            margin: '0 !important',\n            padding: '0 !important',\n        }, globalVariables.CSS_RULES_ID, shadowRoot);\n\n        const el = $J.$new('a', { id: crId, href: landing, target: '_blank' });\n        el.attr('style', 'position: absolute !important; opacity: 1 !important');\n        el.setCss({\n            display: 'inline-block',\n            overflow: 'hidden',\n            visibility : 'visible',\n            'font-size': 0,\n            'font-weight': 'normal',\n            'font-family': 'sans-serif',\n            bottom: 8,\n            right: 8,\n            margin: 'auto',\n            width: 'auto',\n            height: 'auto',\n            transform: 'none',\n            'z-index': 2147483647\n        }).appendTo(targetNode)\n            .addEvent('tap btnclick', (e) => {\n                e.stopDistribution();\n                $J.W.node.open(el.attr('href'));\n            })\n            .append(\n                $J.$new('img', BRAND_LOGO).setProps({ alt: desc })\n            );\n    }\n}\n\nconst GLOBAL_FUNCTIONS = {\n    rootDOM: new RootDOM(),\n\n    viewerFilters: [],\n\n    getNodeWithSirvClassName: (node) => {\n        let result = null;\n\n        if (node) {\n            node = $(node);\n            if (node.hasClass('Sirv')) {\n                result = node.node;\n            } else {\n                result = GLOBAL_FUNCTIONS.getNodeWithSirvClassName(node.node.parentNode);\n            }\n        }\n\n        return result;\n    },\n\n    iconsHash: {\n        nodes: [],\n        elements: [\n            [\n                { classes: ['smv-arrow-control'] },\n                { classes: ['smv-arrow'] },\n                { classes: ['smv-icon'] }\n            ],\n            [\n                { classes: ['smv-button-fullscreen-open'] },\n                { classes: ['smv-icon'] }\n            ],\n            [\n                { classes: ['smv-button-fullscreen-close'] },\n                { classes: ['smv-icon'] }\n            ],\n            [\n                { classes: ['smv-thumbnails'] },\n                { classes: ['smv-selector'], attrs: [{ name: 'data-type', value: 'spin' }] }\n            ]\n        ],\n\n        waitBody: () => {\n            return new Promise((resolve, reject) => {\n                const body = document.body;\n\n                if (body) {\n                    resolve(body);\n                } else {\n                    setTimeout(function () {\n                        GLOBAL_FUNCTIONS.iconsHash.waitBody().then(resolve);\n                    }, 16);\n                }\n            });\n        },\n\n        make: () => {\n            GLOBAL_FUNCTIONS.iconsHash.elements.forEach((data) => {\n                const elements = [];\n                data.reverse().forEach((el) => {\n                    const node = $J.$new('div');\n                    if (el.classes) {\n                        el.classes.forEach((className) => {\n                            node.addClass(className);\n                        });\n                    }\n\n                    if (el.attrs) {\n                        el.attrs.forEach((attr) => {\n                            node.attr(attr.name, attr.value);\n                        });\n                    }\n\n                    elements.push(node);\n                });\n\n                for (let i = 1, l = elements.length; i < l; i++) {\n                    elements[i].append(elements[i - 1]);\n                }\n\n                GLOBAL_FUNCTIONS.iconsHash.nodes.push(elements[elements.length - 1]);\n            });\n\n            GLOBAL_FUNCTIONS.iconsHash.nodes.forEach((el) => {\n                el.setCss({\n                    top: '-10000px',\n                    left: '-10000px',\n                    width: '10px',\n                    height: '10px',\n                    position: 'absolute',\n                    visibility: 'hodden',\n                    opacity: 0\n                });\n\n                GLOBAL_FUNCTIONS.iconsHash.waitBody().finally(() => { $J.$($J.D.node.body).append(el); });\n            });\n        },\n\n        remove: () => {\n            if (GLOBAL_FUNCTIONS.iconsHash.nodes.length) {\n                GLOBAL_FUNCTIONS.iconsHash.nodes.forEach((el) => { el.remove(); });\n                GLOBAL_FUNCTIONS.iconsHash.nodes = [];\n            }\n        }\n    },\n\n    adjustURL: (url) => {\n        if (!/^(http(s)?:)?\\/\\//.test(url)) {\n            url = globalVariables.SIRV_BASE_URL + url;\n        }\n        return adjustURLProto(url).replace(/([^:])\\/+/g, '$1/');\n    },\n\n    normalizeURL(url) {\n        return sanitizeURL(adjustURLProto(url));\n    }\n};\n\nGLOBAL_FUNCTIONS.rootDOM.attachNode($J.D.node.head || $J.D.node.body);\n\nreturn GLOBAL_FUNCTIONS;\n\n    }\n);\n"],"file":"globalFunctions.js"}