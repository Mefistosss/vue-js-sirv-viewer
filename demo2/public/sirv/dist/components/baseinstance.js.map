{"version":3,"sources":["../classes/baseinstance.js"],"names":["Sirv","define","bHelpers","magicJS","EventEmitter","helper","moduleName","$J","$","DEFAULT_PREFIX","BaseInstance","node","options","defaultSchema","instanceNode","instanceUrl","attr","option","_isReady","id","isCustomId","isStartedFullInit","isStarted","destroyed","referrerPolicy","instanceOptions","makeOptions","createOptionFunction","api","isReady","bind","resize","getOptions","setOptions","optInstance","common","local","fromJSON","fromString","makeGlobalOptions","optionsInstance","o","makeMobileOptions","mobile","Options","browser","touchScreen","getOptionsForStartFullInit","getJSON","onResize","getImageClassContainer","checkImage","setts","dontLoad","result","imageClass","isExist","isLoaded","getId","idPrefix","df","generateUUID","trim","length","set","get","startFullInit","getOriginImageUrl","run","done","destroy","removeAttr"],"mappings":"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","sourcesContent":["Sirv.define(\n    'BaseInstance',\n    ['bHelpers','magicJS','EventEmitter','helper'],\n    (bHelpers,magicJS,EventEmitter,helper) => {\n        const moduleName = 'BaseInstance';\n        \n        const $J = magicJS;\n        const $ = $J.$;\n        \n        \n        /* eslint-env es6 */\n/* eslint-disable indent */\n/* global EventEmitter, helper */\n/* eslint-disable class-methods-use-this */\n/* eslint-disable no-unused-vars */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n\n\nconst DEFAULT_PREFIX = 'smv-';\n\nclass BaseInstance extends EventEmitter {\n    constructor(node, options, defaultSchema) {\n        super();\n\n        this.defaultSchema = defaultSchema;\n        this.options = options;\n        this.instanceNode = $(node);\n        this.instanceUrl = this.instanceNode.attr('data-src') || this.instanceNode.attr('src') || this.instanceNode.attr('data-bg-src');\n        this.option = null;\n        this._isReady = false;\n        this.id = null;\n        this.isCustomId = false;\n        this.isStartedFullInit = false;\n        this.isStarted = false;\n        this.destroyed = false;\n        this.referrerPolicy = this.instanceNode.attr('data-referrerpolicy') || this.instanceNode.attr('referrerpolicy') || 'no-referrer-when-downgrade';\n        this.instanceOptions = this.makeOptions();\n        this.createOptionFunction();\n\n        this.api = {\n            isReady: this.isReady.bind(this),\n            resize: this.resize.bind(this),\n            getOptions: this.getOptions.bind(this)\n        };\n    }\n\n    setOptions(optInstance, common, local, attr) {\n        optInstance.fromJSON(common);\n        optInstance.fromString(local);\n        optInstance.fromString(attr);\n\n        return optInstance;\n    }\n\n    makeGlobalOptions(optionsInstance) {\n        const o = this.options.options;\n        return this.setOptions(optionsInstance, o.common.common, o.local.common, this.instanceNode.attr('data-options') || '');\n    }\n\n    makeMobileOptions(optionsInstance) {\n        const o = this.options.options;\n        return this.setOptions(optionsInstance, o.common.mobile, o.local.mobile, this.instanceNode.attr('data-mobile-options') || '');\n    }\n\n    makeOptions() {\n        let options = new $J.Options(this.defaultSchema);\n\n        options = this.makeGlobalOptions(options);\n        if ($J.browser.touchScreen && $J.browser.mobile) {\n            options = this.makeMobileOptions(options);\n        }\n\n        return options;\n    }\n\n    getOptionsForStartFullInit(options) {\n        if (options) {\n            this.options.options = options;\n            this.instanceOptions = this.makeOptions();\n            this.createOptionFunction();\n        }\n    }\n\n    isReady() {\n        return this._isReady;\n    }\n\n    getOptions() {\n        return this.instanceOptions.getJSON();\n    }\n\n    resize() {\n        if (this._isReady) {\n            return this.onResize();\n        }\n\n        return false;\n    }\n\n    onResize() { return true; }\n\n    getImageClassContainer() {\n        return {};\n    }\n\n    checkImage(setts, dontLoad) {\n        let result;\n        const imageClass = this.getImageClassContainer();\n        if (dontLoad) {\n            result = imageClass.isExist(setts); // because we do not load images with imageclass\n        } else {\n            result = imageClass.isLoaded(setts);\n        }\n\n        return result;\n    }\n\n    getId(idPrefix, df) {\n        this.id = this.instanceNode.attr('id');\n\n        if (!this.id) {\n            this.isCustomId = true;\n            if (!idPrefix) { idPrefix = 'component-'; }\n            if (!df) { df = DEFAULT_PREFIX; }\n            this.id = df + idPrefix + helper.generateUUID();\n            this.id = this.id.trim();\n            this.instanceNode.attr('id', this.id);\n        }\n    }\n\n    createOptionFunction() {\n        this.option = (...args) => {\n            if (args.length > 1) {\n                return this.instanceOptions.set(args[0], args[1]);\n            }\n\n            return this.instanceOptions.get(args[0]);\n        };\n    }\n\n    startFullInit(options) {\n        if (this.destroyed || this.isStartedFullInit) { return; }\n        this.isStartedFullInit = true;\n        this.getOptionsForStartFullInit(options);\n    }\n\n    getOriginImageUrl() {}\n\n    // instance 'start' metod rename to 'run'\n    run() {\n        if (!this.isStarted) {\n            this.isStarted = true;\n            return true;\n        }\n\n        return false;\n    }\n\n    done() {\n        this._isReady = true;\n    }\n\n    destroy() {\n        this.destroyed = true;\n        this.isStarted = false;\n        this._isReady = false;\n        this.isStartedFullInit = false;\n\n        if (this.isCustomId) {\n            this.instanceNode.removeAttr('id');\n            this.isCustomId = false;\n        }\n\n        this.instanceNode = null;\n\n        super.destroy();\n    }\n}\n\nreturn BaseInstance;\n\n    }\n);\n"],"file":"baseinstance.js"}