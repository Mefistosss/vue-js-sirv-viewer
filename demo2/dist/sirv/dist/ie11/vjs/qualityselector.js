Sirv.define("qualitySelector",["bHelpers"],(function(t){var e=videojs.getComponent("MenuItem"),i=function(e){"use strict";function i(t,i){var l;return i.selectable=!0,i.multiSelectable=!1,(l=e.call(this,t,i)||this)._label=i.label,l._value=i.value,l}t.inheritsLoose(i,e);var l=i.prototype;return l.handleClick=function(t){if(!this.isSelected_){var i=this.player().hlsQualitySelectorAutoMode,l=i.currentSelection();e.prototype.handleClick.call(this,t),l&&l!==this&&l.selected(!1),i.setQualityAndButtonLabel(this._value,!0)}},l.dispose=function(){this._label="",this._value=0,this.isSelected_=!1,e.prototype.dispose.call(this)},t.createClass(i,[{key:"isSelected",get:function(){return this.isSelected_}},{key:"label",get:function(){return this._label}},{key:"value",get:function(){return this._value}}]),i}(e);e.registerComponent("QualitySelectorMenuItem",i);var l=videojs.getComponent("MenuButton"),n=videojs.getComponent("Menu"),s=function(e){"use strict";function l(t,i){var l;return i.title=t.localize("Quality"),i.name=t.localize("QualityButton"),(l=e.call(this,t,i)||this).levelItems=[],l.canShow()?l.show():l.hide(),l}t.inheritsLoose(l,e);var s=l.prototype;return s.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelEl_=videojs.dom.createEl("div",{className:"vjs-quality-button-auto-mode-label",innerHTML:"auto"}),t.appendChild(this.labelEl_),t},s.buildCSSClass=function(){return e.prototype.buildCSSClass.call(this)+" vjs-quality-button-auto-mode-button"},s.buildWrapperCSSClass=function(){return e.prototype.buildWrapperCSSClass.call(this)+" vjs-quality-button-auto-mode"},s.createMenu=function(){var t=this,e=new n(this.player());return(this.levelItems||[]).forEach((function(l){e.addItem(new i(t.player(),{label:l.label,value:l.value,selected:l.selected}))})),e},s.currentSelection=function(){return this.menu&&this.menu.children().find((function(t){return t.isSelected}))||null},s.setDysplayedQuality=function(){var t=this.currentSelection();t&&(this.labelEl_.innerHTML=t.label)},s.canShow=function(){var t,e,i=null!=(t=null==(e=this.levelItems)?void 0:e.length)?t:0;return!!(this.options_.visibility&&this.levelItems&&(this.levelItems.length>1&&"auto"!==this.levelItems[i-1].value||this.levelItems.length>2))},s.show=function(){this.canShow()&&e.prototype.show.call(this)},s.update=function(){e.prototype.update.call(this),this.setDysplayedQuality()},s.dispose=function(){this.levelItems=[],e.prototype.dispose.call(this)},t.createClass(l,[{key:"newItems",set:function(t){this.levelItems=t}},{key:"quality",set:function(t){this.menu.children().find((function(e){return e.value===t})).handleClick()}}]),l}(l);l.registerComponent("QualitySelectorMenuButton",s);var a=videojs.getPlugin("plugin"),u={visibility:!0},r=videojs.registerPlugin||videojs.plugin,o=function(e){"use strict";function i(i,l){var n;return(n=e.call(this,i)||this).options=l,n.menuButton=null,n.isAuto=!0,n.minHeight=Number.MAX_SAFE_INTEGER,n.minDiffBitrate=Number.MAX_SAFE_INTEGER,n.hlsSources=l.hls||[],n.onAddQualityLevelHandler=n.onAddQualityLevel.bind(t.assertThisInitialized(n)),n.onQualityLevelChangeHandler=n.onQualityLevelChange.bind(t.assertThisInitialized(n)),n.vhs=n.player.tech({IWillNotUseThisInPlugins:!0}).vhs,n.isVHS=n.player.qualityLevels&&n.vhs,n.currentStreamHeight=0,n.levelItems=null,n.playPromise=null,n.firstPlay=!0,n.lastHLSHeight=null,n.min=n.options.min,n.max=n.options.max,n.isVHS?(n.createQualityButton(),n.bindPlayerEvents()):n.hlsSources.length&&(n.isAuto=!1,n.createQualityButton(),n.createHLSLevels()),n}t.inheritsLoose(i,e);var l=i.prototype;return l.bindPlayerEvents=function(){var t=this.player.qualityLevels();t.on("addqualitylevel",this.onAddQualityLevelHandler),t.on("change",this.onQualityLevelChangeHandler)},l.onQualityLevelChange=function(){this.menuButton.setDysplayedQuality()},l.getCurrentStreamHeight=function(){this.levelItems&&(this.currentStreamHeight=function(t,e){var i=e[0].value,l=e.length-1,n=l-1;if(n>-1&&(i=e[n].value,"auto"===e[n].value&&(n-=1)),l>2)for(var s=n-1;s>=0&&t>e[s+1].value;s--){if(t<=e[s].value){i=Math.abs(e[s+1].value-t)<Math.abs(e[s].value-t)?e[s+1].value:e[s].value;break}i=e[s].value}return i}(this.player.currentHeight(),this.levelItems),this.currentStreamHeight<this.min&&(this.currentStreamHeight=this.min),this.currentStreamHeight>this.max&&(this.currentStreamHeight=this.max))},l.createQualityButton=function(){this.menuButton=new s(this.player,{visibility:this.options.visibility});var t=this.player.controlBar.options_.children.length-2;this.player.controlBar.addChild(this.menuButton,{componentClass:"qualitySelector"},t)},l.createLevelItems=function(t){var e=t.map((function(t){return t.height}));this.min=Math.min(Math.max.apply(Math,e),this.options.min),this.max=Math.max(Math.min.apply(Math,e),this.min,this.options.max),this.minHeight=this.min;var i=e.sort((function(t,e){return e-t})).map((function(t){return{label:t+"p",value:t,selected:!1}}));return i.length>1&&i.push({label:"auto",value:"auto",selected:!1}),i},l.setAndGetSelectedItem=function(t){this.getCurrentStreamHeight();var e=t[t.length-1];return e.selected=!0,this.isAuto="auto"===e.value,e},l.createHLSLevels=function(){this.levelItems=this.createLevelItems(this.hlsSources);var t=this.setAndGetSelectedItem(this.levelItems);this.setQualityHLS(t.value),this.menuButton.newItems=this.levelItems,this.menuButton.update()},l.onAddQualityLevel=function(){var t=this.player.qualityLevels().levels_||[];this.levelItems=this.createLevelItems(t),this.setAndGetSelectedItem(this.levelItems),this.setQuality(null,!0),this.menuButton.newItems=this.levelItems,this.menuButton.update()},l.setQualityHLS=function(t){var e=this,i=this.player,l=null;if("auto"===t&&(t=this.currentStreamHeight),t!==this.lastHLSHeight){for(var n=0,s=this.hlsSources.length;n<s;n++)if(t===this.hlsSources[n].height){l=this.hlsSources[n];break}if(l){if(this.playPromise){try{this.playPromise.reject()}catch(t){}this.playPromise=null}var a=i.currentTime(),u=i.paused();i.src({src:this.options.host+l.index,type:"application/x-mpegURL"}),this.lastHLSHeight=t,this.firstPlay||(this.playPromise=this.player.play(),this.playPromise.catch((function(t){e.playPromise=null}))),i.one("loadedmetadata",(function(){a&&(e.player.currentTime(a),e.player.handleTechSeeked_()),u&&(e.firstPlay=!1,e.playPromise&&e.playPromise.then((function(){e.player.pause(),e.playPromise=null})).catch((function(t){e.playPromise=null})))}))}}},l.setQuality=function(t,e){var i=this.player.qualityLevels();if(e&&null!==t)for(var l=i.length-1;l>=0;l--)l!==i.selectedIndex&&(i[l].enabled=!1);for(var n=0,s=i.length;n<s;n++){var a=i[n];a.enabled=e?a.height>=this.min&&a.height<=this.max:a.height===t}},l.setQualityAndButtonLabel=function(t,e){e&&(this.isAuto="auto"===t),this.isVHS?this.isAuto?this.setQuality(t,!0):this.setQuality(t):this.setQualityHLS(t),this.menuButton.setDysplayedQuality(),this.menuButton.unpressButton()},l.currentSelection=function(){return this.menuButton.currentSelection()},l.recalc=function(){this.getCurrentStreamHeight(),this.isAuto&&this.setQualityAndButtonLabel(this.currentStreamHeight)},l.dispose=function(){if(this.isVHS){var t=this.player.qualityLevels();t.off("addqualitylevel",this.onAddQualityLevelHandler),t.off("change",this.onQualityLevelChangeHandler)}try{e.prototype.dispose.call(this)}catch(t){}},i}(a),h=function(t){var e=this;this.ready((function(){!function(t,e){t.hlsQualitySelectorAutoMode=new o(t,e)}(e,videojs.mergeOptions(u,t))}))};return r("hlsQualitySelectorAutoMode",h),h}));