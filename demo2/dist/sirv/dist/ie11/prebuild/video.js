Sirv.define("Video",["bHelpers","magicJS","globalVariables","globalFunctions","helper","EventEmitter","Instance","defaultsVideoOptions"],(function(e,i,t,s,o,n,a,r){var l,h,d,c,v,u,p,m,y,f,g,S,b,j,E,w=i;w.$;return s.rootDOM.addModuleCSSByName("Video",(function(){return".smv-sirv-video .js-focus-visible .vjs-menu li.vjs-menu-item:hover,.smv-sirv-video .js-focus-visible .vjs-menu li.vjs-selected:hover,.smv-sirv-video .vjs-menu li.vjs-menu-item:focus,.smv-sirv-video .vjs-menu li.vjs-menu-item:hover,.smv-sirv-video .vjs-menu li.vjs-selected,.smv-sirv-video .vjs-menu li.vjs-selected:focus,.smv-sirv-video .vjs-menu li.vjs-selected:hover{background-color:transparent;color:inherit}.smv-sirv-video .vjs-playback-rate .vjs-playback-rate-value,.smv-sirv-video .vjs-quality-selector .vjs-icon-placeholder{font-size:1.2em;line-height:2.5em;pointer-events:none}.smv-sirv-video.video-js .vjs-big-play-button,.smv-sirv-video.video-js .vjs-control-bar,.smv-sirv-video.video-js .vjs-menu-button .vjs-menu-content,.smv-sirv-video.video-js .vjs-volume-vertical{background-color:rgba(55,58,60,.8)}.smv-sirv-video{position:relative;top:0;left:0;width:100%!important;height:100%!important}.smv-sirv-video :focus{outline:0}.smv-sirv-video .vjs-poster{background-color:transparent}.smv-sirv-video .vjs-button{display:inline-block;transition:none;border:0!important;background:0 0;color:inherit;font-size:inherit;line-height:inherit;text-decoration:none;text-transform:none;appearance:none}.smv-sirv-video .vjs-big-play-button{top:50%;left:50%;width:1.2em;height:1.2em;margin-top:-.6em;margin-left:-.6em;border:.04em solid transparent;border-radius:1em;color:inherit!important;font-size:5em;letter-spacing:0!important;line-height:1.2em;box-shadow:none}.smv-sirv-video:hover .vjs-big-play-button{border-color:transparent}.smv-sirv-video.vjs-controls-disabled .vjs-big-play-button,.smv-sirv-video.vjs-has-started .vjs-big-play-button{display:block;transition:opacity .25s}.smv-sirv-video.vjs-has-started.vjs-playing .vjs-big-play-button{opacity:0;pointer-events:none}.smv-sirv-video.vjs-has-started.vjs-paused .vjs-big-play-button{opacity:1}.smv-sirv-video .vjs-quality-selector .vjs-icon-placeholder{line-height:1}.smv-sirv-video.video-js{background-color:transparent;color:#fff;font-size:10px}.smv-sirv-video.video-js:not(.vjs-has-started) .vjs-tech{opacity:.001}.smv-sirv-video.video-js .vjs-control-bar :last-child .vjs-menu{left:100%;transform:translateX(-100%)}.smv-sirv-video.video-js .vjs-control-bar .vjs-control{color:inherit!important;box-shadow:none}.smv-sirv-video.video-js .vjs-control-bar .vjs-control .vjs-icon-placeholder{font-family:VideoJS;font-style:normal;font-weight:400;line-height:1}.smv-sirv-video.video-js .vjs-control-bar .vjs-control.vjs-quality-selector,.smv-sirv-video.video-js .vjs-control-bar .vjs-control.vjs-resolution{margin-right:.4em}.smv-sirv-video.video-js.vjs-has-started .vjs-control-bar{transition:visibility .2s,opacity .2s}.smv-sirv-video.video-js .vjs-menu-button{padding:0}.smv-sirv-video.video-js .vjs-slider{background-color:rgba(255,255,255,.2)}.smv-sirv-video.video-js .vjs-progress-control .vjs-progress-holder{transform:scaleY(.6);transition:transform .1s cubic-bezier(.4,0,1,1);font-size:1.6666666667em}.smv-sirv-video.video-js .vjs-progress-control .vjs-play-progress::before{transform:scale(0);transition:transform .1s cubic-bezier(.4,0,1,1)}.smv-sirv-video.video-js .vjs-progress-control:hover .vjs-play-progress::before,.smv-sirv-video.video-js .vjs-progress-control:hover .vjs-progress-holder{transform:none}.smv-sirv-video.video-js .vjs-load-progress{background-color:transparent}.smv-sirv-video.video-js .vjs-load-progress div{background:rgba(255,255,255,.4)}.smv-sirv-video.video-js .vjs-menu{left:50%;width:8em;transform:translateX(-50%)}.smv-sirv-video.video-js .vjs-menu .vjs-menu-item{padding:.6em .6em .3em;font-size:1.2em;text-align:left;text-transform:none}.smv-sirv-video.video-js .vjs-menu .vjs-menu-item~.vjs-menu-item{padding-top:.3em}.smv-sirv-video.video-js .vjs-menu .vjs-menu-item::before{padding:0 1em;font-family:VideoJS;font-size:.66em;content:'\\f111';opacity:0}.smv-sirv-video.video-js .vjs-menu .vjs-menu-item.vjs-selected::before{opacity:1}.smv-sirv-video.video-js .vjs-volume-panel .vjs-volume-control.vjs-volume-vertical{transition:visibility .1s,opacity .1s,height .1s,width .1s,left 0s,top 0s}:root:not(.mobile-magic) .smv-sirv-video.video-js.vjs-has-started:not(:hover) .vjs-control-bar{opacity:0}.smv-disabled-action .vjs-tech{pointer-events:none!important}.smv-disabled-action .vjs-poster{pointer-events:none!important}.smv .vjs-quality-selector .vjs-menu-content .vjs-menu-title{display:none}.smv .smv-q-last .vjs-quality-selector .vjs-menu,.smv .smv-s-last .vjs-playback-rate .vjs-menu{right:0;left:auto!important;transform:none!important}"})),h=[.5,1,1.5,2],d=(l="smv")+"-disabled-action",c="https://video.sirv.com",v=l+"-q-last",u=l+"-s-last",p=50*w.DPPX,m=0,y=1,f=2,g=4,S=5,b=6,j=function(e){return s.loadCssFile(e,t.SIRV_ASSETS_URL+"vjs/sirv.videojs.css","sirv-stylesheet-vjs")},E=function(){return s.loadJsFile(t.SIRV_ASSETS_URL+"vjs/qualityselector.js")},function(i){"use strict";function n(e,o){var n;(n=i.call(this,e,o,r)||this).type=t.SLIDE.TYPES.VIDEO,n.url=n.instanceNode.attr("data-src"),n.info=null,n.HLS=[],n.currentSize={width:0,height:0},n.videoNode=null,n.areSourcesAdded=!1,n.indexOfCurrentHls=0,n.player=null,n.thumbnail=n.option("thumbnail"),n.currentTime=0,n.isVideoPaused=!1,n.fps=30,n.pluginResizeDebounce=null,n.playPromise=null,n.posterSize=null,n.lastAction=m,n.isPlayed=!1,n.isEnded=!1,n.playingState=t.VIDEO.NONE,n.nativeFullscreen=o.nativeFullscreen;var a=s.normalizeURL(n.url.replace(t.REG_URL_QUERY_STRING,"$1")),l=n.url.replace(t.REG_URL_QUERY_STRING,"$2");return n.url=a,l&&(n.url+="?"+l),n.disableAction(),n.isLoadeddata=!1,n.controlsFullscreen=n.option("controls.fullscreen"),n.getInfo(),n}e.inheritsLoose(n,i);var a=n.prototype;return a.normalizeOptions=function(){var e=this.option("quality.min");e>this.option("quality.max")&&this.option("quality.max",e)},a.getSelectorImgUrl=function(e){var i=this;return new Promise((function(t,s){var o=e.width||e.height,n=i.url.split("?")[0]+"?thumbnail="+o;w.DPPX>1&&(n=i.url.split("?")[0]+"?thumbnail="+o*w.DPPX+"&quality=60"),isNaN(parseFloat(i.thumbnail))||(n=i.getThumbnailPoster(n));var a={src:n,callbackData:e.callbackData};w.DPPX>1&&(a.srcset=n),i.getInfo().then((function(){t(a)})).catch(s)}))},a.disableAction=function(){this.always&&[t.FULLSCREEN.CLOSED,t.FULLSCREEN.CLOSING].includes(this.fullscreenState)&&this.instanceNode.addClass(d)},a.enableAction=function(){this.always&&this.instanceNode.removeClass(d)},a.getInfo=function(){var e=this;return this.gettingInfoPromise||(this.gettingInfoPromise=new Promise((function(i,t){e.waitGettingInfo.wait((function(){var s=e.url,n=w.getHashCode(e.url.split("?")[0].replace(/^http(s)?:\/\//,""));/\?/.test(s)?s+="&":s+="?",s+="info=sirv_video_info_"+n+"_main",o.getRemoteData(s,"video_info_"+o.generateUUID(),e.referrerPolicy).then((function(t){e.destroyed||(e.info=t,e.info.QuickTime&&e.info.QuickTime.VideoFrameRate&&(e.fps=e.info.QuickTime.VideoFrameRate),e.HLS=e.info.original.HLS||[],e.HLS.length>1&&e.HLS.sort((function(e,i){var t=0;return e.width<i.width?t=-1:e.width>i.width?t=1:e.height<i.height?t=-1:e.height>i.height&&(t=1),t})),e.infoSize={width:e.info.original.width,height:e.info.original.height},i(e.infoSize))})).catch((function(i){e.destroyed||t(i)}))}))}))),this.gettingInfoPromise},a.getInfoSize=function(){var e=this;return new Promise((function(i,t){e.getInfo().then((function(){i({size:e.infoSize})})).catch((function(e){t({error:e})}))}))},a.addSources=function(){var e,i=this,o=s.getNodeWithSirvClassName(this.instanceNode)||w.D.node.head||w.D.node.body;Promise.all([j(w.D.node.head||w.D.node.body),j(o),(e=o,s.loadCssFile(e,t.SIRV_ASSETS_URL+"vjs/qualityselector.css","sirv-stylesheet-vjs-quality-selector","#"+s.rootDOM.mainCSSID)),s.loadJsFile(t.SIRV_ASSETS_URL+"vjs/sirv.videojs.js").then(E)]).finally((function(){window.Sirv.require("qualitySelector",(function(){i.areSourcesAdded=!0,i.isStarted&&i.isInView&&(i.preload||i.isSlideShown)&&i.createVideoNode()}))}))},a.onStartActions=function(e){this.ready?this.player&&this.isInView&&(this.fullscreenState===t.FULLSCREEN.OPENED&&this.always&&this.option("controls.enable")&&(this.player.controlBar.show(),this.player.bigPlayButton.show()),!this.option("autoplay")||!this.player.paused()||this.fullscreenState!==t.FULLSCREEN.OPENED&&this.always||(this.player.muted(!0),this.isPlayed?this.lastAction=g:e===t.SLIDE_SHOWN_BY.USER&&(this.lastAction=y),this.play())):this.isStarted&&this.isInView&&this.isSlideShown&&!this.preload&&this.areSourcesAdded&&this.createVideoNode()},a.onStopActions=function(){this.player&&(this.player.paused()||this.playingState!==t.VIDEO.PLAYING||(this.lastAction=b,this.pause()))},a.onInView=function(e){e?this.ready?this.player&&this.isSlideShown&&e&&(this.option("autoplay")||this.playingState!==t.VIDEO.NONE&&!this.isVideoPaused)&&(this.lastAction=f,this.play()):this.isStarted&&!this.isInView&&(this.preload||this.isSlideShown)&&this.areSourcesAdded&&(this.isInView=!0,this.createVideoNode()):this.player&&(this.isVideoPaused=this.playingState===t.VIDEO.PAUSE,this.player.paused()||this.playingState!==t.VIDEO.PLAYING||(this.lastAction=S,this.pause()))},a.startFullInit=function(e){this.isStartedFullInit||(i.prototype.startFullInit.call(this,e),this.normalizeOptions(),this.thumbnail=this.option("thumbnail"),this.getId("video-"),this.instanceNode.addClass("sirv-video"),this.instanceNode.addEvent("mousedown",(function(e){e.stop()})))},a.onBeforeFullscreenIn=function(e){this.controlsFullscreen=!1,this.player&&(this.isVideoPaused=this.playingState===t.VIDEO.PAUSE,this.toggleFullscreenButton())},a.onAfterFullscreenIn=function(e){this.enableAction(),this.isSlideShown&&this.isInView&&this.player&&this.player.paused()&&(this.always&&this.option("controls.enable")&&(this.player.controlBar.show(),this.player.bigPlayButton.show()),this.option("autoplay")&&!this.isVideoPaused&&(this.player.currentTime(this.currentTime),this.playingState=t.VIDEO.PLAY,this.player.play_()))},a.onBeforeFullscreenOut=function(e){this.disableAction(),this.option("controls.fullscreen")&&(this.controlsFullscreen=!0),this.player&&(this.isVideoPaused=this.playingState===t.VIDEO.PAUSE,this.toggleFullscreenButton())},a.onAfterFullscreenOut=function(e){this.isSlideShown&&this.isInView&&this.player&&(this.always&&this.option("controls.enable")&&(this.player.controlBar.hide(),this.player.bigPlayButton.hide()),this.option("autoplay")&&!this.isVideoPaused&&(this.lastAction=y,this.play()))},a.onSecondSelectorClick=function(){this.player&&this.isSlideShown&&this.isInView&&(this.fullscreenState!==t.FULLSCREEN.OPENED&&this.always||(this.player.paused()?(this.lastAction=y,this.play()):this.playingState===t.VIDEO.PLAYING&&this.isLoadeddata&&this.pause()))},a.createVideoNode=function(){this.videoNode||(this.videoNode=w.$new("video",{class:l+"-sirv-video",preload:"none"}),this.videoNode.addClass("video-js"),this.instanceNode.append(this.videoNode),this.waitToStart.start(),this.done())},a.play=function(){this.player&&!this.playPromise&&(this.playingState=t.VIDEO.PLAY,this.playPromise=this.player.play())},a.pause=function(){var e=this;this.player&&(this.playPromise||new Promise((function(e){return e(null)}))).then((function(){e.player.pause(),e.playPromise=null})).catch((function(){e.player.pause(),e.playPromise=null}))},a.loadContent=function(){this.createVideoNode()},a.run=function(e,t,s){var o=i.prototype.run.call(this,e,t,s);return o&&(this.calcContainerSize(),this.isInView&&(this.preload||this.isSlideShown)&&this.areSourcesAdded&&this.createVideoNode(),this.startGettingInfo()),o},a.createMasterManifest=function(){var e=this,i=["#EXTM3U"],t=this.option("motionFactor"),s=this.option("dynamicAdaptiveStreaming");return this.HLS.forEach((function(o){var n,a,r,l="#EXT-X-STREAM-INF:PROGRAM-ID=1,";s&&(l+="BANDWIDTH="+(n=o,a=e.fps,r=t,parseInt(n.width*n.height*a*r*.07,10)+",")),l+="RESOLUTION="+o.width+"x"+o.height,i.push(l),i.push(c+o.index)})),i.join("\n")},a.toggleFullscreenButton=function(){var e=this.player.controlBar.getChild("FullscreenToggle"),i=this.player.options_.userActions;this.controlsFullscreen?(i.doubleClick=!0,e.show()):(i.doubleClick=!1,e.hide())},a.isHLS=function(){return this.HLS.length>0&&"ie"!==w.browser.uaName},a.getThumbnailSize=function(){var e=this.isHLS()?this.HLS[this.HLS.length-1].height:this.info.height||this.info.original.height||140,i=e;return this.currentSize.height<i&&(i=this.currentSize.height),(i*=w.DPPX)>e&&(i=e),i},a.done=function(){var e=this;if(!this.ready){this.posterSize=this.getThumbnailSize();var s=this.posterUrl,n={inline:!1};!1===this.option("controls.volume")&&(n=!1);var a={nativeTextTracks:!1,nativeAudioTracks:!1,nativeVideoTracks:!1},r=this.isHLS(),l={overrideNative:r&&"safari"!==w.browser.uaName};a.smoothQualityChange=!0,a.vhs=l;var d={controls:this.option("controls.enable"),fluid:!1,muted:0===this.option("volume")||this.option("autoplay"),loop:this.option("loop"),autoplay:this.option("autoplay")&&this.isSlideShown,preload:this.option("autoplay")||this.option("preload")?"auto":"none",textTrackSettings:!1,controlBar:{fullscreenToggle:!0,volumePanel:n,muteToggle:!1,children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","remainingTimeDisplay","volumePanel","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},poster:s,playsinline:!0,html5:a,userActions:{doubleClick:!0},qualityLevels:{}};if(this.option("controls.quality")?this.instanceNode.addClass(v):this.option("controls.speed")&&this.instanceNode.addClass(u),this.option("controls.speed")&&(d.playbackRates=h),r)this.player=w.W.node.videojs(this.videoNode.node,d),"safari"!==w.browser.uaName&&this.player.src({src:"data:application/x-mpegURL;base64,"+window.btoa(this.createMasterManifest()),type:"application/x-mpegURL"}),this.player.hlsQualitySelectorAutoMode({visibility:this.option("controls.quality"),hls:this.HLS,host:c,max:this.option("quality.max"),min:this.option("quality.min")}),this.pluginResizeDebounce=o.debounce((function(){e.player.hlsQualitySelectorAutoMode.recalc()}),600);else{d.src=this.url;var p=function(e){switch(e=(e=(e=(e=(e=e||"").split("?")[0]).split("."))[e.length-1]).toLowerCase()){case"3gp":e="video/3gpp";break;case"flv":e="video/flv";break;case"mp4":e="video/mp4";break;case"ogv":e="video/ogg";break;case"webm":e="video/webm";break;default:e=""}return e}(this.url);this.videoNode.append(w.$new("source",{src:this.url,type:p})),this.player=videojs(this.videoNode.node,d)}this.player.volume(parseInt(this.option("volume"),10)/100),this.toggleFullscreenButton(),this.player.on("loadeddata",(function(){e.isLoadeddata=!0})),this.player.on("play",(function(){if(e.isVideoPaused=!1,e.playingState=t.VIDEO.PLAYING,e.isSlideShown&&e.isInView){var i="user";e.lastAction===f?i="viewport":e.lastAction===y?i="autoplay":e.lastAction===g&&(i="itemchange"),e.lastAction=m,e.isPlayed?e.sendEvent("resume",{event:{reason:i,playbackTime:e.player.currentTime()}}):(e.isPlayed=!0,e.sendEvent("play",{event:{reason:i}}))}else e.lastAction=S,e.pause()})),this.player.on("pause",(function(){if(e.player.currentTime()!==e.player.duration()){e.playingState=t.VIDEO.PAUSE;var i="user";e.lastAction===S?i="viewport":e.lastAction===b&&(i="itemchange"),e.lastAction=m,e.sendEvent("pause",{event:{reason:i,playbackTime:e.player.currentTime()}})}})),this.player.on("ended",(function(){e.isPlayed=!1,e.isEnded=!0,e.playingState=t.VIDEO.PAUSE,e.sendEvent("end")})),this.player.on("fullscreenchange",(function(){var i="fullscreenOut";e.player.isFullscreen()&&(i="fullscreenIn"),e.sendEvent(i,{event:{playbackTime:e.player.currentTime()}})}));var j=null,E=0,N=0;this.player.on("timeupdate",(function(){E=N,N=e.player.currentTime()})),this.player.on("seeking",(function(){null===j&&(j=E)})),this.player.on("seeked",(function(){e.isEnded?e.isEnded=!1:e.sendEvent("seek",{event:{seekStart:j,seekEnd:e.player.currentTime()}}),j=null})),this.player.on("error",(function(e){console.log("error",e)})),w.browser.touchScreen&&w.browser.mobile&&this.player.on("touchstart",(function(i){"video"===w.$(i.target).tagName&&e.player.hasClass("vjs-user-active")&&(e.player.paused()?(e.lastAction=y,e.play()):e.pause())})),this.player.on("ready",(function(){e.option("controls.fullscreen")||e.player.off(e.player.tech_,"dblclick",e.player.handleTechDoubleClick_),e.option("controls.enable")&&e.fullscreenState!==t.FULLSCREEN.OPENED&&e.always&&(e.player.controlBar.hide(),e.player.bigPlayButton.hide()),e.isSlideShown&&e.isInView&&e.option("autoplay")&&(e.fullscreenState!==t.FULLSCREEN.OPENED&&e.always||(e.player.muted(!0),e.lastAction=y,e.play(),e.player.muted(!0))),i.prototype.done.call(e),e.sendContentLoadedEvent()}))}},a.getThumbnailPoster=function(e){var i=e;if(i||(i=""),this.thumbnail||0===this.thumbnail){var t=parseFloat(this.thumbnail);!isNaN(t)&&t<this.info.original.duration?i+="&video.thumbPos="+this.thumbnail:/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/i.test(this.thumbnail)&&(i=this.thumbnail)}return i},a.calcContainerSize=function(){var e=this.instanceNode.size;if(e.height&&e.width)this.currentSize=e;else{var i={width:0,height:0};i.width=this.info.original.width,i.height=this.info.original.height,e.height?(this.currentSize.height=e.height,this.currentSize.width=i.width/i.height*e.height):(this.currentSize.width=e.width,this.currentSize.height=i.height/i.width*e.width)}},a.createPinchEvent=function(){var e=this;i.prototype.createPinchEvent.call(this,this.instanceNode),this.pinchCloud.onPinchStart=function(i){[t.FULLSCREEN.OPENING,t.FULLSCREEN.CLOSING].includes(e.fullscreenState)||(e.pinchCloud.pinch=!0,e.pinchCloud.scale=i.scale,e.sendEvent("pinchStart"))},this.pinchCloud.onPinchMove=function(i){if(e.pinchCloud.pinch&&!e.pinchCloud.block){var s=i.scale-e.pinchCloud.scale;e.fullscreenState===t.FULLSCREEN.OPENED?s<-.08&&(e.pinchCloud.block=!0,e.sendEvent("fullscreenOut")):i.scale>=.11&&(e.pinchCloud.block=!0,e.sendEvent("fullscreenIn"))}}},a.onResize=function(){if(this.player){if(this.isSlideShown&&this.isInView||this.player.paused()||this.playingState!==t.VIDEO.PLAYING||this.pause(),this.pluginResizeDebounce&&this.pluginResizeDebounce(),this.playingState===t.VIDEO.NONE){this.calcContainerSize();var e=this.getThumbnailSize();e>this.posterSize&&e-this.posterSize>=p&&(this.posterSize=e,this.player.poster(this.posterUrl))}return!0}return!1},a.destroy=function(){return this.player&&(this.player.off(),this.player.dispose(),this.player=null),this.videoNode&&(this.videoNode.remove(),this.videoNode=null),this.pluginResizeDebounce&&(this.pluginResizeDebounce.cancel(),this.pluginResizeDebounce=null),this.instanceNode.clearEvents(),this.instanceNode.removeClass("sirv-video"),this.instanceNode.removeClass(d),this.instanceNode.removeClass(v),this.instanceNode.removeClass(u),this.playPromise=null,this.HLS=[],i.prototype.destroy.call(this),!0},e.createClass(n,[{key:"posterUrl",get:function(){return this.getThumbnailPoster(this.url.split("?")[0]+"?thumbnail="+this.posterSize)}}]),n}(a)}));