{"version":3,"sources":["../classes/imageclass.js"],"names":["Sirv","define","bHelpers","magicJS","globalVariables","globalFunctions","Promise","helper","EventEmitter","moduleName","$J","$","requestCORSIfNotSameOrigin","img","url","URL","origin","W","location","crossOrigin","getUrl","settings","result","paramsToQueryString","cleanQueryString","_Image","name","srcSettings","srcsetSettings","dontLoad","referrerPolicy","state","imageNode","size","width","height","loader","callbacks","dppx","profile","src","srcset","load","resolve","reject","Image","attr","addEvent","e","stop","node","naturalWidth","naturalHeight","browser","uaName","correct","scale","setSrc","setSrcset","isLoading","destroy","_TileImage","tileName","splitOptions","imageSettings","extend","JSON","parse","stringify","parseInt","crop","getOriginUrl","source","split","toPercentageString","v","toFixed","getImageName","hash","replace","sort","getHashCode","join","getPropFromCrop","obj","mixSettings","info","defaultImageSettings","deepExtend","processingSettings","cropSettings","canvas","canvasSettings","frame","frameSettings","option","INFO","IMAGE_INFO","RImage","o","typeOf","type","infoId","generateUUID","round","convertSmallerSideToZero","loadNewImage","imageInfoPromise","images","originUrl","getAbsoluteURL","infoUrl","roundImageSize","originSize","tmp","Number","MAX_VALUE","roundSize","Math","floor","_convertImageSettings","setSize","getClearSizeWithoutProcessingSettings","hasOwnProperty","getOriginSize","_mixSettings","_calcProcessingSettings","viewer","original","widthScale","heightScale","x","y","border","_addImage","defined","getSettings","sett","tile","number","imageInstance","serverWidth","serverHeight","image","_load","eventName","instance","then","imgInst","someImageIsLoaded","catch","finally","someImageIsComplete","emit","data","_createImageData","callbackData","_filter","isTile","objEach","key","push","getCropPosition","test","isExist","Object","prototype","call","_getBiggerImage","isLoaded","isReady","isComplete","getImageInfo","getRemoteData","_isplaceholder","U","value","sendLoad","cancelLoadingImage","getImage","options","maxSize","exactSize","getOriginImageUrl","getProcessingSettings","cropClear","cropSettingsClear","canvasClear","canvasSettingsClear","getDescription","description","getThumbnail","DPPX","getSrc","_size","_imageSettings","text","watermark","getSize","is","r","getAccountInfo","account","branded"],"mappings":"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","sourcesContent":["Sirv.define(\n    'ResponsiveImage',\n    ['bHelpers','magicJS','globalVariables','globalFunctions','Promise!','helper','EventEmitter'],\n    (bHelpers,magicJS,globalVariables,globalFunctions,Promise,helper,EventEmitter) => {\n        const moduleName = 'ResponsiveImage';\n        \n        const $J = magicJS;\n        const $ = $J.$;\n        \n        \n        /* eslint-env es6 */\n/* global Promise */\n/* global helper */\n/* eslint-disable indent */\n/* eslint-disable no-lonely-if*/\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n\n\n/*\n    Image class\n        params:\n            name - name of image\n            url - image url,\n            srcSettings - settings which has current image\n            srcsetSettings - x2 settings which has current image\n*/\n\n// eslint-disable-next-line no-unused-vars\nconst requestCORSIfNotSameOrigin = (img, url) => {\n    if ((new URL(url)).origin !== $J.W.location.origin) {\n        img.crossOrigin = '';\n    }\n};\n\nconst getUrl = (url, settings) => {\n    // let result = url + ('?' + paramsToQueryString(settings).replace(/(?:\\?|&)profile\\=$/, ''));\n    let result = url + ('?' + helper.paramsToQueryString(settings));\n    result = helper.cleanQueryString(result);\n    return result;\n};\n\n// eslint-disable-next-line no-unused-vars\nclass _Image {\n    constructor(name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy) {\n        this.name = name;\n        this.state = 0; // not-loaded = 0, loading = 1, loaded = 2, error = 3\n        this.imageNode = null;\n        this.size = { width: 0, height: 0 };\n        this.loader = null;\n        this.callbacks = [];\n        this.srcSettings = srcSettings;\n        this.srcsetSettings = srcsetSettings;\n        this.dontLoad = dontLoad;\n        this.dppx = this.srcsetSettings ? this.srcsetSettings.dppx : 1;\n        this.referrerPolicy = referrerPolicy;\n\n        if (srcSettings.profile === '') {\n            delete srcSettings.profile;\n        }\n\n        if (srcsetSettings && srcsetSettings.profile === '') {\n            delete srcsetSettings.profile;\n        }\n\n        this.src = getUrl(url, srcSettings);\n\n        this.srcset = null;\n        if (srcsetSettings) {\n            this.srcset = getUrl(url, srcsetSettings.settings);\n        }\n    }\n\n    load() {\n        return new Promise((resolve, reject) => {\n            if (this.dontLoad) {\n                resolve(this);\n            } else if (!this.state) {\n                this.state = 1;\n\n                this.imageNode = $(new Image());\n                this.imageNode.attr('referrerpolicy', this.referrerPolicy || 'no-referrer-when-downgrade');\n\n                this.imageNode.addEvent('load', (e) => {\n                    e.stop();\n                    this.state = 2;\n\n                    this.size = {\n                        width: this.imageNode.node.naturalWidth || this.imageNode.node.width,\n                        height: this.imageNode.node.naturalHeight || this.imageNode.node.height\n                    };\n\n                    if ($J.browser.uaName === 'safari') {\n                        let correct = false;\n                        if (this.srcSettings.scale.width) {\n                            if (this.size.width > this.srcSettings.scale.width + 5) {\n                                correct = true;\n                            }\n                        } else {\n                            if (this.size.height > this.srcSettings.scale.height + 5) {\n                                correct = true;\n                            }\n                        }\n\n                        if (correct) {\n                            this.size.width /= this.dppx;\n                            this.size.height /= this.dppx;\n                        }\n                    }\n\n                    resolve(this);\n                });\n\n                this.imageNode.addEvent('error', (e) => {\n                    e.stop();\n                    this.state = 3;\n                    this.imageNode = null;\n                    reject(this);\n                });\n\n                // requestCORSIfNotSameOrigin(this.imageNode.node, this.src);\n\n                this.setSrc();\n                this.setSrcset();\n            } else {\n                resolve(this);\n            }\n        });\n    }\n\n    setSrc() {\n        this.imageNode.node.src = this.src;\n    }\n\n    setSrcset() {\n        if (this.srcset) { // TODO because amount of tiles are different between 1x image and 1.5x image\n            // this.imageNode.node.srcset = encodeURI(this.srcset) + ' 2x';\n            // this.imageNode.node.srcset = this.srcset + ' 2x';\n            this.imageNode.node.srcset = this.srcset + ' ' + this.dppx + 'x';\n        }\n    }\n\n    isLoading() {\n        return (this.state === 1);\n    }\n\n    destroy() {\n        if (this.state === 1 && this.imageNode) {\n            this.imageNode.attr('src', 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=');\n        }\n\n        this.state = 0;\n    }\n}\n\n\n/* eslint-env es6 */\n/* global _Image */\n\n/* eslint-disable indent */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n\n// eslint-disable-next-line no-unused-vars\nclass _TileImage extends _Image {\n    constructor(name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy, tileName) {\n        super(name, url, srcSettings, srcsetSettings, dontLoad, referrerPolicy);\n        this.tileName = tileName; // name of tile\n    }\n\n    setSrc() {\n        if (this.dppx === 1) { // TODO because amount of tiles are different between 1x image and 1.5x image\n            super.setSrc();\n        }\n    }\n}\n\n/* eslint-env es6 */\n/* global _Image, _TileImage, helper, EventEmitter */\n/* eslint-disable indent */\n/* eslint-disable no-console */\n/* eslint-disable no-lonely-if */\n/* eslint no-prototype-builtins: \"off\" */\n/* eslint no-useless-escape: \"off\" */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n/* eslint class-methods-use-this: [\"off\", { \"_createImageData\": [\"error\"] }] */\n\n\n/*\n    RImage class\n    params:\n        source - sirv image url\n        o - options\n        infoId - id for info object (to save in global object IMAGE_INFO) or will be generated automatically\n\n    public functions:\n        getClearSizeWithoutProcessingSettings\n        isExist\n        isLoaded\n        isReady\n        getOriginSize\n        sendLoad\n        cancelLoadingImage\n        getImageName\n        getImage\n        getOriginImageUrl\n        getProcessingSettings\n        getThumbnail\n        destroy\n\n    public events:\n        'imageOnload' - fire when the image was loaded\n\n    example:\n    this.images = {\n        '123234345456' (it is name of image): {\n            serverWidth: 150,\n            serverHeight: 150,\n            image: _Image class\n        },\n    };\n\n*/\n\n\nconst splitOptions = (imageSettings, dppx) => {\n    const src = $J.extend({}, imageSettings);\n    let srcset;\n\n    delete src.src;\n    delete src.srcset;\n\n    src.imageSettings = $J.extend({}, imageSettings?.imageSettings || {});\n\n    if (dppx > 1) {\n        srcset = JSON.parse(JSON.stringify(src));\n        if (srcset.width) { srcset.width = parseInt(srcset.width * dppx, 10); }\n        if (srcset.height) { srcset.height = parseInt(srcset.height * dppx, 10); }\n\n        if (srcset.imageSettings.crop) {\n            if (srcset.imageSettings.crop.width) { srcset.imageSettings.crop.width = parseInt(srcset.imageSettings.crop.width * dppx, 10); }\n            if (srcset.imageSettings.crop.height) { srcset.imageSettings.crop.height = parseInt(srcset.imageSettings.crop.height * dppx, 10); }\n        }\n\n        srcset.dppx = dppx;\n    }\n\n    src.imageSettings = $J.extend(src.imageSettings, imageSettings.src);\n\n    if (srcset && imageSettings.srcset) {\n        srcset.imageSettings = $J.extend(srcset.imageSettings, imageSettings.srcset);\n    }\n\n    return { src: src, srcset: srcset };\n};\n\nconst getOriginUrl = (source) => { return source.split('?')[0]; };\nconst toPercentageString = (v) => { return (v * 100).toFixed(4) + '%'; };\n\nconst getImageName = (url) => {\n    let hash;\n    let result = null; // eslint-disable-line prefer-const, no-unused-vars\n    url = url.replace('\\?+', '?');\n    url = url.replace('&+', '&');\n\n    url = url.split('?');\n    hash = url[1];\n    url = url[0];\n\n    hash = hash.split('&');\n    hash = hash.sort();\n\n    return '' + $J.getHashCode(url + '?' + hash.join('&'));\n};\n\nconst getPropFromCrop = (obj, name) => {\n    let result = null;\n\n    if (obj && obj.crop && obj.crop[name]) {\n        result = obj.crop[name];\n    }\n\n    return result;\n};\n\nconst mixSettings = (info, defaultImageSettings, imageSettings) => {\n    let result = helper.deepExtend({}, defaultImageSettings);\n\n    if (info && info.imageSettings.processingSettings) {\n        if (!result.crop) { result.crop = {}; }\n        result.crop = helper.deepExtend(result.crop, info.cropSettings);\n\n        // if (result.crop) {\n        //     if (result.crop.width && /100(\\.0*)?%/.test(result.crop.width)) {\n        //         delete result.crop.width;\n        //     }\n\n        //     if (result.crop.height && /100(\\.0*)?%/.test(result.crop.height)) {\n        //         delete result.crop.height;\n        //     }\n        // }\n\n        if (!result.canvas) { result.canvas = {}; }\n        result.canvas = helper.deepExtend(result.canvas, info.canvasSettings);\n\n        if (!result.frame) { result.frame = {}; }\n        result.frame = helper.deepExtend(result.frame, info.frameSettings);\n\n        if (!result.scale) { result.scale = {}; }\n        if (!result.scale.option) { result.scale.option = 'fill'; }\n    }\n\n    if (imageSettings.width && imageSettings.width !== 'auto') {\n        result.scale.width = imageSettings.width;\n    }\n\n    if (imageSettings.height && imageSettings.height !== 'auto') {\n        result.scale.height = imageSettings.height;\n    }\n\n    if (imageSettings.imageSettings) {\n        result = helper.deepExtend(result, imageSettings.imageSettings);\n    }\n\n    // if (getPropFromCrop(defaultImageSettings, 'type') === 'focalpoint' || getPropFromCrop(info.imageSettings.processingSettings, 'type') === 'focalpoint') {\n    //     const x = getPropFromCrop(defaultImageSettings, 'x') || getPropFromCrop(info.imageSettings.processingSettings, 'x');\n    //     if (x) {\n    //         result.crop.x = x;\n    //     }\n\n    //     const y = getPropFromCrop(defaultImageSettings, 'y') || getPropFromCrop(info.imageSettings.processingSettings, 'y');\n    //     if (y) {\n    //         result.crop.y = y;\n    //     }\n\n    //     result.scale = {};\n    // }\n\n    return result;\n};\n\nconst INFO = 'sirv_image_info_';\nconst IMAGE_INFO = {};\n\n// eslint-disable-next-line no-unused-vars\nclass RImage extends EventEmitter {\n    constructor(source, o) {\n        super();\n\n        if ($J.typeOf(source) !== 'string') {\n            source = $(source).attr('src');\n        }\n\n        this.o = $J.extend({\n            type: 'main',\n            infoId: 'sirv-image-' + helper.generateUUID(),\n            imageSettings: {},\n            round: true,\n            dontLoad: false,\n            convertSmallerSideToZero: true,\n            referrerPolicy: 'no-referrer-when-downgrade',\n\n            /*\n                loadNewImage:\n                true - if image is missing - load image\n                false - if image is missing but if bigger image is exist give large image else load image\n            */\n            loadNewImage: false\n        }, o);\n\n        this.imageInfoPromise = null;\n\n        this.images = {};\n        this.originUrl = getOriginUrl($J.getAbsoluteURL(source));\n        this.infoUrl = this.originUrl + '?nometa&info';\n\n        this.imageSettings = $J.extend({}, this.o.imageSettings);\n    }\n\n    static roundImageSize(size, originSize) {\n        let tmp;\n\n        if (!originSize) {\n            originSize = { width: Number.MAX_VALUE, height: Number.MAX_VALUE };\n        }\n\n        if (size.width && size.height) {\n            if (size.width >= size.height) {\n                tmp = helper.roundSize(size.width);\n                if (tmp <= originSize.width) {\n                    size.height = Math.floor((size.height / size.width) * tmp);\n                    size.width = tmp;\n                }\n            } else {\n                tmp = helper.roundSize(size.height);\n                if (tmp <= originSize.height) {\n                    // size.width = Math.round((size.width / size.height) * tmp);\n                    // firefox\n                    // fix 'https://github.com/sirv/sirv.js/issues/148'\n                    // We need to use 'Math.floor' because this image 'https://demo.sirv.com/demo/vax/2759311-g.jpg?scale.option=fill&h=500' has wrong size in zoom\n                    size.width = Math.floor((size.width / size.height) * tmp);\n                    size.height = tmp;\n                }\n            }\n        } else if (size.width) {\n            tmp = helper.roundSize(size.width);\n            if (tmp <= originSize.width) {\n                size.width = tmp;\n            }\n        } else if (size.height) {\n            tmp = helper.roundSize(size.height);\n            if (tmp <= originSize.height) {\n                size.height = tmp;\n            }\n        }\n\n        return size;\n    }\n\n    _convertImageSettings(imageSettings) {\n        const setSize = (obj, size) => {\n            if (size.width) { obj.width = size.width; }\n            if (size.height) { obj.height = size.height; }\n        };\n\n        if (!imageSettings) { imageSettings = {}; }\n        imageSettings = $J.extend({}, imageSettings);\n\n        // correct tile size if we have canvas border\n        let tmp = this.getClearSizeWithoutProcessingSettings({ width: imageSettings.width, height: imageSettings.height });\n        setSize(imageSettings, tmp);\n\n        const result = splitOptions(imageSettings, imageSettings.dppx);\n\n        if (imageSettings.round || !imageSettings.hasOwnProperty('round') && this.o.round) {\n            const originSize = this.getOriginSize();\n            tmp = RImage.roundImageSize(result.src, originSize);\n            setSize(result, tmp);\n            if (result.srcset) {\n                tmp = RImage.roundImageSize(result.srcset, originSize);\n                setSize(result, tmp);\n            }\n        }\n\n        return result;\n    }\n\n    _mixSettings(settings) {\n        return mixSettings(IMAGE_INFO[this.o.infoId], this.imageSettings, settings);\n    }\n\n    _calcProcessingSettings() {\n        let info = IMAGE_INFO[this.o.infoId];\n        const cropSettings = {};\n        const canvasSettings = {};\n        const frameSettings = {};\n\n        if (!info.imageSettings.viewer) { info.imageSettings.viewer = {}; }\n        const viewer = info.imageSettings.viewer;\n\n        const originSize = {\n            width: info.imageSettings.original.width,\n            height: info.imageSettings.original.height,\n            widthScale: 1,\n            heightScale: 1\n        };\n\n        if (viewer.scale) {\n            if (viewer.scale.width) {\n                originSize.width *= viewer.scale.width;\n            }\n\n            if (viewer.scale.height) {\n                originSize.height *= viewer.scale.height;\n            }\n        }\n        originSize.widthScale = originSize.width / info.imageSettings.width;\n        originSize.heightScale = originSize.height / info.imageSettings.height;\n\n        if (viewer.crop) {\n            if (viewer.crop.width) {\n                cropSettings.width = toPercentageString(viewer.crop.width);\n            }\n\n            if (viewer.crop.height) {\n                cropSettings.height = toPercentageString(viewer.crop.height);\n            }\n\n            if (viewer.crop.x) {\n                cropSettings.x = toPercentageString(viewer.crop.x);\n            }\n\n            if (viewer.crop.y) {\n                cropSettings.y = toPercentageString(viewer.crop.y);\n            }\n        }\n\n        if (viewer.canvas) {\n            if (viewer.canvas.width) {\n                canvasSettings.width = toPercentageString(viewer.canvas.width);\n            }\n\n            if (viewer.canvas.height) {\n                canvasSettings.height = toPercentageString(viewer.canvas.height);\n            }\n\n            if (viewer.canvas.border) {\n                canvasSettings.border = {};\n                if (viewer.canvas.border.width) {\n                    canvasSettings.border.width = toPercentageString(viewer.canvas.border.width);\n                }\n\n                if (viewer.canvas.border.height) {\n                    canvasSettings.border.height = toPercentageString(viewer.canvas.border.height);\n                }\n            }\n        }\n\n        if (viewer.frame && viewer.frame.width) {\n            frameSettings.width = toPercentageString(viewer.frame.width);\n        }\n\n        info = $J.extend(info, {\n            cropSettings: cropSettings,\n            canvasSettings: canvasSettings,\n            frameSettings: frameSettings,\n            originSize: originSize\n        });\n    }\n\n    _addImage(name, imageSettings) {\n        const dontLoad = $J.defined(imageSettings.src.dontLoad) ? imageSettings.src.dontLoad : this.o.dontLoad;\n\n        const getSettings = (sett) => {\n            const result = this._mixSettings(sett);\n\n            if (result.scale && result.scale.width && result.scale.height && result.scale.option !== 'ignore') {\n                if (result.scale.width >= result.scale.height) {\n                    if (this.o.convertSmallerSideToZero) {\n                        result.scale.height = 0;\n                    }\n                } else {\n                    if (this.o.convertSmallerSideToZero) {\n                        result.scale.width = 0;\n                    }\n                }\n            }\n\n            return result;\n        };\n\n        const src = getSettings(imageSettings.src);\n        let srcset = null;\n        let tile;\n        let tileName = null;\n        if (imageSettings.src.imageSettings && imageSettings.src.imageSettings.tile) {\n            tile = imageSettings.src.imageSettings.tile;\n            tileName = tile.number + '';\n        }\n\n        if (imageSettings.srcset) {\n            srcset = {\n                dppx: imageSettings.srcset.dppx,\n                settings: getSettings(imageSettings.srcset)\n            };\n        }\n\n        let imageInstance = null;\n        if (tileName === null) {\n            imageInstance = new _Image(name, this.originUrl, src, srcset, dontLoad, this.o.referrerPolicy);\n        } else {\n            imageInstance = new _TileImage(name, this.originUrl, src, srcset, dontLoad, this.o.referrerPolicy, tileName);\n        }\n\n        this.images[name] = {\n            serverWidth: imageSettings.src.width,\n            serverHeight: imageSettings.src.height,\n            image: imageInstance\n        };\n\n        return this.images[name];\n    }\n\n    _load(name, imageSettings) {\n        const img = this._addImage(name, imageSettings);\n        let eventName;\n        let instance;\n\n        img.image.load()\n            .then((imgInst) => {\n                instance = imgInst;\n                eventName = 'imageOnload';\n\n                if (instance instanceof _Image) {\n                    this.someImageIsLoaded = true;\n                }\n            })\n            .catch((imgInst) => {\n                instance = imgInst;\n                eventName = 'imageOnerror';\n            })\n            .finally(() => {\n                if (instance instanceof _Image) {\n                    this.someImageIsComplete = true;\n                }\n\n                const image = this.images[instance.name];\n\n                if (image) {\n                    this.emit(eventName, { data: this._createImageData(image, imageSettings.src.callbackData) });\n                }\n            });\n    }\n\n    _createImageData(img, callbackData) {\n        const obj = img.image;\n        const result = {\n            callbackData: callbackData,\n            name: obj.name,\n            tileName: obj.tileName,\n            tile: obj instanceof _TileImage,\n            node: obj.imageNode,\n            serverWidth: img.serverWidth,\n            serverHeight: img.serverHeight,\n            width: obj.size.width,\n            height: obj.size.height,\n            src: obj.src,\n            srcset: obj.srcset,\n            state: obj.state,\n            dppx: obj.dppx || 1\n        };\n\n        return result;\n    }\n\n    _filter(isTile) {\n        const result = [];\n\n        helper.objEach(this.images, (key, image) => {\n            if (image.image instanceof _TileImage === !!isTile) {\n                result.push(image);\n            }\n        });\n\n        return result;\n    }\n\n    getCropPosition() {\n        const info = IMAGE_INFO[this.o.infoId];\n\n        let x = getPropFromCrop(this.imageSettings, 'x');\n        if (x && !/%$/.test(x)) {\n            x = toPercentageString(x / info.originSize.width);\n        }\n\n        let y = getPropFromCrop(this.imageSettings, 'y');\n        if (y && !/%$/.test(y)) {\n            y = toPercentageString(y / info.originSize.height);\n        }\n\n        return {\n            x: x || info.cropSettings.x,\n            y: y || info.cropSettings.y,\n            type: getPropFromCrop(this.imageSettings, 'type') || getPropFromCrop(info.imageSettings.processingSettings, 'type')\n        };\n    }\n\n    /**\n     * Is image exist with current size or more\n     *\n     * @param {Object}    Image settings object to check\n     *\n     * @returns {boolean} - Returns true if the image is exist\n     */\n    isExist(imageSettings) {\n        imageSettings = this._convertImageSettings(imageSettings);\n\n        const name = this.getImageName(imageSettings.src);\n        let result = Object.prototype.hasOwnProperty.call(this.images, name);\n\n        if (!result) {\n            if (!(imageSettings.src.imageSettings && imageSettings.src.imageSettings.tile) && imageSettings.src.width) {\n                const images = this._filter(false);\n                result = this._getBiggerImage(imageSettings.src.width, images);\n            }\n        }\n\n        return !!result;\n    }\n\n    /**\n     * Is image exist with current size\n     *\n     * @param {Object}    Image settings object to check\n     *\n     * @returns {boolean} - Returns true if the image is loaded\n     */\n\n    isLoaded(imageSettings) {\n        imageSettings = this._convertImageSettings(imageSettings);\n\n        let result = this.images[this.getImageName(imageSettings.src)];\n\n        if (result) { result = result.image.state === 2; }\n\n        return !!result;\n    }\n\n    /**\n     * Some of image is loaded\n     *\n     * @returns {boolean} - Returns true if some of image is loaded\n     */\n    isReady() {\n        return this.someImageIsLoaded;\n    }\n\n    isComplete() {\n        return this.someImageIsComplete;\n    }\n\n    /**\n     * Returns origin size of image from image info\n     *\n     * @returns {Hash} Size of the image  {width: x, height: x}\n     */\n    getOriginSize() {\n        let result = null;\n        let info = null;\n\n        if (IMAGE_INFO[this.o.infoId]) {\n            info = IMAGE_INFO[this.o.infoId].imageSettings;\n        }\n\n        if (info) {\n            let width;\n            let height;\n            if (info.processingSettings) {\n                width = info.width;\n                height = info.height;\n            } else {\n                width = info.original.width;\n                height = info.original.height;\n            }\n\n            result = {\n                width: width,\n                height: height\n            };\n        }\n\n        return result;\n    }\n\n    getImageInfo() {\n        if (!this.imageInfoPromise) {\n            this.imageInfoPromise = new Promise((resolve, reject) => {\n                let url = this.originUrl;\n                const hash = $J.getHashCode(this.infoUrl.replace(/^http(s)?:\\/\\//, ''));\n                const imageSettings = helper.paramsToQueryString(this.imageSettings);\n\n                if (imageSettings !== '') {\n                    url += ('?' + imageSettings);\n                    url += '&';\n                } else {\n                    url += '?';\n                }\n\n                url += ('nometa&info=' + INFO + hash + '_' + this.o.type);\n                url = helper.cleanQueryString(url);\n\n                helper.getRemoteData(url, 'image_info_' + helper.generateUUID(), this.o.referrerPolicy)\n                    .then((data) => {\n                        if (!data.width || data._isplaceholder) {\n                            reject(data);\n                        } else {\n                            IMAGE_INFO[this.o.infoId] = { imageSettings: data };\n                            this._calcProcessingSettings();\n                            resolve(IMAGE_INFO[this.o.infoId]);\n                        }\n                    })\n                    .catch(reject);\n            });\n        }\n\n        return this.imageInfoPromise;\n    }\n\n    _getBiggerImage(width, images, dontLoad) {\n        let result = null;\n\n        if (!width) { width = 0; }\n        if (!images) { images = this.images; }\n        if (dontLoad === $J.U) { dontLoad = this.o.dontLoad; }\n\n        helper.objEach(images, (key, value) => {\n            if (width < value.serverWidth) {\n                if ((value.image.state === 2 || dontLoad) && (!result || result.serverWidth > value.serverWidth)) {\n                    result = value;\n                }\n            }\n        });\n\n        return result;\n    }\n\n    sendLoad(imageSettings) {\n        let img;\n\n        imageSettings = this._convertImageSettings(imageSettings);\n\n        img = this.images[this.getImageName(imageSettings.src)];\n\n        if (!img) {\n            img = this._getBiggerImage(imageSettings.src.width);\n        }\n\n        this.emit('imageOnload', { data: this._createImageData(img, imageSettings.src.callbackData) });\n    }\n\n    /**\n     * Cancels loading image if it is\n     *\n     * @param {Object}    Image settings object to cansel\n     */\n    cancelLoadingImage(imageSettings) {\n        imageSettings = this._convertImageSettings(imageSettings);\n\n        const name = this.getImageName(imageSettings.src);\n        const img = this.images[name];\n\n        if (img) {\n            if (img.image.isLoading()) {\n                img.image.destroy();\n                delete this.images[name];\n            }\n        }\n    }\n\n    /**\n     * Returns image name\n     *\n     * @param {Object}    Image settings object\n     *\n     * @returns {String} name of image\n     */\n    getImageName(imageSettings) {\n        const result = getImageName(helper.cleanQueryString(this.originUrl + ('?' + helper.paramsToQueryString(this._mixSettings(imageSettings)))));\n        return result;\n    }\n\n    getClearSizeWithoutProcessingSettings(size) {\n        const result = {};\n        const info = IMAGE_INFO[this.o.infoId];\n\n        if (size.width) {\n            result.width = Math.round(size.width * info.originSize.widthScale);\n        }\n\n        if (size.height) {\n            result.height = Math.round(size.height * info.originSize.heightScale);\n        }\n\n        return result;\n    }\n\n\n    /*\n     * Returns image object if it is exist or load image if it isn't\n     *\n     * @param {Object}    Image settings object\n     *\n     * @returns {object or null} Returns image object\n\n        imageOptions {\n            width: 42,\n            height: 42,\n            round: true/false(default false) - round max size to 100\n            maxSize: true/false(default true), - if the size of image is not exist send image with bigger size\n\n            additionalImageSettings = {\n                ...\n                quality: 1,\n                tile: {}\n                ...\n            }\n        }\n    */\n    getImage(imageSettings) {\n        const options = this._convertImageSettings(imageSettings);\n        const dontLoad = $J.defined(options.src.dontLoad) ? options.src.dontLoad : this.o.dontLoad;\n\n        const name = this.getImageName(options.src);\n        let result = this.images[name];\n\n        if (!result) {\n            this._load(name, $J.extend({}, options));\n        }\n\n        if (result && result.image.state < 2 && !dontLoad) {\n            result = null;\n        }\n\n        if (!result && (options.src.maxSize || !this.o.loadNewImage)) {\n            if (options.src.exactSize) {\n                if (dontLoad) {\n                    result = this.images[name];\n                }\n            } else {\n                result = this._getBiggerImage(null, null, dontLoad);\n            }\n        }\n\n        if (result) {\n            result = this._createImageData(result, options.src.callbackData);\n        }\n\n        return result;\n    }\n\n        /**\n     * Returns origin url of image\n     *\n     * @returns {String} url\n     */\n    getOriginImageUrl() {\n        let result = null;\n\n        if (this.originUrl) {\n            result = this.originUrl;\n        }\n\n        return result;\n    }\n\n    /**\n     * Returns current processing settings\n     *\n     * @returns {object} processing settings\n     */\n    getProcessingSettings() {\n        const info = IMAGE_INFO[this.o.infoId];\n        return {\n            crop: info.cropSettings,\n            cropClear: info.cropSettingsClear,\n            canvas: info.canvasSettings,\n            canvasClear: info.canvasSettingsClear\n        };\n    }\n\n    getDescription() {\n        let result = null;\n        const info = IMAGE_INFO[this.o.infoId];\n\n        if (info) {\n            result = info.imageSettings.original.description || null;\n        }\n\n        return result;\n    }\n\n    /**\n     * Get thambnail urls (src, srcset)\n     *\n     * @param {Object}    Options for the image\n     *\n     * @returns {Object}  src, srcset and other datas\n     */\n    getThumbnail(imageSettings) {\n        let result = {\n            imageSettings: null,\n            size: null,\n            src: null,\n            srcset: null\n        };\n\n        if (IMAGE_INFO[this.o.infoId]) {\n            const options = splitOptions(imageSettings, $J.DPPX);\n            let srcset = null;\n            let convertSmallerSideToZero = this.o.convertSmallerSideToZero;\n            const originUrl = imageSettings.originUrl || this.originUrl;\n\n            const getSrc = (_size, _imageSettings) => {\n                let settings = { scale: { option: 'fill' } };\n\n                if (_size.width || _size.height) {\n                    if (_size.width && _size.height) {\n                        settings.scale.width = _size.width;\n                        settings.scale.height = _size.height;\n                    } else {\n                        const tmp = _size.width || _size.height;\n                        settings.scale.width = tmp;\n                        settings.scale.height = tmp;\n                    }\n                }\n\n                if (_size.width === _size.height) {\n                    if (imageSettings.crop) {\n                        settings.crop = {\n                            x: 'center',\n                            y: 'center',\n                            width: _size.width,\n                            height: _size.height\n                        };\n                    } else {\n                        settings.scale.option = 'fit';\n                        if (!settings.canvas) {\n                            settings.canvas = {};\n                        }\n\n                        settings.canvas.width = _size.width;\n                        settings.canvas.height = _size.height;\n                    }\n                }\n\n                if (settings.scale) {\n                    if (imageSettings.width && imageSettings.height) {\n                        if (IMAGE_INFO[this.o.infoId].imageSettings.original.width >= IMAGE_INFO[this.o.infoId].imageSettings.original.height) {\n                            if (convertSmallerSideToZero) {\n                                settings.scale.height = 0;\n                            }\n                        } else {\n                            if (convertSmallerSideToZero) {\n                                settings.scale.width = 0;\n                            }\n                        }\n                    } else if (imageSettings.width) {\n                        if (convertSmallerSideToZero) {\n                            settings.scale.height = 0;\n                        }\n                    } else if (imageSettings.height) {\n                        if (convertSmallerSideToZero) {\n                            settings.scale.width = 0;\n                        }\n                    }\n                }\n\n                if (_imageSettings) {\n                    settings = $J.extend(settings, _imageSettings);\n                }\n\n                const tmp = settings;\n                settings = {};\n                settings.imageSettings = tmp;\n                settings = this._mixSettings(settings);\n\n                if (settings.text) {\n                    delete settings.text;\n                }\n\n                if (!imageSettings.watermark && settings.watermark) {\n                    delete settings.watermark;\n                }\n\n                return helper.paramsToQueryString(settings);\n            };\n\n            const getSize = (is) => {\n                const r = {};\n\n                if (is.width) { r.width = is.width; }\n                if (is.height) { r.height = is.height; }\n\n                return r;\n            };\n\n            if (options.src.crop || (options.src.width && options.src.height)) {\n                convertSmallerSideToZero = false;\n            }\n\n            result = {\n                callbackData: imageSettings.callbackData,\n                size: getSize(options.src.imageSettings),\n                src: helper.cleanQueryString(originUrl + '?' + getSrc(getSize(options.src), options.src.imageSettings))\n            };\n\n            if ($J.DPPX > 1) {\n                srcset = getSrc(getSize(options.srcset), options.srcset.imageSettings);\n\n                if (srcset) {\n                    result.srcset = helper.cleanQueryString(originUrl + '?' + srcset);\n                }\n            }\n        }\n\n        return result;\n    }\n\n    getAccountInfo() {\n        const result = {};\n        const info = IMAGE_INFO[this.o.infoId];\n\n        if (info) {\n            result.account = info.imageSettings.account;\n            result.branded = info.imageSettings.branded;\n        }\n\n        return result;\n    }\n\n    destroy() {\n        helper.objEach(this.images, (key, img) => {\n            img.image.destroy();\n        });\n\n        this.images = {};\n        this.someImageIsLoaded = false;\n        this.someImageIsComplete = false;\n\n        if (IMAGE_INFO[this.infoId]) {\n            delete IMAGE_INFO[this.infoId];\n            this.infoId = null;\n        }\n\n        super.destroy();\n    }\n}\n\n\nreturn RImage;\n\n    }\n);\n"],"file":"imageclass.js"}