{"version":3,"sources":["../classes/emitter.js"],"names":["Sirv","define","bHelpers","magicJS","helper","moduleName","$J","$","EventObject","type","direction","data","propagation","nextCalls","emptyEvent","extend","eventType","eventDirection","stopEmptyEvent","bind","stopPropagation","stopNextCalls","stop","stopAll","copyData","result","objEach","key","value","contains","getCustomData","getDirection","isEmptyEventStopped","isPropagationStopped","isNextCallsStopped","correctName","name","defaultName","typeOf","trim","EmitterInstance","__parent","__childs","__subscribers","__NAME_OF_EMPTY_EVENT","__setChild","child","push","__removeChild","idx","indexOf","splice","setParent","parent","__removeParent","__callNext","event","__next","forEach","callbacks","i","length","Object","prototype","hasOwnProperty","call","emit","broadcast","on","fn","self","off","destroy"],"mappings":"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","sourcesContent":["Sirv.define(\n    'EventEmitter',\n    ['bHelpers','magicJS','helper'],\n    (bHelpers,magicJS,helper) => {\n        const moduleName = 'EventEmitter';\n        \n        const $J = magicJS;\n        const $ = $J.$;\n        \n        \n        /* eslint-env es6 */\n/* global helper */\n/* eslint-disable indent */\n/* eslint-disable no-console */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n\n\n// eslint-disable-next-line no-unused-vars\nclass EventObject {\n    constructor(type, direction, data) {\n        this.type = type;\n        this.direction = direction;\n\n        this.propagation = true;\n        this.nextCalls = true;\n        this.emptyEvent = true;\n\n        this.data = $J.extend(data, {\n            eventType: this.type,\n            eventDirection: this.direction,\n            stopEmptyEvent: this.stopEmptyEvent.bind(this),\n            stopPropagation: this.stopPropagation.bind(this),\n            stopNextCalls: this.stopNextCalls.bind(this),\n            stop: this.stop.bind(this),\n            stopAll: this.stopAll.bind(this)\n        });\n    }\n\n    copyData() {\n        const result = {};\n\n        helper.objEach(this.data, (key, value) => {\n            if (!$J.contains(['eventDirection', 'stopEmptyEvent', 'stopPropagation', 'stopNextCalls', 'stop', 'stopAll'], key)) {\n                result[key] = value;\n            }\n        });\n\n        return result;\n    }\n\n    getCustomData() { return this.data; }\n    getDirection() { return this.direction; }\n\n    isEmptyEventStopped() { return !this.emptyEvent; }\n    isPropagationStopped() { return !this.propagation; }\n    isNextCallsStopped() { return !this.nextCalls; }\n\n    stopEmptyEvent() { this.emptyEvent = false; }\n    stopPropagation() { this.propagation = false; }\n    stopNextCalls() { this.nextCalls = false; }\n\n    stop() {\n        this.stopPropagation();\n        this.stopEmptyEvent();\n    }\n\n    stopAll() {\n        this.stop();\n        this.stopNextCalls();\n    }\n}\n\n/* eslint-env es6 */\n/* global EventObject */\n/* eslint-disable indent */\n/* eslint-disable no-console */\n/* eslint quote-props: [\"error\", \"as-needed\", { \"keywords\": true, \"unnecessary\": false }] */\n\n\nconst correctName = (name, defaultName) => {\n    if ($J.typeOf(name) === 'string') {\n        name = name.trim();\n        if (name === '') { name = defaultName; }\n    } else {\n        name = defaultName;\n    }\n\n    return name;\n};\n\n// eslint-disable-next-line no-unused-vars\nclass EmitterInstance {\n    constructor() {\n        this.__parent = null;\n        this.__childs = $([]);\n        this.__subscribers = {};\n        this.__NAME_OF_EMPTY_EVENT = '__empty__';\n    }\n\n    __setChild(child) {\n        this.__childs.push(child);\n    }\n\n    __removeChild(child) {\n        const idx = this.__childs.indexOf(child);\n        if (idx !== -1) {\n            this.__childs.splice(idx, 1);\n        }\n    }\n\n    setParent(parent) {\n        this.__parent = parent;\n        this.__parent.__setChild(this);\n    }\n\n    __removeParent() {\n        if (this.__parent) {\n            this.__parent.__removeChild(this);\n            this.__parent = null;\n        }\n    }\n\n    __callNext(event) {\n        if (!event.isPropagationStopped()) {\n            if (event.getDirection() === 'up') {\n                if (this.__parent) {\n                    this.__parent.__next(event);\n                }\n            } else {\n                this.__childs.forEach((child) => { child.__next(event); });\n            }\n        }\n    }\n\n    __next(event) {\n        const callbacks = this.__subscribers[event.type];\n\n        event = new EventObject(event.type, event.direction, event.copyData());\n\n        if (callbacks) {\n            for (let i = 0; i < callbacks.length; i++) {\n                callbacks[i](event.getCustomData(), event, this);\n                if (event.isNextCallsStopped()) { break; }\n            }\n        }\n\n        if (Object.prototype.hasOwnProperty.call(this.__subscribers, this.__NAME_OF_EMPTY_EVENT) && !event.isEmptyEventStopped()) {\n            for (let i = 0; i < this.__subscribers[this.__NAME_OF_EMPTY_EVENT].length; i++) {\n                this.__subscribers[this.__NAME_OF_EMPTY_EVENT][i](event.getCustomData());\n            }\n        }\n\n        this.__callNext(event);\n    }\n\n    emit(type, data) { // up\n        if (!data || $J.typeOf(data) !== 'object') {\n            if ($J.typeOf(type) === 'object') {\n                data = type;\n                type = null;\n            } else {\n                data = {};\n            }\n        }\n\n        type = correctName(type, this.__NAME_OF_EMPTY_EVENT);\n\n        this.__callNext(new EventObject(type, 'up', data));\n    }\n\n    broadcast(type, data) { // down\n        if (!data || $J.typeOf(data) !== 'object') {\n            if ($J.typeOf(type) === 'object') {\n                data = type;\n                type = null;\n            } else {\n                data = {};\n            }\n        }\n\n        type = correctName(type, this.__NAME_OF_EMPTY_EVENT);\n\n        this.__callNext(new EventObject(type, 'down', data));\n    }\n\n    on(type, fn) {\n        const self = this;\n        if ($J.typeOf(type) === 'function') { fn = type; type = null; }\n        if (!fn) { return null; }\n\n        type = correctName(type, this.__NAME_OF_EMPTY_EVENT);\n\n        if (!this.__subscribers[type]) {\n            this.__subscribers[type] = [];\n        }\n\n        this.__subscribers[type].push(fn);\n\n        return () => { return self.off(type, fn); };\n    }\n\n    off(type, fn) {\n        let idx;\n        if ($J.typeOf(type) === 'function') { fn = type; type = null; }\n        type = correctName(type, this.__NAME_OF_EMPTY_EVENT);\n\n        if (!fn) {\n            delete this.__subscribers[type];\n        } else if (Object.prototype.hasOwnProperty.call(this.__subscribers, type)) {\n            idx = this.__subscribers[type].indexOf(fn);\n            if (idx !== -1) {\n                this.__subscribers[type].splice(idx, 1);\n            }\n        }\n    }\n\n    destroy() {\n        this.__removeParent();\n        this.__childs = $([]);\n        this.__subscribers = {};\n    }\n}\n\nreturn EmitterInstance;\n\n    }\n);\n"],"file":"emitter.js"}